<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>12. Utilities &#8212; Advanced Message Processing System (AMPS) C++ Developer Guide develop
 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'develop',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="13. Advanced Topics" href="advanced-topics.html" />
    <link rel="prev" title="11. Using the AMPS C Client" href="c-client.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/flag_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">12. Utilities</a><ul>
<li><a class="reference internal" href="#composite-message-types">Composite Message Types</a><ul>
<li><a class="reference internal" href="#building-composite-messages">Building Composite Messages</a></li>
<li><a class="reference internal" href="#parsing-composite-messages">Parsing Composite Messages</a></li>
<li><a class="reference internal" href="#composite-message-builder-and-composite-message-parser-samples">Composite Message Builder and Composite Message Parser Samples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nvfix-messages">NVFIX Messages</a><ul>
<li><a class="reference internal" href="#building-nvfix-messages">Building NVFIX Messages</a></li>
<li><a class="reference internal" href="#parsing-nvfix-messages">Parsing NVFIX Messages</a></li>
<li><a class="reference internal" href="#nvfix-builder-and-shredder-samples">NVFIX Builder and Shredder Samples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fix-messages">FIX Messages</a><ul>
<li><a class="reference internal" href="#building-fix-messages">Building FIX Messages</a></li>
<li><a class="reference internal" href="#parsing-fix-messages">Parsing FIX Messages</a></li>
<li><a class="reference internal" href="#fix-builder-and-shredder-samples">FIX Builder and Shredder Samples</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="c-client.html" title="previous chapter">11. Using the AMPS C Client</a></li>
      <li>Next: <a href="advanced-topics.html" title="next chapter">13. Advanced Topics</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="utilities">
<h1>12. Utilities<a class="headerlink" href="#utilities" title="Permalink to this headline">¶</a></h1>
<p>The AMPS C++ client includes a set of utilities and helper classes to
make working with AMPS easier.</p>
<div class="section" id="composite-message-types">
<h2>Composite Message Types<a class="headerlink" href="#composite-message-types" title="Permalink to this headline">¶</a></h2>
<p>The client provides a pair of classes for creating and parsing composite
message types.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">CompositeMessageBuilder</span></code> allows you to assemble the parts of a
composite message and then serialize them in a format suitable for
AMPS.</li>
<li><code class="docutils literal"><span class="pre">CompositeMessageParser</span></code> extracts the individual parts of a
composite message type</li>
</ul>
<p>For more information regarding composite message types, refer to Chapter 4.3.</p>
<div class="section" id="building-composite-messages">
<h3>Building Composite Messages<a class="headerlink" href="#building-composite-messages" title="Permalink to this headline">¶</a></h3>
<p>To build a composite message, create an instance of
<code class="docutils literal"><span class="pre">CompositeMessageBuilder</span></code>, and populate the parts. The
<code class="docutils literal"><span class="pre">CompositeMessageBuilder</span></code> copies the parts provided, in order, to the
underlying message. The builder simply writes to an internal buffer with
the appropriate formatting, and does not allow you to update or change
the individual parts of a message once they&#8217;ve been added to the
builder.</p>
<p>The snippet below shows how to build a composite message that includes a
JSON part, constructed as a string, and a binary part consisting of the
bytes from a standard <code class="docutils literal"><span class="pre">vector</span></code>.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">json_part</span><span class="p">(</span><span class="s">&quot;{</span><span class="se">\&quot;</span><span class="s">data</span><span class="se">\&quot;</span><span class="s">:</span><span class="se">\&quot;</span><span class="s">sample</span><span class="se">\&quot;</span><span class="s">}&quot;</span><span class="p">);</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">;</span>
<span class="cm">/* populate data */</span>
<span class="p">...</span>

<span class="cm">/* Create the payload for the composite message. */</span>
<span class="n">AMPS</span><span class="o">::</span><span class="n">CompositeMessageBuilder</span> <span class="n">builder</span><span class="p">;</span>

<span class="n">builder</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">json_part</span><span class="p">.</span><span class="n">str</span><span class="p">());</span>
<span class="n">builder</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span>
                   <span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>

<span class="cm">/* send the message */</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">topic</span><span class="p">(</span><span class="s">&quot;messages&quot;</span><span class="p">);</span>
<span class="n">ampsClient</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">topic</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">topic</span><span class="p">.</span><span class="n">length</span><span class="p">(),</span> <span class="n">builder</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">builder</span><span class="p">.</span><span class="n">length</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="section" id="parsing-composite-messages">
<h3>Parsing Composite Messages<a class="headerlink" href="#parsing-composite-messages" title="Permalink to this headline">¶</a></h3>
<p>To parse a composite message, create an instance of
<code class="docutils literal"><span class="pre">CompositeMessageParser</span></code>, then use the <code class="docutils literal"><span class="pre">parse()</span></code> method to parse the
message provided by the AMPS client. The CompositeMessageParser gives
you access to each part of the message as a sequence of bytes.</p>
<p>For example, the following snippet parses and prints messages that
contain a JSON part and a binary part that contains an array of doubles.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">message</span> <span class="p">:</span> <span class="n">ampsClient</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;messages&quot;</span><span class="p">))</span> <span class="p">{</span>

    <span class="n">parser</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>

    <span class="cm">/* first part is JSON */</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">json_part</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">parser</span><span class="p">.</span><span class="n">getPart</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>

    <span class="cm">/* Second part is the raw bytes for a vector&lt;double&gt; */</span>
    <span class="n">AMPS</span><span class="o">::</span><span class="n">Field</span> <span class="n">binary</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">getPart</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">vec</span><span class="p">;</span>
    <span class="kt">double</span> <span class="o">*</span><span class="n">array_start</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">binary</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
    <span class="kt">double</span> <span class="o">*</span><span class="n">array_end</span> <span class="o">=</span> <span class="n">array_start</span> <span class="o">+</span> <span class="p">(</span><span class="n">binary</span><span class="p">.</span><span class="n">len</span><span class="p">()</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>

    <span class="n">vec</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">vec</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">array_start</span><span class="p">,</span> <span class="n">array_end</span><span class="p">);</span>

    <span class="cm">/* Print the contents of the message */</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Received message with &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; parts&quot;</span>
              <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span>
              <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">json_part</span>
              <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">d</span> <span class="p">:</span> <span class="n">vec</span><span class="p">)</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">d</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Notice that the receiving application is written with explicit knowledge
of the structure and content of the composite message type.</p>
</div>
<div class="section" id="composite-message-builder-and-composite-message-parser-samples">
<h3>Composite Message Builder and Composite Message Parser Samples<a class="headerlink" href="#composite-message-builder-and-composite-message-parser-samples" title="Permalink to this headline">¶</a></h3>
<p>The C++ client distribution contains the following samples to
demonstrate <code class="docutils literal"><span class="pre">CompositeMessageBuilder</span></code> and <code class="docutils literal"><span class="pre">CompositeMessageParser</span></code>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sample Name</th>
<th class="head">Demonstrates</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps_publish_composite.cpp</span></code></td>
<td>Creating and publishing a composite
message using <code class="docutils literal"><span class="pre">CompositeMessageBuilder</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">amps_subscribe_composite.cpp</span></code></td>
<td>Receiving and parsing a composite message
using <code class="docutils literal"><span class="pre">CompositeMessageParser</span></code></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="nvfix-messages">
<h2>NVFIX Messages<a class="headerlink" href="#nvfix-messages" title="Permalink to this headline">¶</a></h2>
<p>The client provides a pair of classes for creating and parsing NVFIX
message types.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">NVFIXBuilder</span></code> allows you to assemble an NVFIX message and then
serialize them in a format suitable for AMPS.</li>
<li><code class="docutils literal"><span class="pre">FIXShredder</span></code> extracts the individual fields of a NVFIX message
type</li>
</ul>
<div class="section" id="building-nvfix-messages">
<h3>Building NVFIX Messages<a class="headerlink" href="#building-nvfix-messages" title="Permalink to this headline">¶</a></h3>
<p>To build a NVFIX message, create an instance of <code class="docutils literal"><span class="pre">NVFIXBuilder</span></code>, then
add the fields of the message using <code class="docutils literal"><span class="pre">append()</span></code>. <code class="docutils literal"><span class="pre">NVFIXBuilder</span></code>
copies the fields provided, in order, to the underlying message. The
builder simply writes to an internal buffer with the appropriate
formatting, and does not allow you to update or change the individual
fields of a message once they&#8217;ve been added to the builder.</p>
<p>The snippet below shows how to build a NVFIX message and publish it to
the AMPS client.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="cm">/* Construct a client with the name &quot;NVFIXPublisher&quot;. */</span>
<span class="n">AMPS</span><span class="o">::</span><span class="n">Client</span> <span class="nf">ampsClient</span><span class="p">(</span><span class="s">&quot;NVFIXPublisher&quot;</span><span class="p">);</span>

<span class="cm">/* Construct a simple NVFIX message. */</span>
<span class="n">AMPS</span><span class="o">::</span><span class="n">NVFIXBuilder</span> <span class="n">builder</span><span class="p">;</span>

<span class="cm">/* Add data to the builder */</span>
<span class="n">builder</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Test&quot;</span><span class="p">,</span> <span class="s">&quot;data&quot;</span><span class="p">);</span>
<span class="n">builder</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;More&quot;</span><span class="p">,</span> <span class="s">&quot;stuff&quot;</span><span class="p">);</span>

<span class="cm">/* Display the data */</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">builder</span><span class="p">.</span><span class="n">getString</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="k">try</span>
<span class="p">{</span>
    <span class="cm">/* Connect to the server and log on */</span>
    <span class="n">ampsClient</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">uri</span><span class="p">);</span>
    <span class="n">ampsClient</span><span class="p">.</span><span class="n">logon</span><span class="p">();</span>

    <span class="cm">/* Publish message to the topic messages */</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">topic</span><span class="p">(</span><span class="s">&quot;messages&quot;</span><span class="p">);</span>
    <span class="n">ampsClient</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">builder</span><span class="p">.</span><span class="n">getString</span><span class="p">());</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="n">AMPS</span><span class="o">::</span><span class="n">AMPSException</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="parsing-nvfix-messages">
<h3>Parsing NVFIX Messages<a class="headerlink" href="#parsing-nvfix-messages" title="Permalink to this headline">¶</a></h3>
<p>To parse a NVFIX message, create an instance of <code class="docutils literal"><span class="pre">FIXShredder</span></code>, then
use the <code class="docutils literal"><span class="pre">toMap()</span></code> method to parse the message provided by the AMPS
client. The <code class="docutils literal"><span class="pre">FIXShredder</span></code> gives you access to each field of the
message in a map.</p>
<p>The snippet below shows how to parse and print an NVFIX message.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="cm">/* Create a client with the name &quot;NVFIXSubscriber&quot; */</span>
<span class="n">AMPS</span><span class="o">::</span><span class="n">Client</span> <span class="nf">ampsClient</span><span class="p">(</span><span class="s">&quot;NVFIXSubscriber&quot;</span><span class="p">);</span>

<span class="k">try</span>
<span class="p">{</span>
    <span class="cm">/* Connect to the server and log on */</span>
    <span class="n">ampsClient</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">uri</span><span class="p">);</span>
    <span class="n">ampsClient</span><span class="p">.</span><span class="n">logon</span><span class="p">();</span>

    <span class="cm">/* Subscribe to the messages topic</span>
<span class="cm">     *</span>
<span class="cm">     * This overload of the subscribe method returns a MessageStream</span>
<span class="cm">     * that can be iterated over.  When the MessageStream destructor</span>
<span class="cm">     * runs, the destructor unsubscribes.</span>
<span class="cm">     */</span>

    <span class="cm">/* Set up the shredder */</span>
    <span class="n">AMPS</span><span class="o">::</span><span class="n">FIXShredder</span> <span class="n">shredder</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">message</span> <span class="p">:</span> <span class="n">ampsClient</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;messages&quot;</span><span class="p">))</span> <span class="p">{</span>
        <span class="cm">/* Shred the data to a map */</span>
        <span class="k">auto</span> <span class="n">subscription</span> <span class="o">=</span> <span class="n">shredder</span><span class="p">.</span><span class="n">toMap</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">getData</span><span class="p">());</span>

        <span class="cm">/* Display the data */</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">subscription</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">iterator</span> <span class="o">!=</span> <span class="n">subscription</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">iterator</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">iterator</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">iterator</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="n">AMPS</span><span class="o">::</span><span class="n">AMPSException</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="nvfix-builder-and-shredder-samples">
<h3>NVFIX Builder and Shredder Samples<a class="headerlink" href="#nvfix-builder-and-shredder-samples" title="Permalink to this headline">¶</a></h3>
<p>The C++ client distribution contains the following samples to
demonstrate <code class="docutils literal"><span class="pre">NVFIXBuilder</span></code> and <code class="docutils literal"><span class="pre">NVFIXShredder</span></code>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="52%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sample Name</th>
<th class="head">Demonstrates</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps_nvfix_builder_publisher.cpp</span></code></td>
<td>Creating and publishing
a message using <code class="docutils literal"><span class="pre">NVFIXBuilder</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">amps_nvfix_builder_subscriber.cpp</span></code></td>
<td>Receiving a message and
parsing it using <code class="docutils literal"><span class="pre">NVFIXShredder</span></code></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="fix-messages">
<h2>FIX Messages<a class="headerlink" href="#fix-messages" title="Permalink to this headline">¶</a></h2>
<p>The client provides a pair of classes for creating and parsing FIX
messages.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">FIXBuilder</span></code> allows you to assemble a FIX message and then
serialize them in a format suitable for AMPS.</li>
<li><code class="docutils literal"><span class="pre">FIXShredder</span></code> extracts the individual fields of a FIX message.</li>
</ul>
<div class="section" id="building-fix-messages">
<h3>Building FIX Messages<a class="headerlink" href="#building-fix-messages" title="Permalink to this headline">¶</a></h3>
<p>To build a FIX message, create an instance of <code class="docutils literal"><span class="pre">FIXBuilder</span></code>, then add
the fields of the message using <code class="docutils literal"><span class="pre">append()</span></code>. <code class="docutils literal"><span class="pre">FIXBuilder</span></code> copies the
fields provided, in order, to the underlying message. The builder simply
writes to an internal buffer with the appropriate formatting, and does
not allow you to update or change the individual fields of a message
once they&#8217;ve been added to the builder.</p>
<p>The snippet below shows how to build a FIX message and publish it to the
AMPS client.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="cm">/* Construct a client with the name &quot;FIXPublisher&quot;. */</span>
<span class="n">AMPS</span><span class="o">::</span><span class="n">Client</span> <span class="nf">ampsClient</span><span class="p">(</span><span class="s">&quot;FIXPublisher&quot;</span><span class="p">);</span>

<span class="cm">/* Construct a simple FIX message. */</span>
<span class="n">AMPS</span><span class="o">::</span><span class="n">FIXBuilder</span> <span class="n">builder</span><span class="p">;</span>

<span class="cm">/* Add data to the builder */</span>
<span class="n">builder</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;123&quot;</span><span class="p">);</span>

<span class="cm">/* Display the data */</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">builder</span><span class="p">.</span><span class="n">getString</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="k">try</span>
<span class="p">{</span>
    <span class="cm">/* connect to the server and log on */</span>
    <span class="n">ampsClient</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">uri</span><span class="p">);</span>
    <span class="n">ampsClient</span><span class="p">.</span><span class="n">logon</span><span class="p">();</span>

    <span class="cm">/* publish message to the messages topic */</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">topic</span><span class="p">(</span><span class="s">&quot;messages&quot;</span><span class="p">);</span>
    <span class="n">ampsClient</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">builder</span><span class="p">.</span><span class="n">getString</span><span class="p">());</span>

<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="n">AMPS</span><span class="o">::</span><span class="n">AMPSException</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="parsing-fix-messages">
<h3>Parsing FIX Messages<a class="headerlink" href="#parsing-fix-messages" title="Permalink to this headline">¶</a></h3>
<p>To parse a FIX message, create an instance of <code class="docutils literal"><span class="pre">FIXShredder</span></code>, then use
the <code class="docutils literal"><span class="pre">toMap()</span></code> method to parse the message provided by the AMPS client.
The <code class="docutils literal"><span class="pre">FIXShredder</span></code> gives you access to each field of the message in a
map.</p>
<p>The snippet below shows how to parse and print a FIX message.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="cm">/* Create a client with the name &quot;NVFIXSubscriber&quot; */</span>
<span class="n">AMPS</span><span class="o">::</span><span class="n">Client</span> <span class="nf">ampsClient</span><span class="p">(</span><span class="s">&quot;NVFIXSubscriber&quot;</span><span class="p">);</span>

<span class="k">try</span>
<span class="p">{</span>
    <span class="cm">/* Connect to the server and log on */</span>
    <span class="n">ampsClient</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">uri</span><span class="p">);</span>
    <span class="n">ampsClient</span><span class="p">.</span><span class="n">logon</span><span class="p">();</span>

    <span class="cm">/* Subscribe to the messages topic</span>
<span class="cm">     *</span>
<span class="cm">     * This overload of the subscribe method returns a MessageStream</span>
<span class="cm">     * that can be iterated over.  When the MessageStream destructor</span>
<span class="cm">     * runs, the destructor unsubscribes.</span>
<span class="cm">     */</span>

    <span class="cm">/* Set up the shredder */</span>
    <span class="n">AMPS</span><span class="o">::</span><span class="n">FIXShredder</span> <span class="n">shredder</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">message</span> <span class="p">:</span> <span class="n">ampsClient</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;messages&quot;</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// Shred the data to a map</span>
        <span class="k">auto</span> <span class="n">subscription</span> <span class="o">=</span> <span class="n">shredder</span><span class="p">.</span><span class="n">toMap</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">getData</span><span class="p">());</span>

        <span class="c1">// Display the data</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">subscription</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">iterator</span> <span class="o">!=</span> <span class="n">subscription</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">iterator</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">iterator</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">iterator</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="n">AMPS</span><span class="o">::</span><span class="n">AMPSException</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="fix-builder-and-shredder-samples">
<h3>FIX Builder and Shredder Samples<a class="headerlink" href="#fix-builder-and-shredder-samples" title="Permalink to this headline">¶</a></h3>
<p>The C++ client distribution contains the following samples to
demonstrate <code class="docutils literal"><span class="pre">NVFIXBuilder</span></code> and <code class="docutils literal"><span class="pre">NVFIXShredder</span></code>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="52%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sample Name</th>
<th class="head">Demonstrates</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps_fix_builder_publisher.cpp</span></code></td>
<td>Creating and publishing
a message using <code class="docutils literal"><span class="pre">FIXBuilder</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">amps_fix_builder_subscriber.cpp</span></code></td>
<td>Receiving a message and
parsing it using <code class="docutils literal"><span class="pre">FIXShredder</span></code></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2022, 60East Technologies, Inc.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>