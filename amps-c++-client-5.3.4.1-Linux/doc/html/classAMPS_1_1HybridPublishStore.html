<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>AMPS C/C++ Client Class Reference: AMPS::HybridPublishStore Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AMPS C/C++ Client Class Reference
   </div>
   <div id="projectbrief">AMPS C/C++ Client Version 5.3.4.1</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classAMPS_1_1HybridPublishStore.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classAMPS_1_1HybridPublishStore-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">AMPS::HybridPublishStore Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>An implementation of <a class="el" href="classAMPS_1_1StoreImpl.html" title="Abstract base class for storing published messages for an HA publisher client. ">StoreImpl</a> for publication.  
 <a href="classAMPS_1_1HybridPublishStore.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="HybridPublishStore_8hpp_source.html">HybridPublishStore.hpp</a>&gt;</code></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Inheritance diagram for AMPS::HybridPublishStore:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
 <div class="center">
  <img src="classAMPS_1_1HybridPublishStore.png" usemap="#AMPS::HybridPublishStore_map" alt=""/>
  <map id="AMPS::HybridPublishStore_map" name="AMPS::HybridPublishStore_map">
<area href="classAMPS_1_1StoreImpl.html" title="Abstract base class for storing published messages for an HA publisher client. " alt="AMPS::StoreImpl" shape="rect" coords="0,0,163,24"/>
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a0756caa8a4f21cef02bd411477362748"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAMPS_1_1HybridPublishStore.html#a0756caa8a4f21cef02bd411477362748">HybridPublishStore</a> (const char *fileName_, size_t maxMemoryCapacity_, bool errorOnPublishGap_=false)</td></tr>
<tr class="memdesc:a0756caa8a4f21cef02bd411477362748"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a <a class="el" href="classAMPS_1_1HybridPublishStore.html" title="An implementation of StoreImpl for publication. ">HybridPublishStore</a> that will use fileName_ as its file storage and stores at most maxMemoryCapacity_ messages in memory before offloading some messages to the file.  <a href="#a0756caa8a4f21cef02bd411477362748">More...</a><br /></td></tr>
<tr class="separator:a0756caa8a4f21cef02bd411477362748"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2239588a48036c72b238be9ec1a2da6f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAMPS_1_1HybridPublishStore.html#a2239588a48036c72b238be9ec1a2da6f">HybridPublishStore</a> (const std::string &amp;fileName_, size_t maxMemoryCapacity_, bool errorOnPublishGap_=false)</td></tr>
<tr class="memdesc:a2239588a48036c72b238be9ec1a2da6f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a <a class="el" href="classAMPS_1_1HybridPublishStore.html" title="An implementation of StoreImpl for publication. ">HybridPublishStore</a> that will use fileName_ as its file storage and stores at most maxMemoryCapacity_ messages in memory before offloading some messages to the file.  <a href="#a2239588a48036c72b238be9ec1a2da6f">More...</a><br /></td></tr>
<tr class="separator:a2239588a48036c72b238be9ec1a2da6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a641e1b583e395f52913649fd3aae90b4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAMPS_1_1HybridPublishStore.html#a641e1b583e395f52913649fd3aae90b4">setLowWatermark</a> (size_t lowWatermark_)</td></tr>
<tr class="memdesc:a641e1b583e395f52913649fd3aae90b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set how many messags remain in memory after messages get offlined.  <a href="#a641e1b583e395f52913649fd3aae90b4">More...</a><br /></td></tr>
<tr class="separator:a641e1b583e395f52913649fd3aae90b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2ea747c5353ba9ec33fe8890fc316c0"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAMPS_1_1HybridPublishStore.html#ab2ea747c5353ba9ec33fe8890fc316c0">getLowWatermark</a> ()</td></tr>
<tr class="memdesc:ab2ea747c5353ba9ec33fe8890fc316c0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get how many messags remain in memory after messages get offlined.  <a href="#ab2ea747c5353ba9ec33fe8890fc316c0">More...</a><br /></td></tr>
<tr class="separator:ab2ea747c5353ba9ec33fe8890fc316c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad39723f76c84215bfc78d1226c0bec0f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAMPS_1_1HybridPublishStore.html#ad39723f76c84215bfc78d1226c0bec0f">discardUpTo</a> (amps_uint64_t index_)</td></tr>
<tr class="memdesc:ad39723f76c84215bfc78d1226c0bec0f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Discard all messages in the store up to and including index_.  <a href="#ad39723f76c84215bfc78d1226c0bec0f">More...</a><br /></td></tr>
<tr class="separator:ad39723f76c84215bfc78d1226c0bec0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba6f299cb6b34a3e968ad22a896ab8c6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAMPS_1_1HybridPublishStore.html#aba6f299cb6b34a3e968ad22a896ab8c6">replay</a> (<a class="el" href="classAMPS_1_1StoreReplayer.html">StoreReplayer</a> &amp;replayer_)</td></tr>
<tr class="memdesc:aba6f299cb6b34a3e968ad22a896ab8c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used internally by <a class="el" href="classAMPS_1_1Client.html" title="Client represents a connection to an AMPS server, but does not provide failover or reconnection behav...">Client</a> to replay messages in the store to AMPS after a successful connection.  <a href="#aba6f299cb6b34a3e968ad22a896ab8c6">More...</a><br /></td></tr>
<tr class="separator:aba6f299cb6b34a3e968ad22a896ab8c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab76364f40b79a5199c4038906c8e9671"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAMPS_1_1HybridPublishStore.html#ab76364f40b79a5199c4038906c8e9671">unpersistedCount</a> () const </td></tr>
<tr class="memdesc:ab76364f40b79a5199c4038906c8e9671"><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of messages in the <a class="el" href="classAMPS_1_1Store.html" title="Handle class for StoreImpl classes that track publish messages. ">Store</a> that have not been discarded.  <a href="#ab76364f40b79a5199c4038906c8e9671">More...</a><br /></td></tr>
<tr class="separator:ab76364f40b79a5199c4038906c8e9671"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a79aaa1013f282d621a9e27760c57a5"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAMPS_1_1HybridPublishStore.html#a0a79aaa1013f282d621a9e27760c57a5">flush</a> (long timeout_)</td></tr>
<tr class="memdesc:a0a79aaa1013f282d621a9e27760c57a5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Method to wait for the <a class="el" href="classAMPS_1_1Store.html" title="Handle class for StoreImpl classes that track publish messages. ">Store</a> to discard everything that has been stored up to the point in time when flush is called.  <a href="#a0a79aaa1013f282d621a9e27760c57a5">More...</a><br /></td></tr>
<tr class="separator:a0a79aaa1013f282d621a9e27760c57a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec3215e51ae5d7df8bd00068579aa88b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAMPS_1_1HybridPublishStore.html#aec3215e51ae5d7df8bd00068579aa88b">replaySingle</a> (<a class="el" href="classAMPS_1_1StoreReplayer.html">StoreReplayer</a> &amp;replayer_, amps_uint64_t index_)</td></tr>
<tr class="memdesc:aec3215e51ae5d7df8bd00068579aa88b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called by <a class="el" href="classAMPS_1_1Client.html" title="Client represents a connection to an AMPS server, but does not provide failover or reconnection behav...">Client</a> to get a single message replayed by the store onto the <a class="el" href="classAMPS_1_1StoreReplayer.html" title="Abstract base class for replaying a publish message. ">StoreReplayer</a>.  <a href="#aec3215e51ae5d7df8bd00068579aa88b">More...</a><br /></td></tr>
<tr class="separator:aec3215e51ae5d7df8bd00068579aa88b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65a6aa7146c81aa07816ddcd012cc32a"><td class="memItemLeft" align="right" valign="top">amps_uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAMPS_1_1HybridPublishStore.html#a65a6aa7146c81aa07816ddcd012cc32a">store</a> (const <a class="el" href="classAMPS_1_1Message.html">Message</a> &amp;message_)</td></tr>
<tr class="memdesc:a65a6aa7146c81aa07816ddcd012cc32a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used internally by <a class="el" href="classAMPS_1_1Client.html" title="Client represents a connection to an AMPS server, but does not provide failover or reconnection behav...">Client</a> to put messages into the <a class="el" href="classAMPS_1_1Store.html" title="Handle class for StoreImpl classes that track publish messages. ">Store</a>.  <a href="#a65a6aa7146c81aa07816ddcd012cc32a">More...</a><br /></td></tr>
<tr class="separator:a65a6aa7146c81aa07816ddcd012cc32a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a503ab3c61b0b9525d6e359535fba2348"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAMPS_1_1HybridPublishStore.html#a503ab3c61b0b9525d6e359535fba2348">setResizeHandler</a> (PublishStoreResizeHandler handler_, void *data_)</td></tr>
<tr class="memdesc:a503ab3c61b0b9525d6e359535fba2348"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set a handler to be called if the <a class="el" href="classAMPS_1_1Store.html" title="Handle class for StoreImpl classes that track publish messages. ">Store</a> needs to resize in order to keep storing messages.  <a href="#a503ab3c61b0b9525d6e359535fba2348">More...</a><br /></td></tr>
<tr class="separator:a503ab3c61b0b9525d6e359535fba2348"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a11e316618697d930edd479ba3a28fb"><td class="memItemLeft" align="right" valign="top">amps_uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAMPS_1_1HybridPublishStore.html#a1a11e316618697d930edd479ba3a28fb">getLowestUnpersisted</a> () const </td></tr>
<tr class="memdesc:a1a11e316618697d930edd479ba3a28fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the oldest unpersisted message sequence in the store.  <a href="#a1a11e316618697d930edd479ba3a28fb">More...</a><br /></td></tr>
<tr class="separator:a1a11e316618697d930edd479ba3a28fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87bce3f512e698abbf5e4361ffbb8dff"><td class="memItemLeft" align="right" valign="top">amps_uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAMPS_1_1HybridPublishStore.html#a87bce3f512e698abbf5e4361ffbb8dff">getLastPersisted</a> (void)</td></tr>
<tr class="memdesc:a87bce3f512e698abbf5e4361ffbb8dff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the last persisted sequence number.  <a href="#a87bce3f512e698abbf5e4361ffbb8dff">More...</a><br /></td></tr>
<tr class="separator:a87bce3f512e698abbf5e4361ffbb8dff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classAMPS_1_1StoreImpl"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classAMPS_1_1StoreImpl')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classAMPS_1_1StoreImpl.html">AMPS::StoreImpl</a></td></tr>
<tr class="memitem:ae6dffba99210c30facc396491f271e77 inherit pub_methods_classAMPS_1_1StoreImpl"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAMPS_1_1StoreImpl.html#ae6dffba99210c30facc396491f271e77">StoreImpl</a> (bool errorOnPublishGap_=false)</td></tr>
<tr class="memdesc:ae6dffba99210c30facc396491f271e77 inherit pub_methods_classAMPS_1_1StoreImpl"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default constructor.  <a href="#ae6dffba99210c30facc396491f271e77">More...</a><br /></td></tr>
<tr class="separator:ae6dffba99210c30facc396491f271e77 inherit pub_methods_classAMPS_1_1StoreImpl"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pub_static_methods_classAMPS_1_1StoreImpl"><td colspan="2" onclick="javascript:toggleInherit('pub_static_methods_classAMPS_1_1StoreImpl')"><img src="closed.png" alt="-"/>&#160;Static Public Member Functions inherited from <a class="el" href="classAMPS_1_1StoreImpl.html">AMPS::StoreImpl</a></td></tr>
<tr class="memitem:a2b96fcfc9e76a87c1854edc7c3f7d7ce inherit pub_static_methods_classAMPS_1_1StoreImpl"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2b96fcfc9e76a87c1854edc7c3f7d7ce"></a>
static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAMPS_1_1StoreImpl.html#a2b96fcfc9e76a87c1854edc7c3f7d7ce">getUnsetPosition</a> ()</td></tr>
<tr class="memdesc:a2b96fcfc9e76a87c1854edc7c3f7d7ce inherit pub_static_methods_classAMPS_1_1StoreImpl"><td class="mdescLeft">&#160;</td><td class="mdescRight">Method to return the value used to represent not found or unset. <br /></td></tr>
<tr class="separator:a2b96fcfc9e76a87c1854edc7c3f7d7ce inherit pub_static_methods_classAMPS_1_1StoreImpl"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23e0d9dc3d5fbb2c45a1c990c9606cab inherit pub_static_methods_classAMPS_1_1StoreImpl"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a23e0d9dc3d5fbb2c45a1c990c9606cab"></a>
static amps_uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAMPS_1_1StoreImpl.html#a23e0d9dc3d5fbb2c45a1c990c9606cab">getUnsetSequence</a> ()</td></tr>
<tr class="memdesc:a23e0d9dc3d5fbb2c45a1c990c9606cab inherit pub_static_methods_classAMPS_1_1StoreImpl"><td class="mdescLeft">&#160;</td><td class="mdescRight">Method to return the value used to represent no such sequence. <br /></td></tr>
<tr class="separator:a23e0d9dc3d5fbb2c45a1c990c9606cab inherit pub_static_methods_classAMPS_1_1StoreImpl"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>An implementation of <a class="el" href="classAMPS_1_1StoreImpl.html" title="Abstract base class for storing published messages for an HA publisher client. ">StoreImpl</a> for publication. </p>
<p>This store uses memory up to a specified capacity, then starts using a file if it will exceed the set maximum memory capacity. This store does not provide guaranteed durable publication if the application is restarted. However, this store does help to limit the amount of memory consumed by a publisher when the publisher cannot connect to AMPS. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a0756caa8a4f21cef02bd411477362748"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">AMPS::HybridPublishStore::HybridPublishStore </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fileName_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>maxMemoryCapacity_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>errorOnPublishGap_</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Create a <a class="el" href="classAMPS_1_1HybridPublishStore.html" title="An implementation of StoreImpl for publication. ">HybridPublishStore</a> that will use fileName_ as its file storage and stores at most maxMemoryCapacity_ messages in memory before offloading some messages to the file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fileName_</td><td>The name to use for the file-based storage. </td></tr>
    <tr><td class="paramname">maxMemoryCapacity_</td><td>The maximum number of messages to store in in memory before starting to use a file. </td></tr>
    <tr><td class="paramname">errorOnPublishGap_</td><td>If true, PublishStoreGapException can be thrown by the store if the client logs onto a server that appears to be missing messages no longer held in the store. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a2239588a48036c72b238be9ec1a2da6f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">AMPS::HybridPublishStore::HybridPublishStore </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>fileName_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>maxMemoryCapacity_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>errorOnPublishGap_</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Create a <a class="el" href="classAMPS_1_1HybridPublishStore.html" title="An implementation of StoreImpl for publication. ">HybridPublishStore</a> that will use fileName_ as its file storage and stores at most maxMemoryCapacity_ messages in memory before offloading some messages to the file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fileName_</td><td>The name to use for the file-based storage. </td></tr>
    <tr><td class="paramname">maxMemoryCapacity_</td><td>The maximum number of messages to store in in memory before starting to use a file. </td></tr>
    <tr><td class="paramname">errorOnPublishGap_</td><td>If true, PublishStoreGapException can be thrown by the store if the client logs onto a server that appears to be missing messages no longer held in the store. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ad39723f76c84215bfc78d1226c0bec0f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void AMPS::HybridPublishStore::discardUpTo </td>
          <td>(</td>
          <td class="paramtype">amps_uint64_t&#160;</td>
          <td class="paramname"><em>index_</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Discard all messages in the store up to and including index_. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index_</td><td>The maximum index to remove from storage. </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classAMPS_1_1StoreImpl.html#a3a391f99cd236d3a2370638596e96063">AMPS::StoreImpl</a>.</p>

</div>
</div>
<a class="anchor" id="a0a79aaa1013f282d621a9e27760c57a5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void AMPS::HybridPublishStore::flush </td>
          <td>(</td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>timeout_</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Method to wait for the <a class="el" href="classAMPS_1_1Store.html" title="Handle class for StoreImpl classes that track publish messages. ">Store</a> to discard everything that has been stored up to the point in time when flush is called. </p>
<p>It will get the current max and wait up to timeout for that message to be discarded </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeout_</td><td>The number of milliseconds to wait. </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DisconnectedException</td><td>The <a class="el" href="classAMPS_1_1Client.html" title="Client represents a connection to an AMPS server, but does not provide failover or reconnection behav...">Client</a> is no longer connected to a server. </td></tr>
    <tr><td class="paramname">ConnectionException</td><td>An error occurred while sending the message. </td></tr>
    <tr><td class="paramname">TimedOutException</td><td>The publish command was not acked in the allowed time. </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classAMPS_1_1StoreImpl.html#a4405a4c73ea6dc3df17b5663d191cc8e">AMPS::StoreImpl</a>.</p>

</div>
</div>
<a class="anchor" id="a87bce3f512e698abbf5e4361ffbb8dff"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amps_uint64_t AMPS::HybridPublishStore::getLastPersisted </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the last persisted sequence number. </p>
<dl class="section return"><dt>Returns</dt><dd>The sequence of the last persisted message. </dd></dl>

<p>Implements <a class="el" href="classAMPS_1_1StoreImpl.html#a24fd9abeba9620f7d515b0933fc0afb8">AMPS::StoreImpl</a>.</p>

</div>
</div>
<a class="anchor" id="a1a11e316618697d930edd479ba3a28fb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amps_uint64_t AMPS::HybridPublishStore::getLowestUnpersisted </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the oldest unpersisted message sequence in the store. </p>
<dl class="section return"><dt>Returns</dt><dd>The sequence of the oldest message. </dd></dl>

<p>Implements <a class="el" href="classAMPS_1_1StoreImpl.html#af5060827d0e062282e1dbf25cbc2a2e3">AMPS::StoreImpl</a>.</p>

</div>
</div>
<a class="anchor" id="ab2ea747c5353ba9ec33fe8890fc316c0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t AMPS::HybridPublishStore::getLowWatermark </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get how many messags remain in memory after messages get offlined. </p>
<p>When memory storage reaches its cap, it will write its oldest messages to its file until it is holding only lowWatermark_ messages. </p><dl class="section return"><dt>Returns</dt><dd>The number of messages that remain in memory after offlining completes. </dd></dl>

</div>
</div>
<a class="anchor" id="aba6f299cb6b34a3e968ad22a896ab8c6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void AMPS::HybridPublishStore::replay </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classAMPS_1_1StoreReplayer.html">StoreReplayer</a> &amp;&#160;</td>
          <td class="paramname"><em>replayer_</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Used internally by <a class="el" href="classAMPS_1_1Client.html" title="Client represents a connection to an AMPS server, but does not provide failover or reconnection behav...">Client</a> to replay messages in the store to AMPS after a successful connection. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">replayer_</td><td>The <a class="el" href="classAMPS_1_1StoreReplayer.html" title="Abstract base class for replaying a publish message. ">StoreReplayer</a> that replays the messages. </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classAMPS_1_1StoreImpl.html#ac3326d25b8aa2df5a93db3629b60cc21">AMPS::StoreImpl</a>.</p>

</div>
</div>
<a class="anchor" id="aec3215e51ae5d7df8bd00068579aa88b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool AMPS::HybridPublishStore::replaySingle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classAMPS_1_1StoreReplayer.html">StoreReplayer</a> &amp;&#160;</td>
          <td class="paramname"><em>replayer_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">amps_uint64_t&#160;</td>
          <td class="paramname"><em>index_</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Called by <a class="el" href="classAMPS_1_1Client.html" title="Client represents a connection to an AMPS server, but does not provide failover or reconnection behav...">Client</a> to get a single message replayed by the store onto the <a class="el" href="classAMPS_1_1StoreReplayer.html" title="Abstract base class for replaying a publish message. ">StoreReplayer</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">replayer_</td><td>The <a class="el" href="classAMPS_1_1StoreReplayer.html" title="Abstract base class for replaying a publish message. ">StoreReplayer</a> to be used to replay the messages. </td></tr>
    <tr><td class="paramname">index_</td><td>The index of the message to replay. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns true for success, false for failure such as an invalid index. </dd></dl>

<p>Implements <a class="el" href="classAMPS_1_1StoreImpl.html#ada24473da48fd544d789b7ec2dac7d08">AMPS::StoreImpl</a>.</p>

</div>
</div>
<a class="anchor" id="a641e1b583e395f52913649fd3aae90b4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void AMPS::HybridPublishStore::setLowWatermark </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>lowWatermark_</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set how many messags remain in memory after messages get offlined. </p>
<p>When memory storage reaches its cap, it will write its oldest messages to its file until it is holding only lowWatermark_ messages. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lowWatermark_</td><td>The number of messages that remain in memory after offlining completes. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a503ab3c61b0b9525d6e359535fba2348"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void AMPS::HybridPublishStore::setResizeHandler </td>
          <td>(</td>
          <td class="paramtype">PublishStoreResizeHandler&#160;</td>
          <td class="paramname"><em>handler_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>userData_</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set a handler to be called if the <a class="el" href="classAMPS_1_1Store.html" title="Handle class for StoreImpl classes that track publish messages. ">Store</a> needs to resize in order to keep storing messages. </p>
<p>Resize could be caused by not being connected to the server, publishing messages faster than the network or AMPS can keep up, not properly discarding messages when receiving persisted acks, or AMPS being unable to complete persistence such as when its connection to a sync replication destination is unavailable. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handler_</td><td>The handler to be called when a resize event is required. </td></tr>
    <tr><td class="paramname">userData_</td><td>The data to pass to the handler each time it is called. </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classAMPS_1_1StoreImpl.html#af38461a40772ee3147546e0e6132eea4">AMPS::StoreImpl</a>.</p>

</div>
</div>
<a class="anchor" id="a65a6aa7146c81aa07816ddcd012cc32a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amps_uint64_t AMPS::HybridPublishStore::store </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classAMPS_1_1Message.html">Message</a> &amp;&#160;</td>
          <td class="paramname"><em>message_</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Used internally by <a class="el" href="classAMPS_1_1Client.html" title="Client represents a connection to an AMPS server, but does not provide failover or reconnection behav...">Client</a> to put messages into the <a class="el" href="classAMPS_1_1Store.html" title="Handle class for StoreImpl classes that track publish messages. ">Store</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">message_</td><td>The <a class="el" href="classAMPS_1_1Message.html" title="Message encapsulates a single message sent to or received from an AMPS server, and provides methods f...">Message</a> to be stored. </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classAMPS_1_1StoreImpl.html#a76e41f2c8c132c63ed560135949cd220">AMPS::StoreImpl</a>.</p>

</div>
</div>
<a class="anchor" id="ab76364f40b79a5199c4038906c8e9671"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t AMPS::HybridPublishStore::unpersistedCount </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The number of messages in the <a class="el" href="classAMPS_1_1Store.html" title="Handle class for StoreImpl classes that track publish messages. ">Store</a> that have not been discarded. </p>
<dl class="section return"><dt>Returns</dt><dd>The number of messages still in the <a class="el" href="classAMPS_1_1Store.html" title="Handle class for StoreImpl classes that track publish messages. ">Store</a>. </dd></dl>

<p>Implements <a class="el" href="classAMPS_1_1StoreImpl.html#a6ba03a337bf6cc5ce6545fca968ff226">AMPS::StoreImpl</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>include/amps/<a class="el" href="HybridPublishStore_8hpp_source.html">HybridPublishStore.hpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>AMPS</b></li><li class="navelem"><a class="el" href="classAMPS_1_1HybridPublishStore.html">HybridPublishStore</a></li>
    <li class="footer">Generated on Mon Oct 9 2023 18:11:31 for AMPS C/C++ Client Class Reference by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
