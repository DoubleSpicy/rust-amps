<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>AMPS C/C++ Client Class Reference: include/amps/ampsplusplus.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AMPS C/C++ Client Class Reference
   </div>
   <div id="projectbrief">AMPS C/C++ Client Version 5.3.4.1</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ampsplusplus_8hpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ampsplusplus.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ampsplusplus_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Copyright (c) 2010-2023 60East Technologies Inc., All Rights Reserved.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This computer software is owned by 60East Technologies Inc. and is</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// protected by U.S. copyright laws and other laws and by international</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// treaties.  This computer software is furnished by 60East Technologies</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// Inc. pursuant to a written license agreement and may be used, copied,</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// transmitted, and stored only in accordance with the terms of such</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// license agreement and with the inclusion of the above copyright notice.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// This computer software or any other copies thereof may not be provided</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// or otherwise made available to any other person.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// U.S. Government Restricted Rights.  This computer software: (a) was</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// developed at private expense and is in all respects the proprietary</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// information of 60East Technologies Inc.; (b) was not developed with</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// government funds; (c) is a trade secret of 60East Technologies Inc.</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// for all purposes of the Freedom of Information Act; and (d) is a</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">// commercial item and thus, pursuant to Section 12.212 of the Federal</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">// Acquisition Regulations (FAR) and DFAR Supplement Section 227.7202,</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">// Government&#39;s use, duplication or disclosure of the computer software</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">// is subject to the restrictions set forth by 60East Technologies Inc..</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"></span><span class="preprocessor">#ifndef _AMPSPLUSPLUS_H_</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#define _AMPSPLUSPLUS_H_</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="amps_8h.html">amps/amps.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;amps/ampsver.h&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &lt;stdexcept&gt;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &lt;limits.h&gt;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &lt;list&gt;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &lt;set&gt;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &lt;deque&gt;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &lt;assert.h&gt;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#ifndef _WIN32</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">  #include &lt;inttypes.h&gt;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#if defined(sun)</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">  #include &lt;sys/atomic.h&gt;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;amps/BookmarkStore.hpp&quot;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;amps/MessageRouter.hpp&quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;amps/util.hpp&quot;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;amps/ampscrc.hpp&quot;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#if __cplusplus &gt;= 201100L || _MSC_VER &gt;= 1900</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &lt;atomic&gt;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#ifndef AMPS_TESTING_SLOW_MESSAGE_STREAM</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">  #define AMPS_TESTING_SLOW_MESSAGE_STREAM</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">// For StoreBuffer implementations</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#define AMPS_MEMORYBUFFER_DEFAULT_BUFFERS              10</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#define AMPS_MEMORYBUFFER_DEFAULT_LENGTH            40960</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#define AMPS_SUBSCRIPTION_MANAGER_DEFAULT_TIMEOUT       0</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#define AMPS_HACLIENT_TIMEOUT_DEFAULT               10000</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#define AMPS_HACLIENT_RECONNECT_DEFAULT               200</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#define AMPS_DEFAULT_COMMAND_TIMEOUT                 5000</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#define AMPS_DEFAULT_TOP_N                             -1</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#define AMPS_DEFAULT_BATCH_SIZE                        10</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#define AMPS_NUMBER_BUFFER_LEN                         20</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#define AMPS_DEFAULT_QUEUE_ACK_TIMEOUT               1000</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#if defined(_M_X64) || defined(__x86_64) || defined(_WIN64)</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">  #define AMPS_X64 1</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keyword">static</span> __declspec ( thread ) <a class="code" href="namespaceAMPS.html">AMPS</a>::Message* publishStoreMessage = 0;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keyword">static</span> __thread <a class="code" href="classAMPS_1_1Message.html">AMPS::Message</a>* publishStoreMessage = 0;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceAMPS.html">AMPS</a></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;{</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keyword">typedef</span> std::map&lt;std::string, std::string&gt; ConnectionInfo;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keyword">class </span>PerThreadMessageTracker</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    std::vector&lt;AMPS::Message*&gt; _messages;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    PerThreadMessageTracker() {}</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    ~PerThreadMessageTracker()</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; _messages.size(); ++i)</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="keyword">delete</span> _messages[i];</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      }</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordtype">void</span> addMessage(<a class="code" href="classAMPS_1_1Message.html">AMPS::Message</a>* message)</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      _messages.push_back(message);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">void</span> addMessageToCleanupList(<a class="code" href="classAMPS_1_1Message.html">AMPS::Message</a>* message)</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    {</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="keyword">static</span> AMPS::Mutex _lock;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      AMPS::Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      _addMessageToCleanupList(message);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">void</span> _addMessageToCleanupList(<a class="code" href="classAMPS_1_1Message.html">AMPS::Message</a>* message)</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="keyword">static</span> PerThreadMessageTracker tracker;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      tracker.addMessage(message);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    }</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  };</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keyword">template</span>&lt;<span class="keyword">class</span> Type&gt;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keyword">inline</span> std::string asString(Type x_)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  {</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    std::ostringstream os;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    os &lt;&lt; x_;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">return</span> os.str();</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keyword">inline</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="keywordtype">size_t</span> convertToCharArray(<span class="keywordtype">char</span>* buf_, amps_uint64_t seqNo_)</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordtype">size_t</span> pos = AMPS_NUMBER_BUFFER_LEN;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; AMPS_NUMBER_BUFFER_LEN; ++i)</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="keywordflow">if</span> (seqNo_ &gt; 0)</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        buf_[--pos] = (char)(seqNo_ % 10 + <span class="charliteral">&#39;0&#39;</span>);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        seqNo_ /= 10;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">return</span> pos;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  }</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keyword">inline</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordtype">size_t</span> convertToCharArray(<span class="keywordtype">char</span>* buf_, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> seqNo_)</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  {</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordtype">size_t</span> pos = AMPS_NUMBER_BUFFER_LEN;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; AMPS_NUMBER_BUFFER_LEN; ++i)</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="keywordflow">if</span> (seqNo_ &gt; 0)</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      {</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        buf_[--pos] = (char)(seqNo_ % 10 + <span class="charliteral">&#39;0&#39;</span>);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        seqNo_ /= 10;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">return</span> pos;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="classAMPS_1_1Reason.html">  183</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1Reason.html">Reason</a></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* duplicate()</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    {</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;duplicate&quot;</span>;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* badFilter()</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;bad filter&quot;</span>;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    }</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* badRegexTopic()</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    {</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;bad regex topic&quot;</span>;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* subscriptionAlreadyExists()</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;subscription already exists&quot;</span>;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    }</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* nameInUse()</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    {</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;name in use&quot;</span>;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* authFailure()</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;auth failure&quot;</span>;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    }</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* notEntitled()</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;not entitled&quot;</span>;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* authDisabled()</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    {</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;authentication disabled&quot;</span>;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    }</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* subidInUse()</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    {</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;subid in use&quot;</span>;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    }</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* noTopic()</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    {</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;no topic&quot;</span>;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    }</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  };</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno"><a class="line" href="classAMPS_1_1ExceptionListener.html">  236</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1ExceptionListener.html">ExceptionListener</a></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keyword">virtual</span> ~<a class="code" href="classAMPS_1_1ExceptionListener.html">ExceptionListener</a>() {;}</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> exceptionThrown(<span class="keyword">const</span> std::exception&amp;)<span class="keyword"> const </span>{;}</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  };</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classAMPS_1_1ExceptionListener.html">ExceptionListener</a> <a class="code" href="classAMPS_1_1ExceptionListener.html">DefaultExceptionListener</a>;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="preprocessor">#define AMPS_CALL_EXCEPTION_WRAPPER(x) \</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="preprocessor">  try\</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="preprocessor">  {\</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="preprocessor">    x;\</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="preprocessor">  }\</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="preprocessor">  catch (std::exception&amp; ex_)\</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="preprocessor">  {\</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="preprocessor">    try\</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="preprocessor">    {\</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="preprocessor">      _exceptionListener-&gt;exceptionThrown(ex_);\</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="preprocessor">    }\</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="preprocessor">    catch(...)\</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="preprocessor">    {\</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="preprocessor">      ;\</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="preprocessor">    }\</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="preprocessor">  }</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">   *  Note : we don&#39;t attempt to trap non std::exception exceptions</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">   *  here because doing so interferes with pthread_exit on some OSes.</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">  catch (...)\</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">  {\</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">    try\</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">    {\</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">      _exceptionListener-&gt;exceptionThrown(AMPS::AMPSException(\</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">          &quot;An unhandled exception of unknown type was thrown by &quot;\</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">          &quot;the registered handler.&quot;, AMPS_E_USAGE));\</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">    }\</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">    catch(...)\</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">    {\</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">      ;\</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">    }\</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">  }</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="preprocessor">#define AMPS_CALL_EXCEPTION_WRAPPER_2(me,x) \</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="preprocessor">  try\</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="preprocessor">  {\</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="preprocessor">    while(me-&gt;_connected)\</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="preprocessor">    {\</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="preprocessor">      try\</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="preprocessor">      {\</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="preprocessor">        x;\</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="preprocessor">        break;\</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="preprocessor">      }\</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="preprocessor">      catch(MessageStreamFullException&amp;)\</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="preprocessor">      {\</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="preprocessor">        me-&gt;checkAndSendHeartbeat(false);\</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="preprocessor">      }\</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="preprocessor">    }\</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="preprocessor">  }\</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="preprocessor">  catch (std::exception&amp; ex_)\</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="preprocessor">  {\</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="preprocessor">    try\</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="preprocessor">    {\</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="preprocessor">      me-&gt;_exceptionListener-&gt;exceptionThrown(ex_);\</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="preprocessor">    }\</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="preprocessor">    catch(...)\</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="preprocessor">    {\</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="preprocessor">      ;\</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="preprocessor">    }\</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="preprocessor">  }</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">   *  Note : we don&#39;t attempt to trap non std::exception exceptions</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">   *  here because doing so interferes with pthread_exit on some OSes.</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">  catch (...)\</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">  {\</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">    try\</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">    {\</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">      me-&gt;_exceptionListener-&gt;exceptionThrown(AMPS::AMPSException(\</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">          &quot;An unhandled exception of unknown type was thrown by &quot;\</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">          &quot;the registered handler.&quot;, AMPS_E_USAGE));\</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">    }\</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">    catch(...)\</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">    {\</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">      ;\</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">    }\</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">  }*/</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="preprocessor">#define AMPS_CALL_EXCEPTION_WRAPPER_STREAM_FULL_2(me, x)\</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="preprocessor">  while(me-&gt;_connected)\</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="preprocessor">  {\</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="preprocessor">    try\</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="preprocessor">    {\</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="preprocessor">      x;\</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="preprocessor">      break;\</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="preprocessor">    }\</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="preprocessor">    catch(MessageStreamFullException&amp;)\</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="preprocessor">    {\</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="preprocessor">      me-&gt;checkAndSendHeartbeat(false);\</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="preprocessor">    }\</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="preprocessor">  }</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="preprocessor">#define AMPS_CALL_EXCEPTION_WRAPPER_2(me,x) \</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="preprocessor">  try\</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="preprocessor">  {\</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="preprocessor">    while(me-&gt;_connected)\</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="preprocessor">    {\</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="preprocessor">      try\</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="preprocessor">      {\</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="preprocessor">        x;\</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="preprocessor">        break;\</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="preprocessor">      }\</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="preprocessor">      catch(MessageStreamFullException&amp; ex_)\</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="preprocessor">      {\</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="preprocessor">        me-&gt;checkAndSendHeartbeat(false);\</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="preprocessor">      }\</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="preprocessor">    }\</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="preprocessor">  }\</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="preprocessor">  catch (std::exception&amp; ex_)\</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="preprocessor">  {\</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="preprocessor">    try\</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="preprocessor">    {\</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="preprocessor">      me-&gt;_exceptionListener-&gt;exceptionThrown(ex_);\</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="preprocessor">    }\</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="preprocessor">    catch(...)\</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="preprocessor">    {\</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="preprocessor">      ;\</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="preprocessor">    }\</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="preprocessor">  }</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">   *  Note : we don&#39;t attempt to trap non std::exception exceptions</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">   *  here because doing so interferes with pthread_exit on some OSes.</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">  catch (...)\</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">  {\</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">    try\</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">    {\</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">      me-&gt;_exceptionListener-&gt;exceptionThrown(AMPS::AMPSException(\</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">          &quot;An unhandled exception of unknown type was thrown by &quot;\</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">          &quot;the registered handler.&quot;, AMPS_E_USAGE));\</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">    }\</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">    catch(...)\</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">    {\</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">      ;\</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">    }\</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">  }*/</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="preprocessor">#define AMPS_CALL_EXCEPTION_WRAPPER_STREAM_FULL_2(me, x)\</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="preprocessor">  while(me-&gt;_connected)\</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="preprocessor">  {\</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="preprocessor">    try\</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="preprocessor">    {\</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="preprocessor">      x;\</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="preprocessor">      break;\</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="preprocessor">    }\</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="preprocessor">    catch(MessageStreamFullException&amp; ex_)\</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="preprocessor">    {\</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="preprocessor">      me-&gt;checkAndSendHeartbeat(false);\</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="preprocessor">    }\</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="preprocessor">  }</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="preprocessor">#define AMPS_UNHANDLED_EXCEPTION(ex) \</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="preprocessor">  try\</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="preprocessor">  {\</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="preprocessor">    _exceptionListener-&gt;exceptionThrown(ex);\</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="preprocessor">  }\</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="preprocessor">  catch(...)\</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="preprocessor">  {;}</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="preprocessor">#define AMPS_UNHANDLED_EXCEPTION_2(me,ex) \</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="preprocessor">  try\</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="preprocessor">  {\</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="preprocessor">    me-&gt;_exceptionListener-&gt;exceptionThrown(ex);\</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="preprocessor">  }\</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="preprocessor">  catch(...)\</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="preprocessor">  {;}</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1Client.html">Client</a>;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html">  441</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1Command.html">Command</a></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <a class="code" href="classAMPS_1_1Message.html">Message</a> _message;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordtype">unsigned</span> _timeout;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordtype">unsigned</span> _batchSize;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordtype">unsigned</span> _flags;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> Subscribe           = 1;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> SOW                 = 2;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> NeedsSequenceNumber = 4;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ProcessedAck        = 8;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> StatsAck            = 16;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordtype">void</span> init(Message::Command::Type command_)</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    {</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      _timeout = 0;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      _batchSize = 0;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      _flags = 0;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      _message.reset();</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ab84e7ca0d5f72269208b0647b67c0375">setCommandEnum</a>(command_);</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      _setIds();</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    }</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordtype">void</span> init(<span class="keyword">const</span> std::string&amp; command_)</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    {</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      _timeout = 0;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      _batchSize = 0;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      _flags = 0;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      _message.reset();</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#af39105be28f361f2323148114509f663">setCommand</a>(command_);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      _setIds();</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    }</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordtype">void</span> init(<span class="keyword">const</span> <span class="keywordtype">char</span>* command_, <span class="keywordtype">size_t</span> commandLen_)</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    {</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      _timeout = 0;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      _batchSize = 0;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      _flags = 0;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      _message.reset();</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#af39105be28f361f2323148114509f663">setCommand</a>(command_, commandLen_);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      _setIds();</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    }</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordtype">void</span> _setIds(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    {</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      Message::Command::Type command = _message.<a class="code" href="classAMPS_1_1Message.html#a3e9f467321699a813340e57d4161f3e6">getCommandEnum</a>();</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <span class="keywordflow">if</span> (!(command &amp; Message::Command::NoDataCommands))</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      {</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <span class="keywordflow">if</span> (command == Message::Command::Subscribe ||</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            command == Message::Command::SOWAndSubscribe ||</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            command == Message::Command::DeltaSubscribe ||</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            command == Message::Command::SOWAndDeltaSubscribe)</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;          _message.<a class="code" href="classAMPS_1_1Message.html#aba905c4e623ad81e1cd100d2da197024">setSubscriptionId</a>(_message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>());</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;          _flags |= Subscribe;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        }</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="keywordflow">if</span> (command == Message::Command::SOW</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            || command == Message::Command::SOWAndSubscribe</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            || command == Message::Command::SOWAndDeltaSubscribe)</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        {</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;          _message.<a class="code" href="classAMPS_1_1Message.html#a1a814beb4b54f23e364cac2f929b3bfe">setQueryID</a>(_message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>());</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;          <span class="keywordflow">if</span> (_batchSize == 0)</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;          {</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            setBatchSize(AMPS_DEFAULT_BATCH_SIZE);</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;          }</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;          <span class="keywordflow">if</span> (command == Message::Command::SOW)</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;          {</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            _flags |= SOW;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;          }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        }</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        _flags |= ProcessedAck;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      }</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command == Message::Command::SOWDelete)</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      {</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        _flags |= ProcessedAck;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        _flags |= NeedsSequenceNumber;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      }</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command == Message::Command::Publish</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;               || command == Message::Command::DeltaPublish)</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      {</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        _flags |= NeedsSequenceNumber;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command == Message::Command::StopTimer)</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      {</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      }</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    }</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l00529"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a9bc5e9a4db84fc9f2c3570ee3ad6a3c3">  529</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html#a9bc5e9a4db84fc9f2c3570ee3ad6a3c3">Command</a>(<span class="keyword">const</span> std::string&amp; command_)</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    {</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      init(command_);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    }</div><div class="line"><a name="l00537"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#abe60c2afbfddcd1eb2e2f2d035100e83">  537</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html#abe60c2afbfddcd1eb2e2f2d035100e83">Command</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* command_, <span class="keywordtype">size_t</span> commandLen_)</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      init(command_, commandLen_);</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    }</div><div class="line"><a name="l00544"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a8d27c7a091022a3d09885f0f75eb57ab">  544</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html#a8d27c7a091022a3d09885f0f75eb57ab">Command</a>(Message::Command::Type command_)</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    {</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      init(command_);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    }</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#afb5f2abac84771cc21a79726a9c7f520">  552</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#afb5f2abac84771cc21a79726a9c7f520">reset</a>(<span class="keyword">const</span> std::string&amp; command_)</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    {</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      init(command_);</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    }</div><div class="line"><a name="l00561"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#ae2a297fa51e30777207361e090fe72d5">  561</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#ae2a297fa51e30777207361e090fe72d5">reset</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* command_, <span class="keywordtype">size_t</span> commandLen_)</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    {</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      init(command_, commandLen_);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    }</div><div class="line"><a name="l00569"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a4b1ae75ee305b560aec92535d83ec583">  569</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a4b1ae75ee305b560aec92535d83ec583">reset</a>(Message::Command::Type command_)</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    {</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      init(command_);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    }</div><div class="line"><a name="l00581"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#ad69da394a06b70a520377454c2c295f9">  581</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#ad69da394a06b70a520377454c2c295f9">setSowKey</a>(<span class="keyword">const</span> std::string&amp; sowKey_)</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    {</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a91c7836acad3ba13f71c2de6a320cfc7">setSowKey</a>(sowKey_);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    }</div><div class="line"><a name="l00594"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a28458656d98019132b6f12e6e6d6beab">  594</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a28458656d98019132b6f12e6e6d6beab">setSowKey</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* sowKey_, <span class="keywordtype">size_t</span> sowKeyLen_)</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    {</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a91c7836acad3ba13f71c2de6a320cfc7">setSowKey</a>(sowKey_, sowKeyLen_);</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    }</div><div class="line"><a name="l00611"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#ad92fd7193d751b22bb5798d61e82869a">  611</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#ad92fd7193d751b22bb5798d61e82869a">setSowKeys</a>(<span class="keyword">const</span> std::string&amp; sowKeys_)</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    {</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ae137f7a16fe053ab0d487d551780a744">setSowKeys</a>(sowKeys_);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    }</div><div class="line"><a name="l00629"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a718262bf4e93bd1a3268a63f2da2286e">  629</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a718262bf4e93bd1a3268a63f2da2286e">setSowKeys</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* sowKeys_, <span class="keywordtype">size_t</span> sowKeysLen_)</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    {</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ae137f7a16fe053ab0d487d551780a744">setSowKeys</a>(sowKeys_, sowKeysLen_);</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    }</div><div class="line"><a name="l00635"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a72986309f5f7ddc9bd34704d5a771b50">  635</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a72986309f5f7ddc9bd34704d5a771b50">setCommandId</a>(<span class="keyword">const</span> std::string&amp; cmdId_)</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a71cf9429e3173c45d74b70ffd7736ece">setCommandId</a>(cmdId_);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    }</div><div class="line"><a name="l00642"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a83a0aad855b226d75ebbae2c3ad150f3">  642</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a83a0aad855b226d75ebbae2c3ad150f3">setCommandId</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* cmdId_, <span class="keywordtype">size_t</span> cmdIdLen_)</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    {</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a71cf9429e3173c45d74b70ffd7736ece">setCommandId</a>(cmdId_, cmdIdLen_);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    }</div><div class="line"><a name="l00648"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a06fbdc5c3e1d46c2a81b6f106fbe7731">  648</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a06fbdc5c3e1d46c2a81b6f106fbe7731">setTopic</a>(<span class="keyword">const</span> std::string&amp; topic_)</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    {</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ab68a4ca105280880c57e3bb29506c2c6">setTopic</a>(topic_);</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    }</div><div class="line"><a name="l00655"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#aa0cfeafe37d2b3a30518c88a869f2c2f">  655</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#aa0cfeafe37d2b3a30518c88a869f2c2f">setTopic</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_, <span class="keywordtype">size_t</span> topicLen_)</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    {</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ab68a4ca105280880c57e3bb29506c2c6">setTopic</a>(topic_, topicLen_);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    }</div><div class="line"><a name="l00661"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#aa5bbd6590624610a555e3928addca1a2">  661</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#aa5bbd6590624610a555e3928addca1a2">setFilter</a>(<span class="keyword">const</span> std::string&amp; filter_)</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    {</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#abaa87b57b3fd2b92efba6a2987b825f2">setFilter</a>(filter_);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    }</div><div class="line"><a name="l00668"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#aba9624de4f611d56fcdf415377ff6d1f">  668</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#aba9624de4f611d56fcdf415377ff6d1f">setFilter</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* filter_, <span class="keywordtype">size_t</span> filterLen_)</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    {</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#abaa87b57b3fd2b92efba6a2987b825f2">setFilter</a>(filter_, filterLen_);</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    }</div><div class="line"><a name="l00674"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a26f34e7d69627feca5880a5298007b63">  674</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a26f34e7d69627feca5880a5298007b63">setOrderBy</a>(<span class="keyword">const</span> std::string&amp; orderBy_)</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    {</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a6b211029971140a5c5c0f9f1416c6f2e">setOrderBy</a>(orderBy_);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    }</div><div class="line"><a name="l00681"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a8dc288f3f9fb70f39783939a32f2c0f1">  681</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a8dc288f3f9fb70f39783939a32f2c0f1">setOrderBy</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* orderBy_, <span class="keywordtype">size_t</span> orderByLen_)</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    {</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a6b211029971140a5c5c0f9f1416c6f2e">setOrderBy</a>(orderBy_, orderByLen_);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    }</div><div class="line"><a name="l00687"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a7228cb64f1bc52d086d96928c6b4f29d">  687</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a7228cb64f1bc52d086d96928c6b4f29d">setSubId</a>(<span class="keyword">const</span> std::string&amp; subId_)</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    {</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#aba905c4e623ad81e1cd100d2da197024">setSubscriptionId</a>(subId_);</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    }</div><div class="line"><a name="l00694"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a4daebac94b438bf99cb0efd782095950">  694</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a4daebac94b438bf99cb0efd782095950">setSubId</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* subId_, <span class="keywordtype">size_t</span> subIdLen_)</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    {</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#aba905c4e623ad81e1cd100d2da197024">setSubscriptionId</a>(subId_, subIdLen_);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    }</div><div class="line"><a name="l00700"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a9719923668a86708e2a18a05e22a7da4">  700</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a9719923668a86708e2a18a05e22a7da4">setQueryId</a>(<span class="keyword">const</span> std::string&amp; queryId_)</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    {</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a7d503375ce8227f2e428fcbbe41c8310">setQueryId</a>(queryId_);</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    }</div><div class="line"><a name="l00707"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a41d4fe90af9fa7e64631cdbf38d4474c">  707</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a41d4fe90af9fa7e64631cdbf38d4474c">setQueryId</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* queryId_, <span class="keywordtype">size_t</span> queryIdLen_)</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    {</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a7d503375ce8227f2e428fcbbe41c8310">setQueryId</a>(queryId_, queryIdLen_);</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    }</div><div class="line"><a name="l00717"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#ae76a87584bbabbd04387c890000c8653">  717</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#ae76a87584bbabbd04387c890000c8653">setBookmark</a>(<span class="keyword">const</span> std::string&amp; bookmark_)</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    {</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a5bfe27b946a745eac652586d09e71438">setBookmark</a>(bookmark_);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    }</div><div class="line"><a name="l00728"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a3fd62107459f6d1f9efcc3dbd3195014">  728</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a3fd62107459f6d1f9efcc3dbd3195014">setBookmark</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* bookmark_, <span class="keywordtype">size_t</span> bookmarkLen_)</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    {</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a5bfe27b946a745eac652586d09e71438">setBookmark</a>(bookmark_, bookmarkLen_);</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    }</div><div class="line"><a name="l00739"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#aac68ea7a5194fc37ea7fce24e6f1b2e2">  739</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#aac68ea7a5194fc37ea7fce24e6f1b2e2">setCorrelationId</a>(<span class="keyword">const</span> std::string&amp; correlationId_)</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    {</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#af74da8269d78337655907680cb03c950">setCorrelationId</a>(correlationId_);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    }</div><div class="line"><a name="l00751"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#abff58b407ee65fa3ba3bc30a0a901b37">  751</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#abff58b407ee65fa3ba3bc30a0a901b37">setCorrelationId</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* correlationId_, <span class="keywordtype">size_t</span> correlationIdLen_)</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    {</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#af74da8269d78337655907680cb03c950">setCorrelationId</a>(correlationId_, correlationIdLen_);</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    }</div><div class="line"><a name="l00758"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a57b4ea42d4917e552593cdd3d59cb34c">  758</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a57b4ea42d4917e552593cdd3d59cb34c">setOptions</a>(<span class="keyword">const</span> std::string&amp; options_)</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    {</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a946e77e4579c0fc419887743de0e333d">setOptions</a>(options_);</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    }</div><div class="line"><a name="l00766"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a2754902102892e4072feee3d6f356fe7">  766</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a2754902102892e4072feee3d6f356fe7">setOptions</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* options_, <span class="keywordtype">size_t</span> optionsLen_)</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    {</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a946e77e4579c0fc419887743de0e333d">setOptions</a>(options_, optionsLen_);</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    }</div><div class="line"><a name="l00772"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a7f762adedb0c899de4c948a32c52af0c">  772</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a7f762adedb0c899de4c948a32c52af0c">setSequence</a>(<span class="keyword">const</span> std::string&amp; seq_)</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    {</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a6a226fb422c3baf9b5304b292e7cd950">setSequence</a>(seq_);</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    }</div><div class="line"><a name="l00779"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a06736e24beb25dcb27c50f5d8bbf12d8">  779</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a06736e24beb25dcb27c50f5d8bbf12d8">setSequence</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* seq_, <span class="keywordtype">size_t</span> seqLen_)</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    {</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a6a226fb422c3baf9b5304b292e7cd950">setSequence</a>(seq_, seqLen_);</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    }</div><div class="line"><a name="l00785"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a4f92fd299fdcae768723b0ae286cea89">  785</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a4f92fd299fdcae768723b0ae286cea89">setSequence</a>(<span class="keyword">const</span> amps_uint64_t seq_)</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    {</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      std::ostringstream os;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      os &lt;&lt; seq_;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a6a226fb422c3baf9b5304b292e7cd950">setSequence</a>(os.str());</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    }</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    amps_uint64_t getSequence()<span class="keyword"> const</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="amps_8h.html#a55949576a6ac830600d5e356308308c4">amps_message_get_field_uint64</a>(_message.getMessage(), AMPS_Sequence);</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    }</div><div class="line"><a name="l00798"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a95f64efcf26813d9a2888b115eaa2e82">  798</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a95f64efcf26813d9a2888b115eaa2e82">setData</a>(<span class="keyword">const</span> std::string&amp; data_)</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    {</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#afbdb7364fc7634f7a25751a5c284686b">setData</a>(data_);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    }</div><div class="line"><a name="l00806"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a02de7745dd770b0cd6eae121767831f6">  806</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a02de7745dd770b0cd6eae121767831f6">setData</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> dataLen_)</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    {</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#afbdb7364fc7634f7a25751a5c284686b">setData</a>(data_, dataLen_);</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    }</div><div class="line"><a name="l00820"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a3b178e108bbc1d6f48b40039c714975e">  820</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a3b178e108bbc1d6f48b40039c714975e">setTimeout</a>(<span class="keywordtype">unsigned</span> timeout_)</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    {</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      _timeout = timeout_;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    }</div><div class="line"><a name="l00826"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a036e74005b6221c1ffbdad734eda9588">  826</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a036e74005b6221c1ffbdad734eda9588">setTopN</a>(<span class="keywordtype">unsigned</span> topN_)</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    {</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a806ab5b1e5e69c8541d6c35f891b9905">setTopNRecordsReturned</a>(topN_);</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    }</div><div class="line"><a name="l00835"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a4da5f284f51b7eccc4e758e9c3d2f0cb">  835</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a4da5f284f51b7eccc4e758e9c3d2f0cb">setBatchSize</a>(<span class="keywordtype">unsigned</span> batchSize_)</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    {</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ae70b22f7c5a65f058e25fa9b4ccbca20">setBatchSize</a>(batchSize_);</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;      _batchSize = batchSize_;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    }</div><div class="line"><a name="l00851"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#ae65e7a153a338239210ec52786717384">  851</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#ae65e7a153a338239210ec52786717384">setExpiration</a>(<span class="keywordtype">unsigned</span> expiration_)</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    {</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a1ec9017cd6fd7acf3dff2123a5189b6d">setExpiration</a>(expiration_);</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    }</div><div class="line"><a name="l00857"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#adb6b8d41f238cae8188bc120f09d0860">  857</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#adb6b8d41f238cae8188bc120f09d0860">addAckType</a>(<span class="keyword">const</span> std::string&amp; ackType_)</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    {</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a862bfc9f74ca5b47689e84873180331e">setAckType</a>(_message.<a class="code" href="classAMPS_1_1Message.html#a3a466c84aa258673083b621733a595df">getAckType</a>() + <span class="stringliteral">&quot;,&quot;</span> + ackType_);</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      <span class="keywordflow">if</span> (ackType_ == <span class="stringliteral">&quot;processed&quot;</span>)</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      {</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        _flags |= ProcessedAck;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      }</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ackType_ == <span class="stringliteral">&quot;stats&quot;</span>)</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      {</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        _flags |= StatsAck;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      }</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    }</div><div class="line"><a name="l00871"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a2e6f175a2f1b77cc51b0766d9ca44064">  871</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a2e6f175a2f1b77cc51b0766d9ca44064">setAckType</a>(<span class="keyword">const</span> std::string&amp; ackType_)</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    {</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a862bfc9f74ca5b47689e84873180331e">setAckType</a>(ackType_);</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      <span class="keywordflow">if</span> (ackType_.find(<span class="stringliteral">&quot;processed&quot;</span>) != std::string::npos)</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;      {</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        _flags |= ProcessedAck;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      }</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      {</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        _flags &amp;= ~ProcessedAck;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      }</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      <span class="keywordflow">if</span> (ackType_.find(<span class="stringliteral">&quot;stats&quot;</span>) != std::string::npos)</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      {</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        _flags |= StatsAck;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      }</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      {</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        _flags &amp;= ~StatsAck;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      }</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    }</div><div class="line"><a name="l00893"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a0efb7bc0a43730b866f6d68d357d4dac">  893</a></span>&#160;    <a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; <a class="code" href="classAMPS_1_1Command.html#a0efb7bc0a43730b866f6d68d357d4dac">setAckType</a>(<span class="keywordtype">unsigned</span> ackType_)</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    {</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(ackType_);</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      <span class="keywordflow">if</span> (ackType_ &amp; Message::AckType::Processed)</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      {</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        _flags |= ProcessedAck;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      }</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      {</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        _flags &amp;= ~ProcessedAck;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      }</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      <span class="keywordflow">if</span> (ackType_ &amp; Message::AckType::Stats)</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      {</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        _flags |= StatsAck;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      }</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      {</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        _flags &amp;= ~StatsAck;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      }</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    }</div><div class="line"><a name="l00915"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a3578f78b66ee6520eb1dd65f641715ea">  915</a></span>&#160;    std::string <a class="code" href="classAMPS_1_1Command.html#a3578f78b66ee6520eb1dd65f641715ea">getAckType</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      <span class="keywordflow">return</span> (std::string)(_message.<a class="code" href="classAMPS_1_1Message.html#a3a466c84aa258673083b621733a595df">getAckType</a>());</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    }</div><div class="line"><a name="l00920"></a><span class="lineno"><a class="line" href="classAMPS_1_1Command.html#a03cab2a448b7204d209f229c966bb151">  920</a></span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="classAMPS_1_1Command.html#a03cab2a448b7204d209f229c966bb151">getAckTypeEnum</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      <span class="keywordflow">return</span> _message.<a class="code" href="classAMPS_1_1Message.html#a7d58a2c39f59d6fca098efd4bb81d3b5">getAckTypeEnum</a>();</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    }</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; getMessage(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    {</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <span class="keywordflow">return</span> _message;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    }</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <span class="keywordtype">unsigned</span> getTimeout(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      <span class="keywordflow">return</span> _timeout;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    }</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="keywordtype">unsigned</span> getBatchSize(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      <span class="keywordflow">return</span> _batchSize;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    }</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keywordtype">bool</span> isSubscribe(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      <span class="keywordflow">return</span> _flags &amp; Subscribe;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    }</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keywordtype">bool</span> isSow(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      <span class="keywordflow">return</span> (_flags &amp; SOW) != 0;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    }</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="keywordtype">bool</span> hasProcessedAck(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      <span class="keywordflow">return</span> (_flags &amp; ProcessedAck) != 0;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    }</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <span class="keywordtype">bool</span> hasStatsAck(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;      <span class="keywordflow">return</span> (_flags &amp; StatsAck) != 0;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    }</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keywordtype">bool</span> needsSequenceNumber(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;      <span class="keywordflow">return</span> (_flags &amp; NeedsSequenceNumber) != 0;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    }</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  };</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00961"></a><span class="lineno"><a class="line" href="ampsplusplus_8hpp.html#a84d7a196cc2fccb02f9e593a827a3dfc">  961</a></span>&#160;  <span class="keyword">typedef</span> void(*DisconnectHandlerFunc)(<a class="code" href="classAMPS_1_1Client.html">Client</a>&amp;, <span class="keywordtype">void</span>* userData);</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1Message.html">Message</a>;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classAMPS_1_1Handler.html">Handler&lt;DisconnectHandlerFunc, Client&amp;&gt;</a> <a class="code" href="classAMPS_1_1Handler.html">DisconnectHandler</a>;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div><div class="line"><a name="l00968"></a><span class="lineno"><a class="line" href="classAMPS_1_1Authenticator.html">  968</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1Authenticator.html">Authenticator</a></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  {</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="keyword">virtual</span> ~<a class="code" href="classAMPS_1_1Authenticator.html">Authenticator</a>() {;}</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="keyword">virtual</span> std::string authenticate(<span class="keyword">const</span> std::string&amp; userName_, <span class="keyword">const</span> std::string&amp; password_) = 0;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="keyword">virtual</span> std::string retry(<span class="keyword">const</span> std::string&amp; userName_, <span class="keyword">const</span> std::string&amp; password_) = 0;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> completed(<span class="keyword">const</span> std::string&amp; userName_, <span class="keyword">const</span> std::string&amp; password_, <span class="keyword">const</span> std::string&amp; reason_) = 0;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  };</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div><div class="line"><a name="l00999"></a><span class="lineno"><a class="line" href="classAMPS_1_1DefaultAuthenticator.html">  999</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1DefaultAuthenticator.html">DefaultAuthenticator</a> : <span class="keyword">public</span> <a class="code" href="classAMPS_1_1Authenticator.html">Authenticator</a></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  {</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <span class="keyword">virtual</span> ~<a class="code" href="classAMPS_1_1DefaultAuthenticator.html">DefaultAuthenticator</a>() {;}</div><div class="line"><a name="l01005"></a><span class="lineno"><a class="line" href="classAMPS_1_1DefaultAuthenticator.html#a36c6103a7f172503f19a3d314f2df9d4"> 1005</a></span>&#160;    std::string <a class="code" href="classAMPS_1_1DefaultAuthenticator.html#a36c6103a7f172503f19a3d314f2df9d4">authenticate</a>(<span class="keyword">const</span> std::string&amp; <span class="comment">/*userName_*/</span>, <span class="keyword">const</span> std::string&amp; password_)</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    {</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;      <span class="keywordflow">return</span> password_;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    }</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div><div class="line"><a name="l01012"></a><span class="lineno"><a class="line" href="classAMPS_1_1DefaultAuthenticator.html#a5e0e20ec8ccfa247b669d218318d797f"> 1012</a></span>&#160;    std::string <a class="code" href="classAMPS_1_1DefaultAuthenticator.html#a5e0e20ec8ccfa247b669d218318d797f">retry</a>(<span class="keyword">const</span> std::string&amp; <span class="comment">/*userName_*/</span>, <span class="keyword">const</span> std::string&amp; <span class="comment">/*password_*/</span>)</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    {</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      <span class="keywordflow">throw</span> AuthenticationException(<span class="stringliteral">&quot;retry not implemented by DefaultAuthenticator.&quot;</span>);</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    }</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div><div class="line"><a name="l01017"></a><span class="lineno"><a class="line" href="classAMPS_1_1DefaultAuthenticator.html#a89cc5a38aeb64afb48a7b0cc12590321"> 1017</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1DefaultAuthenticator.html#a89cc5a38aeb64afb48a7b0cc12590321">completed</a>(<span class="keyword">const</span> std::string&amp; <span class="comment">/*userName_*/</span>, <span class="keyword">const</span> std::string&amp; <span class="comment">/* password_ */</span>, <span class="keyword">const</span> std::string&amp; <span class="comment">/* reason */</span>) {;}</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div><div class="line"><a name="l01022"></a><span class="lineno"><a class="line" href="classAMPS_1_1DefaultAuthenticator.html#a5e01247122ade887a4f4f17c649b50c0"> 1022</a></span>&#160;    <span class="keyword">static</span> <a class="code" href="classAMPS_1_1Authenticator.html">Authenticator</a>&amp; <a class="code" href="classAMPS_1_1DefaultAuthenticator.html#a5e01247122ade887a4f4f17c649b50c0">instance</a>()</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    {</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      <span class="keyword">static</span> <a class="code" href="classAMPS_1_1DefaultAuthenticator.html">DefaultAuthenticator</a> d;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      <span class="keywordflow">return</span> d;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    }</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  };</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div><div class="line"><a name="l01031"></a><span class="lineno"><a class="line" href="classAMPS_1_1StoreReplayer.html"> 1031</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1StoreReplayer.html">StoreReplayer</a></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  {</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> execute(<a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message_) = 0;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <span class="keyword">virtual</span> ~<a class="code" href="classAMPS_1_1StoreReplayer.html">StoreReplayer</a>() {;}</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  };</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1Store.html">Store</a>;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div><div class="line"><a name="l01053"></a><span class="lineno"><a class="line" href="ampsplusplus_8hpp.html#a9fa4264bf91045e7105b5502c0ee0e9c"> 1053</a></span>&#160;  <span class="keyword">typedef</span> bool (*PublishStoreResizeHandler)(<a class="code" href="classAMPS_1_1Store.html">Store</a> store_,</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                                            <span class="keywordtype">size_t</span> size_,</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                                            <span class="keywordtype">void</span>* userData_);</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01059"></a><span class="lineno"><a class="line" href="classAMPS_1_1StoreImpl.html"> 1059</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1StoreImpl.html">StoreImpl</a> : <span class="keyword">public</span> RefBody</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  {</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l01067"></a><span class="lineno"><a class="line" href="classAMPS_1_1StoreImpl.html#ae6dffba99210c30facc396491f271e77"> 1067</a></span>&#160;    <a class="code" href="classAMPS_1_1StoreImpl.html#ae6dffba99210c30facc396491f271e77">StoreImpl</a>(<span class="keywordtype">bool</span> errorOnPublishGap_ = <span class="keyword">false</span>)</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      : _resizeHandler(NULL)</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      , _resizeHandlerData(NULL)</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      , _errorOnPublishGap(errorOnPublishGap_)</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    {;}</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="keyword">virtual</span> amps_uint64_t store(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message_) = 0;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> discardUpTo(amps_uint64_t index_) = 0;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> replay(<a class="code" href="classAMPS_1_1StoreReplayer.html">StoreReplayer</a>&amp; replayer_) = 0;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> replaySingle(<a class="code" href="classAMPS_1_1StoreReplayer.html">StoreReplayer</a>&amp; replayer_, amps_uint64_t index_) = 0;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">size_t</span> unpersistedCount() <span class="keyword">const</span> = 0;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keyword">virtual</span> ~<a class="code" href="classAMPS_1_1StoreImpl.html">StoreImpl</a>() {;}</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> flush(<span class="keywordtype">long</span> timeout_) = 0;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;</div><div class="line"><a name="l01122"></a><span class="lineno"><a class="line" href="classAMPS_1_1StoreImpl.html#a2b96fcfc9e76a87c1854edc7c3f7d7ce"> 1122</a></span>&#160;    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">size_t</span> <a class="code" href="classAMPS_1_1StoreImpl.html#a2b96fcfc9e76a87c1854edc7c3f7d7ce">getUnsetPosition</a>()</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    {</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;      <span class="keywordflow">return</span> AMPS_UNSET_INDEX;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    }</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div><div class="line"><a name="l01129"></a><span class="lineno"><a class="line" href="classAMPS_1_1StoreImpl.html#a23e0d9dc3d5fbb2c45a1c990c9606cab"> 1129</a></span>&#160;    <span class="keyword">static</span> <span class="keyword">inline</span> amps_uint64_t <a class="code" href="classAMPS_1_1StoreImpl.html#a23e0d9dc3d5fbb2c45a1c990c9606cab">getUnsetSequence</a>()</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    {</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;      <span class="keywordflow">return</span> AMPS_UNSET_SEQUENCE;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    }</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="keyword">virtual</span> amps_uint64_t getLowestUnpersisted() <span class="keyword">const</span> = 0;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <span class="keyword">virtual</span> amps_uint64_t getLastPersisted() = 0;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div><div class="line"><a name="l01153"></a><span class="lineno"><a class="line" href="classAMPS_1_1StoreImpl.html#af38461a40772ee3147546e0e6132eea4"> 1153</a></span>&#160;    <span class="keyword">inline</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1StoreImpl.html#af38461a40772ee3147546e0e6132eea4">setResizeHandler</a>(PublishStoreResizeHandler handler_,</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                                         <span class="keywordtype">void</span>* userData_)</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    {</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      _resizeHandler = handler_;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;      _resizeHandlerData = userData_;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    }</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keyword">inline</span> <span class="keyword">virtual</span> <a class="code" href="ampsplusplus_8hpp.html#a9fa4264bf91045e7105b5502c0ee0e9c">PublishStoreResizeHandler</a> getResizeHandler()<span class="keyword"> const</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      <span class="keywordflow">return</span> _resizeHandler;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    }</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keywordtype">bool</span> callResizeHandler(<span class="keywordtype">size_t</span> newSize_);</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keyword">inline</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> setErrorOnPublishGap(<span class="keywordtype">bool</span> errorOnPublishGap_)</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    {</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      _errorOnPublishGap = errorOnPublishGap_;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    }</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="keyword">inline</span> <span class="keyword">virtual</span> <span class="keywordtype">bool</span> getErrorOnPublishGap()<span class="keyword"> const</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      <span class="keywordflow">return</span> _errorOnPublishGap;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    }</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  <span class="keyword">private</span>:</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <a class="code" href="ampsplusplus_8hpp.html#a9fa4264bf91045e7105b5502c0ee0e9c">PublishStoreResizeHandler</a> _resizeHandler;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="keywordtype">void</span>*                     _resizeHandlerData;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="keywordtype">bool</span>                      _errorOnPublishGap;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  };</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div><div class="line"><a name="l01185"></a><span class="lineno"><a class="line" href="classAMPS_1_1Store.html"> 1185</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1Store.html">Store</a></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  {</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    RefHandle&lt;StoreImpl&gt; _body;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <a class="code" href="classAMPS_1_1Store.html">Store</a>() {;}</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <a class="code" href="classAMPS_1_1Store.html">Store</a>(<a class="code" href="classAMPS_1_1StoreImpl.html">StoreImpl</a>* body_) : _body(body_) {;}</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <a class="code" href="classAMPS_1_1Store.html">Store</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Store.html">Store</a>&amp; rhs) : _body(rhs._body) {;}</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <a class="code" href="classAMPS_1_1Store.html">Store</a>&amp; operator=(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Store.html">Store</a>&amp; rhs)</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    {</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      _body = rhs._body;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    }</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;</div><div class="line"><a name="l01201"></a><span class="lineno"><a class="line" href="classAMPS_1_1Store.html#acb06fbca0f83c7c4dfc91662b9149dba"> 1201</a></span>&#160;    amps_uint64_t <a class="code" href="classAMPS_1_1Store.html#acb06fbca0f83c7c4dfc91662b9149dba">store</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message_)</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    {</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      <span class="keywordflow">return</span> _body.get().store(message_);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    }</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div><div class="line"><a name="l01212"></a><span class="lineno"><a class="line" href="classAMPS_1_1Store.html#a7ec3c52b0f3d54454f55d8ccb071151c"> 1212</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Store.html#a7ec3c52b0f3d54454f55d8ccb071151c">discardUpTo</a>(amps_uint64_t index_)</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    {</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;      _body.get().discardUpTo(index_);</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    }</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;</div><div class="line"><a name="l01221"></a><span class="lineno"><a class="line" href="classAMPS_1_1Store.html#a061742652521bbbf91709703cd75f8cc"> 1221</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Store.html#a061742652521bbbf91709703cd75f8cc">replay</a>(<a class="code" href="classAMPS_1_1StoreReplayer.html">StoreReplayer</a>&amp; replayer_)</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    {</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;      _body.get().replay(replayer_);</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    }</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div><div class="line"><a name="l01233"></a><span class="lineno"><a class="line" href="classAMPS_1_1Store.html#ac715c8dd8436c4c484e53a31668366a0"> 1233</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classAMPS_1_1Store.html#ac715c8dd8436c4c484e53a31668366a0">replaySingle</a>(<a class="code" href="classAMPS_1_1StoreReplayer.html">StoreReplayer</a>&amp; replayer_, amps_uint64_t index_)</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    {</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;      <span class="keywordflow">return</span> _body.get().replaySingle(replayer_, index_);</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    }</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;</div><div class="line"><a name="l01242"></a><span class="lineno"><a class="line" href="classAMPS_1_1Store.html#ac936fdf868fb74571577f3f6f9251930"> 1242</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="classAMPS_1_1Store.html#ac936fdf868fb74571577f3f6f9251930">unpersistedCount</a>()<span class="keyword"> const</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;      <span class="keywordflow">return</span> _body.get().unpersistedCount();</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    }</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div><div class="line"><a name="l01250"></a><span class="lineno"><a class="line" href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac"> 1250</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac">isValid</a>()<span class="keyword"> const</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      <span class="keywordflow">return</span> _body.isValid();</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    }</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;</div><div class="line"><a name="l01263"></a><span class="lineno"><a class="line" href="classAMPS_1_1Store.html#ab074d36fc26325c59630e90c5bd871b4"> 1263</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Store.html#ab074d36fc26325c59630e90c5bd871b4">flush</a>(<span class="keywordtype">long</span> timeout_ = 0)</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    {</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;      <span class="keywordflow">return</span> _body.get().flush(timeout_);</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    }</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;</div><div class="line"><a name="l01271"></a><span class="lineno"><a class="line" href="classAMPS_1_1Store.html#a928e1a334e213cb4d00a113e85984d52"> 1271</a></span>&#160;    amps_uint64_t <a class="code" href="classAMPS_1_1Store.html#a928e1a334e213cb4d00a113e85984d52">getLowestUnpersisted</a>()</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    {</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      <span class="keywordflow">return</span> _body.get().getLowestUnpersisted();</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    }</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div><div class="line"><a name="l01279"></a><span class="lineno"><a class="line" href="classAMPS_1_1Store.html#a5cf5ab022849a4bc25c5d4f75653cf8b"> 1279</a></span>&#160;    amps_uint64_t <a class="code" href="classAMPS_1_1Store.html#a5cf5ab022849a4bc25c5d4f75653cf8b">getLastPersisted</a>()</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    {</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      <span class="keywordflow">return</span> _body.get().getLastPersisted();</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    }</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;</div><div class="line"><a name="l01293"></a><span class="lineno"><a class="line" href="classAMPS_1_1Store.html#ab267b150a870f650ea5f3a5b6c6aac01"> 1293</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Store.html#ab267b150a870f650ea5f3a5b6c6aac01">setResizeHandler</a>(PublishStoreResizeHandler handler_,</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                          <span class="keywordtype">void</span>* userData_)</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    {</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;      _body.get().setResizeHandler(handler_, userData_);</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    }</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <a class="code" href="ampsplusplus_8hpp.html#a9fa4264bf91045e7105b5502c0ee0e9c">PublishStoreResizeHandler</a> getResizeHandler()<span class="keyword"> const</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;      <span class="keywordflow">return</span> _body.get().getResizeHandler();</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    }</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;</div><div class="line"><a name="l01308"></a><span class="lineno"><a class="line" href="classAMPS_1_1Store.html#ac7f5bd02d664786a067b1cf8b54728fa"> 1308</a></span>&#160;    <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Store.html#ac7f5bd02d664786a067b1cf8b54728fa">setErrorOnPublishGap</a>(<span class="keywordtype">bool</span> errorOnPublishGap_)</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    {</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      _body.get().setErrorOnPublishGap(errorOnPublishGap_);</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    }</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div><div class="line"><a name="l01317"></a><span class="lineno"><a class="line" href="classAMPS_1_1Store.html#aa2c8054f0f9cbd6728122a43a9aeb53f"> 1317</a></span>&#160;    <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classAMPS_1_1Store.html#aa2c8054f0f9cbd6728122a43a9aeb53f">getErrorOnPublishGap</a>()<span class="keyword"> const</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;      <span class="keywordflow">return</span> _body.get().getErrorOnPublishGap();</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    }</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;</div><div class="line"><a name="l01325"></a><span class="lineno"><a class="line" href="classAMPS_1_1Store.html#a0ec6dc4d797cb1e7f5ed68183c38d9c4"> 1325</a></span>&#160;    <a class="code" href="classAMPS_1_1StoreImpl.html">StoreImpl</a>* <span class="keyword">get</span>()</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    {</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;      <span class="keywordflow">if</span> (_body.isValid())</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;      {</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        <span class="keywordflow">return</span> &amp;_body.get();</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;      }</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;      {</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;      }</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    }</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  };</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;</div><div class="line"><a name="l01343"></a><span class="lineno"><a class="line" href="classAMPS_1_1FailedWriteHandler.html"> 1343</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1FailedWriteHandler.html">FailedWriteHandler</a></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  {</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <span class="keyword">virtual</span> ~<a class="code" href="classAMPS_1_1FailedWriteHandler.html">FailedWriteHandler</a>() {;}</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> failedWrite(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message_,</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                             <span class="keyword">const</span> <span class="keywordtype">char</span>* reason_, <span class="keywordtype">size_t</span> reasonLength_) = 0;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  };</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">bool</span> StoreImpl::callResizeHandler(<span class="keywordtype">size_t</span> newSize_)</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  {</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <span class="keywordflow">if</span> (_resizeHandler)</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    {</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;      <span class="keywordflow">return</span> _resizeHandler(<a class="code" href="classAMPS_1_1Store.html">Store</a>(<span class="keyword">this</span>), newSize_, _resizeHandlerData);</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    }</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  }</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;</div><div class="line"><a name="l01373"></a><span class="lineno"><a class="line" href="ampsplusplus_8hpp.html#a9bb281004cdd51708ed2e971f344c972"> 1373</a></span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="ampsplusplus_8hpp.html#a9bb281004cdd51708ed2e971f344c972">DangerousFlushPublishStoreResizeHandler</a>(<a class="code" href="classAMPS_1_1Store.html">Store</a> store_, <span class="keywordtype">size_t</span> <span class="comment">/*size_*/</span>,</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;                                                      <span class="keywordtype">void</span>* data_)</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;  {</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    <span class="keywordtype">long</span>* timeoutp = (<span class="keywordtype">long</span>*)data_;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <span class="keywordtype">size_t</span> count = store_.<a class="code" href="classAMPS_1_1Store.html#ac936fdf868fb74571577f3f6f9251930">unpersistedCount</a>();</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <span class="keywordflow">if</span> (count == 0)</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    {</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    }</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    <span class="keywordflow">try</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    {</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;      store_.<a class="code" href="classAMPS_1_1Store.html#ab074d36fc26325c59630e90c5bd871b4">flush</a>(*timeoutp);</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    }</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    <span class="keywordflow">catch</span> (<span class="keyword">const</span> TimedOutException&amp;)</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    <span class="keywordflow">catch</span> (<span class="keyword">const</span> TimedOutException&amp; e)</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    {</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    }</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="keywordflow">return</span> (count == store_.<a class="code" href="classAMPS_1_1Store.html#ac936fdf868fb74571577f3f6f9251930">unpersistedCount</a>());</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  }</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"><a class="line" href="classAMPS_1_1FailedResubscribeHandler.html"> 1401</a></span>&#160;<span class="keyword">class </span><a class="code" href="classAMPS_1_1FailedResubscribeHandler.html">FailedResubscribeHandler</a></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;{</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> failure(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message_, <span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; handler_,</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;                       <span class="keywordtype">unsigned</span> requestedAckTypes_,</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;                       <span class="keyword">const</span> AMPSException&amp; exception_) = 0;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;};</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01423"></a><span class="lineno"><a class="line" href="classAMPS_1_1SubscriptionManager.html"> 1423</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1SubscriptionManager.html">SubscriptionManager</a></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  {</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    <span class="keyword">virtual</span> ~<a class="code" href="classAMPS_1_1SubscriptionManager.html">SubscriptionManager</a>() {;}</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> subscribe(<a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a> messageHandler_, <span class="keyword">const</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message_,</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;                           <span class="keywordtype">unsigned</span> requestedAckTypes_) = 0;</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> unsubscribe(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Field.html">Message::Field</a>&amp; subId_) = 0;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> clear() = 0;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> resubscribe(Client&amp; client_) = 0;</div><div class="line"><a name="l01451"></a><span class="lineno"><a class="line" href="classAMPS_1_1SubscriptionManager.html#a763d96b233fdbccc2261a4b9312c7eac"> 1451</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1SubscriptionManager.html#a763d96b233fdbccc2261a4b9312c7eac">setFailedResubscribeHandler</a>(std::shared_ptr&lt;FailedResubscribeHandler&gt; handler_)</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    {</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;      _failedResubscribeHandler = handler_;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    }</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;  <span class="keyword">protected</span>:</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    std::shared_ptr&lt;FailedResubscribeHandler&gt; _failedResubscribeHandler;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;  };</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div><div class="line"><a name="l01463"></a><span class="lineno"><a class="line" href="classAMPS_1_1ConnectionStateListener.html"> 1463</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1ConnectionStateListener.html">ConnectionStateListener</a></div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;  {</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l01467"></a><span class="lineno"><a class="line" href="classAMPS_1_1ConnectionStateListener.html#a6b55fc390dd4591b2a89fd00113f1ef3"> 1467</a></span>&#160;    <span class="keyword">typedef</span> <span class="keyword">enum</span> { Disconnected = 0,</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;                   Shutdown = 1,</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;                   Connected = 2,</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;                   LoggedOn = 4,</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;                   PublishReplayed = 8,</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;                   HeartbeatInitiated = 16,</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;                   Resubscribed = 32,</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;                   UNKNOWN = 16384</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;                 } <a class="code" href="classAMPS_1_1ConnectionStateListener.html#a6b55fc390dd4591b2a89fd00113f1ef3">State</a>;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> connectionStateChanged(<a class="code" href="classAMPS_1_1ConnectionStateListener.html#a6b55fc390dd4591b2a89fd00113f1ef3">State</a> newState_) = 0;</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    <span class="keyword">virtual</span> ~<a class="code" href="classAMPS_1_1ConnectionStateListener.html">ConnectionStateListener</a>()  {;};</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  };</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;  <span class="keyword">class </span>MessageStreamImpl;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a>;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  <span class="keyword">typedef</span> void(*DeferredExecutionFunc)(<span class="keywordtype">void</span>*);</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;  <span class="keyword">class </span>ClientImpl : <span class="keyword">public</span> RefBody <span class="comment">// -V553</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;  {</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    <span class="comment">// Class to wrap turning of Nagle for things like flush and logon</span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keyword">class </span>NoDelay</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    {</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;      <span class="keyword">private</span>:</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        AMPS_SOCKET _socket;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        <span class="keywordtype">int</span> _noDelay;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        <span class="keywordtype">char</span>* _valuePtr;</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        <span class="keywordtype">int</span> _valueLen;</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        socklen_t _valueLen;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;      <span class="keyword">public</span>:</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;        NoDelay(<a class="code" href="amps_8h.html#acfa1278412265f3b4c421e77111ed2ce">amps_handle</a> client_)</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;        : _socket(AMPS_INVALID_SOCKET), _noDelay(0), _valueLen(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>))</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;        {</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;          _valuePtr = (<span class="keywordtype">char</span>*)&amp;_noDelay;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;          _socket = <a class="code" href="amps_8h.html#acbe9d0930eeaa8c7ef2d6620e779f2e2">amps_client_get_socket</a>(client_);</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;          <span class="keywordflow">if</span> (_socket != AMPS_INVALID_SOCKET)</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;          {</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;            getsockopt(_socket, IPPROTO_TCP, TCP_NODELAY, _valuePtr, &amp;_valueLen);</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;            <span class="keywordflow">if</span> (!_noDelay)</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;            {</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;              _noDelay = 1;</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;              setsockopt(_socket, IPPROTO_TCP, TCP_NODELAY, _valuePtr, _valueLen);</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;            }</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;            {</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;              _socket = AMPS_INVALID_SOCKET;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;            }</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;          }</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;        }</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        ~NoDelay()</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        {</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;          <span class="keywordflow">if</span> (_socket != AMPS_INVALID_SOCKET)</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;          {</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;            _noDelay = 0;</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;            setsockopt(_socket, IPPROTO_TCP, TCP_NODELAY, _valuePtr, _valueLen);</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;          }</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;        }</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    };</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    <span class="keyword">friend</span> <span class="keyword">class </span>Client;</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  <span class="keyword">protected</span>:</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    <a class="code" href="amps_8h.html#acfa1278412265f3b4c421e77111ed2ce">amps_handle</a> _client;</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    DisconnectHandler _disconnectHandler;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="keyword">enum</span> GlobalCommandTypeHandlers : <span class="keywordtype">size_t</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    {</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;      Publish = 0,</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;      SOW = 1,</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;      GroupBegin = 2,</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;      GroupEnd = 3,</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;      Heartbeat = 4,</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;      OOF = 5,</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;      Ack = 6,</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;      LastChance = 7,</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;      DuplicateMessage = 8,</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;      COUNT = 9</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    };</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    std::vector&lt;MessageHandler&gt; _globalCommandTypeHandlers;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <a class="code" href="classAMPS_1_1Message.html">Message</a> _message, _readMessage, _publishMessage, _deltaMessage, _beatMessage;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    <a class="code" href="classAMPS_1_1MessageRouter.html">MessageRouter</a> _routes;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    MessageRouter::RouteCache _routeCache;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <span class="keyword">mutable</span> Mutex _lock;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    std::string _name, _nameHash, _lastUri, _logonCorrelationData;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    amps_uint64_t _nameHashValue;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    <a class="code" href="classAMPS_1_1BookmarkStore.html">BookmarkStore</a> _bookmarkStore;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <a class="code" href="classAMPS_1_1Store.html">Store</a> _publishStore;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    <span class="keywordtype">bool</span> _isRetryOnDisconnect;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    amps_unique_ptr&lt;FailedWriteHandler&gt; _failedWriteHandler;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;<span class="preprocessor">#if __cplusplus &gt;= 201100L || _MSC_VER &gt;= 1900</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    std::atomic&lt;amps_uint64_t&gt; _lastSentHaSequenceNumber;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <span class="keyword">volatile</span> amps_uint64_t _lastSentHaSequenceNumber;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    AMPS_ATOMIC_TYPE_8 _logonInProgress;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    AMPS_ATOMIC_TYPE_8 _badTimeToHASubscribe;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    VersionInfo _serverVersion;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    Timer _heartbeatTimer;</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    amps_unique_ptr&lt;MessageStream&gt; _pEmptyMessageStream;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    <span class="comment">// queue data</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <span class="keywordtype">int</span>           _queueAckTimeout;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    <span class="keywordtype">bool</span>          _isAutoAckEnabled;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    <span class="keywordtype">unsigned</span>      _ackBatchSize;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    <span class="keywordtype">unsigned</span>      _queuedAckCount;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    <span class="keywordtype">unsigned</span>      _defaultMaxDepth;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    <span class="keyword">struct </span>QueueBookmarks</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    {</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;      QueueBookmarks(<span class="keyword">const</span> std::string&amp; topic_)</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;        : _topic(topic_)</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;        , _oldestTime(0)</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;        , _bookmarkCount(0)</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;      {;}</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;      std::string   _topic;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;      std::string   _data;</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;      amps_uint64_t _oldestTime;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;      <span class="keywordtype">unsigned</span>      _bookmarkCount;</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;    };</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    <span class="keyword">typedef</span> amps_uint64_t topic_hash;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    <span class="keyword">typedef</span> std::map&lt;topic_hash, QueueBookmarks&gt; TopicHashMap;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    TopicHashMap _topicHashMap;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    <span class="keyword">class </span>ClientStoreReplayer : <span class="keyword">public</span> <a class="code" href="classAMPS_1_1StoreReplayer.html">StoreReplayer</a></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;    {</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;      ClientImpl* _client;</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;      <span class="keywordtype">unsigned</span> _version;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;      <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04">amps_result</a> _res;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      ClientStoreReplayer()</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        : _client(NULL), _version(0), _res(<a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a>)</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;      {}</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;      ClientStoreReplayer(ClientImpl* client_)</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;        : _client(client_), _version(0), _res(<a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a>)</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;      {}</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;      <span class="keywordtype">void</span> setClient(ClientImpl* client_)</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;      {</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;        _client = client_;</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;      }</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;      <span class="keywordtype">void</span> execute(<a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message_)</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;      {</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;        <span class="keywordflow">if</span> (!_client)</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;        {</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;          <span class="keywordflow">throw</span> CommandException(<span class="stringliteral">&quot;Can&#39;t replay without a client.&quot;</span>);</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;        }</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;        amps_uint64_t index = <a class="code" href="amps_8h.html#a55949576a6ac830600d5e356308308c4">amps_message_get_field_uint64</a>(message_.getMessage(),</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;                                                            AMPS_Sequence);</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;        <span class="keywordflow">if</span> (index &gt; _client-&gt;_lastSentHaSequenceNumber)</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;        {</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;          _client-&gt;_lastSentHaSequenceNumber = index;</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;        }</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;        _res = <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a>;</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;        <span class="comment">// Don&#39;t replay a queue cancel message after a reconnect.</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;        <span class="comment">// Currently, the only messages that will have anything in options</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;        <span class="comment">// are cancel messages.</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;        <span class="keywordflow">if</span> (!message_.<a class="code" href="classAMPS_1_1Message.html#a9bfa516683f5fd04d0ab2e3161b2babc">getCommand</a>().<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>() &amp;&amp;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;            (!_client-&gt;_logonInProgress ||</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;             message_.<a class="code" href="classAMPS_1_1Message.html#afdc34084b92891f21370c9f848936cad">getOptions</a>().<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>() &lt; 6))</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;        {</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;          _res = <a class="code" href="amps_8h.html#ac34eedaa39d701459abd94bd14086b67">amps_client_send_with_version</a>(_client-&gt;_client,</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;                                               message_.getMessage(),</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;                                               &amp;_version);</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;          <span class="keywordflow">if</span> (_res != <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a>)</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;          {</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;            <span class="keywordflow">throw</span> DisconnectedException(<span class="stringliteral">&quot;AMPS Server disconnected during replay&quot;</span>);</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;          }</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;        }</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;      }</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    };</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    ClientStoreReplayer _replayer;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    <span class="keyword">class </span>FailedWriteStoreReplayer : <span class="keyword">public</span> <a class="code" href="classAMPS_1_1StoreReplayer.html">StoreReplayer</a></div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    {</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;      ClientImpl* _parent;</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span>* _reason;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;      <span class="keywordtype">size_t</span>      _reasonLength;</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;      <span class="keywordtype">size_t</span>      _replayCount;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;      FailedWriteStoreReplayer(ClientImpl* parent, <span class="keyword">const</span> <span class="keywordtype">char</span>* reason_, <span class="keywordtype">size_t</span> reasonLength_)</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        : _parent(parent),</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;          _reason(reason_),</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;          _reasonLength(reasonLength_),</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;          _replayCount(0)</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      {;}</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      <span class="keywordtype">void</span> execute(<a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message_)</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;      {</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        <span class="keywordflow">if</span> (_parent-&gt;_failedWriteHandler)</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        {</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;          ++_replayCount;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;          _parent-&gt;_failedWriteHandler-&gt;failedWrite(message_,</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                                                    _reason, _reasonLength);</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        }</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      }</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;      <span class="keywordtype">size_t</span> replayCount(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="keyword">      </span>{</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;        <span class="keywordflow">return</span> _replayCount;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      }</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    };</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    <span class="keyword">struct </span>AckResponseImpl : <span class="keyword">public</span> RefBody</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    {</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;      std::string username, password, reason, status, bookmark, options;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;      amps_uint64_t sequenceNo;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;      amps_uint64_t nameHashValue;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      VersionInfo serverVersion;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="preprocessor">#if __cplusplus &gt;= 201100L || _MSC_VER &gt;= 1900</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;      std::atomic&lt;bool&gt; responded;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;      std::atomic&lt;bool&gt; abandoned;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;      <span class="keyword">volatile</span> <span class="keywordtype">bool</span> responded;</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;      <span class="keyword">volatile</span> <span class="keywordtype">bool</span> abandoned;</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;      <span class="keywordtype">unsigned</span> connectionVersion;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;      AckResponseImpl() :</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        RefBody(),</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;        sequenceNo((amps_uint64_t)0),</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        serverVersion(),</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;        responded(<span class="keyword">false</span>),</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        abandoned(<span class="keyword">false</span>),</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;        connectionVersion(0)</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;      {</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;      }</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    };</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="keyword">class </span>AckResponse</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    {</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;      RefHandle&lt;AckResponseImpl&gt; _body;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;      AckResponse() : _body(NULL) {;}</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;      AckResponse(<span class="keyword">const</span> AckResponse&amp; rhs) : _body(rhs._body) {;}</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      <span class="keyword">static</span> AckResponse create()</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;      {</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;        AckResponse r;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        r._body = <span class="keyword">new</span> AckResponseImpl();</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;        <span class="keywordflow">return</span> r;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;      }</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;      <span class="keyword">const</span> std::string&amp; username()</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;      {</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;        <span class="keywordflow">return</span> _body.get().username;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;      }</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;      <span class="keywordtype">void</span> setUsername(<span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> len_)</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      {</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;        <span class="keywordflow">if</span> (data_)</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;        {</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;          _body.get().username.assign(data_, len_);</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;        }</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;        {</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;          _body.get().username.clear();</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        }</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;      }</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;      <span class="keyword">const</span> std::string&amp; password()</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;      {</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;        <span class="keywordflow">return</span> _body.get().password;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;      }</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;      <span class="keywordtype">void</span> setPassword(<span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> len_)</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;      {</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;        <span class="keywordflow">if</span> (data_)</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;        {</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;          _body.get().password.assign(data_, len_);</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;        }</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;        {</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;          _body.get().password.clear();</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        }</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;      }</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;      <span class="keyword">const</span> std::string&amp; reason()</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;      {</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;        <span class="keywordflow">return</span> _body.get().reason;</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;      }</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;      <span class="keywordtype">void</span> setReason(<span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> len_)</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;      {</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;        <span class="keywordflow">if</span> (data_)</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        {</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;          _body.get().reason.assign(data_, len_);</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;        }</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;        {</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;          _body.get().reason.clear();</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;        }</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;      }</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;      <span class="keyword">const</span> std::string&amp; status()</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;      {</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;        <span class="keywordflow">return</span> _body.get().status;</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;      }</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;      <span class="keywordtype">void</span> setStatus(<span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> len_)</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;      {</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;        <span class="keywordflow">if</span> (data_)</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;        {</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;          _body.get().status.assign(data_, len_);</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;        }</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        {</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;          _body.get().status.clear();</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        }</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;      }</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;      <span class="keyword">const</span> std::string&amp; bookmark()</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;      {</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;        <span class="keywordflow">return</span> _body.get().bookmark;</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      }</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      <span class="keywordtype">void</span> setBookmark(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Field.html">Field</a>&amp; bookmark_)</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;      {</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;        <span class="keywordflow">if</span> (!bookmark_.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>())</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;        {</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;          _body.get().bookmark.assign(bookmark_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), bookmark_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>());</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;          Field::parseBookmark(bookmark_, _body.get().nameHashValue,</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;                               _body.get().sequenceNo);</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;        }</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;        {</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;          _body.get().bookmark.clear();</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;          _body.get().sequenceNo = (amps_uint64_t)0;</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;          _body.get().nameHashValue = (amps_uint64_t)0;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;        }</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;      }</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      amps_uint64_t sequenceNo()<span class="keyword"> const</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;<span class="keyword">      </span>{</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;        <span class="keywordflow">return</span> _body.get().sequenceNo;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;      }</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;      amps_uint64_t nameHashValue()<span class="keyword"> const</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="keyword">      </span>{</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;        <span class="keywordflow">return</span> _body.get().nameHashValue;</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;      }</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;      <span class="keywordtype">void</span> setSequenceNo(<span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> len_)</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;      {</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;        amps_uint64_t result = (amps_uint64_t)0;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;        <span class="keywordflow">if</span> (data_)</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;        {</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; len_; ++i)</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;          {</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;            result *= (amps_uint64_t)10;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;            result += (amps_uint64_t)(data_[i] - <span class="charliteral">&#39;0&#39;</span>);</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;          }</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;        }</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;        _body.get().sequenceNo = result;</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;      }</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;      VersionInfo serverVersion()<span class="keyword"> const</span></div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="keyword">      </span>{</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;        <span class="keywordflow">return</span> _body.get().serverVersion;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;      }</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;      <span class="keywordtype">void</span> setServerVersion(<span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> len_)</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;      {</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;        <span class="keywordflow">if</span> (data_)</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;        {</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;          _body.get().serverVersion.setVersion(std::string(data_, len_));</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;        }</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;      }</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;      <span class="keywordtype">bool</span> responded()</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;      {</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;        <span class="keywordflow">return</span> _body.get().responded;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;      }</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;      <span class="keywordtype">void</span> setResponded()</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;      {</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;        _body.get().responded = <span class="keyword">true</span>;</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;      }</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;      <span class="keywordtype">bool</span> abandoned()</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;      {</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;        <span class="keywordflow">return</span> _body.get().abandoned;</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      }</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;      <span class="keywordtype">void</span> setAbandoned()</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;      {</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;        <span class="keywordflow">if</span> (_body.isValid())</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;        {</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;          _body.get().abandoned = <span class="keyword">true</span>;</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;        }</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;      }</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;      <span class="keywordtype">void</span> setConnectionVersion(<span class="keywordtype">unsigned</span> connectionVersion)</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;      {</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;        _body.get().connectionVersion = connectionVersion;</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;      }</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;      <span class="keywordtype">unsigned</span> getConnectionVersion()</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      {</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;        <span class="keywordflow">return</span> _body.get().connectionVersion;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;      }</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;      <span class="keywordtype">void</span> setOptions(<span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> len_)</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;      {</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;        <span class="keywordflow">if</span> (data_)</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;        {</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;          _body.get().options.assign(data_, len_);</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;        }</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;        {</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;          _body.get().options.clear();</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;        }</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;      }</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;      <span class="keyword">const</span> std::string&amp; options()</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;      {</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;        <span class="keywordflow">return</span> _body.get().options;</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      }</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;      AckResponse&amp; operator=(<span class="keyword">const</span> AckResponse&amp; rhs)</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;      {</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        _body = rhs._body;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;        <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;      }</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    };</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    <span class="keyword">typedef</span> std::map&lt;std::string, AckResponse&gt; AckMap;</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    AckMap _ackMap;</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;    Mutex  _ackMapLock;</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;    DefaultExceptionListener _defaultExceptionListener;</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;  <span class="keyword">protected</span>:</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    <span class="keyword">struct </span>DeferredExecutionRequest</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    {</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;      DeferredExecutionRequest(DeferredExecutionFunc func_,</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;                               <span class="keywordtype">void</span>*                 userData_)</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;        : _func(func_),</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;          _userData(userData_)</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;      {;}</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;      DeferredExecutionFunc _func;</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;      <span class="keywordtype">void</span>*                 _userData;</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    };</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAMPS_1_1ExceptionListener.html">ExceptionListener</a>* _exceptionListener;</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    std::shared_ptr&lt;const ExceptionListener&gt; _pExceptionListener;</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    amps_unique_ptr&lt;SubscriptionManager&gt; _subscriptionManager;</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    <span class="keyword">volatile</span> <span class="keywordtype">bool</span> _connected;</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    std::string _username;</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    <span class="keyword">typedef</span> std::set&lt;ConnectionStateListener*&gt; ConnectionStateListeners;</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    ConnectionStateListeners _connectionStateListeners;</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    <span class="keyword">typedef</span> std::vector&lt;DeferredExecutionRequest&gt; DeferredExecutionList;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    Mutex _deferredExecutionLock;</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    DeferredExecutionList _deferredExecutionList;</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;    <span class="keywordtype">unsigned</span> _heartbeatInterval;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;    <span class="keywordtype">unsigned</span> _readTimeout;</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    <span class="keywordtype">void</span> broadcastConnectionStateChanged(<a class="code" href="classAMPS_1_1ConnectionStateListener.html#a6b55fc390dd4591b2a89fd00113f1ef3">ConnectionStateListener::State</a> newState_)</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    {</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;      <span class="comment">// If we disconnected before we got to notification, don&#39;t notify.</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;      <span class="comment">// This should only be able to happen for Resubscribed, since the lock</span></div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;      <span class="comment">// is released to let the subscription manager run resubscribe so a</span></div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      <span class="comment">// disconnect could be called before the change is broadcast.</span></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;      <span class="keywordflow">if</span> (!_connected &amp;&amp; newState_ &gt; ConnectionStateListener::Connected)</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;      {</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;      }</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;      <span class="keywordflow">for</span> (ConnectionStateListeners::iterator it = _connectionStateListeners.begin(); it != _connectionStateListeners.end(); ++it)</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;      {</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;        AMPS_CALL_EXCEPTION_WRAPPER(</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;          (*it)-&gt;connectionStateChanged(newState_));</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;      }</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    }</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    <span class="keywordtype">unsigned</span> processedAck(<a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message);</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    <span class="keywordtype">unsigned</span> persistedAck(<a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; meesage);</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    <span class="keywordtype">void</span> lastChance(<a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message);</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    <span class="keywordtype">void</span> checkAndSendHeartbeat(<span class="keywordtype">bool</span> force = <span class="keyword">false</span>);</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    <span class="keyword">virtual</span> ConnectionInfo getConnectionInfo() <span class="keyword">const</span>;</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    <span class="keyword">static</span> <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04">amps_result</a></div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;    ClientImplMessageHandler(<a class="code" href="amps_8h.html#acfa1278412265f3b4c421e77111ed2ce">amps_handle</a> message, <span class="keywordtype">void</span>* userData);</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    ClientImplPreDisconnectHandler(<a class="code" href="amps_8h.html#acfa1278412265f3b4c421e77111ed2ce">amps_handle</a> client, <span class="keywordtype">unsigned</span> failedConnectionVersion, <span class="keywordtype">void</span>* userData);</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;    <span class="keyword">static</span> <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04">amps_result</a></div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    ClientImplDisconnectHandler(<a class="code" href="amps_8h.html#acfa1278412265f3b4c421e77111ed2ce">amps_handle</a> client, <span class="keywordtype">void</span>* userData);</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;    <span class="keywordtype">void</span> unsubscribeInternal(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>)</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    {</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;      <span class="keywordflow">if</span> (<span class="keywordtype">id</span>.empty())</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      {</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;      }</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;      <span class="comment">// remove the handler first to avoid any more message delivery</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;      <a class="code" href="classAMPS_1_1Field.html">Message::Field</a> subId;</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;      subId.assign(<span class="keywordtype">id</span>.data(), <span class="keywordtype">id</span>.length());</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;      _routes.removeRoute(subId);</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;      <span class="comment">// Lock is already acquired</span></div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;      <span class="keywordflow">if</span> (_subscriptionManager)</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;      {</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;        <span class="comment">// Have to unlock before calling into sub manager to avoid deadlock</span></div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;        Unlock&lt;Mutex&gt; unlock(_lock);</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;        _subscriptionManager-&gt;unsubscribe(subId);</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;      }</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;      _message.reset();</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ab84e7ca0d5f72269208b0647b67c0375">setCommandEnum</a>(Message::Command::Unsubscribe);</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#aba905c4e623ad81e1cd100d2da197024">setSubscriptionId</a>(<span class="keywordtype">id</span>);</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;      _sendWithoutRetry(_message);</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;      deferredExecution(&amp;amps_noOpFn, NULL);</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    }</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    AckResponse syncAckProcessing(<span class="keywordtype">long</span> timeout_, <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message_,</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;                                  <span class="keywordtype">bool</span> isHASubscribe_)</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    {</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;      <span class="keywordflow">return</span> syncAckProcessing(timeout_, message_,</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;                               (amps_uint64_t)0, isHASubscribe_);</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;    }</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;    AckResponse syncAckProcessing(<span class="keywordtype">long</span> timeout_, <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message_,</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;                                  amps_uint64_t haSeq = (amps_uint64_t)0,</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;                                  <span class="keywordtype">bool</span> isHASubscribe_ = <span class="keyword">false</span>)</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;    {</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;      <span class="comment">// inv: we already have _lock locked up.</span></div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      AckResponse ack = AckResponse::create();</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;      <span class="keywordflow">if</span> (1)</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;      {</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        Lock&lt;Mutex&gt; guard(_ackMapLock);</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;        _ackMap[message_.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>()] = ack;</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;      }</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;      ack.setConnectionVersion((<span class="keywordtype">unsigned</span>)_send(message_, haSeq, isHASubscribe_));</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;      <span class="keywordflow">if</span> (ack.getConnectionVersion() == 0)</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;      {</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;        <span class="comment">// Send failed</span></div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;        <span class="keywordflow">throw</span> DisconnectedException(<span class="stringliteral">&quot;Connection closed while waiting for response.&quot;</span>);</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;      }</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;      <span class="keywordtype">bool</span> timedOut = <span class="keyword">false</span>;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;      AMPS_START_TIMER(timeout_)</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;      <span class="keywordflow">while</span> (!timedOut &amp;&amp; !ack.responded() &amp;&amp; !ack.abandoned() &amp;&amp; _connected)</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;      {</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;        <span class="keywordflow">if</span> (timeout_)</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;        {</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;          timedOut = !_lock.wait(timeout_);</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;          <span class="comment">// May have woken up early, check real time</span></div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;          <span class="keywordflow">if</span> (timedOut)</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;          {</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;            AMPS_RESET_TIMER(timedOut, timeout_);</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;          }</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;        }</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;        {</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;          <span class="comment">// Using a timeout version to ensure python can interrupt</span></div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;          _lock.wait(1000);</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;          Unlock&lt;Mutex&gt; unlck(_lock);</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;          amps_invoke_waiting_function();</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;        }</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;      }</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;      <span class="keywordflow">if</span> (ack.responded())</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;      {</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;        <span class="keywordflow">if</span> (ack.status() != <span class="stringliteral">&quot;failure&quot;</span>)</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;        {</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;          <span class="keywordflow">if</span> (message_.<a class="code" href="classAMPS_1_1Message.html#a9bfa516683f5fd04d0ab2e3161b2babc">getCommand</a>() == <span class="stringliteral">&quot;logon&quot;</span>)</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;          {</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;            amps_uint64_t ackSequence = ack.sequenceNo();</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;            <span class="keywordflow">if</span> (_lastSentHaSequenceNumber &lt; ackSequence)</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;            {</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;              _lastSentHaSequenceNumber = ackSequence;</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;            }</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;            <span class="keywordflow">if</span> (_publishStore.<a class="code" href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac">isValid</a>())</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;            {</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;              <span class="comment">// If this throws, logon will fail and eitehr be</span></div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;              <span class="comment">// handled in HAClient/ServerChooser or by the caller</span></div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;              <span class="comment">// of logon.</span></div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;              _publishStore.<a class="code" href="classAMPS_1_1Store.html#a7ec3c52b0f3d54454f55d8ccb071151c">discardUpTo</a>(ackSequence);</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;              <span class="keywordflow">if</span> (_lastSentHaSequenceNumber &lt; _publishStore.<a class="code" href="classAMPS_1_1Store.html#a5cf5ab022849a4bc25c5d4f75653cf8b">getLastPersisted</a>())</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;              {</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;                _lastSentHaSequenceNumber = _publishStore.<a class="code" href="classAMPS_1_1Store.html#a5cf5ab022849a4bc25c5d4f75653cf8b">getLastPersisted</a>();</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;              }</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;            }</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;            _nameHash = ack.bookmark().substr(0, ack.bookmark().find(<span class="charliteral">&#39;|&#39;</span>));</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;            _nameHashValue = ack.nameHashValue();</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;            _serverVersion = ack.serverVersion();</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;            <span class="keywordflow">if</span> (_bookmarkStore.isValid())</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;            {</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;              _bookmarkStore.<a class="code" href="classAMPS_1_1BookmarkStore.html#a1111ca27840fa8b321f0b47ff0e99b88">setServerVersion</a>(_serverVersion);</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;            }</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;          }</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;          <span class="keywordflow">if</span> (_ackBatchSize)</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;          {</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;            <span class="keyword">const</span> std::string&amp; options = ack.options();</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;            <span class="keywordtype">size_t</span> index = options.find_first_of(<span class="stringliteral">&quot;max_backlog=&quot;</span>);</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;            <span class="keywordflow">if</span> (index != std::string::npos)</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;            {</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;              <span class="keywordtype">unsigned</span> data = 0;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;              <span class="keyword">const</span> <span class="keywordtype">char</span>* c = options.c_str() + index + 12;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;              <span class="keywordflow">while</span> (*c &amp;&amp; *c != <span class="charliteral">&#39;,&#39;</span>)</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;              {</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;                data = (data * 10) + (<span class="keywordtype">unsigned</span>)(*c++ -48);</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;              }</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;              <span class="keywordflow">if</span> (_ackBatchSize &gt; data)</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;              {</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;                _ackBatchSize = data;</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;              }</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;            }</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;          }</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;          <span class="keywordflow">return</span> ack;</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;        }</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">size_t</span> NotEntitled = 12;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;        std::string ackReason = ack.reason();</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;        <span class="keywordflow">if</span> (ackReason.length() == 0)</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;        {</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;          <span class="keywordflow">return</span> ack;  <span class="comment">// none</span></div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;        }</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;        <span class="keywordflow">if</span> (ackReason.length() == NotEntitled &amp;&amp;</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;            ackReason[0] == <span class="charliteral">&#39;n&#39;</span> &amp;&amp;</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;            message_.<a class="code" href="classAMPS_1_1Message.html#a1dacda9d7f12db2871bd13e3b4d8c62e">getUserId</a>().<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>() == 0)</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;        {</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;          message_.<a class="code" href="classAMPS_1_1Message.html#ad63229ae2f13d0d4f1aca228ccd902c6">assignUserId</a>(_username);</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;        }</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;        message_.throwFor(_client, ackReason);</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;      }</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;      <span class="keywordflow">else</span>     <span class="comment">// !ack.responded()</span></div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;      {</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;        <span class="keywordflow">if</span> (!ack.abandoned())</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;        {</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;          <span class="keywordflow">throw</span> TimedOutException(<span class="stringliteral">&quot;timed out waiting for operation.&quot;</span>);</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;        }</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;        {</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;          <span class="keywordflow">throw</span> DisconnectedException(<span class="stringliteral">&quot;Connection closed while waiting for response.&quot;</span>);</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;        }</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;      }</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;      <span class="keywordflow">return</span> ack;</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;    }</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    <span class="keywordtype">void</span> _cleanup(<span class="keywordtype">void</span>)</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;    {</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;      <span class="keywordflow">if</span> (!_client)</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;      {</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;      }</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;      <a class="code" href="amps_8h.html#ab497b6d4c689878c2fe99ba80fb64a62">amps_client_set_predisconnect_handler</a>(_client, NULL, 0L);</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;      <a class="code" href="amps_8h.html#af3c7405bbfab51b026e39b11295f6172">amps_client_set_disconnect_handler</a>(_client, NULL, 0L);</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;      AMPS_CALL_EXCEPTION_WRAPPER(ClientImpl::disconnect());</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;      _pEmptyMessageStream.reset(NULL);</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;      <a class="code" href="amps_8h.html#a24ba31c24748140d5e4870c33aab2fbd">amps_client_destroy</a>(_client);</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;      _client = NULL;</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;    }</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;    ClientImpl(<span class="keyword">const</span> std::string&amp; clientName)</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;      : _client(NULL), _name(clientName)</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;      , _isRetryOnDisconnect(<span class="keyword">true</span>)</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;      , _lastSentHaSequenceNumber((amps_uint64_t)0), _logonInProgress(0)</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;      , _badTimeToHASubscribe(0), _serverVersion()</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;      , _queueAckTimeout(AMPS_DEFAULT_QUEUE_ACK_TIMEOUT)</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;      , _isAutoAckEnabled(<span class="keyword">false</span>)</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;      , _ackBatchSize(0)</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;      , _queuedAckCount(0)</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;      , _defaultMaxDepth(0)</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;      , _connected(<span class="keyword">false</span>)</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;      , _heartbeatInterval(0)</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;      , _readTimeout(0)</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;    {</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;      _replayer.setClient(<span class="keyword">this</span>);</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;      _client = <a class="code" href="amps_8h.html#af1c2d862766f235158f10e8a2d368389">amps_client_create</a>(clientName.c_str());</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;      <a class="code" href="amps_8h.html#ac7816495baca710ac04603903aa172fb">amps_client_set_message_handler</a>(_client,</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;                                      (amps_handler)ClientImpl::ClientImplMessageHandler,</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;                                      <span class="keyword">this</span>);</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;      <a class="code" href="amps_8h.html#ab497b6d4c689878c2fe99ba80fb64a62">amps_client_set_predisconnect_handler</a>(_client,</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;                                            (amps_predisconnect_handler)ClientImpl::ClientImplPreDisconnectHandler,</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;                                            <span class="keyword">this</span>);</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;      <a class="code" href="amps_8h.html#af3c7405bbfab51b026e39b11295f6172">amps_client_set_disconnect_handler</a>(_client,</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                                         (amps_handler)ClientImpl::ClientImplDisconnectHandler,</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;                                         <span class="keyword">this</span>);</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;      _exceptionListener = &amp;_defaultExceptionListener;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; GlobalCommandTypeHandlers::COUNT; ++i)</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;      {</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;<span class="preprocessor">#ifdef AMPS_USE_EMPLACE</span></div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;        _globalCommandTypeHandlers.emplace_back(<a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>());</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;        _globalCommandTypeHandlers.push_back(<a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>());</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;      }</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;    }</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;    <span class="keyword">virtual</span> ~ClientImpl()</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;    {</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;      _cleanup();</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;    }</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;    <span class="keyword">const</span> std::string&amp; getName()<span class="keyword"> const</span></div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;      <span class="keywordflow">return</span> _name;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;    }</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;    <span class="keyword">const</span> std::string&amp; getNameHash()<span class="keyword"> const</span></div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;      <span class="keywordflow">return</span> _nameHash;</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;    }</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;    <span class="keyword">const</span> amps_uint64_t getNameHashValue()<span class="keyword"> const</span></div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;      <span class="keywordflow">return</span> _nameHashValue;</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    }</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;    <span class="keywordtype">void</span> setName(<span class="keyword">const</span> std::string&amp; name)</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;    {</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;      <span class="comment">// This operation will fail if the client&#39;s</span></div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;      <span class="comment">// name is already set.</span></div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;      <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04">amps_result</a> result = <a class="code" href="amps_8h.html#a598d1dad4cf605f0b46ec2de6649eae0">amps_client_set_name</a>(_client, name.c_str());</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;      <span class="keywordflow">if</span> (result != <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a>)</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;      {</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;        AMPSException::throwFor(_client, result);</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;      }</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;      _name = name;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;    }</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;    <span class="keyword">const</span> std::string&amp; getLogonCorrelationData()<span class="keyword"> const</span></div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;      <span class="keywordflow">return</span> _logonCorrelationData;</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;    }</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    <span class="keywordtype">void</span> setLogonCorrelationData(<span class="keyword">const</span> std::string&amp; logonCorrelationData_)</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;    {</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;      _logonCorrelationData = logonCorrelationData_;</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;    }</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    <span class="keywordtype">size_t</span> getServerVersion()<span class="keyword"> const</span></div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;      <span class="keywordflow">return</span> _serverVersion.getOldStyleVersion();</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;    }</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    VersionInfo getServerVersionInfo()<span class="keyword"> const</span></div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;      <span class="keywordflow">return</span> _serverVersion;</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;    }</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;    <span class="keyword">const</span> std::string&amp; getURI()<span class="keyword"> const</span></div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;      <span class="keywordflow">return</span> _lastUri;</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    }</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> connect(<span class="keyword">const</span> std::string&amp; uri)</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;    {</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;      _connect(uri);</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;    }</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> _connect(<span class="keyword">const</span> std::string&amp; uri)</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;    {</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;      _lastUri = uri;</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;      <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04">amps_result</a> result = <a class="code" href="amps_8h.html#a44ece132b32081e6c2191cc63326b198">amps_client_connect</a>(_client, uri.c_str());</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;      <span class="keywordflow">if</span> (result != <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a>)</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;      {</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;        AMPSException::throwFor(_client, result);</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;      }</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;      _message.reset();</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;      _deltaMessage.<a class="code" href="classAMPS_1_1Message.html#ab84e7ca0d5f72269208b0647b67c0375">setCommandEnum</a>(Message::Command::DeltaPublish);</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;      _publishMessage.<a class="code" href="classAMPS_1_1Message.html#ab84e7ca0d5f72269208b0647b67c0375">setCommandEnum</a>(Message::Command::Publish);</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;      _beatMessage.<a class="code" href="classAMPS_1_1Message.html#ab84e7ca0d5f72269208b0647b67c0375">setCommandEnum</a>(Message::Command::Heartbeat);</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      _beatMessage.<a class="code" href="classAMPS_1_1Message.html#a946e77e4579c0fc419887743de0e333d">setOptions</a>(<span class="stringliteral">&quot;beat&quot;</span>);</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;      _readMessage.setClientImpl(<span class="keyword">this</span>);</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;      <span class="keywordflow">if</span> (_queueAckTimeout)</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;      {</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;        result = <a class="code" href="amps_8h.html#ad5674cb8a55c793aa66de7c7068d923c">amps_client_set_idle_time</a>(_client, _queueAckTimeout);</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;        <span class="keywordflow">if</span> (result != <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a>)</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;        {</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;          AMPSException::throwFor(_client, result);</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;        }</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;      }</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;      _connected = <span class="keyword">true</span>;</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;      broadcastConnectionStateChanged(ConnectionStateListener::Connected);</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;    }</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    <span class="keywordtype">void</span> setDisconnected()</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;    {</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;      {</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;        Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;        <span class="keywordflow">if</span> (_connected)</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;        {</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;          AMPS_CALL_EXCEPTION_WRAPPER(broadcastConnectionStateChanged(ConnectionStateListener::Disconnected));</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;        }</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;        _connected = <span class="keyword">false</span>;</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;        _heartbeatTimer.setTimeout(0.0);</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;      }</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;      clearAcks(INT_MAX);</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;      <a class="code" href="amps_8h.html#a11605a2b33d17883c3496559d9d492d6">amps_client_disconnect</a>(_client);</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;      _routes.clear();</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;    }</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> disconnect()</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;    {</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;      AMPS_CALL_EXCEPTION_WRAPPER(flushAcks());</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;      setDisconnected();</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;      AMPS_CALL_EXCEPTION_WRAPPER(processDeferredExecutions());</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;      broadcastConnectionStateChanged(ConnectionStateListener::Shutdown);</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;    }</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;    <span class="keywordtype">void</span> clearAcks(<span class="keywordtype">unsigned</span> failedVersion)</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;    {</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;      <span class="comment">// Have to lock to prevent race conditions</span></div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;      Lock&lt;Mutex&gt; guard(_ackMapLock);</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;      {</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;        <span class="comment">// Go ahead and signal any waiters if they are around...</span></div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;        std::vector&lt;std::string&gt; worklist;</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;        <span class="keywordflow">for</span> (AckMap::iterator i = _ackMap.begin(), e = _ackMap.end(); i != e; ++i)</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;        {</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;          <span class="keywordflow">if</span> (i-&gt;second.getConnectionVersion() &lt;= failedVersion)</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;          {</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;            i-&gt;second.setAbandoned();</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;            worklist.push_back(i-&gt;first);</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;          }</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;        }</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;        <span class="keywordflow">for</span> (std::vector&lt;std::string&gt;::iterator j = worklist.begin(), e = worklist.end(); j != e; ++j)</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;        {</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;          _ackMap.erase(*j);</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;        }</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;      }</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;      _lock.signalAll();</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;    }</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;    <span class="keywordtype">int</span> send(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message)</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;    {</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;      <span class="keywordflow">return</span> _send(message);</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    }</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;    <span class="keywordtype">void</span> sendWithoutRetry(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message_)</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    {</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;      <span class="comment">// If we got here while logon was in progress, then we tried to send</span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;      <span class="comment">// while we were disconnected so throw DisconnectedException</span></div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;      <span class="keywordflow">if</span> (_logonInProgress)</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;      {</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;        <span class="keywordflow">throw</span> DisconnectedException(<span class="stringliteral">&quot;The client has been disconnected.&quot;</span>);</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;      }</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;      _sendWithoutRetry(message_);</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;    }</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;    <span class="keywordtype">void</span> _sendWithoutRetry(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message_)</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;    {</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;      <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04">amps_result</a> result = <a class="code" href="amps_8h.html#a4675b81308412798c6f2f0852ecc4ee6">amps_client_send</a>(_client, message_.getMessage());</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;      <span class="keywordflow">if</span> (result != <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a>)</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;      {</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;        AMPSException::throwFor(_client, result);</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;      }</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;    }</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;    <span class="keywordtype">int</span> _send(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message, amps_uint64_t haSeq = (amps_uint64_t)0,</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;              <span class="keywordtype">bool</span> isHASubscribe_ = <span class="keyword">false</span>)</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;    {</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;      <span class="comment">// Lock is already acquired</span></div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;      <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04">amps_result</a> result = <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a046fe5490917dab049a5a7c516c5b098">AMPS_E_RETRY</a>;</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;      <span class="comment">// Create a local reference to this message, as we&#39;ll need to hold on</span></div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;      <span class="comment">// to a reference to it in case reconnect occurs.</span></div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;      <a class="code" href="classAMPS_1_1Message.html">Message</a> localMessage = message;</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;      <span class="keywordtype">unsigned</span> version = 0;</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;      <span class="keywordflow">while</span> (result == <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a046fe5490917dab049a5a7c516c5b098">AMPS_E_RETRY</a>)</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;      {</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;        <span class="keywordflow">if</span> (haSeq &amp;&amp; _logonInProgress)</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;        {</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;          <span class="comment">// If retrySend is disabled, do not wait for the reconnect</span></div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;          <span class="comment">// to finish, just throw.</span></div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;          <span class="keywordflow">if</span> (!_isRetryOnDisconnect)</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;          {</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;            AMPSException::throwFor(_client, <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a046fe5490917dab049a5a7c516c5b098">AMPS_E_RETRY</a>);</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;          }</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;          <span class="keywordflow">if</span> (!_lock.wait(1000))</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;          {</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;            amps_invoke_waiting_function();</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;          }</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;        }</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;        {</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;          <span class="keywordflow">if</span> ((haSeq &amp;&amp; haSeq &lt;= _lastSentHaSequenceNumber) ||</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;              (isHASubscribe_ &amp;&amp; _badTimeToHASubscribe))</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;          {</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;            <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)version;</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;          }</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;          <span class="comment">// It&#39;s possible to get here out of order, but this way we&#39;ll</span></div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;          <span class="comment">// always send in order.</span></div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;          <span class="keywordflow">if</span> (haSeq &gt; _lastSentHaSequenceNumber)</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;          {</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;            <span class="keywordflow">while</span> (haSeq &gt; _lastSentHaSequenceNumber + 1)</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;            {</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;              <span class="keywordflow">try</span></div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;              {</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;                <span class="comment">// Replayer updates _lastSentHaSsequenceNumber</span></div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;                <span class="keywordflow">if</span> (!_publishStore.<a class="code" href="classAMPS_1_1Store.html#ac715c8dd8436c4c484e53a31668366a0">replaySingle</a>(_replayer,</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;                                                _lastSentHaSequenceNumber + 1))</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;                {</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;                  <span class="comment">//++_lastSentHaSequenceNumber;</span></div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;                  <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;                }</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;                result = <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a>;</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;                version = _replayer._version;</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;              }</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;              <span class="keywordflow">catch</span> (<span class="keyword">const</span> DisconnectedException&amp;)</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;              <span class="keywordflow">catch</span> (<span class="keyword">const</span> DisconnectedException&amp; e)</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;              {</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;                result = _replayer._res;</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;              }</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;            }</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;            result = <a class="code" href="amps_8h.html#ac34eedaa39d701459abd94bd14086b67">amps_client_send_with_version</a>(_client,</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;                                                   localMessage.getMessage(),</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;                                                   &amp;version);</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;            ++_lastSentHaSequenceNumber;</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;          }</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;          {</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;            <span class="keywordflow">if</span> (_logonInProgress &amp;&amp; localMessage.<a class="code" href="classAMPS_1_1Message.html#a9bfa516683f5fd04d0ab2e3161b2babc">getCommand</a>().<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>()[0] != <span class="charliteral">&#39;l&#39;</span>)</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;            {</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;              <span class="keywordflow">while</span> (_logonInProgress)</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;              {</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;                <span class="keywordflow">if</span> (!_lock.wait(1000))</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;                {</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;                  amps_invoke_waiting_function();</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;                }</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;              }</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;            }</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;            result = <a class="code" href="amps_8h.html#ac34eedaa39d701459abd94bd14086b67">amps_client_send_with_version</a>(_client,</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;                                                   localMessage.getMessage(),</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;                                                   &amp;version);</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;          }</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;          <span class="keywordflow">if</span> (result != <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a>)</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;          {</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;            <span class="keywordflow">if</span> (!isHASubscribe_ &amp;&amp; !haSeq &amp;&amp;</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;                localMessage.getMessage() == message.getMessage())</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;            {</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;              localMessage = message.<a class="code" href="classAMPS_1_1Message.html#afd3b5831324320af6566883f3b9ff9dd">deepCopy</a>();</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;            }</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;            <span class="keywordflow">if</span> (_isRetryOnDisconnect)</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;            {</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;              Unlock&lt;Mutex&gt; u(_lock);</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;              result = <a class="code" href="amps_8h.html#a68540fe2dee66d424783377b04aacca4">amps_client_attempt_reconnect</a>(_client, version);</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;              <span class="comment">// If this is an HA publish or subscribe command, it was</span></div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;              <span class="comment">// stored first and will have already been replayed by the</span></div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;              <span class="comment">// store or sub manager after reconnect, so just return.</span></div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;              <span class="keywordflow">if</span> ((isHASubscribe_ || haSeq) &amp;&amp;</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                  result == <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a046fe5490917dab049a5a7c516c5b098">AMPS_E_RETRY</a>)</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;              {</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;                <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)version;</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;              }</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;            }</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;            {</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;              <span class="comment">// retrySend is disabled so throw the error</span></div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;              <span class="comment">// from the send as an exception, do not retry.</span></div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;              AMPSException::throwFor(_client, result);</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;            }</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;          }</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;        }</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;        <span class="keywordflow">if</span> (result == <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a046fe5490917dab049a5a7c516c5b098">AMPS_E_RETRY</a>)</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;        {</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;          amps_invoke_waiting_function();</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;        }</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;      }</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;      <span class="keywordflow">if</span> (result != <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a>)</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;      {</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;        AMPSException::throwFor(_client, result);</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;      }</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;      <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)version;</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;    }</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;    <span class="keywordtype">void</span> addMessageHandler(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Field.html">Field</a>&amp; commandId_,</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;                           <span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">AMPS::MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;                           <span class="keywordtype">unsigned</span> requestedAcks_, <span class="keywordtype">bool</span> isSubscribe_)</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;    {</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;      Lock&lt;Mutex&gt; lock(_lock);</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;      _routes.addRoute(commandId_, messageHandler_, requestedAcks_,</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                       0, isSubscribe_);</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;    }</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;    <span class="keywordtype">bool</span> removeMessageHandler(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Field.html">Field</a>&amp; commandId_)</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;    {</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;      Lock&lt;Mutex&gt; lock(_lock);</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;      <span class="keywordflow">return</span> _routes.removeRoute(commandId_);</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;    }</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;    std::string send(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_, <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message_, <span class="keywordtype">int</span> timeout_ = 0)</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;    {</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;      <a class="code" href="classAMPS_1_1Field.html">Field</a> <span class="keywordtype">id</span> = message_.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;      <a class="code" href="classAMPS_1_1Field.html">Field</a> subId = message_.<a class="code" href="classAMPS_1_1Message.html#a4beb1e21b1dabf98cbb956f97fb95dbd">getSubscriptionId</a>();</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;      <a class="code" href="classAMPS_1_1Field.html">Field</a> qid = message_.<a class="code" href="classAMPS_1_1Message.html#a1b4db85007e3981904544f36371247ad">getQueryId</a>();</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;      <span class="keywordtype">bool</span> isSubscribe = <span class="keyword">false</span>;</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;      <span class="keywordtype">bool</span> isSubscribeOnly = <span class="keyword">false</span>;</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;      <span class="keywordtype">bool</span> replace = <span class="keyword">false</span>;</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;      <span class="keywordtype">unsigned</span> requestedAcks = message_.<a class="code" href="classAMPS_1_1Message.html#a7d58a2c39f59d6fca098efd4bb81d3b5">getAckTypeEnum</a>();</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;      <span class="keywordtype">unsigned</span> systemAddedAcks = Message::AckType::None;</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;      <span class="keywordflow">switch</span> (message_.<a class="code" href="classAMPS_1_1Message.html#a3e9f467321699a813340e57d4161f3e6">getCommandEnum</a>())</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;      {</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;      <span class="keywordflow">case</span> Message::Command::Subscribe:</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;      <span class="keywordflow">case</span> Message::Command::DeltaSubscribe:</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;        replace = message_.<a class="code" href="classAMPS_1_1Message.html#afdc34084b92891f21370c9f848936cad">getOptions</a>().operator std::string().find(AMPS_OPTIONS_REPLACE, 0, strlen(AMPS_OPTIONS_REPLACE) - 1) != std::string::npos;</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;        isSubscribeOnly = <span class="keyword">true</span>;</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;      <span class="comment">// fall through</span></div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;      <span class="keywordflow">case</span> Message::Command::SOWAndSubscribe:</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;      <span class="keywordflow">case</span> Message::Command::SOWAndDeltaSubscribe:</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;        <span class="keywordflow">if</span> (<span class="keywordtype">id</span>.empty())</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;        {</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;          <span class="keywordtype">id</span> = message_.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>().<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;        }</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;        {</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;          <span class="keywordflow">while</span> (!replace &amp;&amp; <span class="keywordtype">id</span> != subId &amp;&amp; _routes.hasRoute(<span class="keywordtype">id</span>))</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;          {</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;            <span class="keywordtype">id</span> = message_.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>().<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;          }</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;        }</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;        <span class="keywordflow">if</span> (subId.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>())</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;        {</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;          message_.<a class="code" href="classAMPS_1_1Message.html#aba905c4e623ad81e1cd100d2da197024">setSubscriptionId</a>(<span class="keywordtype">id</span>);</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;          subId = id;</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;        }</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;        isSubscribe = <span class="keyword">true</span>;</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;        <span class="keywordflow">if</span> (!message_.<a class="code" href="classAMPS_1_1Message.html#a7108ef0b54bc76e43dc4d49d700dc8ef">getBookmark</a>().<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>() &amp;&amp; _bookmarkStore.isValid())</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;        {</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;          systemAddedAcks |= Message::AckType::Persisted;</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;        }</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;      <span class="comment">// fall through</span></div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;      <span class="keywordflow">case</span> Message::Command::SOW:</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;        <span class="keywordflow">if</span> (<span class="keywordtype">id</span>.empty())</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;        {</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;          <span class="keywordtype">id</span> = message_.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>().<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;        }</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;        {</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;          <span class="keywordflow">while</span> (!replace &amp;&amp; <span class="keywordtype">id</span> != subId &amp;&amp; _routes.hasRoute(<span class="keywordtype">id</span>))</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;          {</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;            message_.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;            <span class="keywordflow">if</span> (qid == <span class="keywordtype">id</span>)</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;            {</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;              qid = message_.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;              message_.<a class="code" href="classAMPS_1_1Message.html#a7d503375ce8227f2e428fcbbe41c8310">setQueryId</a>(qid);</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;            }</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;            <span class="keywordtype">id</span> = message_.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;          }</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;        }</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;        <span class="keywordflow">if</span> (!isSubscribeOnly)</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;        {</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;          <span class="keywordflow">if</span> (qid.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>())</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;          {</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;            message_.<a class="code" href="classAMPS_1_1Message.html#a1a814beb4b54f23e364cac2f929b3bfe">setQueryID</a>(<span class="keywordtype">id</span>);</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;            qid = id;</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;          }</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;          {</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;            <span class="keywordflow">while</span> (!replace &amp;&amp; qid != subId &amp;&amp; qid != <span class="keywordtype">id</span></div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;                   &amp;&amp; _routes.hasRoute(qid))</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;            {</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;              qid = message_.<a class="code" href="classAMPS_1_1Message.html#af0abc1c791ec6cbc73e6a4e97b32a18c">newQueryId</a>().<a class="code" href="classAMPS_1_1Message.html#a1b4db85007e3981904544f36371247ad">getQueryId</a>();</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;            }</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;          }</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;        }</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;        systemAddedAcks |= Message::AckType::Processed;</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;        <span class="comment">// for SOW only, we get a completed ack so we know when to remove the handler.</span></div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;        <span class="keywordflow">if</span> (!isSubscribeOnly)</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;        {</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;          systemAddedAcks |= Message::AckType::Completed;</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;        }</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;        message_.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(requestedAcks | systemAddedAcks);</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;        {</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;          <span class="keywordtype">int</span> routesAdded = 0;</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;          Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;          <span class="keywordflow">if</span> (!subId.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>() &amp;&amp; messageHandler_.isValid())</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;          {</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;            <span class="keywordflow">if</span> (!_routes.hasRoute(subId))</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;            {</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;              ++routesAdded;</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;            }</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;            <span class="comment">// This can replace a non-subscribe with a matching id</span></div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;            <span class="comment">// with a subscription but not another subscription.</span></div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;            _routes.addRoute(subId, messageHandler_, requestedAcks,</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;                             systemAddedAcks, isSubscribe);</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;          }</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;          <span class="keywordflow">if</span> (!isSubscribeOnly &amp;&amp; !qid.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>()</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;              &amp;&amp; messageHandler_.isValid() &amp;&amp; qid != subId)</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;          {</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;            <span class="keywordflow">if</span> (routesAdded == 0)</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;            {</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;              _routes.addRoute(qid, messageHandler_,</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;                               requestedAcks, systemAddedAcks, <span class="keyword">false</span>);</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;            }</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;            {</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;              <span class="keywordtype">void</span>* data = NULL;</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;              {</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;                Unlock&lt;Mutex&gt; u(_lock);</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;                data = amps_invoke_copy_route_function(</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;                         messageHandler_.userData());</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;              }</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;              <span class="keywordflow">if</span> (!data)</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;              {</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;                _routes.addRoute(qid, messageHandler_, requestedAcks,</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;                                 systemAddedAcks, <span class="keyword">false</span>);</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;              }</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;              <span class="keywordflow">else</span></div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;              {</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;                _routes.addRoute(qid,</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;                                 <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(messageHandler_.function(),</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;                                                data),</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;                                 requestedAcks, systemAddedAcks, <span class="keyword">false</span>);</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;              }</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;            }</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;            ++routesAdded;</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;          }</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;          <span class="keywordflow">if</span> (!<span class="keywordtype">id</span>.empty() &amp;&amp; messageHandler_.isValid()</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;              &amp;&amp; requestedAcks &amp; ~<a class="code" href="classAMPS_1_1Message.html">Message</a>::AckType::Persisted</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;              &amp;&amp; <span class="keywordtype">id</span> != subId &amp;&amp; <span class="keywordtype">id</span> != qid)</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;          {</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;            <span class="keywordflow">if</span> (routesAdded == 0)</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;            {</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;              _routes.addRoute(<span class="keywordtype">id</span>, messageHandler_, requestedAcks,</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;                               systemAddedAcks, <span class="keyword">false</span>);</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;            }</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;            {</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;              <span class="keywordtype">void</span>* data = NULL;</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;              {</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;                Unlock&lt;Mutex&gt; u(_lock);</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;                data = amps_invoke_copy_route_function(</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;                         messageHandler_.userData());</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;              }</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;              <span class="keywordflow">if</span> (!data)</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;              {</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;                _routes.addRoute(<span class="keywordtype">id</span>, messageHandler_, requestedAcks,</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;                                 systemAddedAcks, <span class="keyword">false</span>);</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;              }</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;              <span class="keywordflow">else</span></div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;              {</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;                _routes.addRoute(<span class="keywordtype">id</span>,</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;                                 <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(messageHandler_.function(),</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;                                                data),</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;                                 requestedAcks,</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;                                 systemAddedAcks, <span class="keyword">false</span>);</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;              }</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;            }</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;            ++routesAdded;</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;          }</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;          <span class="keywordflow">try</span></div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;          {</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;            <span class="comment">// We aren&#39;t adding to subscription manager, so this isn&#39;t</span></div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;            <span class="comment">// an HA subscribe.</span></div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;            syncAckProcessing(timeout_, message_, 0, <span class="keyword">false</span>);</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;            message_.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(requestedAcks);</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;          }</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;          <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;          {</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;            _routes.removeRoute(message_.<a class="code" href="classAMPS_1_1Message.html#a636338403d40c748af5a33f931293f41">getQueryID</a>());</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;            _routes.removeRoute(message_.<a class="code" href="classAMPS_1_1Message.html#a4beb1e21b1dabf98cbb956f97fb95dbd">getSubscriptionId</a>());</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;            _routes.removeRoute(<span class="keywordtype">id</span>);</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;            message_.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(requestedAcks);</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;            <span class="keywordflow">throw</span>;</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;          }</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;        }</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;      <span class="comment">// These are valid commands that are used as-is</span></div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;      <span class="keywordflow">case</span> Message::Command::Unsubscribe:</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;      <span class="keywordflow">case</span> Message::Command::Heartbeat:</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;      <span class="keywordflow">case</span> Message::Command::Logon:</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;      <span class="keywordflow">case</span> Message::Command::StartTimer:</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;      <span class="keywordflow">case</span> Message::Command::StopTimer:</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;      <span class="keywordflow">case</span> Message::Command::SOWDelete:</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;      {</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;        Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;        <span class="comment">// if an ack is requested, it&#39;ll need a command ID.</span></div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;        <span class="keywordflow">if</span> (message_.<a class="code" href="classAMPS_1_1Message.html#a7d58a2c39f59d6fca098efd4bb81d3b5">getAckTypeEnum</a>() != Message::AckType::None)</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;        {</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;          <span class="keywordflow">if</span> (<span class="keywordtype">id</span>.empty())</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;          {</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;            message_.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;            <span class="keywordtype">id</span> = message_.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;          }</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;          <span class="keywordflow">if</span> (messageHandler_.isValid())</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;          {</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;            _routes.addRoute(<span class="keywordtype">id</span>, messageHandler_, requestedAcks,</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;                             Message::AckType::None, <span class="keyword">false</span>);</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;          }</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;        }</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;        _send(message_);</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;      }</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;      <span class="keywordflow">case</span> Message::Command::DeltaPublish:</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;      <span class="keywordflow">case</span> Message::Command::Publish:</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;      {</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;        <span class="keywordtype">bool</span> useSync = message_.<a class="code" href="classAMPS_1_1Message.html#a5fa58330c69b73c47b4d8bc3de6bfa06">getFilter</a>().<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>() &gt; 0;</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;        Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;        <span class="comment">// if an ack is requested, it&#39;ll need a command ID.</span></div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;        <span class="keywordtype">unsigned</span> ackType = message_.<a class="code" href="classAMPS_1_1Message.html#a7d58a2c39f59d6fca098efd4bb81d3b5">getAckTypeEnum</a>();</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;        <span class="keywordflow">if</span> (ackType != Message::AckType::None</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;            || useSync)</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;        {</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;          <span class="keywordflow">if</span> (<span class="keywordtype">id</span>.empty())</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;          {</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;            message_.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;            <span class="keywordtype">id</span> = message_.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;          }</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;          <span class="keywordflow">if</span> (messageHandler_.isValid())</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;          {</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;            _routes.addRoute(<span class="keywordtype">id</span>, messageHandler_, requestedAcks,</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;                             Message::AckType::None, <span class="keyword">false</span>);</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;          }</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;        }</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;        <span class="keywordflow">if</span> (useSync)</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        {</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;          message_.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(ackType | Message::AckType::Processed);</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;          syncAckProcessing(timeout_, message_, 0, <span class="keyword">false</span>);</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;        }</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;        {</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;          _send(message_);</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;        }</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;      }</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;      <span class="comment">// These are things that shouldn&#39;t be sent (not meaningful)</span></div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;      <span class="keywordflow">case</span> Message::Command::GroupBegin:</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;      <span class="keywordflow">case</span> Message::Command::GroupEnd:</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;      <span class="keywordflow">case</span> Message::Command::OOF:</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;      <span class="keywordflow">case</span> Message::Command::Ack:</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;      <span class="keywordflow">case</span> Message::Command::Unknown:</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;        <span class="keywordflow">throw</span> CommandException(<span class="stringliteral">&quot;Command type &quot;</span> + message_.<a class="code" href="classAMPS_1_1Message.html#a9bfa516683f5fd04d0ab2e3161b2babc">getCommand</a>() + <span class="stringliteral">&quot; can not be sent directly to AMPS&quot;</span>);</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;      }</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;      message_.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(requestedAcks);</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;      <span class="keywordflow">return</span> id;</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;    }</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;    <span class="keywordtype">void</span> setDisconnectHandler(<span class="keyword">const</span> DisconnectHandler&amp; disconnectHandler)</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;    {</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;      _disconnectHandler = disconnectHandler;</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;    }</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;    <span class="keywordtype">void</span> setGlobalCommandTypeMessageHandler(<span class="keyword">const</span> std::string&amp; command_, <span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; handler_)</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;    {</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;      <span class="keywordflow">switch</span> (command_[0])</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;      {</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;<span class="preprocessor">#if 0 // Not currently implemented to avoid an extra branch in delivery</span></div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;        _globalCommandTypeHandlers[GlobalCommandTypeHandlers::Publish] = handler_;</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;        _globalCommandTypeHandlers[GlobalCommandTypeHandlers::SOW] = handler_;</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;        _globalCommandTypeHandlers[GlobalCommandTypeHandlers::Heartbeat] = handler_;</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;<span class="preprocessor">#if 0 // Not currently implemented to avoid an extra branch in delivery</span></div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;g&#39;</span>:</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;        <span class="keywordflow">if</span> (command_[6] == <span class="charliteral">&#39;b&#39;</span>)</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;        {</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;          _globalCommandTypeHandlers[GlobalCommandTypeHandlers::GroupBegin] = handler_;</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;        }</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command_[6] == <span class="charliteral">&#39;e&#39;</span>)</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;        {</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;          _globalCommandTypeHandlers[GlobalCommandTypeHandlers::GroupEnd] = handler_;</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;        }</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;        {</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;          std::ostringstream os;</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot;Invalid command &#39;&quot;</span> &lt;&lt; command_ &lt;&lt; <span class="stringliteral">&quot;&#39; passed to setGlobalCommandTypeHandler&quot;</span>;</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;          <span class="keywordflow">throw</span> CommandException(os.str());</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;        }</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;o&#39;</span>:</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;        _globalCommandTypeHandlers[GlobalCommandTypeHandlers::OOF] = handler_;</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>:</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;        _globalCommandTypeHandlers[GlobalCommandTypeHandlers::Ack] = handler_;</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>:</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;L&#39;</span>:</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;        _globalCommandTypeHandlers[GlobalCommandTypeHandlers::LastChance] = handler_;</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;D&#39;</span>:</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;        _globalCommandTypeHandlers[GlobalCommandTypeHandlers::DuplicateMessage] = handler_;</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;        std::ostringstream os;</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;        os &lt;&lt; <span class="stringliteral">&quot;Invalid command &#39;&quot;</span> &lt;&lt; command_ &lt;&lt; <span class="stringliteral">&quot;&#39; passed to setGlobalCommandTypeHandler&quot;</span>;</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;        <span class="keywordflow">throw</span> CommandException(os.str());</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;      }</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;    }</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;    <span class="keywordtype">void</span> setGlobalCommandTypeMessageHandler(<span class="keyword">const</span> Message::Command::Type command_, <span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; handler_)</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;    {</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;      <span class="keywordflow">switch</span> (command_)</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;      {</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;<span class="preprocessor">#if 0 // Not currently implemented to avoid an extra branch in delivery</span></div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;      <span class="keywordflow">case</span> Message::Command::Publish:</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;        _globalCommandTypeHandlers[GlobalCommandTypeHandlers::Publish] = handler_;</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;      <span class="keywordflow">case</span> Message::Command::SOW:</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;        _globalCommandTypeHandlers[GlobalCommandTypeHandlers::SOW] = handler_;</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;      <span class="keywordflow">case</span> Message::Command::Heartbeat:</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;        _globalCommandTypeHandlers[GlobalCommandTypeHandlers::Heartbeat] = handler_;</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;<span class="preprocessor">#if 0 // Not currently implemented to avoid an extra branch in delivery</span></div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;      <span class="keywordflow">case</span> Message::Command::GroupBegin:</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;        _globalCommandTypeHandlers[GlobalCommandTypeHandlers::GroupBegin] = handler_;</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;      <span class="keywordflow">case</span> Message::Command::GroupEnd:</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;        _globalCommandTypeHandlers[GlobalCommandTypeHandlers::GroupEnd] = handler_;</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;      <span class="keywordflow">case</span> Message::Command::OOF:</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;        _globalCommandTypeHandlers[GlobalCommandTypeHandlers::OOF] = handler_;</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;      <span class="keywordflow">case</span> Message::Command::Ack:</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;        _globalCommandTypeHandlers[GlobalCommandTypeHandlers::Ack] = handler_;</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;        <span class="keywordtype">unsigned</span> bits = 0;</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;        <span class="keywordtype">unsigned</span> command = command_;</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;        <span class="keywordflow">while</span> (command &gt; 0)</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;        {</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;          ++bits;</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;          command &gt;&gt;= 1;</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;        }</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;        <span class="keywordtype">char</span> errBuf[128];</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;        AMPS_snprintf(errBuf, <span class="keyword">sizeof</span>(errBuf),</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;                      <span class="stringliteral">&quot;Invalid command &#39;%.*s&#39; passed to setGlobalCommandTypeHandler&quot;</span>,</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;                      CommandConstants&lt;0&gt;::Lengths[bits],</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;                      CommandConstants&lt;0&gt;::Values[bits]);</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;        <span class="keywordflow">throw</span> CommandException(errBuf);</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;      }</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;    }</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;    <span class="keywordtype">void</span> setGlobalCommandTypeMessageHandler(<span class="keyword">const</span> GlobalCommandTypeHandlers handlerType_, <span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; handler_)</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;    {</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;      _globalCommandTypeHandlers[handlerType_] = handler_;</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;    }</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;    <span class="keywordtype">void</span> setFailedWriteHandler(<a class="code" href="classAMPS_1_1FailedWriteHandler.html">FailedWriteHandler</a>* handler_)</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;    {</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;      _failedWriteHandler.reset(handler_);</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;    }</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;    <span class="keywordtype">void</span> setPublishStore(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Store.html">Store</a>&amp; publishStore_)</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;    {</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;      <span class="keywordflow">if</span> (_connected)</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;      {</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;        <span class="keywordflow">throw</span> AlreadyConnectedException(<span class="stringliteral">&quot;Setting a publish store on a connected client is undefined behavior&quot;</span>);</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;      }</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;      _publishStore = publishStore_;</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;    }</div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;    <span class="keywordtype">void</span> setBookmarkStore(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1BookmarkStore.html">BookmarkStore</a>&amp; bookmarkStore_)</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;    {</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;      <span class="keywordflow">if</span> (_connected)</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;      {</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;        <span class="keywordflow">throw</span> AlreadyConnectedException(<span class="stringliteral">&quot;Setting a bookmark store on a connected client is undefined behavior&quot;</span>);</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;      }</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;      _bookmarkStore = bookmarkStore_;</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;    }</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;    <span class="keywordtype">void</span> setSubscriptionManager(<a class="code" href="classAMPS_1_1SubscriptionManager.html">SubscriptionManager</a>* subscriptionManager_)</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;    {</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;      _subscriptionManager.reset(subscriptionManager_);</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;    }</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;    <a class="code" href="classAMPS_1_1SubscriptionManager.html">SubscriptionManager</a>* getSubscriptionManager()<span class="keyword"> const</span></div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><a class="code" href="classAMPS_1_1SubscriptionManager.html">SubscriptionManager</a>*<span class="keyword">&gt;</span>(_subscriptionManager.get());</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;    }</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;    DisconnectHandler getDisconnectHandler()<span class="keyword"> const</span></div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;      <span class="keywordflow">return</span> _disconnectHandler;</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;    }</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;    <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a> getDuplicateMessageHandler()<span class="keyword"> const</span></div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;      <span class="keywordflow">return</span> _globalCommandTypeHandlers[GlobalCommandTypeHandlers::DuplicateMessage];</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;    }</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;    <a class="code" href="classAMPS_1_1FailedWriteHandler.html">FailedWriteHandler</a>* getFailedWriteHandler()<span class="keyword"> const</span></div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><a class="code" href="classAMPS_1_1FailedWriteHandler.html">FailedWriteHandler</a>*<span class="keyword">&gt;</span>(_failedWriteHandler.get());</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;    }</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;    <a class="code" href="classAMPS_1_1Store.html">Store</a> getPublishStore()<span class="keyword"> const</span></div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;      <span class="keywordflow">return</span> _publishStore;</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;    }</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;    <a class="code" href="classAMPS_1_1BookmarkStore.html">BookmarkStore</a> getBookmarkStore()<span class="keyword"> const</span></div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;      <span class="keywordflow">return</span> _bookmarkStore;</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;    }</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;    amps_uint64_t publish(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_, <span class="keywordtype">size_t</span> topicLen_, <span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> dataLen_)</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;    {</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;      <span class="keywordflow">if</span> (!_publishStore.<a class="code" href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac">isValid</a>())</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;      {</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;        Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;        _publishMessage.<a class="code" href="classAMPS_1_1Message.html#ab615fec15ed415791470da4b056bfe36">assignTopic</a>(topic_, topicLen_);</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;        _publishMessage.assignData(data_, dataLen_);</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;        _send(_publishMessage);</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;      }</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;      {</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;        <span class="keywordflow">if</span> (!publishStoreMessage)</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;        {</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;          publishStoreMessage = <span class="keyword">new</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>();</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;          PerThreadMessageTracker::addMessageToCleanupList(publishStoreMessage);</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;        }</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;        publishStoreMessage-&gt;reset();</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;        publishStoreMessage-&gt;setCommandEnum(Message::Command::Publish);</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;        <span class="keywordflow">return</span> _publish(topic_, topicLen_, data_, dataLen_);</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;      }</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;    }</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;    amps_uint64_t publish(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_, <span class="keywordtype">size_t</span> topicLen_, <span class="keyword">const</span> <span class="keywordtype">char</span>* data_,</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;                          <span class="keywordtype">size_t</span> dataLen_, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> expiration_)</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;    {</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;      <span class="keywordflow">if</span> (!_publishStore.<a class="code" href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac">isValid</a>())</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;      {</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;        Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;        _publishMessage.<a class="code" href="classAMPS_1_1Message.html#ab615fec15ed415791470da4b056bfe36">assignTopic</a>(topic_, topicLen_);</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;        _publishMessage.assignData(data_, dataLen_);</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;        <span class="keywordtype">char</span> exprBuf[AMPS_NUMBER_BUFFER_LEN];</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;        <span class="keywordtype">size_t</span> pos = convertToCharArray(exprBuf, expiration_);</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;        _publishMessage.<a class="code" href="classAMPS_1_1Message.html#a00cbe4fc836c7c71cdb50303d1503067">assignExpiration</a>(exprBuf + pos, AMPS_NUMBER_BUFFER_LEN - pos);</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;        _send(_publishMessage);</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;        _publishMessage.<a class="code" href="classAMPS_1_1Message.html#a00cbe4fc836c7c71cdb50303d1503067">assignExpiration</a>(NULL, 0);</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;      }</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;      {</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;        <span class="keywordflow">if</span> (!publishStoreMessage)</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;        {</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;          publishStoreMessage = <span class="keyword">new</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>();</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;          PerThreadMessageTracker::addMessageToCleanupList(publishStoreMessage);</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;        }</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;        publishStoreMessage-&gt;reset();</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;        <span class="keywordtype">char</span> exprBuf[AMPS_NUMBER_BUFFER_LEN];</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;        <span class="keywordtype">size_t</span> exprPos = convertToCharArray(exprBuf, expiration_);</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;        publishStoreMessage-&gt;setCommandEnum(Message::Command::Publish)</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;        .assignExpiration(exprBuf + exprPos,</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;                          AMPS_NUMBER_BUFFER_LEN - exprPos);</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;        <span class="keywordflow">return</span> _publish(topic_, topicLen_, data_, dataLen_);</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;      }</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;    }</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;    <span class="keyword">class </span>FlushAckHandler : <a class="code" href="classAMPS_1_1ConnectionStateListener.html">ConnectionStateListener</a></div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;    {</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;    <span class="keyword">private</span>:</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;      ClientImpl* _pClient;</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;      <a class="code" href="classAMPS_1_1Field.html">Field</a> _cmdId;</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;<span class="preprocessor">#if __cplusplus &gt;= 201100L || _MSC_VER &gt;= 1900</span></div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;      std::atomic&lt;bool&gt; _acked;</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;      std::atomic&lt;bool&gt; _disconnected;</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;      <span class="keyword">volatile</span> <span class="keywordtype">bool</span> _acked;</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;      <span class="keyword">volatile</span> <span class="keywordtype">bool</span> _disconnected;</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;      FlushAckHandler(ClientImpl* pClient_)</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;        : _pClient(pClient_), _cmdId(), _acked(<span class="keyword">false</span>), _disconnected(<span class="keyword">false</span>)</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;      {</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;        pClient_-&gt;addConnectionStateListener(<span class="keyword">this</span>);</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;      }</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;      ~FlushAckHandler()</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;      {</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;        _pClient-&gt;removeConnectionStateListener(<span class="keyword">this</span>);</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;        _pClient-&gt;removeMessageHandler(_cmdId);</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;        _cmdId.<a class="code" href="classAMPS_1_1Field.html#a268793c302ec9a3b7ce83248ef7524b3">clear</a>();</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;      }</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;      <span class="keywordtype">void</span> setCommandId(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Field.html">Field</a>&amp; cmdId_)</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;      {</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;        _cmdId.<a class="code" href="classAMPS_1_1Field.html#a6ddfd1486e7bdb967e57eca5c963f1b3">deepCopy</a>(cmdId_);</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;      }</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;      <span class="keywordtype">void</span> invoke(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp;)</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;      {</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;        _acked = <span class="keyword">true</span>;</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;      }</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;      <span class="keywordtype">void</span> connectionStateChanged(<a class="code" href="classAMPS_1_1ConnectionStateListener.html#a6b55fc390dd4591b2a89fd00113f1ef3">State</a> state_)</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;      {</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;        <span class="keywordflow">if</span> (state_ &lt;= Shutdown)</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;        {</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;          _disconnected = <span class="keyword">true</span>;</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;        }</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;      }</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;      <span class="keywordtype">bool</span> acked()</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;      {</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;        <span class="keywordflow">return</span> _acked;</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;      }</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;      <span class="keywordtype">bool</span> done()</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;      {</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;        <span class="keywordflow">return</span> _acked || _disconnected;</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;      }</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;    };</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;    <span class="keywordtype">void</span> publishFlush(<span class="keywordtype">long</span> timeout_, <span class="keywordtype">unsigned</span> ackType_)</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;    {</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* processed = <span class="stringliteral">&quot;processed&quot;</span>;</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> processedLen = strlen(processed);</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* persisted = <span class="stringliteral">&quot;persisted&quot;</span>;</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> persistedLen = strlen(persisted);</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* flush = <span class="stringliteral">&quot;flush&quot;</span>;</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> flushLen = strlen(flush);</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;      <span class="keyword">static</span> VersionInfo minPersisted(<span class="stringliteral">&quot;5.3.3.0&quot;</span>);</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;      <span class="keyword">static</span> VersionInfo minFlush(<span class="stringliteral">&quot;4&quot;</span>);</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;      <span class="keywordflow">if</span> (ackType_ != Message::AckType::Processed</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;          &amp;&amp; ackType_ != Message::AckType::Persisted)</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;      {</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;        <span class="keywordflow">throw</span> CommandException(<span class="stringliteral">&quot;Flush can only be used with processed or persisted acks.&quot;</span>);</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;      }</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;      FlushAckHandler flushHandler(<span class="keyword">this</span>);</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;      <span class="keywordflow">if</span> (_serverVersion &gt;= minFlush)</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;      {</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;        Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;        <span class="keywordflow">if</span> (!_connected)</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;        {</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;          <span class="keywordflow">throw</span> DisconnectedException(<span class="stringliteral">&quot;Not connected trying to flush&quot;</span>);</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;        }</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;        _message.reset();</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a7d1f25436d5a567bda4b69171fbc469c">assignCommand</a>(flush, flushLen);</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;        <span class="keywordflow">if</span> (_serverVersion &lt; minPersisted</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;            || ackType_ == Message::AckType::Processed)</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;        {</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;          _message.<a class="code" href="classAMPS_1_1Message.html#a2a05e8fb7bfc572a5680935a9b841bb1">assignAckType</a>(processed, processedLen);</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;        }</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;        {</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;          _message.<a class="code" href="classAMPS_1_1Message.html#a2a05e8fb7bfc572a5680935a9b841bb1">assignAckType</a>(persisted, persistedLen);</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;        }</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;        flushHandler.setCommandId(_message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>());</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;        addMessageHandler(_message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>(),</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;                          std::bind(&amp;FlushAckHandler::invoke,</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;                                    std::ref(flushHandler),</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;                                    std::placeholders::_1),</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;                          ackType_, <span class="keyword">false</span>);</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;        NoDelay noDelay(_client);</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;        <span class="keywordflow">if</span> (_send(_message) == -1)</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;        {</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;          <span class="keywordflow">throw</span> DisconnectedException(<span class="stringliteral">&quot;Disconnected trying to flush&quot;</span>);</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;        }</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;      }</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;      <span class="keywordflow">if</span> (_publishStore.<a class="code" href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac">isValid</a>())</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;      {</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;        <span class="keywordflow">try</span></div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;        {</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;          _publishStore.<a class="code" href="classAMPS_1_1Store.html#ab074d36fc26325c59630e90c5bd871b4">flush</a>(timeout_);</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;        }</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;        <span class="keywordflow">catch</span> (<span class="keyword">const</span> AMPSException&amp; ex)</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;        {</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;          AMPS_UNHANDLED_EXCEPTION(ex);</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;          <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;        }</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;      }</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (_serverVersion &lt; minFlush)</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;      {</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;        <span class="keywordflow">if</span> (timeout_ &gt; 0)</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;        {</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;          AMPS_USLEEP(timeout_ * 1000);</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;        }</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;        {</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;          AMPS_USLEEP(1000 * 1000);</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;        }</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;      }</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;      <span class="keywordflow">if</span> (timeout_)</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;      {</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;        Timer timer((<span class="keywordtype">double</span>)timeout_);</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;        timer.start();</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;        <span class="keywordflow">while</span> (!timer.check() &amp;&amp; !flushHandler.done())</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;        {</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;          AMPS_USLEEP(10000);</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;          amps_invoke_waiting_function();</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;        }</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;      }</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;      {</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;        <span class="keywordflow">while</span> (!flushHandler.done())</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;        {</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;          AMPS_USLEEP(10000);</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;          amps_invoke_waiting_function();</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;        }</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;      }</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;      <span class="comment">// No response or disconnect in timeout interval</span></div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;      <span class="keywordflow">if</span> (!flushHandler.done())</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;      {</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;        <span class="keywordflow">throw</span> TimedOutException(<span class="stringliteral">&quot;Timed out waiting for flush&quot;</span>);</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;      }</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;      <span class="comment">// We got disconnected and there is no publish store</span></div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;      <span class="keywordflow">if</span> (!flushHandler.acked() &amp;&amp; !_publishStore.<a class="code" href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac">isValid</a>())</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;      {</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;        <span class="keywordflow">throw</span> DisconnectedException(<span class="stringliteral">&quot;Disconnected waiting for flush&quot;</span>);</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;      }</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;    }</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;    amps_uint64_t deltaPublish(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_, <span class="keywordtype">size_t</span> topicLength_,</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;                               <span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> dataLength_)</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;    {</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;      <span class="keywordflow">if</span> (!_publishStore.<a class="code" href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac">isValid</a>())</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;      {</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;        Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;        _deltaMessage.<a class="code" href="classAMPS_1_1Message.html#ab615fec15ed415791470da4b056bfe36">assignTopic</a>(topic_, topicLength_);</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;        _deltaMessage.assignData(data_, dataLength_);</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;        _send(_deltaMessage);</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;      }</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;      {</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;        <span class="keywordflow">if</span> (!publishStoreMessage)</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;        {</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;          publishStoreMessage = <span class="keyword">new</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>();</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;          PerThreadMessageTracker::addMessageToCleanupList(publishStoreMessage);</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;        }</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;        publishStoreMessage-&gt;reset();</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;        publishStoreMessage-&gt;setCommandEnum(Message::Command::DeltaPublish);</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;        <span class="keywordflow">return</span> _publish(topic_, topicLength_, data_, dataLength_);</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;      }</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;    }</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;    amps_uint64_t deltaPublish(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_, <span class="keywordtype">size_t</span> topicLength_,</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;                               <span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> dataLength_,</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;                               <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> expiration_)</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;    {</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;      <span class="keywordflow">if</span> (!_publishStore.<a class="code" href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac">isValid</a>())</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;      {</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;        Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;        _deltaMessage.<a class="code" href="classAMPS_1_1Message.html#ab615fec15ed415791470da4b056bfe36">assignTopic</a>(topic_, topicLength_);</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;        _deltaMessage.assignData(data_, dataLength_);</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;        <span class="keywordtype">char</span> exprBuf[AMPS_NUMBER_BUFFER_LEN];</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;        <span class="keywordtype">size_t</span> pos = convertToCharArray(exprBuf, expiration_);</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;        _deltaMessage.<a class="code" href="classAMPS_1_1Message.html#a00cbe4fc836c7c71cdb50303d1503067">assignExpiration</a>(exprBuf + pos, AMPS_NUMBER_BUFFER_LEN - pos);</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;        _send(_deltaMessage);</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;        _deltaMessage.<a class="code" href="classAMPS_1_1Message.html#a00cbe4fc836c7c71cdb50303d1503067">assignExpiration</a>(NULL, 0);</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;      }</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;      {</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;        <span class="keywordflow">if</span> (!publishStoreMessage)</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;        {</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;          publishStoreMessage = <span class="keyword">new</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>();</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;          PerThreadMessageTracker::addMessageToCleanupList(publishStoreMessage);</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;        }</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;        publishStoreMessage-&gt;reset();</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;        <span class="keywordtype">char</span> exprBuf[AMPS_NUMBER_BUFFER_LEN];</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;        <span class="keywordtype">size_t</span> exprPos = convertToCharArray(exprBuf, expiration_);</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;        publishStoreMessage-&gt;setCommandEnum(Message::Command::DeltaPublish)</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;        .assignExpiration(exprBuf + exprPos,</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;                          AMPS_NUMBER_BUFFER_LEN - exprPos);</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;        <span class="keywordflow">return</span> _publish(topic_, topicLength_, data_, dataLength_);</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;      }</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;    }</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;    amps_uint64_t _publish(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_, <span class="keywordtype">size_t</span> topicLength_,</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;                           <span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> dataLength_)</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;    {</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;      publishStoreMessage-&gt;assignTopic(topic_, topicLength_)</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;      .setAckTypeEnum(Message::AckType::Persisted)</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;      .assignData(data_, dataLength_);</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;      amps_uint64_t haSequenceNumber = _publishStore.<a class="code" href="classAMPS_1_1Store.html#acb06fbca0f83c7c4dfc91662b9149dba">store</a>(*publishStoreMessage);</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;      <span class="keywordtype">char</span> buf[AMPS_NUMBER_BUFFER_LEN];</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;      <span class="keywordtype">size_t</span> pos = convertToCharArray(buf, haSequenceNumber);</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;      publishStoreMessage-&gt;assignSequence(buf + pos, AMPS_NUMBER_BUFFER_LEN - pos);</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;      {</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;        Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;        _send(*publishStoreMessage, haSequenceNumber);</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;      }</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;      <span class="keywordflow">return</span> haSequenceNumber;</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;    }</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;    <span class="keyword">virtual</span> std::string logon(<span class="keywordtype">long</span> timeout_, <a class="code" href="classAMPS_1_1Authenticator.html">Authenticator</a>&amp; authenticator_,</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;                              <span class="keyword">const</span> <span class="keywordtype">char</span>* options_ = NULL)</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;    {</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;      <span class="keywordflow">return</span> _logon(timeout_, authenticator_, options_);</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;    }</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    <span class="keyword">virtual</span> std::string _logon(<span class="keywordtype">long</span> timeout_, <a class="code" href="classAMPS_1_1Authenticator.html">Authenticator</a>&amp; authenticator_,</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;                               <span class="keyword">const</span> <span class="keywordtype">char</span>* options_ = NULL)</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;    {</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;      _message.reset();</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;      std::string newCommandId = _message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ab84e7ca0d5f72269208b0647b67c0375">setCommandEnum</a>(Message::Command::Logon);</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a617a1ec519cf9cfc868f8e28eef108e4">setClientName</a>(_name);</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;<span class="preprocessor">#ifdef AMPS_CLIENT_VERSION_WITH_LANGUAGE</span></div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a7cd07ad086b817bc95abbecbe729666b">assignVersion</a>(AMPS_CLIENT_VERSION_WITH_LANGUAGE,</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;                             strlen(AMPS_CLIENT_VERSION_WITH_LANGUAGE));</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;      URI uri(_lastUri);</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;      <span class="keywordflow">if</span> (uri.user().size())</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;      {</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a6bcb681645121af485daee1d4ecda730">setUserId</a>(uri.user());</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;      }</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;      <span class="keywordflow">if</span> (uri.password().size())</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;      {</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a703caed4d3de9b343c1695e3d0e7b662">setPassword</a>(uri.password());</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;      }</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;      <span class="keywordflow">if</span> (uri.protocol() == <span class="stringliteral">&quot;amps&quot;</span> &amp;&amp; uri.messageType().size())</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;      {</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a1f764331674c037090b73401dda816bc">setMessageType</a>(uri.messageType());</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;      }</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;      <span class="keywordflow">if</span> (uri.isTrue(<span class="stringliteral">&quot;pretty&quot;</span>))</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;      {</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a946e77e4579c0fc419887743de0e333d">setOptions</a>(<span class="stringliteral">&quot;pretty&quot;</span>);</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;      }</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a703caed4d3de9b343c1695e3d0e7b662">setPassword</a>(authenticator_.<a class="code" href="classAMPS_1_1Authenticator.html#a3ca23cf3bab7fa2326db9123be0fe594">authenticate</a>(_message.<a class="code" href="classAMPS_1_1Message.html#a1dacda9d7f12db2871bd13e3b4d8c62e">getUserId</a>(), _message.<a class="code" href="classAMPS_1_1Message.html#ad93e2cdda6d519d3600e3182937faa85">getPassword</a>()));</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;      <span class="keywordflow">if</span> (!_logonCorrelationData.empty())</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;      {</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#ad036a9214ec2b202fdefa75f43dfbe5a">assignCorrelationId</a>(_logonCorrelationData);</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;      }</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;      <span class="keywordflow">if</span> (options_)</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;      {</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a946e77e4579c0fc419887743de0e333d">setOptions</a>(options_);</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;      }</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;      _username = _message.<a class="code" href="classAMPS_1_1Message.html#a1dacda9d7f12db2871bd13e3b4d8c62e">getUserId</a>();</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;      <span class="keywordflow">try</span></div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;      {</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;        AtomicFlagFlip pubFlip(&amp;_logonInProgress);</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;        NoDelay noDelay(_client);</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;        <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;        {</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;          _message.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(Message::AckType::Processed);</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;          AckResponse ack = syncAckProcessing(timeout_, _message);</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;          <span class="keywordflow">if</span> (ack.status() == <span class="stringliteral">&quot;retry&quot;</span>)</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;          {</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;            _message.<a class="code" href="classAMPS_1_1Message.html#a703caed4d3de9b343c1695e3d0e7b662">setPassword</a>(authenticator_.<a class="code" href="classAMPS_1_1Authenticator.html#ac8f59e8371571030bbd751d215781866">retry</a>(ack.username(), ack.password()));</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;            _username = ack.username();</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;            _message.<a class="code" href="classAMPS_1_1Message.html#a6bcb681645121af485daee1d4ecda730">setUserId</a>(_username);</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;          }</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;          {</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;            authenticator_.<a class="code" href="classAMPS_1_1Authenticator.html#ac363ec42f1c034ccdd9e8a6d13596811">completed</a>(ack.username(), ack.password(), ack.reason());</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;          }</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;        }</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;        broadcastConnectionStateChanged(ConnectionStateListener::LoggedOn);</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;        <span class="comment">// Now re-send the heartbeat command if configured</span></div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;        _sendHeartbeat();</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;        <span class="comment">// Signal any threads waiting for _logonInProgress</span></div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;        _lock.signalAll();</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;      }</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;      <span class="keywordflow">catch</span> (<span class="keyword">const</span> AMPSException&amp; ex)</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;      {</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;        _lock.signalAll();</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;        AMPS_UNHANDLED_EXCEPTION(ex);</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;      }</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;      <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;      {</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;        _lock.signalAll();</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;      }</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;      <span class="keywordflow">if</span> (_publishStore.<a class="code" href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac">isValid</a>())</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;      {</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;        <span class="keywordflow">try</span></div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;        {</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;          _publishStore.<a class="code" href="classAMPS_1_1Store.html#a061742652521bbbf91709703cd75f8cc">replay</a>(_replayer);</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;          broadcastConnectionStateChanged(ConnectionStateListener::PublishReplayed);</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;        }</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;        <span class="keywordflow">catch</span> (<span class="keyword">const</span> PublishStoreGapException&amp; ex)</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;        {</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;          _lock.signalAll();</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;          AMPS_UNHANDLED_EXCEPTION(ex);</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;          <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;        }</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;        <span class="keywordflow">catch</span> (<span class="keyword">const</span> StoreException&amp; ex)</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;        {</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;          _lock.signalAll();</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;          std::ostringstream os;</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot;A local store exception occurred while logging on.&quot;</span></div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;             &lt;&lt; ex.toString();</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;          <span class="keywordflow">throw</span> ConnectionException(os.str());</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;        }</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;        <span class="keywordflow">catch</span> (<span class="keyword">const</span> AMPSException&amp; ex)</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;        {</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;          _lock.signalAll();</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;          AMPS_UNHANDLED_EXCEPTION(ex);</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;          <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;        }</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;        <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; ex)</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;        {</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;          _lock.signalAll();</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;          AMPS_UNHANDLED_EXCEPTION(ex);</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;          <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;        }</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;        <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;        {</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;          _lock.signalAll();</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;          <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;        }</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;      }</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;      _lock.signalAll();</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;      <span class="keywordflow">return</span> newCommandId;</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;    }</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;    std::string subscribe(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;                          <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;                          <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;                          <span class="keyword">const</span> std::string&amp; filter_,</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;                          <span class="keyword">const</span> std::string&amp; bookmark_,</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;                          <span class="keyword">const</span> std::string&amp; options_,</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;                          <span class="keyword">const</span> std::string&amp; subId_,</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;                          <span class="keywordtype">bool</span> isHASubscribe_ = <span class="keyword">true</span>)</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;    {</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;      isHASubscribe_ &amp;= (bool)_subscriptionManager;</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;      _message.reset();</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ab84e7ca0d5f72269208b0647b67c0375">setCommandEnum</a>(Message::Command::Subscribe);</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;      std::string subId(subId_);</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;      <span class="keywordflow">if</span> (subId.empty())</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;      {</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;        <span class="keywordflow">if</span> (options_.find(AMPS_OPTIONS_REPLACE, 0, strlen(AMPS_OPTIONS_REPLACE) - 1) != std::string::npos)</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;        {</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;          <span class="keywordflow">throw</span> ConnectionException(<span class="stringliteral">&quot;Cannot issue a replacement subscription; a valid subscription id is required.&quot;</span>);</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;        }</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;        subId = _message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;      }</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#aba905c4e623ad81e1cd100d2da197024">setSubscriptionId</a>(subId);</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;      <span class="comment">// we need to deep copy this before sending the message; while we are</span></div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;      <span class="comment">// waiting for a response, the fields in _message may get blown away for</span></div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;      <span class="comment">// other operations.</span></div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;      <a class="code" href="classAMPS_1_1Field.html">AMPS::Message::Field</a> subIdField(subId);</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;      <span class="keywordtype">unsigned</span> ackTypes = Message::AckType::Processed;</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;      <span class="keywordflow">if</span> (!bookmark_.empty() &amp;&amp; _bookmarkStore.isValid())</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;      {</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;        ackTypes |= Message::AckType::Persisted;</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;      }</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ab68a4ca105280880c57e3bb29506c2c6">setTopic</a>(topic_);</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;      <span class="keywordflow">if</span> (filter_.length())</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;      {</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#abaa87b57b3fd2b92efba6a2987b825f2">setFilter</a>(filter_);</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;      }</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;      <span class="keywordflow">if</span> (bookmark_.length())</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;      {</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;        <span class="keywordflow">if</span> (bookmark_ == <a class="code" href="group__specialBookmarks.html#ga9dc6d653c4c409720e685038051c7460">AMPS_BOOKMARK_RECENT</a>)</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;        {</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;          <a class="code" href="classAMPS_1_1Field.html">Message::Field</a> mostRecent = _bookmarkStore.<a class="code" href="classAMPS_1_1BookmarkStore.html#aec9e0485c22cf800e90327bcb5ac01a9">getMostRecent</a>(subIdField);</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;          _message.<a class="code" href="classAMPS_1_1Message.html#a5bfe27b946a745eac652586d09e71438">setBookmark</a>(mostRecent);</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;        }</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;        {</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;          _message.<a class="code" href="classAMPS_1_1Message.html#a5bfe27b946a745eac652586d09e71438">setBookmark</a>(bookmark_);</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;          <span class="keywordflow">if</span> (_bookmarkStore.isValid())</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;          {</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;            <span class="keywordflow">if</span> (bookmark_ != <a class="code" href="group__specialBookmarks.html#ga56a5f968956ad81c7ebb864816c55a01">AMPS_BOOKMARK_NOW</a> &amp;&amp;</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;                bookmark_ != <a class="code" href="group__specialBookmarks.html#ga9b906ecdf1afe8a265183dbe0856959a">AMPS_BOOKMARK_EPOCH</a>)</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;            {</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;              _bookmarkStore.<a class="code" href="classAMPS_1_1BookmarkStore.html#a502ac677f4ceea04e19b4cdd820c876c">log</a>(_message);</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;              _bookmarkStore.<a class="code" href="classAMPS_1_1BookmarkStore.html#a4d9b0e300e15e63999aad696c00b04c8">discard</a>(_message);</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;              _bookmarkStore.<a class="code" href="classAMPS_1_1BookmarkStore.html#a73ade06e341e7e694cbe756a1c6ab187">persisted</a>(subIdField, _message.<a class="code" href="classAMPS_1_1Message.html#a7108ef0b54bc76e43dc4d49d700dc8ef">getBookmark</a>());</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;            }</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;          }</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;        }</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;      }</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;      <span class="keywordflow">if</span> (options_.length())</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;      {</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a946e77e4579c0fc419887743de0e333d">setOptions</a>(options_);</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;      }</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;      <a class="code" href="classAMPS_1_1Message.html">Message</a> message = _message;</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;      <span class="keywordflow">if</span> (isHASubscribe_)</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;      {</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;        message = _message.<a class="code" href="classAMPS_1_1Message.html#afd3b5831324320af6566883f3b9ff9dd">deepCopy</a>();</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;        Unlock&lt;Mutex&gt; u(_lock);</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;        _subscriptionManager-&gt;subscribe(messageHandler_, message,</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;                                        Message::AckType::None);</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;        <span class="keywordflow">if</span> (_badTimeToHASubscribe)</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;        {</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;          <span class="keywordflow">return</span> subId;</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;        }</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;      }</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;      <span class="keywordflow">if</span> (!_routes.hasRoute(_message.<a class="code" href="classAMPS_1_1Message.html#a4beb1e21b1dabf98cbb956f97fb95dbd">getSubscriptionId</a>()))</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;      {</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;        _routes.addRoute(_message.<a class="code" href="classAMPS_1_1Message.html#a4beb1e21b1dabf98cbb956f97fb95dbd">getSubscriptionId</a>(), messageHandler_,</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;                         Message::AckType::None, ackTypes, <span class="keyword">true</span>);</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;      }</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;      message.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(ackTypes);</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;      <span class="keywordflow">if</span> (!options_.empty())</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;      {</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;        message.<a class="code" href="classAMPS_1_1Message.html#a946e77e4579c0fc419887743de0e333d">setOptions</a>(options_);</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;      }</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;      <span class="keywordflow">try</span></div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;      {</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;        syncAckProcessing(timeout_, message, isHASubscribe_);</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;      }</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;      <span class="keywordflow">catch</span> (<span class="keyword">const</span> DisconnectedException&amp;)</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;      {</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;        <span class="keywordflow">if</span> (!isHASubscribe_)</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;        {</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;          _routes.removeRoute(subIdField);</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;          <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;        }</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;        {</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;          AMPS_CALL_EXCEPTION_WRAPPER(unsubscribeInternal(subIdField));</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;          <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;        }</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;      }</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;      <span class="keywordflow">catch</span> (<span class="keyword">const</span> TimedOutException&amp;)</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;      {</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;        AMPS_CALL_EXCEPTION_WRAPPER(unsubscribeInternal(subIdField));</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;      }</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;      <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;      {</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;        <span class="keywordflow">if</span> (isHASubscribe_)</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;        {</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;          <span class="comment">// Have to unlock before calling into sub manager to avoid deadlock</span></div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;          Unlock&lt;Mutex&gt; unlock(_lock);</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;          _subscriptionManager-&gt;unsubscribe(subIdField);</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;        }</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;        _routes.removeRoute(subIdField);</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;      }</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;      <span class="keywordflow">return</span> subId;</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;    }</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;    std::string deltaSubscribe(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;                               <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;                               <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;                               <span class="keyword">const</span> std::string&amp; filter_,</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;                               <span class="keyword">const</span> std::string&amp; bookmark_,</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;                               <span class="keyword">const</span> std::string&amp; options_,</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;                               <span class="keyword">const</span> std::string&amp; subId_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;                               <span class="keywordtype">bool</span> isHASubscribe_ = <span class="keyword">true</span>)</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;    {</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;      isHASubscribe_ &amp;= (bool)_subscriptionManager;</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;      _message.reset();</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ab84e7ca0d5f72269208b0647b67c0375">setCommandEnum</a>(Message::Command::DeltaSubscribe);</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;      std::string subId(subId_);</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;      <span class="keywordflow">if</span> (subId.empty())</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;      {</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;        subId = _message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;      }</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#aba905c4e623ad81e1cd100d2da197024">setSubscriptionId</a>(subId);</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;      <span class="comment">// we need to deep copy this before sending the message; while we are</span></div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;      <span class="comment">// waiting for a response, the fields in _message may get blown away for</span></div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;      <span class="comment">// other operations.</span></div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;      <a class="code" href="classAMPS_1_1Field.html">AMPS::Message::Field</a> subIdField(subId);</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;      <span class="keywordtype">unsigned</span> ackTypes = Message::AckType::Processed;</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;      <span class="keywordflow">if</span> (!bookmark_.empty() &amp;&amp; _bookmarkStore.isValid())</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;      {</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;        ackTypes |= Message::AckType::Persisted;</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;      }</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ab68a4ca105280880c57e3bb29506c2c6">setTopic</a>(topic_);</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;      <span class="keywordflow">if</span> (filter_.length())</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;      {</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#abaa87b57b3fd2b92efba6a2987b825f2">setFilter</a>(filter_);</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;      }</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;      <span class="keywordflow">if</span> (bookmark_.length())</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;      {</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;        <span class="keywordflow">if</span> (bookmark_ == <a class="code" href="group__specialBookmarks.html#ga9dc6d653c4c409720e685038051c7460">AMPS_BOOKMARK_RECENT</a>)</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;        {</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;          <a class="code" href="classAMPS_1_1Field.html">Message::Field</a> mostRecent = _bookmarkStore.<a class="code" href="classAMPS_1_1BookmarkStore.html#aec9e0485c22cf800e90327bcb5ac01a9">getMostRecent</a>(subIdField);</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;          _message.<a class="code" href="classAMPS_1_1Message.html#a5bfe27b946a745eac652586d09e71438">setBookmark</a>(mostRecent);</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;        }</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;        {</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;          _message.<a class="code" href="classAMPS_1_1Message.html#a5bfe27b946a745eac652586d09e71438">setBookmark</a>(bookmark_);</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;          <span class="keywordflow">if</span> (_bookmarkStore.isValid())</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;          {</div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;            <span class="keywordflow">if</span> (bookmark_ != <a class="code" href="group__specialBookmarks.html#ga56a5f968956ad81c7ebb864816c55a01">AMPS_BOOKMARK_NOW</a> &amp;&amp;</div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;                bookmark_ != <a class="code" href="group__specialBookmarks.html#ga9b906ecdf1afe8a265183dbe0856959a">AMPS_BOOKMARK_EPOCH</a>)</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;            {</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;              _bookmarkStore.<a class="code" href="classAMPS_1_1BookmarkStore.html#a502ac677f4ceea04e19b4cdd820c876c">log</a>(_message);</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;              _bookmarkStore.<a class="code" href="classAMPS_1_1BookmarkStore.html#a4d9b0e300e15e63999aad696c00b04c8">discard</a>(_message);</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;              _bookmarkStore.<a class="code" href="classAMPS_1_1BookmarkStore.html#a73ade06e341e7e694cbe756a1c6ab187">persisted</a>(subIdField, _message.<a class="code" href="classAMPS_1_1Message.html#a7108ef0b54bc76e43dc4d49d700dc8ef">getBookmark</a>());</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;            }</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;          }</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;        }</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;      }</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;      <span class="keywordflow">if</span> (options_.length())</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;      {</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a946e77e4579c0fc419887743de0e333d">setOptions</a>(options_);</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;      }</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;      <a class="code" href="classAMPS_1_1Message.html">Message</a> message = _message;</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;      <span class="keywordflow">if</span> (isHASubscribe_)</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;      {</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;        message = _message.<a class="code" href="classAMPS_1_1Message.html#afd3b5831324320af6566883f3b9ff9dd">deepCopy</a>();</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;        Unlock&lt;Mutex&gt; u(_lock);</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;        _subscriptionManager-&gt;subscribe(messageHandler_, message,</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;                                        Message::AckType::None);</div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;        <span class="keywordflow">if</span> (_badTimeToHASubscribe)</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;        {</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;          <span class="keywordflow">return</span> subId;</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;        }</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;      }</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;      <span class="keywordflow">if</span> (!_routes.hasRoute(_message.<a class="code" href="classAMPS_1_1Message.html#a4beb1e21b1dabf98cbb956f97fb95dbd">getSubscriptionId</a>()))</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;      {</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;        _routes.addRoute(_message.<a class="code" href="classAMPS_1_1Message.html#a4beb1e21b1dabf98cbb956f97fb95dbd">getSubscriptionId</a>(), messageHandler_,</div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;                         Message::AckType::None, ackTypes, <span class="keyword">true</span>);</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;      }</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;      message.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(ackTypes);</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;      <span class="keywordflow">if</span> (!options_.empty())</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;      {</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;        message.<a class="code" href="classAMPS_1_1Message.html#a946e77e4579c0fc419887743de0e333d">setOptions</a>(options_);</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;      }</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;      <span class="keywordflow">try</span></div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;      {</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;        syncAckProcessing(timeout_, message, isHASubscribe_);</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;      }</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;      <span class="keywordflow">catch</span> (<span class="keyword">const</span> DisconnectedException&amp;)</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;      {</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;        <span class="keywordflow">if</span> (!isHASubscribe_)</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;        {</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;          _routes.removeRoute(subIdField);</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;          <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;        }</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;      }</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;      <span class="keywordflow">catch</span> (<span class="keyword">const</span> TimedOutException&amp;)</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;      {</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;        AMPS_CALL_EXCEPTION_WRAPPER(unsubscribeInternal(subIdField));</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;      }</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;      <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;      {</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;        <span class="keywordflow">if</span> (isHASubscribe_)</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;        {</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;          <span class="comment">// Have to unlock before calling into sub manager to avoid deadlock</span></div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;          Unlock&lt;Mutex&gt; unlock(_lock);</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;          _subscriptionManager-&gt;unsubscribe(subIdField);</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;        }</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;        _routes.removeRoute(subIdField);</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;      }</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;      <span class="keywordflow">return</span> subId;</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;    }</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;</div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;    <span class="keywordtype">void</span> unsubscribe(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>)</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;    {</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;      unsubscribeInternal(<span class="keywordtype">id</span>);</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;    }</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;    <span class="keywordtype">void</span> unsubscribe(<span class="keywordtype">void</span>)</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;    {</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;      <span class="keywordflow">if</span> (_subscriptionManager)</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;      {</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;        _subscriptionManager-&gt;clear();</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;      }</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;      {</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;        _routes.unsubscribeAll();</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;        Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;        _message.reset();</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#ab84e7ca0d5f72269208b0647b67c0375">setCommandEnum</a>(Message::Command::Unsubscribe);</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#aba905c4e623ad81e1cd100d2da197024">setSubscriptionId</a>(<span class="stringliteral">&quot;all&quot;</span>);</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;        _sendWithoutRetry(_message);</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;      }</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;      deferredExecution(&amp;amps_noOpFn, NULL);</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;    }</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;</div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;    std::string sow(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;                    <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;                    <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;                    <span class="keyword">const</span> std::string&amp; orderBy_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;                    <span class="keyword">const</span> std::string&amp; bookmark_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;                    <span class="keywordtype">int</span> batchSize_ = AMPS_DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;                    <span class="keywordtype">int</span> topN_ = AMPS_DEFAULT_TOP_N,</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;                    <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;                    <span class="keywordtype">long</span> timeout_ = AMPS_DEFAULT_COMMAND_TIMEOUT)</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;    {</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;      _message.reset();</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ab84e7ca0d5f72269208b0647b67c0375">setCommandEnum</a>(Message::Command::SOW);</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;      <span class="comment">// need to keep our own copy of the command ID.</span></div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;      std::string commandId = _message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a1a814beb4b54f23e364cac2f929b3bfe">setQueryID</a>(_message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>());</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;      <span class="keywordtype">unsigned</span> ackTypes = Message::AckType::Processed | Message::AckType::Completed;</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(ackTypes);</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ab68a4ca105280880c57e3bb29506c2c6">setTopic</a>(topic_);</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;      <span class="keywordflow">if</span> (filter_.length())</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;      {</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#abaa87b57b3fd2b92efba6a2987b825f2">setFilter</a>(filter_);</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;      }</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;      <span class="keywordflow">if</span> (orderBy_.length())</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;      {</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a6b211029971140a5c5c0f9f1416c6f2e">setOrderBy</a>(orderBy_);</div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;      }</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;      <span class="keywordflow">if</span> (bookmark_.length())</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;      {</div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a5bfe27b946a745eac652586d09e71438">setBookmark</a>(bookmark_);</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;      }</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ae70b22f7c5a65f058e25fa9b4ccbca20">setBatchSize</a>(AMPS::asString(batchSize_));</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;      <span class="keywordflow">if</span> (topN_ != AMPS_DEFAULT_TOP_N)</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;      {</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a806ab5b1e5e69c8541d6c35f891b9905">setTopNRecordsReturned</a>(AMPS::asString(topN_));</div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;      }</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;      <span class="keywordflow">if</span> (options_.length())</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;      {</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a946e77e4579c0fc419887743de0e333d">setOptions</a>(options_);</div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;      }</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;</div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;      _routes.addRoute(_message.<a class="code" href="classAMPS_1_1Message.html#a636338403d40c748af5a33f931293f41">getQueryID</a>(), messageHandler_,</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;                       Message::AckType::None, ackTypes, <span class="keyword">false</span>);</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;      <span class="keywordflow">try</span></div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;      {</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;        syncAckProcessing(timeout_, _message);</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;      }</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;      <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;      {</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;        AMPS_CALL_EXCEPTION_WRAPPER(_routes.removeRoute(commandId));</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;      }</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;</div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;      <span class="keywordflow">return</span> commandId;</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;    }</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;</div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;    std::string sow(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;                    <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;                    <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;                    <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;                    <span class="keywordtype">int</span> batchSize_ = AMPS_DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;                    <span class="keywordtype">int</span> topN_ = AMPS_DEFAULT_TOP_N)</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;    {</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;      std::string notSet;</div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;      <span class="keywordflow">return</span> sow(messageHandler_,</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;                 topic_,</div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;                 filter_,</div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;                 notSet,   <span class="comment">// orderBy</span></div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;                 notSet,   <span class="comment">// bookmark</span></div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;                 batchSize_,</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;                 topN_,</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;                 notSet,</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;                 timeout_);</div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;    }</div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;</div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;    std::string sowAndSubscribe(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;                                <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;                                <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;                                <span class="keyword">const</span> std::string&amp; orderBy_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;                                <span class="keyword">const</span> std::string&amp; bookmark_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;                                <span class="keywordtype">int</span> batchSize_ = AMPS_DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;                                <span class="keywordtype">int</span> topN_ = AMPS_DEFAULT_TOP_N,</div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;                                <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;                                <span class="keywordtype">long</span> timeout_ = AMPS_DEFAULT_COMMAND_TIMEOUT,</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;                                <span class="keywordtype">bool</span> isHASubscribe_ = <span class="keyword">true</span>)</div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;    {</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;      isHASubscribe_ &amp;= (bool)_subscriptionManager;</div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;      <span class="keywordtype">unsigned</span> ackTypes = Message::AckType::Processed;</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;      _message.reset();</div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ab84e7ca0d5f72269208b0647b67c0375">setCommandEnum</a>(Message::Command::SOWAndSubscribe);</div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;      <a class="code" href="classAMPS_1_1Field.html">Field</a> cid = _message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;      std::string subId = cid;</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a1a814beb4b54f23e364cac2f929b3bfe">setQueryID</a>(cid).<a class="code" href="classAMPS_1_1Message.html#aba905c4e623ad81e1cd100d2da197024">setSubscriptionId</a>(cid).<a class="code" href="classAMPS_1_1Message.html#ab68a4ca105280880c57e3bb29506c2c6">setTopic</a>(topic_);</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;      <span class="keywordflow">if</span> (filter_.length())</div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;      {</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#abaa87b57b3fd2b92efba6a2987b825f2">setFilter</a>(filter_);</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;      }</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;      <span class="keywordflow">if</span> (orderBy_.length())</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;      {</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a6b211029971140a5c5c0f9f1416c6f2e">setOrderBy</a>(orderBy_);</div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;      }</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;      <span class="keywordflow">if</span> (bookmark_.length())</div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;      {</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a5bfe27b946a745eac652586d09e71438">setBookmark</a>(bookmark_);</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;        <a class="code" href="classAMPS_1_1Field.html">Message::Field</a> bookmark = _message.<a class="code" href="classAMPS_1_1Message.html#a7108ef0b54bc76e43dc4d49d700dc8ef">getBookmark</a>();</div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;        <span class="keywordflow">if</span> (_bookmarkStore.isValid())</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;        {</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;          ackTypes |= Message::AckType::Persisted;</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;          <span class="keywordflow">if</span> (bookmark == <a class="code" href="group__specialBookmarks.html#ga9dc6d653c4c409720e685038051c7460">AMPS_BOOKMARK_RECENT</a>)</div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;          {</div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;            _message.<a class="code" href="classAMPS_1_1Message.html#a5bfe27b946a745eac652586d09e71438">setBookmark</a>(_bookmarkStore.<a class="code" href="classAMPS_1_1BookmarkStore.html#aec9e0485c22cf800e90327bcb5ac01a9">getMostRecent</a>(_message.<a class="code" href="classAMPS_1_1Message.html#a4beb1e21b1dabf98cbb956f97fb95dbd">getSubscriptionId</a>()));</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;          }</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bookmark != <a class="code" href="group__specialBookmarks.html#ga56a5f968956ad81c7ebb864816c55a01">AMPS_BOOKMARK_NOW</a> &amp;&amp;</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;                   bookmark != <a class="code" href="group__specialBookmarks.html#ga9b906ecdf1afe8a265183dbe0856959a">AMPS_BOOKMARK_EPOCH</a>)</div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;          {</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;            _bookmarkStore.<a class="code" href="classAMPS_1_1BookmarkStore.html#a502ac677f4ceea04e19b4cdd820c876c">log</a>(_message);</div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;            <span class="keywordflow">if</span> (!BookmarkRange::isRange(bookmark))</div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;            {</div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;              _bookmarkStore.<a class="code" href="classAMPS_1_1BookmarkStore.html#a4d9b0e300e15e63999aad696c00b04c8">discard</a>(_message);</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;              _bookmarkStore.<a class="code" href="classAMPS_1_1BookmarkStore.html#a73ade06e341e7e694cbe756a1c6ab187">persisted</a>(_message.<a class="code" href="classAMPS_1_1Message.html#a4beb1e21b1dabf98cbb956f97fb95dbd">getSubscriptionId</a>(),</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;                                       bookmark);</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;            }</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;          }</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;        }</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bookmark == <a class="code" href="group__specialBookmarks.html#ga9dc6d653c4c409720e685038051c7460">AMPS_BOOKMARK_RECENT</a>)</div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;        {</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;          _message.<a class="code" href="classAMPS_1_1Message.html#a5bfe27b946a745eac652586d09e71438">setBookmark</a>(<a class="code" href="group__specialBookmarks.html#ga9b906ecdf1afe8a265183dbe0856959a">AMPS_BOOKMARK_EPOCH</a>);</div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;        }</div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;      }</div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ae70b22f7c5a65f058e25fa9b4ccbca20">setBatchSize</a>(AMPS::asString(batchSize_));</div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;      <span class="keywordflow">if</span> (topN_ != AMPS_DEFAULT_TOP_N)</div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;      {</div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a806ab5b1e5e69c8541d6c35f891b9905">setTopNRecordsReturned</a>(AMPS::asString(topN_));</div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;      }</div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;      <span class="keywordflow">if</span> (options_.length())</div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;      {</div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a946e77e4579c0fc419887743de0e333d">setOptions</a>(options_);</div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;      }</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;</div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;      <a class="code" href="classAMPS_1_1Message.html">Message</a> message = _message;</div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;      <span class="keywordflow">if</span> (isHASubscribe_)</div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;      {</div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;        message = _message.<a class="code" href="classAMPS_1_1Message.html#afd3b5831324320af6566883f3b9ff9dd">deepCopy</a>();</div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;        Unlock&lt;Mutex&gt; u(_lock);</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;        _subscriptionManager-&gt;subscribe(messageHandler_, message,</div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;                                        Message::AckType::None);</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;        <span class="keywordflow">if</span> (_badTimeToHASubscribe)</div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;        {</div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;          <span class="keywordflow">return</span> subId;</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;        }</div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;      }</div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;      _routes.addRoute(cid, messageHandler_,</div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;                       Message::AckType::None, ackTypes, <span class="keyword">true</span>);</div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;      message.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(ackTypes);</div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;      <span class="keywordflow">if</span> (!options_.empty())</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;      {</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;        message.<a class="code" href="classAMPS_1_1Message.html#a946e77e4579c0fc419887743de0e333d">setOptions</a>(options_);</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;      }</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;      <span class="keywordflow">try</span></div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;      {</div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;        syncAckProcessing(timeout_, message, isHASubscribe_);</div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;      }</div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;      <span class="keywordflow">catch</span> (<span class="keyword">const</span> DisconnectedException&amp;)</div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;      {</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;        <span class="keywordflow">if</span> (!isHASubscribe_)</div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;        {</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;          _routes.removeRoute(subId);</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;          <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;        }</div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;      }</div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;      <span class="keywordflow">catch</span> (<span class="keyword">const</span> TimedOutException&amp;)</div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;      {</div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;        AMPS_CALL_EXCEPTION_WRAPPER(unsubscribeInternal(subId));</div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;      }</div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;      <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;      {</div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;        <span class="keywordflow">if</span> (isHASubscribe_)</div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;        {</div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;          <span class="comment">// Have to unlock before calling into sub manager to avoid deadlock</span></div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;          Unlock&lt;Mutex&gt; unlock(_lock);</div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;          _subscriptionManager-&gt;unsubscribe(cid);</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;        }</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;        _routes.removeRoute(subId);</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;      }</div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;      <span class="keywordflow">return</span> subId;</div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;    }</div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;</div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;    std::string sowAndSubscribe(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;                                <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;                                <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;                                <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;                                <span class="keywordtype">int</span> batchSize_ = AMPS_DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;                                <span class="keywordtype">bool</span> oofEnabled_ = <span class="keyword">false</span>,</div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;                                <span class="keywordtype">int</span> topN_ = AMPS_DEFAULT_TOP_N,</div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;                                <span class="keywordtype">bool</span> isHASubscribe_ = <span class="keyword">true</span>)</div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;    {</div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;      std::string notSet;</div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;      <span class="keywordflow">return</span> sowAndSubscribe(messageHandler_,</div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;                             topic_,</div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;                             filter_,</div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;                             notSet,   <span class="comment">// orderBy</span></div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;                             notSet,   <span class="comment">// bookmark</span></div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;                             batchSize_,</div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;                             topN_,</div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;                             (oofEnabled_ ? <span class="stringliteral">&quot;oof&quot;</span> : <span class="stringliteral">&quot;&quot;</span>),</div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;                             timeout_,</div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;                             isHASubscribe_);</div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;    }</div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;</div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;    std::string sowAndDeltaSubscribe(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;                                     <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;                                     <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;                                     <span class="keyword">const</span> std::string&amp; orderBy_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;                                     <span class="keywordtype">int</span> batchSize_ = AMPS_DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;                                     <span class="keywordtype">int</span> topN_ = AMPS_DEFAULT_TOP_N,</div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;                                     <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;                                     <span class="keywordtype">long</span> timeout_ = AMPS_DEFAULT_COMMAND_TIMEOUT,</div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;                                     <span class="keywordtype">bool</span> isHASubscribe_ = <span class="keyword">true</span>)</div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;    {</div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;      isHASubscribe_ &amp;= (bool)_subscriptionManager;</div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;      _message.reset();</div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ab84e7ca0d5f72269208b0647b67c0375">setCommandEnum</a>(Message::Command::SOWAndDeltaSubscribe);</div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#a1a814beb4b54f23e364cac2f929b3bfe">setQueryID</a>(_message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>());</div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#aba905c4e623ad81e1cd100d2da197024">setSubscriptionId</a>(_message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>());</div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;      std::string subId = _message.<a class="code" href="classAMPS_1_1Message.html#a4beb1e21b1dabf98cbb956f97fb95dbd">getSubscriptionId</a>();</div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ab68a4ca105280880c57e3bb29506c2c6">setTopic</a>(topic_);</div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;      <span class="keywordflow">if</span> (filter_.length())</div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;      {</div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#abaa87b57b3fd2b92efba6a2987b825f2">setFilter</a>(filter_);</div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;      }</div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;      <span class="keywordflow">if</span> (orderBy_.length())</div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;      {</div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a6b211029971140a5c5c0f9f1416c6f2e">setOrderBy</a>(orderBy_);</div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;      }</div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ae70b22f7c5a65f058e25fa9b4ccbca20">setBatchSize</a>(AMPS::asString(batchSize_));</div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;      <span class="keywordflow">if</span> (topN_ != AMPS_DEFAULT_TOP_N)</div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;      {</div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a806ab5b1e5e69c8541d6c35f891b9905">setTopNRecordsReturned</a>(AMPS::asString(topN_));</div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;      }</div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;      <span class="keywordflow">if</span> (options_.length())</div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;      {</div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#a946e77e4579c0fc419887743de0e333d">setOptions</a>(options_);</div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;      }</div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;      <a class="code" href="classAMPS_1_1Message.html">Message</a> message = _message;</div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;      <span class="keywordflow">if</span> (isHASubscribe_)</div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;      {</div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;        message = _message.<a class="code" href="classAMPS_1_1Message.html#afd3b5831324320af6566883f3b9ff9dd">deepCopy</a>();</div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;        Unlock&lt;Mutex&gt; u(_lock);</div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;        _subscriptionManager-&gt;subscribe(messageHandler_, message,</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;                                        Message::AckType::None);</div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;        <span class="keywordflow">if</span> (_badTimeToHASubscribe)</div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;        {</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;          <span class="keywordflow">return</span> subId;</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;        }</div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;      }</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;      _routes.addRoute(message.<a class="code" href="classAMPS_1_1Message.html#a636338403d40c748af5a33f931293f41">getQueryID</a>(), messageHandler_,</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;                       Message::AckType::None, Message::AckType::Processed, <span class="keyword">true</span>);</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;      message.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(Message::AckType::Processed);</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;      <span class="keywordflow">if</span> (!options_.empty())</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;      {</div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;        message.<a class="code" href="classAMPS_1_1Message.html#a946e77e4579c0fc419887743de0e333d">setOptions</a>(options_);</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;      }</div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;      <span class="keywordflow">try</span></div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;      {</div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;        syncAckProcessing(timeout_, message, isHASubscribe_);</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;      }</div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;      <span class="keywordflow">catch</span> (<span class="keyword">const</span> DisconnectedException&amp;)</div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;      {</div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;        <span class="keywordflow">if</span> (!isHASubscribe_)</div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;        {</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;          _routes.removeRoute(subId);</div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;          <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;        }</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;      }</div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;      <span class="keywordflow">catch</span> (<span class="keyword">const</span> TimedOutException&amp;)</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;      {</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;        AMPS_CALL_EXCEPTION_WRAPPER(unsubscribeInternal(subId));</div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;      }</div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;      <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;      {</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;        <span class="keywordflow">if</span> (isHASubscribe_)</div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;        {</div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;          <span class="comment">// Have to unlock before calling into sub manager to avoid deadlock</span></div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;          Unlock&lt;Mutex&gt; unlock(_lock);</div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;          _subscriptionManager-&gt;unsubscribe(<a class="code" href="classAMPS_1_1Field.html">Field</a>(subId));</div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;        }</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;        _routes.removeRoute(subId);</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;      }</div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;      <span class="keywordflow">return</span> subId;</div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;    }</div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;</div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;    std::string sowAndDeltaSubscribe(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;                                     <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;                                     <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;                                     <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;                                     <span class="keywordtype">int</span> batchSize_ = AMPS_DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;                                     <span class="keywordtype">bool</span> oofEnabled_ = <span class="keyword">false</span>,</div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;                                     <span class="keywordtype">bool</span> sendEmpties_ = <span class="keyword">false</span>,</div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;                                     <span class="keywordtype">int</span> topN_ = AMPS_DEFAULT_TOP_N,</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;                                     <span class="keywordtype">bool</span> isHASubscribe_ = <span class="keyword">true</span>)</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;    {</div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;      std::string notSet;</div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;      <a class="code" href="classAMPS_1_1Message_1_1Options.html">Message::Options</a> options;</div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;      <span class="keywordflow">if</span> (oofEnabled_)</div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;      {</div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;        options.<a class="code" href="classAMPS_1_1Message_1_1Options.html#adf952bbadc27b3ee45680d4041458a2e">setOOF</a>();</div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;      }</div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;      <span class="keywordflow">if</span> (sendEmpties_ == <span class="keyword">false</span>)</div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;      {</div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;        options.<a class="code" href="classAMPS_1_1Message_1_1Options.html#a4f4f51284cd746515ffe1ce4e7c727b7">setNoEmpties</a>();</div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;      }</div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;      <span class="keywordflow">return</span> sowAndDeltaSubscribe(messageHandler_,</div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;                                  topic_,</div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;                                  filter_,</div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;                                  notSet,   <span class="comment">// orderBy</span></div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;                                  batchSize_,</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;                                  topN_,</div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;                                  options,</div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;                                  timeout_,</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;                                  isHASubscribe_);</div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;    }</div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;</div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;    std::string sowDelete(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;                          <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;                          <span class="keyword">const</span> std::string&amp; filter_,</div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;                          <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;                          <a class="code" href="classAMPS_1_1Field.html">Message::Field</a> commandId_ = <a class="code" href="classAMPS_1_1Field.html">Message::Field</a>())</div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;    {</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;      <span class="keywordflow">if</span> (_publishStore.<a class="code" href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac">isValid</a>())</div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;      {</div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;        <span class="keywordtype">unsigned</span> ackType = Message::AckType::Processed |</div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;                           Message::AckType::Stats |</div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;                           Message::AckType::Persisted;</div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;        <span class="keywordflow">if</span> (!publishStoreMessage)</div><div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;        {</div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;          publishStoreMessage = <span class="keyword">new</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>();</div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;          PerThreadMessageTracker::addMessageToCleanupList(publishStoreMessage);</div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;        }</div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;        publishStoreMessage-&gt;reset();</div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;        <span class="keywordflow">if</span> (commandId_.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>())</div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;        {</div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;          publishStoreMessage-&gt;newCommandId();</div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;          commandId_ = publishStoreMessage-&gt;getCommandId();</div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;        }</div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;        {</div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;          publishStoreMessage-&gt;setCommandId(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>());</div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;        }</div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;        publishStoreMessage-&gt;setCommandEnum(Message::Command::SOWDelete)</div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;        .assignSubscriptionId(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>())</div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;        .assignQueryID(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>())</div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;        .setAckTypeEnum(ackType)</div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;        .assignTopic(topic_.c_str(), topic_.length())</div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;        .assignFilter(filter_.c_str(), filter_.length());</div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;        amps_uint64_t haSequenceNumber = _publishStore.<a class="code" href="classAMPS_1_1Store.html#acb06fbca0f83c7c4dfc91662b9149dba">store</a>(*publishStoreMessage);</div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;        <span class="keywordtype">char</span> buf[AMPS_NUMBER_BUFFER_LEN];</div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;        <span class="keywordtype">size_t</span> pos = convertToCharArray(buf, haSequenceNumber);</div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;        publishStoreMessage-&gt;assignSequence(buf + pos, AMPS_NUMBER_BUFFER_LEN - pos);</div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;        {</div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;          <span class="keywordflow">try</span></div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;          {</div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;            Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;            _routes.addRoute(commandId_, messageHandler_,</div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;                             Message::AckType::Stats,</div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;                             Message::AckType::Processed | Message::AckType::Persisted,</div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;                             <span class="keyword">false</span>);</div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;            syncAckProcessing(timeout_, *publishStoreMessage,</div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;                              haSequenceNumber);</div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;          }</div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;          <span class="keywordflow">catch</span> (<span class="keyword">const</span> DisconnectedException&amp;)</div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;          {</div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;            <span class="comment">// -V565</span></div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;            <span class="comment">// Pass - it will get replayed upon reconnect</span></div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;          }</div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;          <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;          {</div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;            AMPS_CALL_EXCEPTION_WRAPPER(_routes.removeRoute(commandId_));</div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;            <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;          }</div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;        }</div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;        <span class="keywordflow">return</span> (std::string)commandId_;</div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;      }</div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;      {</div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;        Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;        _message.reset();</div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;        <span class="keywordflow">if</span> (commandId_.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>())</div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;        {</div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;          _message.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;          commandId_ = _message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;        }</div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;        {</div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;          _message.<a class="code" href="classAMPS_1_1Message.html#a71cf9429e3173c45d74b70ffd7736ece">setCommandId</a>(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>());</div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;        }</div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#ab84e7ca0d5f72269208b0647b67c0375">setCommandEnum</a>(Message::Command::SOWDelete)</div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;        .<a class="code" href="classAMPS_1_1Message.html#a31c695d0d5a3409d23e45c8cc845592c">assignSubscriptionId</a>(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>())</div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;        .assignQueryID(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>())</div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;        .setAckTypeEnum(Message::AckType::Processed |</div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;                        Message::AckType::Stats)</div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;        .<a class="code" href="classAMPS_1_1Message.html#ab615fec15ed415791470da4b056bfe36">assignTopic</a>(topic_.c_str(), topic_.length())</div><div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;        .assignFilter(filter_.c_str(), filter_.length());</div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;        _routes.addRoute(commandId_, messageHandler_,</div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;                         Message::AckType::Stats,</div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;                         Message::AckType::Processed,</div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;                         <span class="keyword">false</span>);</div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;        <span class="keywordflow">try</span></div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;        {</div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;          syncAckProcessing(timeout_, _message);</div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;        }</div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;        <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;        {</div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;          AMPS_CALL_EXCEPTION_WRAPPER(_routes.removeRoute(commandId_));</div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;          <span class="keywordflow">throw</span>;</div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;        }</div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;        <span class="keywordflow">return</span> (std::string)commandId_;</div><div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;      }</div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;    }</div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;</div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;    std::string sowDeleteByData(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;                                <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;                                <span class="keyword">const</span> std::string&amp; data_,</div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;                                <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;                                <a class="code" href="classAMPS_1_1Field.html">Message::Field</a> commandId_ = <a class="code" href="classAMPS_1_1Field.html">Message::Field</a>())</div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;    {</div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;      <span class="keywordflow">if</span> (_publishStore.<a class="code" href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac">isValid</a>())</div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;      {</div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;        <span class="keywordtype">unsigned</span> ackType = Message::AckType::Processed |</div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;                           Message::AckType::Stats |</div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;                           Message::AckType::Persisted;</div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;        <span class="keywordflow">if</span> (!publishStoreMessage)</div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;        {</div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;          publishStoreMessage = <span class="keyword">new</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>();</div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;          PerThreadMessageTracker::addMessageToCleanupList(publishStoreMessage);</div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;        }</div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;        publishStoreMessage-&gt;reset();</div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;        <span class="keywordflow">if</span> (commandId_.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>())</div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;        {</div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;          publishStoreMessage-&gt;newCommandId();</div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;          commandId_ = publishStoreMessage-&gt;getCommandId();</div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;        }</div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;        {</div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;          publishStoreMessage-&gt;setCommandId(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>());</div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;        }</div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;        publishStoreMessage-&gt;setCommandEnum(Message::Command::SOWDelete)</div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;        .assignSubscriptionId(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>())</div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;        .assignQueryID(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>())</div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;        .setAckTypeEnum(ackType)</div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;        .assignTopic(topic_.c_str(), topic_.length())</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;        .assignData(data_.c_str(), data_.length());</div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;        amps_uint64_t haSequenceNumber = _publishStore.<a class="code" href="classAMPS_1_1Store.html#acb06fbca0f83c7c4dfc91662b9149dba">store</a>(*publishStoreMessage);</div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;        <span class="keywordtype">char</span> buf[AMPS_NUMBER_BUFFER_LEN];</div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;        <span class="keywordtype">size_t</span> pos = convertToCharArray(buf, haSequenceNumber);</div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;        publishStoreMessage-&gt;assignSequence(buf + pos, AMPS_NUMBER_BUFFER_LEN - pos);</div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;        {</div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;          <span class="keywordflow">try</span></div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;          {</div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;            Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;            _routes.addRoute(commandId_, messageHandler_,</div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;                             Message::AckType::Stats,</div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;                             Message::AckType::Processed | Message::AckType::Persisted,</div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;                             <span class="keyword">false</span>);</div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;            syncAckProcessing(timeout_, *publishStoreMessage,</div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;                              haSequenceNumber);</div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;          }</div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;          <span class="keywordflow">catch</span> (<span class="keyword">const</span> DisconnectedException&amp;)</div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;          {</div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;            <span class="comment">// -V565</span></div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;            <span class="comment">// Pass - it will get replayed upon reconnect</span></div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;          }</div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;          <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;          {</div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;            AMPS_CALL_EXCEPTION_WRAPPER(_routes.removeRoute(commandId_));</div><div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;            <span class="keywordflow">throw</span>;</div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;          }</div><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;        }</div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;        <span class="keywordflow">return</span> (std::string)commandId_;</div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;      }</div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;      {</div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;        Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;        _message.reset();</div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;        <span class="keywordflow">if</span> (commandId_.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>())</div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;        {</div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;          _message.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;          commandId_ = _message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;        }</div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;        {</div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;          _message.<a class="code" href="classAMPS_1_1Message.html#a71cf9429e3173c45d74b70ffd7736ece">setCommandId</a>(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>());</div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;        }</div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#ab84e7ca0d5f72269208b0647b67c0375">setCommandEnum</a>(Message::Command::SOWDelete)</div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;        .<a class="code" href="classAMPS_1_1Message.html#a31c695d0d5a3409d23e45c8cc845592c">assignSubscriptionId</a>(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>())</div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;        .assignQueryID(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>())</div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;        .setAckTypeEnum(Message::AckType::Processed |</div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;                        Message::AckType::Stats)</div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;        .<a class="code" href="classAMPS_1_1Message.html#ab615fec15ed415791470da4b056bfe36">assignTopic</a>(topic_.c_str(), topic_.length())</div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;        .assignData(data_.c_str(), data_.length());</div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;        _routes.addRoute(commandId_, messageHandler_,</div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;                         Message::AckType::Stats,</div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;                         Message::AckType::Processed,</div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;                         <span class="keyword">false</span>);</div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;        <span class="keywordflow">try</span></div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;        {</div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;          syncAckProcessing(timeout_, _message);</div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;        }</div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;        <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;        {</div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;          AMPS_CALL_EXCEPTION_WRAPPER(_routes.removeRoute(commandId_));</div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;          <span class="keywordflow">throw</span>;</div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;        }</div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;        <span class="keywordflow">return</span> (std::string)commandId_;</div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;      }</div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;    }</div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;</div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;    std::string sowDeleteByKeys(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;                                <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;                                <span class="keyword">const</span> std::string&amp; keys_,</div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;                                <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;                                <a class="code" href="classAMPS_1_1Field.html">Message::Field</a> commandId_ = <a class="code" href="classAMPS_1_1Field.html">Message::Field</a>())</div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;    {</div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;      <span class="keywordflow">if</span> (_publishStore.<a class="code" href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac">isValid</a>())</div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;      {</div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;        <span class="keywordtype">unsigned</span> ackType = Message::AckType::Processed |</div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;                           Message::AckType::Stats |</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;                           Message::AckType::Persisted;</div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;        <span class="keywordflow">if</span> (!publishStoreMessage)</div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;        {</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;          publishStoreMessage = <span class="keyword">new</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>();</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;          PerThreadMessageTracker::addMessageToCleanupList(publishStoreMessage);</div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;        }</div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;        publishStoreMessage-&gt;reset();</div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;        <span class="keywordflow">if</span> (commandId_.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>())</div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;        {</div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;          publishStoreMessage-&gt;newCommandId();</div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;          commandId_ = publishStoreMessage-&gt;getCommandId();</div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;        }</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;        {</div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;          publishStoreMessage-&gt;setCommandId(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>());</div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;        }</div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;        publishStoreMessage-&gt;setCommandEnum(Message::Command::SOWDelete)</div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;        .assignSubscriptionId(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>())</div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;        .assignQueryID(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>())</div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;        .setAckTypeEnum(ackType)</div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;        .assignTopic(topic_.c_str(), topic_.length())</div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;        .assignSowKeys(keys_.c_str(), keys_.length());</div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;        amps_uint64_t haSequenceNumber = _publishStore.<a class="code" href="classAMPS_1_1Store.html#acb06fbca0f83c7c4dfc91662b9149dba">store</a>(*publishStoreMessage);</div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;        <span class="keywordtype">char</span> buf[AMPS_NUMBER_BUFFER_LEN];</div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;        <span class="keywordtype">size_t</span> pos = convertToCharArray(buf, haSequenceNumber);</div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;        publishStoreMessage-&gt;assignSequence(buf + pos, AMPS_NUMBER_BUFFER_LEN - pos);</div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;        {</div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;          <span class="keywordflow">try</span></div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;          {</div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;            Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;            _routes.addRoute(commandId_, messageHandler_,</div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;                             Message::AckType::Stats,</div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;                             Message::AckType::Processed | Message::AckType::Persisted,</div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;                             <span class="keyword">false</span>);</div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;            syncAckProcessing(timeout_, *publishStoreMessage,</div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;                              haSequenceNumber);</div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;          }</div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;          <span class="keywordflow">catch</span> (<span class="keyword">const</span> DisconnectedException&amp;)</div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;          {</div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;            <span class="comment">// -V565</span></div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;            <span class="comment">// Pass - it will get replayed upon reconnect</span></div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;          }</div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;          <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;          {</div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;            AMPS_CALL_EXCEPTION_WRAPPER(_routes.removeRoute(commandId_));</div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;            <span class="keywordflow">throw</span>;</div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;          }</div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;        }</div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;        <span class="keywordflow">return</span> (std::string)commandId_;</div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;      }</div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;      {</div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;        Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;        _message.reset();</div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;        <span class="keywordflow">if</span> (commandId_.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>())</div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;        {</div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;          _message.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>();</div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;          commandId_ = _message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;        }</div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;        {</div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;          _message.<a class="code" href="classAMPS_1_1Message.html#a71cf9429e3173c45d74b70ffd7736ece">setCommandId</a>(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>());</div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;        }</div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;        _message.<a class="code" href="classAMPS_1_1Message.html#ab84e7ca0d5f72269208b0647b67c0375">setCommandEnum</a>(Message::Command::SOWDelete)</div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;        .<a class="code" href="classAMPS_1_1Message.html#a31c695d0d5a3409d23e45c8cc845592c">assignSubscriptionId</a>(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>())</div><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;        .assignQueryID(commandId_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), commandId_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>())</div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;        .setAckTypeEnum(Message::AckType::Processed |</div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;                        Message::AckType::Stats)</div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;        .<a class="code" href="classAMPS_1_1Message.html#ab615fec15ed415791470da4b056bfe36">assignTopic</a>(topic_.c_str(), topic_.length())</div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;        .assignSowKeys(keys_.c_str(), keys_.length());</div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;        _routes.addRoute(commandId_, messageHandler_,</div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;                         Message::AckType::Stats,</div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;                         Message::AckType::Processed,</div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;                         <span class="keyword">false</span>);</div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;        <span class="keywordflow">try</span></div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;        {</div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;          syncAckProcessing(timeout_, _message);</div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;        }</div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;        <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;        {</div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;          AMPS_CALL_EXCEPTION_WRAPPER(_routes.removeRoute(commandId_));</div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;          <span class="keywordflow">throw</span>;</div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;        }</div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;        <span class="keywordflow">return</span> (std::string)commandId_;</div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;      }</div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;    }</div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;</div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;    <span class="keywordtype">void</span> startTimer(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;    {</div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;      <span class="keywordflow">if</span> (_serverVersion &gt;= <span class="stringliteral">&quot;5.3.2.0&quot;</span>)</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;      {</div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;        <span class="keywordflow">throw</span> CommandException(<span class="stringliteral">&quot;The start_timer command is deprecated.&quot;</span>);</div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;      }</div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;      _message.reset();</div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;      _message.<a class="code" href="classAMPS_1_1Message.html#ab84e7ca0d5f72269208b0647b67c0375">setCommandEnum</a>(Message::Command::StartTimer);</div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;</div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;      _send(_message);</div><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;    }</div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;</div><div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;    std::string stopTimer(<a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a> messageHandler_)</div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;    {</div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;      <span class="keywordflow">if</span> (_serverVersion &gt;= <span class="stringliteral">&quot;5.3.2.0&quot;</span>)</div><div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;      {</div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;        <span class="keywordflow">throw</span> CommandException(<span class="stringliteral">&quot;The stop_timer command is deprecated.&quot;</span>);</div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;      }</div><div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;      <span class="keywordflow">return</span> executeAsync(<a class="code" href="classAMPS_1_1Command.html">Command</a>(<span class="stringliteral">&quot;stop_timer&quot;</span>).addAckType(<span class="stringliteral">&quot;completed&quot;</span>), messageHandler_);</div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;    }</div><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;</div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;    <a class="code" href="amps_8h.html#acfa1278412265f3b4c421e77111ed2ce">amps_handle</a> getHandle(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;    {</div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;      <span class="keywordflow">return</span> _client;</div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;    }</div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;</div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;    <span class="keywordtype">void</span> setExceptionListener(<span class="keyword">const</span> std::shared_ptr&lt;const ExceptionListener&gt;&amp; pListener_)</div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;    {</div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;      _pExceptionListener = pListener_;</div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;      _exceptionListener = _pExceptionListener.get();</div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;    }</div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;</div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;    <span class="keywordtype">void</span> setExceptionListener(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1ExceptionListener.html">ExceptionListener</a>&amp; listener_)</div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;    {</div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;      _exceptionListener = &amp;listener_;</div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;    }</div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;</div><div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAMPS_1_1ExceptionListener.html">ExceptionListener</a>&amp; getExceptionListener(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;      <span class="keywordflow">return</span> *_exceptionListener;</div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;    }</div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;</div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;    <span class="keywordtype">void</span> setHeartbeat(<span class="keywordtype">unsigned</span> heartbeatInterval_, <span class="keywordtype">unsigned</span> readTimeout_)</div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;    {</div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;      <span class="keywordflow">if</span> (readTimeout_ &lt; heartbeatInterval_)</div><div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;      {</div><div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;        <span class="keywordflow">throw</span> UsageException(<span class="stringliteral">&quot;The socket read timeout must be &gt;= the heartbeat interval.&quot;</span>);</div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;      }</div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;      Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;      <span class="keywordflow">if</span> (_heartbeatInterval != heartbeatInterval_ ||</div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;          _readTimeout       != readTimeout_)</div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;      {</div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;        _heartbeatInterval = heartbeatInterval_;</div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;        _readTimeout = readTimeout_;</div><div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;        _sendHeartbeat();</div><div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;      }</div><div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;    }</div><div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;</div><div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;    <span class="keywordtype">void</span> _sendHeartbeat(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;    {</div><div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;      <span class="keywordflow">if</span> (_connected &amp;&amp; _heartbeatInterval != 0)</div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;      {</div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;        std::ostringstream options;</div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;        options &lt;&lt; <span class="stringliteral">&quot;start,&quot;</span> &lt;&lt; _heartbeatInterval;</div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;        _beatMessage.<a class="code" href="classAMPS_1_1Message.html#a946e77e4579c0fc419887743de0e333d">setOptions</a>(options.str());</div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;</div><div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;        _heartbeatTimer.setTimeout(_heartbeatInterval * 1000.0);</div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;        _heartbeatTimer.start();</div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;        <span class="keywordflow">try</span></div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;        {</div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;          _sendWithoutRetry(_beatMessage);</div><div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;          broadcastConnectionStateChanged(ConnectionStateListener::HeartbeatInitiated);</div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;        }</div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;        <span class="keywordflow">catch</span> (ConnectionException&amp; ex_)</div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;        {</div><div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;          <span class="comment">// If we are disconnected when we attempt to send, that&#39;s OK;</span></div><div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;          <span class="comment">//   we&#39;ll send this message after we re-connect (if we do).</span></div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;          AMPS_UNHANDLED_EXCEPTION(ex_);</div><div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;        }</div><div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;        _beatMessage.<a class="code" href="classAMPS_1_1Message.html#a946e77e4579c0fc419887743de0e333d">setOptions</a>(<span class="stringliteral">&quot;beat&quot;</span>);</div><div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;      }</div><div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;      <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04">amps_result</a> result = <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a>;</div><div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;      <span class="keywordflow">if</span> (_readTimeout &amp;&amp; _connected)</div><div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;      {</div><div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;        result = <a class="code" href="amps_8h.html#a7bc2d5213a2a07234287fe191c19bae1">amps_client_set_read_timeout</a>(_client, (<span class="keywordtype">int</span>)_readTimeout);</div><div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;      }</div><div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;      <span class="keywordflow">if</span> (result != <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a> &amp;&amp; result != <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a867ac1b88eb736ddae182279d2788aea">AMPS_E_DISCONNECTED</a>)</div><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;      {</div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;        AMPSException::throwFor(_client, result);</div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;      }</div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;    }</div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;</div><div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;    <span class="keywordtype">void</span> addConnectionStateListener(<a class="code" href="classAMPS_1_1ConnectionStateListener.html">ConnectionStateListener</a>* listener_)</div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;    {</div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;      Lock&lt;Mutex&gt; lock(_lock);</div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;      _connectionStateListeners.insert(listener_);</div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;    }</div><div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;</div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;    <span class="keywordtype">void</span> removeConnectionStateListener(<a class="code" href="classAMPS_1_1ConnectionStateListener.html">ConnectionStateListener</a>* listener_)</div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;    {</div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;      Lock&lt;Mutex&gt; lock(_lock);</div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;      _connectionStateListeners.erase(listener_);</div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;    }</div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;</div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;    <span class="keywordtype">void</span> clearConnectionStateListeners()</div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;    {</div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;      Lock&lt;Mutex&gt; lock(_lock);</div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;      _connectionStateListeners.clear();</div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;    }</div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;</div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;    <span class="keywordtype">void</span> _registerHandler(<a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; command_, <a class="code" href="classAMPS_1_1Field.html">Message::Field</a>&amp; cid_,</div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;                          <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; handler_, <span class="keywordtype">unsigned</span> requestedAcks_,</div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;                          <span class="keywordtype">unsigned</span> systemAddedAcks_, <span class="keywordtype">bool</span> isSubscribe_)</div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;    {</div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;      <a class="code" href="classAMPS_1_1Message.html">Message</a> message = command_.getMessage();</div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;      Message::Command::Type commandType = message.<a class="code" href="classAMPS_1_1Message.html#a3e9f467321699a813340e57d4161f3e6">getCommandEnum</a>();</div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;      <a class="code" href="classAMPS_1_1Field.html">Message::Field</a> subid = message.<a class="code" href="classAMPS_1_1Message.html#a4beb1e21b1dabf98cbb956f97fb95dbd">getSubscriptionId</a>();</div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;      <a class="code" href="classAMPS_1_1Field.html">Message::Field</a> qid = message.<a class="code" href="classAMPS_1_1Message.html#a636338403d40c748af5a33f931293f41">getQueryID</a>();</div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;      <span class="comment">// If we have an id, we&#39;re good, even if it&#39;s an existing route</span></div><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;      <span class="keywordtype">bool</span> added = qid.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>() || subid.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>() || cid_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>();</div><div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;      <span class="keywordtype">bool</span> cidIsQid = cid_ == qid;</div><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;      <span class="keywordtype">bool</span> cidUnique = !cidIsQid &amp;&amp; cid_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>() &gt; 0 &amp;&amp; cid_ != subid;</div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;      <span class="keywordtype">int</span> addedCount = 0;</div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;      <span class="keywordflow">if</span> (subid.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>() &gt; 0)</div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;      {</div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;        <span class="comment">// This can replace a non-subscribe with a matching id</span></div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;        <span class="comment">// with a subscription but not another subscription.</span></div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;        addedCount += _routes.addRoute(subid, handler_, requestedAcks_,</div><div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;                                       systemAddedAcks_, isSubscribe_);</div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;        <span class="keywordflow">if</span> (!cidUnique</div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;            &amp;&amp; (commandType == Message::Command::Subscribe</div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;                || commandType == Message::Command::DeltaSubscribe))</div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;        {</div><div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;          <span class="comment">// We don&#39;t need to do anything else</span></div><div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;          cid_ = subid;</div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;          <span class="keywordflow">return</span>;</div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;        }</div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;      }</div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;      <span class="keywordflow">if</span> (qid.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>() &gt; 0 &amp;&amp; qid != subid</div><div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;          &amp;&amp; (commandType == Message::Command::SOW</div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;              || commandType == Message::Command::SOWDelete</div><div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;              || commandType == Message::Command::SOWAndSubscribe</div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;              || commandType == Message::Command::SOWAndDeltaSubscribe))</div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;      {</div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;        <span class="keywordflow">while</span> (_routes.hasRoute(qid))</div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;        {</div><div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;          message.<a class="code" href="classAMPS_1_1Message.html#af0abc1c791ec6cbc73e6a4e97b32a18c">newQueryId</a>();</div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;          <span class="keywordflow">if</span> (cidIsQid)</div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;          {</div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;            cid_ = message.<a class="code" href="classAMPS_1_1Message.html#a1b4db85007e3981904544f36371247ad">getQueryId</a>();</div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;          }</div><div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;          qid = message.<a class="code" href="classAMPS_1_1Message.html#a1b4db85007e3981904544f36371247ad">getQueryId</a>();</div><div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;        }</div><div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;        <span class="keywordflow">if</span> (addedCount == 0)</div><div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;        {</div><div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;          _routes.addRoute(qid, handler_, requestedAcks_,</div><div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;                           systemAddedAcks_, isSubscribe_);</div><div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;        }</div><div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;        {</div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;          <span class="keywordtype">void</span>* data = NULL;</div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;          {</div><div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;            Unlock&lt;Mutex&gt; u(_lock);</div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;            data = amps_invoke_copy_route_function(handler_.userData());</div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;          }</div><div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;          <span class="keywordflow">if</span> (!data)</div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;          {</div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;            _routes.addRoute(qid, handler_, requestedAcks_,</div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;                             systemAddedAcks_, <span class="keyword">false</span>);</div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;          }</div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;          {</div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;            _routes.addRoute(qid,</div><div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;                             <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(handler_.function(),</div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;                                            data),</div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;                             requestedAcks_,</div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;                             systemAddedAcks_, <span class="keyword">false</span>);</div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;          }</div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;        }</div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;        ++addedCount;</div><div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;      }</div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;      <span class="keywordflow">if</span> (cidUnique &amp;&amp; requestedAcks_ &amp; ~Message::AckType::Persisted)</div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;      {</div><div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;        <span class="keywordflow">while</span> (_routes.hasRoute(cid_))</div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;        {</div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;          cid_ = message.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>().<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;        }</div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;        <span class="keywordflow">if</span> (addedCount == 0)</div><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;        {</div><div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;          _routes.addRoute(cid_, handler_, requestedAcks_,</div><div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;                           systemAddedAcks_, <span class="keyword">false</span>);</div><div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;        }</div><div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;        {</div><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;          <span class="keywordtype">void</span>* data = NULL;</div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;          {</div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;            Unlock&lt;Mutex&gt; u(_lock);</div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;            data = amps_invoke_copy_route_function(handler_.userData());</div><div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;          }</div><div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;          <span class="keywordflow">if</span> (!data)</div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;          {</div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;            _routes.addRoute(cid_, handler_, requestedAcks_,</div><div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;                             systemAddedAcks_, <span class="keyword">false</span>);</div><div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;          }</div><div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;          {</div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;            _routes.addRoute(cid_,</div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;                             <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(handler_.function(),</div><div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;                                            data),</div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;                             requestedAcks_,</div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;                             systemAddedAcks_, <span class="keyword">false</span>);</div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;          }</div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;        }</div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;      }</div><div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((commandType == Message::Command::Publish ||</div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;                commandType == Message::Command::DeltaPublish)</div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;               &amp;&amp; requestedAcks_ &amp; ~<a class="code" href="classAMPS_1_1Message.html">Message</a>::AckType::Persisted)</div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;      {</div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;        cid_ = command_.getMessage().<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>().<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;        _routes.addRoute(cid_, handler_, requestedAcks_,</div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;                         systemAddedAcks_, <span class="keyword">false</span>);</div><div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;        added = <span class="keyword">true</span>;</div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;      }</div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;      <span class="keywordflow">if</span> (!added)</div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;      {</div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;        <span class="keywordflow">throw</span> UsageException(<span class="stringliteral">&quot;To use a messagehandler, you must also supply a command or subscription ID.&quot;</span>);</div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;      }</div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;    }</div><div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;</div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;    std::string executeAsyncNoLock(<a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; command_, <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; handler_,</div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;                                   <span class="keywordtype">bool</span> isHASubscribe_ = <span class="keyword">true</span>)</div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;    {</div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;      isHASubscribe_ &amp;= (bool)_subscriptionManager;</div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;      <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message = command_.getMessage();</div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;      <span class="keywordtype">unsigned</span> systemAddedAcks = (handler_.isValid() || command_.hasProcessedAck()) ?</div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;                                 Message::AckType::Processed : Message::AckType::None;</div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;      <span class="keywordtype">unsigned</span> requestedAcks = message.<a class="code" href="classAMPS_1_1Message.html#a7d58a2c39f59d6fca098efd4bb81d3b5">getAckTypeEnum</a>();</div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;      <span class="keywordtype">bool</span> isPublishStore = _publishStore.<a class="code" href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac">isValid</a>() &amp;&amp; command_.needsSequenceNumber();</div><div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;      Message::Command::Type commandType = message.<a class="code" href="classAMPS_1_1Message.html#a3e9f467321699a813340e57d4161f3e6">getCommandEnum</a>();</div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;      <span class="keywordflow">if</span> (commandType == Message::Command::SOW</div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;          || commandType == Message::Command::SOWAndSubscribe</div><div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;          || commandType == Message::Command::SOWAndDeltaSubscribe</div><div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;          || commandType == Message::Command::StopTimer)</div><div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;      {</div><div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;        systemAddedAcks |= Message::AckType::Completed;</div><div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;      }</div><div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;      <a class="code" href="classAMPS_1_1Field.html">Message::Field</a> cid = message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;      <span class="keywordflow">if</span> (handler_.isValid() &amp;&amp; cid.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>())</div><div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;      {</div><div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;        cid = message.<a class="code" href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">newCommandId</a>().<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>();</div><div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;      }</div><div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;      <span class="keywordflow">if</span> (message.<a class="code" href="classAMPS_1_1Message.html#a7108ef0b54bc76e43dc4d49d700dc8ef">getBookmark</a>().<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>() &gt; 0)</div><div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;      {</div><div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;        <span class="keywordflow">if</span> (command_.isSubscribe())</div><div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;        {</div><div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;          <a class="code" href="classAMPS_1_1Field.html">Message::Field</a> bookmark = message.<a class="code" href="classAMPS_1_1Message.html#a7108ef0b54bc76e43dc4d49d700dc8ef">getBookmark</a>();</div><div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;          <span class="keywordflow">if</span> (_bookmarkStore.isValid())</div><div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;          {</div><div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;            systemAddedAcks |= Message::AckType::Persisted;</div><div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;            <span class="keywordflow">if</span> (bookmark == <a class="code" href="group__specialBookmarks.html#ga9dc6d653c4c409720e685038051c7460">AMPS_BOOKMARK_RECENT</a>)</div><div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;            {</div><div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;              message.<a class="code" href="classAMPS_1_1Message.html#a5bfe27b946a745eac652586d09e71438">setBookmark</a>(_bookmarkStore.<a class="code" href="classAMPS_1_1BookmarkStore.html#aec9e0485c22cf800e90327bcb5ac01a9">getMostRecent</a>(message.<a class="code" href="classAMPS_1_1Message.html#a4beb1e21b1dabf98cbb956f97fb95dbd">getSubscriptionId</a>()));</div><div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;            }</div><div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bookmark != <a class="code" href="group__specialBookmarks.html#ga56a5f968956ad81c7ebb864816c55a01">AMPS_BOOKMARK_NOW</a> &amp;&amp;</div><div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;                     bookmark != <a class="code" href="group__specialBookmarks.html#ga9b906ecdf1afe8a265183dbe0856959a">AMPS_BOOKMARK_EPOCH</a>)</div><div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;            {</div><div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;              _bookmarkStore.<a class="code" href="classAMPS_1_1BookmarkStore.html#a502ac677f4ceea04e19b4cdd820c876c">log</a>(message);</div><div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;              <span class="keywordflow">if</span> (!BookmarkRange::isRange(bookmark))</div><div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;              {</div><div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;                _bookmarkStore.<a class="code" href="classAMPS_1_1BookmarkStore.html#a4d9b0e300e15e63999aad696c00b04c8">discard</a>(message);</div><div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;                _bookmarkStore.<a class="code" href="classAMPS_1_1BookmarkStore.html#a73ade06e341e7e694cbe756a1c6ab187">persisted</a>(message.<a class="code" href="classAMPS_1_1Message.html#a4beb1e21b1dabf98cbb956f97fb95dbd">getSubscriptionId</a>(),</div><div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;                                         bookmark);</div><div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;              }</div><div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;            }</div><div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;          }</div><div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bookmark == <a class="code" href="group__specialBookmarks.html#ga9dc6d653c4c409720e685038051c7460">AMPS_BOOKMARK_RECENT</a>)</div><div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;          {</div><div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;            message.<a class="code" href="classAMPS_1_1Message.html#a5bfe27b946a745eac652586d09e71438">setBookmark</a>(<a class="code" href="group__specialBookmarks.html#ga9b906ecdf1afe8a265183dbe0856959a">AMPS_BOOKMARK_EPOCH</a>);</div><div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;          }</div><div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;        }</div><div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;      }</div><div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;      <span class="keywordflow">if</span> (isPublishStore)</div><div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;      {</div><div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;        systemAddedAcks |= Message::AckType::Persisted;</div><div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;      }</div><div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;      <span class="keywordtype">bool</span> isSubscribe = command_.isSubscribe();</div><div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;      <span class="keywordflow">if</span> (handler_.isValid() &amp;&amp; !isSubscribe)</div><div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;      {</div><div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;        _registerHandler(command_, cid, handler_,</div><div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;                         requestedAcks, systemAddedAcks, isSubscribe);</div><div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;      }</div><div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;      <span class="keywordtype">bool</span> useSyncSend = cid.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>() &gt; 0 &amp;&amp; command_.hasProcessedAck();</div><div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;      <span class="keywordflow">if</span> (isPublishStore)</div><div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;      {</div><div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;        amps_uint64_t haSequenceNumber = (amps_uint64_t)0;</div><div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;        message.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(requestedAcks | systemAddedAcks);</div><div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;        {</div><div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;          Unlock&lt;Mutex&gt; u(_lock);</div><div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;          haSequenceNumber = _publishStore.<a class="code" href="classAMPS_1_1Store.html#acb06fbca0f83c7c4dfc91662b9149dba">store</a>(message);</div><div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;        }</div><div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;        message.<a class="code" href="classAMPS_1_1Message.html#a6a226fb422c3baf9b5304b292e7cd950">setSequence</a>(haSequenceNumber);</div><div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;        <span class="keywordflow">try</span></div><div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;        {</div><div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;          <span class="keywordflow">if</span> (useSyncSend)</div><div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;          {</div><div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;            syncAckProcessing((<span class="keywordtype">long</span>)command_.getTimeout(), message,</div><div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;                              haSequenceNumber);</div><div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;          }</div><div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;          {</div><div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;            _send(message, haSequenceNumber);</div><div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;          }</div><div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;        }</div><div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;        <span class="keywordflow">catch</span> (<span class="keyword">const</span> DisconnectedException&amp;)</div><div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;        {</div><div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;          <span class="comment">// -V565</span></div><div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;          <span class="comment">// Pass - message will get replayed when reconnected</span></div><div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;        }</div><div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;        <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;        {</div><div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;          AMPS_CALL_EXCEPTION_WRAPPER(_routes.removeRoute(cid));</div><div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;          <span class="keywordflow">throw</span>;</div><div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;        }</div><div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;      }</div><div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;      {</div><div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;        <span class="keywordflow">if</span> (isSubscribe)</div><div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;        {</div><div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;          <span class="keyword">const</span> <a class="code" href="classAMPS_1_1Field.html">Message::Field</a>&amp; subId = message.<a class="code" href="classAMPS_1_1Message.html#a4beb1e21b1dabf98cbb956f97fb95dbd">getSubscriptionId</a>();</div><div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;          <span class="keywordflow">if</span> (isHASubscribe_)</div><div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;          {</div><div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;            Unlock&lt;Mutex&gt; u(_lock);</div><div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;            _subscriptionManager-&gt;subscribe(handler_,</div><div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;                                            message.<a class="code" href="classAMPS_1_1Message.html#afd3b5831324320af6566883f3b9ff9dd">deepCopy</a>(),</div><div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;                                            requestedAcks);</div><div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;            <span class="keywordflow">if</span> (_badTimeToHASubscribe)</div><div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;            {</div><div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;              message.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(requestedAcks);</div><div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;              <span class="keywordflow">return</span> std::string(subId.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), subId.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>());</div><div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;            }</div><div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;          }</div><div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;          <span class="keywordflow">if</span> (handler_.isValid())</div><div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;          {</div><div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;            _registerHandler(command_, cid, handler_,</div><div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;                             requestedAcks, systemAddedAcks, isSubscribe);</div><div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;          }</div><div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;          message.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(requestedAcks | systemAddedAcks);</div><div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;          <span class="keywordflow">try</span></div><div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;          {</div><div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;            <span class="keywordflow">if</span> (useSyncSend)</div><div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;            {</div><div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;              syncAckProcessing((<span class="keywordtype">long</span>)command_.getTimeout(), message,</div><div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;                                isHASubscribe_);</div><div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;            }</div><div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;            {</div><div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;              _send(message);</div><div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;            }</div><div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;          }</div><div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;          <span class="keywordflow">catch</span> (<span class="keyword">const</span> DisconnectedException&amp;)</div><div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;          {</div><div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;            <span class="keywordflow">if</span> (!isHASubscribe_)</div><div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;            {</div><div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;              AMPS_CALL_EXCEPTION_WRAPPER(_routes.removeRoute(cid));</div><div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;              AMPS_CALL_EXCEPTION_WRAPPER(_routes.removeRoute(subId));</div><div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;              AMPS_CALL_EXCEPTION_WRAPPER(_routes.removeRoute(message.<a class="code" href="classAMPS_1_1Message.html#a1b4db85007e3981904544f36371247ad">getQueryId</a>()));</div><div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;              message.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(requestedAcks);</div><div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;              <span class="keywordflow">throw</span>;</div><div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;            }</div><div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;          }</div><div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;          <span class="keywordflow">catch</span> (<span class="keyword">const</span> TimedOutException&amp;)</div><div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;          {</div><div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;            AMPS_CALL_EXCEPTION_WRAPPER(unsubscribeInternal(cid));</div><div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;            AMPS_CALL_EXCEPTION_WRAPPER(unsubscribeInternal(subId));</div><div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;            AMPS_CALL_EXCEPTION_WRAPPER(unsubscribeInternal(message.<a class="code" href="classAMPS_1_1Message.html#a1b4db85007e3981904544f36371247ad">getQueryId</a>()));</div><div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;            <span class="keywordflow">throw</span>;</div><div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;          }</div><div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;          <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;          {</div><div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;            <span class="keywordflow">if</span> (isHASubscribe_)</div><div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;            {</div><div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;              <span class="comment">// Have to unlock before calling into sub manager to avoid deadlock</span></div><div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;              Unlock&lt;Mutex&gt; unlock(_lock);</div><div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;              _subscriptionManager-&gt;unsubscribe(subId);</div><div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;            }</div><div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;            <span class="keywordflow">if</span> (message.<a class="code" href="classAMPS_1_1Message.html#a636338403d40c748af5a33f931293f41">getQueryID</a>().<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>() &gt; 0)</div><div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;            {</div><div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;              _routes.removeRoute(message.<a class="code" href="classAMPS_1_1Message.html#a636338403d40c748af5a33f931293f41">getQueryID</a>());</div><div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;            }</div><div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;            _routes.removeRoute(cid);</div><div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;            _routes.removeRoute(subId);</div><div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;            <span class="keywordflow">throw</span>;</div><div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;          }</div><div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;          <span class="keywordflow">if</span> (subId.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>() &gt; 0)</div><div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;          {</div><div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;            message.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(requestedAcks);</div><div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;            <span class="keywordflow">return</span> std::string(subId.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), subId.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>());</div><div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;          }</div><div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;        }</div><div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;        {</div><div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;          message.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(requestedAcks | systemAddedAcks);</div><div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;          <span class="keywordflow">try</span></div><div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;          {</div><div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;            <span class="keywordflow">if</span> (useSyncSend)</div><div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;            {</div><div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;              syncAckProcessing((<span class="keywordtype">long</span>)(command_.getTimeout()), message);</div><div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;            }</div><div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;            {</div><div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;              _send(message);</div><div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;            }</div><div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;          }</div><div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;          <span class="keywordflow">catch</span> (<span class="keyword">const</span> DisconnectedException&amp;)</div><div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;          {</div><div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;            AMPS_CALL_EXCEPTION_WRAPPER(_routes.removeRoute(cid));</div><div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;            AMPS_CALL_EXCEPTION_WRAPPER(_routes.removeRoute(message.<a class="code" href="classAMPS_1_1Message.html#a1b4db85007e3981904544f36371247ad">getQueryId</a>()));</div><div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;            message.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(requestedAcks);</div><div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;            <span class="keywordflow">throw</span>;</div><div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;          }</div><div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;          <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;          {</div><div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;            AMPS_CALL_EXCEPTION_WRAPPER(_routes.removeRoute(cid));</div><div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;            AMPS_CALL_EXCEPTION_WRAPPER(_routes.removeRoute(message.<a class="code" href="classAMPS_1_1Message.html#a1b4db85007e3981904544f36371247ad">getQueryId</a>()));</div><div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;            message.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(requestedAcks);</div><div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;            <span class="keywordflow">throw</span>;</div><div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;          }</div><div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;        }</div><div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;      }</div><div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;      message.<a class="code" href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">setAckTypeEnum</a>(requestedAcks);</div><div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;      <span class="keywordflow">return</span> cid;</div><div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;    }</div><div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;</div><div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> getEmptyMessageStream(<span class="keywordtype">void</span>);</div><div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;</div><div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;    std::string executeAsync(<a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; command_, <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; handler_,</div><div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;                             <span class="keywordtype">bool</span> isHASubscribe_ = <span class="keyword">true</span>)</div><div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;    {</div><div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;      Lock&lt;Mutex&gt; lock(_lock);</div><div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;      <span class="keywordflow">return</span> executeAsyncNoLock(command_, handler_, isHASubscribe_);</div><div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;    }</div><div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;</div><div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;    <span class="comment">// Queue Methods //</span></div><div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;    <span class="keywordtype">void</span> setAutoAck(<span class="keywordtype">bool</span> isAutoAckEnabled_)</div><div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;    {</div><div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;      _isAutoAckEnabled = isAutoAckEnabled_;</div><div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;    }</div><div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;    <span class="keywordtype">bool</span> getAutoAck(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;      <span class="keywordflow">return</span> _isAutoAckEnabled;</div><div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;    }</div><div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;    <span class="keywordtype">void</span> setAckBatchSize(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> batchSize_)</div><div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;    {</div><div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;      _ackBatchSize = batchSize_;</div><div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;      <span class="keywordflow">if</span> (!_queueAckTimeout)</div><div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;      {</div><div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;        _queueAckTimeout = AMPS_DEFAULT_QUEUE_ACK_TIMEOUT;</div><div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;        <a class="code" href="amps_8h.html#ad5674cb8a55c793aa66de7c7068d923c">amps_client_set_idle_time</a>(_client, _queueAckTimeout);</div><div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;      }</div><div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;    }</div><div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;    <span class="keywordtype">unsigned</span> getAckBatchSize(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;      <span class="keywordflow">return</span> _ackBatchSize;</div><div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;    }</div><div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;    <span class="keywordtype">int</span> getAckTimeout(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;      <span class="keywordflow">return</span> _queueAckTimeout;</div><div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;    }</div><div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;    <span class="keywordtype">void</span> setAckTimeout(<span class="keyword">const</span> <span class="keywordtype">int</span> ackTimeout_)</div><div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;    {</div><div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;      <a class="code" href="amps_8h.html#ad5674cb8a55c793aa66de7c7068d923c">amps_client_set_idle_time</a>(_client, ackTimeout_);</div><div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;      _queueAckTimeout = ackTimeout_;</div><div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;    }</div><div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;    <span class="keywordtype">size_t</span> _ack(QueueBookmarks&amp; queueBookmarks_)</div><div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;    {</div><div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;      <span class="keywordflow">if</span> (queueBookmarks_._bookmarkCount)</div><div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;      {</div><div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;        <span class="keywordflow">if</span> (!publishStoreMessage)</div><div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;        {</div><div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;          publishStoreMessage = <span class="keyword">new</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>();</div><div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;          PerThreadMessageTracker::addMessageToCleanupList(publishStoreMessage);</div><div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;        }</div><div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;        publishStoreMessage-&gt;reset();</div><div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;        publishStoreMessage-&gt;setCommandEnum(Message::Command::SOWDelete)</div><div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;        .setTopic(queueBookmarks_._topic)</div><div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;        .setBookmark(queueBookmarks_._data)</div><div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;        .setCommandId(<span class="stringliteral">&quot;AMPS-queue-ack&quot;</span>);</div><div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;        amps_uint64_t haSequenceNumber = 0;</div><div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;        <span class="keywordflow">if</span> (_publishStore.<a class="code" href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac">isValid</a>())</div><div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;        {</div><div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;          haSequenceNumber = _publishStore.<a class="code" href="classAMPS_1_1Store.html#acb06fbca0f83c7c4dfc91662b9149dba">store</a>(*publishStoreMessage);</div><div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;          publishStoreMessage-&gt;setAckType(<span class="stringliteral">&quot;persisted&quot;</span>)</div><div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;          .setSequence(haSequenceNumber);</div><div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;          queueBookmarks_._data.erase();</div><div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;          queueBookmarks_._bookmarkCount = 0;</div><div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;        }</div><div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;        _send(*publishStoreMessage, haSequenceNumber);</div><div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;        <span class="keywordflow">if</span> (!_publishStore.<a class="code" href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac">isValid</a>())</div><div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;        {</div><div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;          queueBookmarks_._data.erase();</div><div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;          queueBookmarks_._bookmarkCount = 0;</div><div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;        }</div><div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;      }</div><div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;    }</div><div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;    <span class="keywordtype">void</span> ack(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Field.html">Field</a>&amp; topic_, <span class="keyword">const</span> <a class="code" href="classAMPS_1_1Field.html">Field</a>&amp; bookmark_, <span class="keyword">const</span> <span class="keywordtype">char</span>* options_ = NULL)</div><div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;    {</div><div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;      <span class="keywordflow">if</span> (_isAutoAckEnabled)</div><div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;      {</div><div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;      }</div><div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;      _ack(topic_, bookmark_, options_);</div><div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;    }</div><div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;    <span class="keywordtype">void</span> _ack(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Field.html">Field</a>&amp; topic_, <span class="keyword">const</span> <a class="code" href="classAMPS_1_1Field.html">Field</a>&amp; bookmark_, <span class="keyword">const</span> <span class="keywordtype">char</span>* options_ = NULL)</div><div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;    {</div><div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;      <span class="keywordflow">if</span> (bookmark_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>() == 0)</div><div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;      {</div><div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;      }</div><div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;      Lock&lt;Mutex&gt; lock(_lock);</div><div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;      <span class="keywordflow">if</span> (_ackBatchSize &lt; 2 || options_ != NULL)</div><div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;      {</div><div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;        <span class="keywordflow">if</span> (!publishStoreMessage)</div><div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;        {</div><div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;          publishStoreMessage = <span class="keyword">new</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>();</div><div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;          PerThreadMessageTracker::addMessageToCleanupList(publishStoreMessage);</div><div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;        }</div><div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;        publishStoreMessage-&gt;reset();</div><div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;        publishStoreMessage-&gt;setCommandEnum(Message::Command::SOWDelete)</div><div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;        .setCommandId(<span class="stringliteral">&quot;AMPS-queue-ack&quot;</span>)</div><div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;        .setTopic(topic_).setBookmark(bookmark_);</div><div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;        <span class="keywordflow">if</span> (options_)</div><div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;        {</div><div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;          publishStoreMessage-&gt;setOptions(options_);</div><div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;        }</div><div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;        amps_uint64_t haSequenceNumber = 0;</div><div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;        <span class="keywordflow">if</span> (_publishStore.<a class="code" href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac">isValid</a>())</div><div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;        {</div><div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;          haSequenceNumber = _publishStore.<a class="code" href="classAMPS_1_1Store.html#acb06fbca0f83c7c4dfc91662b9149dba">store</a>(*publishStoreMessage);</div><div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;          publishStoreMessage-&gt;setAckType(<span class="stringliteral">&quot;persisted&quot;</span>)</div><div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;          .setSequence(haSequenceNumber);</div><div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;        }</div><div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;        _send(*publishStoreMessage, haSequenceNumber);</div><div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;      }</div><div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;      <span class="comment">// have we acked anything for this hash</span></div><div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;      topic_hash hash = CRC&lt;0&gt;::crcNoSSE(topic_.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>(), topic_.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>());</div><div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;      TopicHashMap::iterator it = _topicHashMap.find(hash);</div><div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;      <span class="keywordflow">if</span> (it == _topicHashMap.end())</div><div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;      {</div><div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;        <span class="comment">// add a new one to the map</span></div><div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;<span class="preprocessor">#ifdef AMPS_USE_EMPLACE</span></div><div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;        it = _topicHashMap.emplace(TopicHashMap::value_type(hash, QueueBookmarks(topic_))).first;</div><div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;        it = _topicHashMap.insert(TopicHashMap::value_type(hash, QueueBookmarks(topic_))).first;</div><div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;      }</div><div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;      QueueBookmarks&amp; queueBookmarks = it-&gt;second;</div><div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;      <span class="keywordflow">if</span> (queueBookmarks._data.length())</div><div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;      {</div><div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;        queueBookmarks._data.append(<span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;      }</div><div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;      {</div><div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;        queueBookmarks._oldestTime = amps_now();</div><div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;      }</div><div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;      queueBookmarks._data.append(bookmark_);</div><div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;      <span class="keywordflow">if</span> (++queueBookmarks._bookmarkCount &gt;= _ackBatchSize)</div><div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;      {</div><div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;        _ack(queueBookmarks);</div><div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;      }</div><div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;    }</div><div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;    <span class="keywordtype">void</span> flushAcks(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;    {</div><div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;      <span class="keywordtype">size_t</span> sendCount = 0;</div><div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;      <span class="keywordflow">if</span> (!_connected)</div><div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;      {</div><div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;      }</div><div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;      {</div><div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;        Lock&lt;Mutex&gt; lock(_lock);</div><div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;        <span class="keyword">typedef</span> TopicHashMap::iterator iterator;</div><div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;        <span class="keywordflow">for</span> (iterator it = _topicHashMap.begin(), end = _topicHashMap.end(); it != end; ++it)</div><div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;        {</div><div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;          QueueBookmarks&amp; queueBookmarks = it-&gt;second;</div><div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;          sendCount += _ack(queueBookmarks);</div><div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;        }</div><div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;      }</div><div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;      <span class="keywordflow">if</span> (sendCount &amp;&amp; _connected)</div><div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;      {</div><div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;        publishFlush(0, Message::AckType::Processed);</div><div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;      }</div><div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;    }</div><div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;    <span class="comment">// called when there&#39;s idle time, to see if we need to flush out any &quot;acks&quot;</span></div><div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;    <span class="keywordtype">void</span> checkQueueAcks(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;    {</div><div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;      <span class="keywordflow">if</span> (!_topicHashMap.size())</div><div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;      {</div><div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;      }</div><div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;      Lock&lt;Mutex&gt; lock(_lock);</div><div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;      <span class="keywordflow">try</span></div><div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;      {</div><div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;        amps_uint64_t threshold = amps_now()</div><div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;                                  - (amps_uint64_t)_queueAckTimeout;</div><div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;        <span class="keyword">typedef</span> TopicHashMap::iterator iterator;</div><div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;        <span class="keywordflow">for</span> (iterator it = _topicHashMap.begin(), end = _topicHashMap.end(); it != end; ++it)</div><div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;        {</div><div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;          QueueBookmarks&amp; queueBookmarks = it-&gt;second;</div><div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;          <span class="keywordflow">if</span> (queueBookmarks._bookmarkCount &amp;&amp; queueBookmarks._oldestTime &lt; threshold)</div><div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;          {</div><div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;            _ack(queueBookmarks);</div><div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;          }</div><div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;        }</div><div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;      }</div><div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;      <span class="keywordflow">catch</span> (std::exception&amp; ex)</div><div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;      {</div><div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;        AMPS_UNHANDLED_EXCEPTION(ex);</div><div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;      }</div><div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;    }</div><div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;</div><div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;    <span class="keywordtype">void</span> deferredExecution(DeferredExecutionFunc func_, <span class="keywordtype">void</span>* userData_)</div><div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;    {</div><div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;      Lock&lt;Mutex&gt; lock(_deferredExecutionLock);</div><div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;<span class="preprocessor">#ifdef AMPS_USE_EMPLACE</span></div><div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;      _deferredExecutionList.emplace_back(</div><div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;        DeferredExecutionRequest(func_, userData_));</div><div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;      _deferredExecutionList.push_back(</div><div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;        DeferredExecutionRequest(func_, userData_));</div><div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;    }</div><div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;</div><div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;    <span class="keyword">inline</span> <span class="keywordtype">void</span> processDeferredExecutions(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;    {</div><div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;      <span class="keywordflow">if</span> (_deferredExecutionList.size())</div><div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;      {</div><div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;        Lock&lt;Mutex&gt; lock(_deferredExecutionLock);</div><div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;        DeferredExecutionList::iterator it = _deferredExecutionList.begin();</div><div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;        DeferredExecutionList::iterator end = _deferredExecutionList.end();</div><div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;        <span class="keywordflow">for</span> (; it != end; ++it)</div><div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;        {</div><div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;          <span class="keywordflow">try</span></div><div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;          {</div><div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;            it-&gt;_func(it-&gt;_userData);</div><div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;          }</div><div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;          <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;          {</div><div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;            <span class="comment">// -V565</span></div><div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;            <span class="comment">// Intentionally ignore errors</span></div><div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;          }</div><div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;        }</div><div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;        _deferredExecutionList.clear();</div><div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;        _routes.invalidateCache();</div><div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;        _routeCache.invalidateCache();</div><div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;      }</div><div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;    }</div><div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;</div><div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;    <span class="keywordtype">bool</span> getRetryOnDisconnect(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;      <span class="keywordflow">return</span> _isRetryOnDisconnect;</div><div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;    }</div><div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;</div><div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;    <span class="keywordtype">void</span> setRetryOnDisconnect(<span class="keywordtype">bool</span> isRetryOnDisconnect_)</div><div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;    {</div><div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;      _isRetryOnDisconnect = isRetryOnDisconnect_;</div><div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;    }</div><div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;</div><div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;    <span class="keywordtype">void</span> setDefaultMaxDepth(<span class="keywordtype">unsigned</span> maxDepth_)</div><div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;    {</div><div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;      _defaultMaxDepth = maxDepth_;</div><div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;    }</div><div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;</div><div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;    <span class="keywordtype">unsigned</span> getDefaultMaxDepth(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;      <span class="keywordflow">return</span> _defaultMaxDepth;</div><div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;    }</div><div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;</div><div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;    <span class="keywordtype">void</span> setTransportFilterFunction(<a class="code" href="amps_8h.html#ad41bd414e658417575019135a09acf55">amps_transport_filter_function</a> filter_,</div><div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;                                    <span class="keywordtype">void</span>* userData_)</div><div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;    {</div><div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;      <a class="code" href="amps_8h.html#a913663899199a9168a51df67a2ff8684">amps_client_set_transport_filter_function</a>(_client, filter_, userData_);</div><div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;    }</div><div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;</div><div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;    <span class="keywordtype">void</span> setThreadCreatedCallback(<a class="code" href="amps_8h.html#a84547b45700e098324ea8d78641a6036">amps_thread_created_callback</a> callback_,</div><div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;                                  <span class="keywordtype">void</span>* userData_)</div><div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;    {</div><div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;      <a class="code" href="amps_8h.html#aa0f4f979392dd0aaa1c94cdd159e590f">amps_client_set_thread_created_callback</a>(_client, callback_, userData_);</div><div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;    }</div><div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;  }; <span class="comment">// class ClientImpl</span></div><div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04943"></a><span class="lineno"><a class="line" href="classAMPS_1_1MessageStream.html"> 4943</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a></div><div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;  {</div><div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;    RefHandle&lt;MessageStreamImpl&gt; _body;</div><div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l04951"></a><span class="lineno"><a class="line" href="classAMPS_1_1MessageStream_1_1iterator.html"> 4951</a></span>&#160;    <span class="keyword">class </span><a class="code" href="classAMPS_1_1MessageStream_1_1iterator.html">iterator</a></div><div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;    {</div><div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a>* _pStream;</div><div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;      <a class="code" href="classAMPS_1_1Message.html">Message</a> _current;</div><div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;      <span class="keyword">inline</span> <span class="keywordtype">void</span> advance(<span class="keywordtype">void</span>);</div><div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;</div><div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream_1_1iterator.html">iterator</a>() <span class="comment">// end</span></div><div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;        : _pStream(NULL)</div><div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;      {;}</div><div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream_1_1iterator.html">iterator</a>(<a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a>* pStream_)</div><div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;        : _pStream(pStream_)</div><div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;      {</div><div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;        advance();</div><div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;      }</div><div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;</div><div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;      <span class="keywordtype">bool</span> operator==(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1MessageStream_1_1iterator.html">iterator</a>&amp; rhs)<span class="keyword"> const</span></div><div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;<span class="keyword">      </span>{</div><div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;        <span class="keywordflow">return</span> _pStream == rhs._pStream;</div><div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;      }</div><div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;      <span class="keywordtype">bool</span> operator!=(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1MessageStream_1_1iterator.html">iterator</a>&amp; rhs)<span class="keyword"> const</span></div><div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;<span class="keyword">      </span>{</div><div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;        <span class="keywordflow">return</span> _pStream != rhs._pStream;</div><div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;      }</div><div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;      <span class="keywordtype">void</span> operator++(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;      {</div><div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;        advance();</div><div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;      }</div><div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;      <a class="code" href="classAMPS_1_1Message.html">Message</a> operator*(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;      {</div><div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;        <span class="keywordflow">return</span> _current;</div><div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;      }</div><div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;      <a class="code" href="classAMPS_1_1Message.html">Message</a>* operator-&gt;(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;      {</div><div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;        <span class="keywordflow">return</span> &amp;_current;</div><div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;      }</div><div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;    };</div><div class="line"><a name="l04989"></a><span class="lineno"><a class="line" href="classAMPS_1_1MessageStream.html#ac63bb0d3c7072548c04ac41d35131416"> 4989</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classAMPS_1_1MessageStream.html#ac63bb0d3c7072548c04ac41d35131416">isValid</a>()<span class="keyword"> const</span></div><div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;      <span class="keywordflow">return</span> _body.isValid();</div><div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;    }</div><div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;</div><div class="line"><a name="l04996"></a><span class="lineno"><a class="line" href="classAMPS_1_1MessageStream.html#a1ba2852c71ae794b66020f0b331d7288"> 4996</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream_1_1iterator.html">iterator</a> <a class="code" href="classAMPS_1_1MessageStream.html#a1ba2852c71ae794b66020f0b331d7288">begin</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;    {</div><div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;      <span class="keywordflow">if</span> (!_body.isValid())</div><div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;      {</div><div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;        <span class="keywordflow">throw</span> UsageException(<span class="stringliteral">&quot;This MessageStream is not valid and cannot be iterated.&quot;</span>);</div><div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;      }</div><div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classAMPS_1_1MessageStream_1_1iterator.html">iterator</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;    }</div><div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;    <span class="comment">//           For non-SOW queries, the end is never reached.</span></div><div class="line"><a name="l05007"></a><span class="lineno"><a class="line" href="classAMPS_1_1MessageStream.html#af18bb3867d6f394cb215ef7dadaf4818"> 5007</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream_1_1iterator.html">iterator</a> <a class="code" href="classAMPS_1_1MessageStream.html#af18bb3867d6f394cb215ef7dadaf4818">end</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;    {</div><div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classAMPS_1_1MessageStream_1_1iterator.html">iterator</a>();</div><div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;    }</div><div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;    <span class="keyword">inline</span> <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;</div><div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> timeout(<span class="keywordtype">unsigned</span> timeout_);</div><div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;</div><div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> conflate(<span class="keywordtype">void</span>);</div><div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> maxDepth(<span class="keywordtype">unsigned</span> maxDepth_);</div><div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;    <span class="keywordtype">unsigned</span> getMaxDepth(<span class="keywordtype">void</span>) <span class="keyword">const</span>;</div><div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;    <span class="keywordtype">unsigned</span> getDepth(<span class="keywordtype">void</span>) <span class="keyword">const</span>;</div><div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;</div><div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;  <span class="keyword">private</span>:</div><div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;    <span class="keyword">inline</span> <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a>(<span class="keyword">const</span> Client&amp; client_);</div><div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;    <span class="keyword">inline</span> <span class="keywordtype">void</span> setSOWOnly(<span class="keyword">const</span> std::string&amp; commandId_,</div><div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;                           <span class="keyword">const</span> std::string&amp; queryId_ = <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;    <span class="keyword">inline</span> <span class="keywordtype">void</span> setSubscription(<span class="keyword">const</span> std::string&amp; subId_,</div><div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;                                <span class="keyword">const</span> std::string&amp; commandId_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;                                <span class="keyword">const</span> std::string&amp; queryId_ = <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;    <span class="keyword">inline</span> <span class="keywordtype">void</span> setStatsOnly(<span class="keyword">const</span> std::string&amp; commandId_,</div><div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;                             <span class="keyword">const</span> std::string&amp; queryId_ = <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;    <span class="keyword">inline</span> <span class="keywordtype">void</span> setAcksOnly(<span class="keyword">const</span> std::string&amp; commandId_, <span class="keywordtype">unsigned</span> acks_);</div><div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;</div><div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;    <span class="keyword">inline</span> <span class="keyword">operator</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;</div><div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;    <span class="keyword">inline</span> <span class="keyword">static</span> <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> fromExistingHandler(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; handler);</div><div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;</div><div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;    <span class="keyword">friend</span> <span class="keyword">class </span>Client;</div><div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;</div><div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;  };</div><div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;</div><div class="line"><a name="l05075"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html"> 5075</a></span>&#160;  <span class="keyword">class </span>Client <span class="comment">// -V553</span></div><div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;  {</div><div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;  <span class="keyword">protected</span>:</div><div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;    BorrowRefHandle&lt;ClientImpl&gt; _body;</div><div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> DEFAULT_COMMAND_TIMEOUT = AMPS_DEFAULT_COMMAND_TIMEOUT;</div><div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> DEFAULT_BATCH_SIZE      = AMPS_DEFAULT_BATCH_SIZE;</div><div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> DEFAULT_TOP_N           = AMPS_DEFAULT_TOP_N;</div><div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;</div><div class="line"><a name="l05092"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a4b5866738505dee70761e241df42dd2e"> 5092</a></span>&#160;    <a class="code" href="classAMPS_1_1Client.html#a4b5866738505dee70761e241df42dd2e">Client</a>(<span class="keyword">const</span> std::string&amp; clientName = <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;      : _body(new ClientImpl(clientName), true)</div><div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;    {;}</div><div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;</div><div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;    Client(ClientImpl* existingClient)</div><div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;      : _body(existingClient, <span class="keyword">true</span>)</div><div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;    {;}</div><div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;</div><div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;    Client(ClientImpl* existingClient, <span class="keywordtype">bool</span> isRef)</div><div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;      : _body(existingClient, isRef)</div><div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;    {;}</div><div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;</div><div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;    Client(<span class="keyword">const</span> Client&amp; rhs) : _body(rhs._body) {;}</div><div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;    <span class="keyword">virtual</span> ~Client(<span class="keywordtype">void</span>) {;}</div><div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;</div><div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;    Client&amp; operator=(<span class="keyword">const</span> Client&amp; rhs)</div><div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;    {</div><div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;      _body = rhs._body;</div><div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;    }</div><div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;</div><div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;    <span class="keywordtype">bool</span> isValid()</div><div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;    {</div><div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;      <span class="keywordflow">return</span> _body.isValid();</div><div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;    }</div><div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;</div><div class="line"><a name="l05130"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a35592f4b12faeabff94450d74902a6c5"> 5130</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a35592f4b12faeabff94450d74902a6c5">setName</a>(<span class="keyword">const</span> std::string&amp; name)</div><div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;    {</div><div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;      _body.get().setName(name);</div><div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;    }</div><div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;</div><div class="line"><a name="l05137"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#af16fd9fccdbf0ae84c2b11544a989f58"> 5137</a></span>&#160;    <span class="keyword">const</span> std::string&amp; <a class="code" href="classAMPS_1_1Client.html#af16fd9fccdbf0ae84c2b11544a989f58">getName</a>()<span class="keyword"> const</span></div><div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;      <span class="keywordflow">return</span> _body.get().getName();</div><div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;    }</div><div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;</div><div class="line"><a name="l05145"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a91a6874ed0558ff4f835f61bcf48c6e2"> 5145</a></span>&#160;    <span class="keyword">const</span> std::string&amp; <a class="code" href="classAMPS_1_1Client.html#a91a6874ed0558ff4f835f61bcf48c6e2">getNameHash</a>()<span class="keyword"> const</span></div><div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;      <span class="keywordflow">return</span> _body.get().getNameHash();</div><div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;    }</div><div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;</div><div class="line"><a name="l05153"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a337510e3d98de7216fcbc06f2ba17d74"> 5153</a></span>&#160;    <span class="keyword">const</span> amps_uint64_t <a class="code" href="classAMPS_1_1Client.html#a337510e3d98de7216fcbc06f2ba17d74">getNameHashValue</a>()<span class="keyword"> const</span></div><div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;      <span class="keywordflow">return</span> _body.get().getNameHashValue();</div><div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;    }</div><div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;</div><div class="line"><a name="l05164"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#ad974dd3577be4471a48164e0ee43ae55"> 5164</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#ad974dd3577be4471a48164e0ee43ae55">setLogonCorrelationData</a>(<span class="keyword">const</span> std::string&amp; logonCorrelationData_)</div><div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;    {</div><div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;      _body.get().setLogonCorrelationData(logonCorrelationData_);</div><div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;    }</div><div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;</div><div class="line"><a name="l05171"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a25e68b3da452c79b701993ea2bfa17c2"> 5171</a></span>&#160;    <span class="keyword">const</span> std::string&amp; <a class="code" href="classAMPS_1_1Client.html#a25e68b3da452c79b701993ea2bfa17c2">getLogonCorrelationData</a>()<span class="keyword"> const</span></div><div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;      <span class="keywordflow">return</span> _body.get().getLogonCorrelationData();</div><div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;    }</div><div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;</div><div class="line"><a name="l05184"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#aaeb2b405c78ce2a16f2f5a2f685fc1a0"> 5184</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="classAMPS_1_1Client.html#aaeb2b405c78ce2a16f2f5a2f685fc1a0">getServerVersion</a>()<span class="keyword"> const</span></div><div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;      <span class="keywordflow">return</span> _body.get().getServerVersion();</div><div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;    }</div><div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;</div><div class="line"><a name="l05195"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#ac0545f209017fb7ea215aa9b13668e66"> 5195</a></span>&#160;    VersionInfo <a class="code" href="classAMPS_1_1Client.html#ac0545f209017fb7ea215aa9b13668e66">getServerVersionInfo</a>()<span class="keyword"> const</span></div><div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;      <span class="keywordflow">return</span> _body.get().getServerVersionInfo();</div><div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;    }</div><div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;</div><div class="line"><a name="l05209"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#af44e3550521234435f7967adc845578f"> 5209</a></span>&#160;    <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="classAMPS_1_1Client.html#af44e3550521234435f7967adc845578f">convertVersionToNumber</a>(<span class="keyword">const</span> std::string&amp; version_)</div><div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;    {</div><div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;      <span class="keywordflow">return</span> AMPS::convertVersionToNumber(version_.c_str(), version_.length());</div><div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;    }</div><div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;</div><div class="line"><a name="l05224"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a4b3c857af6818082d742295f5d38edd2"> 5224</a></span>&#160;    <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="classAMPS_1_1Client.html#a4b3c857af6818082d742295f5d38edd2">convertVersionToNumber</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> len_)</div><div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;    {</div><div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;      <span class="keywordflow">return</span> AMPS::convertVersionToNumber(data_, len_);</div><div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;    }</div><div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;</div><div class="line"><a name="l05231"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a5f251b42fa95e5e99d514be8646ed407"> 5231</a></span>&#160;    <span class="keyword">const</span> std::string&amp; <a class="code" href="classAMPS_1_1Client.html#a5f251b42fa95e5e99d514be8646ed407">getURI</a>()<span class="keyword"> const</span></div><div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;      <span class="keywordflow">return</span> _body.get().getURI();</div><div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;    }</div><div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;</div><div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;</div><div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;</div><div class="line"><a name="l05255"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#ab17450ad7154a0867ae89aa4fdc4e3e4"> 5255</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#ab17450ad7154a0867ae89aa4fdc4e3e4">connect</a>(<span class="keyword">const</span> std::string&amp; uri)</div><div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;    {</div><div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;      _body.get().connect(uri);</div><div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;    }</div><div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;</div><div class="line"><a name="l05262"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a40bbfce7ed53e6438ce55e4f5cda5023"> 5262</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a40bbfce7ed53e6438ce55e4f5cda5023">disconnect</a>()</div><div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;    {</div><div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;      _body.get().disconnect();</div><div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;    }</div><div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;</div><div class="line"><a name="l05280"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a9575d96a91df4f3254085a79d24cc9d8"> 5280</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a9575d96a91df4f3254085a79d24cc9d8">send</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message)</div><div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;    {</div><div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;      _body.get().send(message);</div><div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;    }</div><div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;</div><div class="line"><a name="l05293"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#aa5855363a3780aac2df900f815dc6eba"> 5293</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#aa5855363a3780aac2df900f815dc6eba">addMessageHandler</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Field.html">Field</a>&amp; commandId_,</div><div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;                           <span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">AMPS::MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;                           <span class="keywordtype">unsigned</span> requestedAcks_, <span class="keywordtype">bool</span> isSubscribe_)</div><div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;    {</div><div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;      _body.get().addMessageHandler(commandId_, messageHandler_,</div><div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;                                    requestedAcks_, isSubscribe_);</div><div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;    }</div><div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;</div><div class="line"><a name="l05304"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#abf8c120c68bb374f839b7510d12647e7"> 5304</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classAMPS_1_1Client.html#abf8c120c68bb374f839b7510d12647e7">removeMessageHandler</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Field.html">Field</a>&amp; commandId_)</div><div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160;    {</div><div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;      <span class="keywordflow">return</span> _body.get().removeMessageHandler(commandId_);</div><div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;    }</div><div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;</div><div class="line"><a name="l05332"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a26c7ef49af94b85f5dd432bc26e5181c"> 5332</a></span>&#160;    std::string <a class="code" href="classAMPS_1_1Client.html#a26c7ef49af94b85f5dd432bc26e5181c">send</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler, <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message, <span class="keywordtype">int</span> timeout = 0)</div><div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;    {</div><div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;      <span class="keywordflow">return</span> _body.get().send(messageHandler, message, timeout);</div><div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160;    }</div><div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;</div><div class="line"><a name="l05346"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a5de7a2604ac4f18c93ca812ce6ebf605"> 5346</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a5de7a2604ac4f18c93ca812ce6ebf605">setDisconnectHandler</a>(<span class="keyword">const</span> DisconnectHandler&amp; disconnectHandler)</div><div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;    {</div><div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;      _body.get().setDisconnectHandler(disconnectHandler);</div><div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;    }</div><div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160;</div><div class="line"><a name="l05354"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a6779e81b85aaab32f00790d3d2ef779b"> 5354</a></span>&#160;    DisconnectHandler <a class="code" href="classAMPS_1_1Client.html#a6779e81b85aaab32f00790d3d2ef779b">getDisconnectHandler</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;      <span class="keywordflow">return</span> _body.get().getDisconnectHandler();</div><div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160;    }</div><div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;</div><div class="line"><a name="l05363"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a22e83df2788e08a38927bef0759a46d8"> 5363</a></span>&#160;    <span class="keyword">virtual</span> ConnectionInfo <a class="code" href="classAMPS_1_1Client.html#a22e83df2788e08a38927bef0759a46d8">getConnectionInfo</a>()<span class="keyword"> const</span></div><div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;      <span class="keywordflow">return</span> _body.get().getConnectionInfo();</div><div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;    }</div><div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;</div><div class="line"><a name="l05376"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a0fcb952dea3610728b490179c553e52f"> 5376</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a0fcb952dea3610728b490179c553e52f">setBookmarkStore</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1BookmarkStore.html">BookmarkStore</a>&amp; bookmarkStore_)</div><div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;    {</div><div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;      _body.get().setBookmarkStore(bookmarkStore_);</div><div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160;    }</div><div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;</div><div class="line"><a name="l05384"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a676e669b401a20ea2264b1e85e61ea15"> 5384</a></span>&#160;    <a class="code" href="classAMPS_1_1BookmarkStore.html">BookmarkStore</a> <a class="code" href="classAMPS_1_1Client.html#a676e669b401a20ea2264b1e85e61ea15">getBookmarkStore</a>()</div><div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;    {</div><div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;      <span class="keywordflow">return</span> _body.<a class="code" href="classAMPS_1_1BookmarkStore.html#ab3463f69d9afcf2b9fc2fcd2a9a92dbc">get</a>().getBookmarkStore();</div><div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;    }</div><div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160;</div><div class="line"><a name="l05392"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a1c6cabbad324c935e8f97eff3476a92d"> 5392</a></span>&#160;    <a class="code" href="classAMPS_1_1SubscriptionManager.html">SubscriptionManager</a>* <a class="code" href="classAMPS_1_1Client.html#a1c6cabbad324c935e8f97eff3476a92d">getSubscriptionManager</a>()</div><div class="line"><a name="l05393"></a><span class="lineno"> 5393</span>&#160;    {</div><div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;      <span class="keywordflow">return</span> _body.get().getSubscriptionManager();</div><div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;    }</div><div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160;</div><div class="line"><a name="l05404"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a85fc196c705dafab3e9802709b6cb029"> 5404</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a85fc196c705dafab3e9802709b6cb029">setSubscriptionManager</a>(<a class="code" href="classAMPS_1_1SubscriptionManager.html">SubscriptionManager</a>* subscriptionManager_)</div><div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;    {</div><div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;      _body.get().setSubscriptionManager(subscriptionManager_);</div><div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;    }</div><div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;</div><div class="line"><a name="l05428"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#aceec2c8638a2728d13604ad2b37cae7b"> 5428</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#aceec2c8638a2728d13604ad2b37cae7b">setPublishStore</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Store.html">Store</a>&amp; publishStore_)</div><div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;    {</div><div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;      _body.get().setPublishStore(publishStore_);</div><div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;    }</div><div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;</div><div class="line"><a name="l05436"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#af876c155695c6296a597d3ffd958b8b7"> 5436</a></span>&#160;    <a class="code" href="classAMPS_1_1Store.html">Store</a> <a class="code" href="classAMPS_1_1Client.html#af876c155695c6296a597d3ffd958b8b7">getPublishStore</a>()</div><div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;    {</div><div class="line"><a name="l05438"></a><span class="lineno"> 5438</span>&#160;      <span class="keywordflow">return</span> _body.<a class="code" href="classAMPS_1_1Store.html#a0ec6dc4d797cb1e7f5ed68183c38d9c4">get</a>().getPublishStore();</div><div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;    }</div><div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;</div><div class="line"><a name="l05444"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#aeb616a25779f0bacd12e021ac3b20b9b"> 5444</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#aeb616a25779f0bacd12e021ac3b20b9b">setDuplicateMessageHandler</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; duplicateMessageHandler_)</div><div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;    {</div><div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160;      _body.get().setGlobalCommandTypeMessageHandler(ClientImpl::GlobalCommandTypeHandlers::DuplicateMessage,</div><div class="line"><a name="l05447"></a><span class="lineno"> 5447</span>&#160;                                                     duplicateMessageHandler_);</div><div class="line"><a name="l05448"></a><span class="lineno"> 5448</span>&#160;    }</div><div class="line"><a name="l05449"></a><span class="lineno"> 5449</span>&#160;</div><div class="line"><a name="l05459"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#ae104192d161560f702480ce138855804"> 5459</a></span>&#160;    <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a> <a class="code" href="classAMPS_1_1Client.html#ae104192d161560f702480ce138855804">getDuplicateMessageHandler</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l05460"></a><span class="lineno"> 5460</span>&#160;    {</div><div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;      <span class="keywordflow">return</span> _body.get().getDuplicateMessageHandler();</div><div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160;    }</div><div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;</div><div class="line"><a name="l05473"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a324b2eb19cdf02d77cede593541e9002"> 5473</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a324b2eb19cdf02d77cede593541e9002">setFailedWriteHandler</a>(<a class="code" href="classAMPS_1_1FailedWriteHandler.html">FailedWriteHandler</a>* handler_)</div><div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160;    {</div><div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;      _body.get().setFailedWriteHandler(handler_);</div><div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;    }</div><div class="line"><a name="l05477"></a><span class="lineno"> 5477</span>&#160;</div><div class="line"><a name="l05481"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a38829ab40b25b3514098007cf47c622f"> 5481</a></span>&#160;    <a class="code" href="classAMPS_1_1FailedWriteHandler.html">FailedWriteHandler</a>* <a class="code" href="classAMPS_1_1Client.html#a38829ab40b25b3514098007cf47c622f">getFailedWriteHandler</a>()</div><div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160;    {</div><div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160;      <span class="keywordflow">return</span> _body.get().getFailedWriteHandler();</div><div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;    }</div><div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;</div><div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;</div><div class="line"><a name="l05504"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a3a81db5a4818f1d3ddf119b13f93133d"> 5504</a></span>&#160;    amps_uint64_t <a class="code" href="classAMPS_1_1Client.html#a3a81db5a4818f1d3ddf119b13f93133d">publish</a>(<span class="keyword">const</span> std::string&amp; topic_, <span class="keyword">const</span> std::string&amp; data_)</div><div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;    {</div><div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;      <span class="keywordflow">return</span> _body.get().publish(topic_.c_str(), topic_.length(),</div><div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;                                 data_.c_str(), data_.length());</div><div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160;    }</div><div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160;</div><div class="line"><a name="l05529"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a06589dcfa1e74108cce1c0350a8ac5a4"> 5529</a></span>&#160;    amps_uint64_t <a class="code" href="classAMPS_1_1Client.html#a06589dcfa1e74108cce1c0350a8ac5a4">publish</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_, <span class="keywordtype">size_t</span> topicLength_,</div><div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;                          <span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> dataLength_)</div><div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160;    {</div><div class="line"><a name="l05532"></a><span class="lineno"> 5532</span>&#160;      <span class="keywordflow">return</span> _body.get().publish(topic_, topicLength_, data_, dataLength_);</div><div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;    }</div><div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160;</div><div class="line"><a name="l05553"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a1314726e3e71a30c068f911d7e20d221"> 5553</a></span>&#160;    amps_uint64_t <a class="code" href="classAMPS_1_1Client.html#a1314726e3e71a30c068f911d7e20d221">publish</a>(<span class="keyword">const</span> std::string&amp; topic_, <span class="keyword">const</span> std::string&amp; data_,</div><div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;                          <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> expiration_)</div><div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;    {</div><div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;      <span class="keywordflow">return</span> _body.get().publish(topic_.c_str(), topic_.length(),</div><div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;                                 data_.c_str(), data_.length(), expiration_);</div><div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;    }</div><div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160;</div><div class="line"><a name="l05580"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#af83e27efa1a60c996b6d50788ba3efad"> 5580</a></span>&#160;    amps_uint64_t <a class="code" href="classAMPS_1_1Client.html#af83e27efa1a60c996b6d50788ba3efad">publish</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_, <span class="keywordtype">size_t</span> topicLength_,</div><div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;                          <span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> dataLength_,</div><div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;                          <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> expiration_)</div><div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;    {</div><div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;      <span class="keywordflow">return</span> _body.get().publish(topic_, topicLength_,</div><div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;                                 data_, dataLength_, expiration_);</div><div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;    }</div><div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160;</div><div class="line"><a name="l05626"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a97138feb835e25fbf88eec2e74dcee83"> 5626</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a97138feb835e25fbf88eec2e74dcee83">publishFlush</a>(<span class="keywordtype">long</span> timeout_ = 0, <span class="keywordtype">unsigned</span> ackType_ = Message::AckType::Processed)</div><div class="line"><a name="l05627"></a><span class="lineno"> 5627</span>&#160;    {</div><div class="line"><a name="l05628"></a><span class="lineno"> 5628</span>&#160;      _body.get().publishFlush(timeout_, ackType_);</div><div class="line"><a name="l05629"></a><span class="lineno"> 5629</span>&#160;    }</div><div class="line"><a name="l05630"></a><span class="lineno"> 5630</span>&#160;</div><div class="line"><a name="l05631"></a><span class="lineno"> 5631</span>&#160;</div><div class="line"><a name="l05647"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a37c037481e360ab212e965f2d0f51e23"> 5647</a></span>&#160;    amps_uint64_t <a class="code" href="classAMPS_1_1Client.html#a37c037481e360ab212e965f2d0f51e23">deltaPublish</a>(<span class="keyword">const</span> std::string&amp; topic_, <span class="keyword">const</span> std::string&amp; data_)</div><div class="line"><a name="l05648"></a><span class="lineno"> 5648</span>&#160;    {</div><div class="line"><a name="l05649"></a><span class="lineno"> 5649</span>&#160;      <span class="keywordflow">return</span> _body.get().deltaPublish(topic_.c_str(), topic_.length(),</div><div class="line"><a name="l05650"></a><span class="lineno"> 5650</span>&#160;                                      data_.c_str(), data_.length());</div><div class="line"><a name="l05651"></a><span class="lineno"> 5651</span>&#160;    }</div><div class="line"><a name="l05652"></a><span class="lineno"> 5652</span>&#160;</div><div class="line"><a name="l05670"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a4af4789d563e731b9a952bb6a1866e5e"> 5670</a></span>&#160;    amps_uint64_t <a class="code" href="classAMPS_1_1Client.html#a4af4789d563e731b9a952bb6a1866e5e">deltaPublish</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_, <span class="keywordtype">size_t</span> topicLength_,</div><div class="line"><a name="l05671"></a><span class="lineno"> 5671</span>&#160;                               <span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> dataLength_)</div><div class="line"><a name="l05672"></a><span class="lineno"> 5672</span>&#160;    {</div><div class="line"><a name="l05673"></a><span class="lineno"> 5673</span>&#160;      <span class="keywordflow">return</span> _body.get().deltaPublish(topic_, topicLength_,</div><div class="line"><a name="l05674"></a><span class="lineno"> 5674</span>&#160;                                      data_, dataLength_);</div><div class="line"><a name="l05675"></a><span class="lineno"> 5675</span>&#160;    }</div><div class="line"><a name="l05676"></a><span class="lineno"> 5676</span>&#160;</div><div class="line"><a name="l05693"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#aa709a48088f1e1d859d5cb07a54b5848"> 5693</a></span>&#160;    amps_uint64_t <a class="code" href="classAMPS_1_1Client.html#aa709a48088f1e1d859d5cb07a54b5848">deltaPublish</a>(<span class="keyword">const</span> std::string&amp; topic_, <span class="keyword">const</span> std::string&amp; data_,</div><div class="line"><a name="l05694"></a><span class="lineno"> 5694</span>&#160;                               <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> expiration_)</div><div class="line"><a name="l05695"></a><span class="lineno"> 5695</span>&#160;    {</div><div class="line"><a name="l05696"></a><span class="lineno"> 5696</span>&#160;      <span class="keywordflow">return</span> _body.get().deltaPublish(topic_.c_str(), topic_.length(),</div><div class="line"><a name="l05697"></a><span class="lineno"> 5697</span>&#160;                                      data_.c_str(), data_.length(),</div><div class="line"><a name="l05698"></a><span class="lineno"> 5698</span>&#160;                                      expiration_);</div><div class="line"><a name="l05699"></a><span class="lineno"> 5699</span>&#160;    }</div><div class="line"><a name="l05700"></a><span class="lineno"> 5700</span>&#160;</div><div class="line"><a name="l05719"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a9a387e08e23ec67d9d4faa670fc07def"> 5719</a></span>&#160;    amps_uint64_t <a class="code" href="classAMPS_1_1Client.html#a9a387e08e23ec67d9d4faa670fc07def">deltaPublish</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_, <span class="keywordtype">size_t</span> topicLength_,</div><div class="line"><a name="l05720"></a><span class="lineno"> 5720</span>&#160;                               <span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> dataLength_,</div><div class="line"><a name="l05721"></a><span class="lineno"> 5721</span>&#160;                               <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> expiration_)</div><div class="line"><a name="l05722"></a><span class="lineno"> 5722</span>&#160;    {</div><div class="line"><a name="l05723"></a><span class="lineno"> 5723</span>&#160;      <span class="keywordflow">return</span> _body.get().deltaPublish(topic_, topicLength_,</div><div class="line"><a name="l05724"></a><span class="lineno"> 5724</span>&#160;                                      data_, dataLength_, expiration_);</div><div class="line"><a name="l05725"></a><span class="lineno"> 5725</span>&#160;    }</div><div class="line"><a name="l05726"></a><span class="lineno"> 5726</span>&#160;</div><div class="line"><a name="l05742"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a71a4e9911b4ecf17cfdc8c92febc80ef"> 5742</a></span>&#160;    std::string <a class="code" href="classAMPS_1_1Client.html#a71a4e9911b4ecf17cfdc8c92febc80ef">logon</a>(<span class="keywordtype">int</span> timeout_ = 0,</div><div class="line"><a name="l05743"></a><span class="lineno"> 5743</span>&#160;                      <a class="code" href="classAMPS_1_1Authenticator.html">Authenticator</a>&amp; authenticator_ = <a class="code" href="classAMPS_1_1DefaultAuthenticator.html#a5e01247122ade887a4f4f17c649b50c0">DefaultAuthenticator::instance</a>(),</div><div class="line"><a name="l05744"></a><span class="lineno"> 5744</span>&#160;                      <span class="keyword">const</span> <span class="keywordtype">char</span>* options_ = NULL)</div><div class="line"><a name="l05745"></a><span class="lineno"> 5745</span>&#160;    {</div><div class="line"><a name="l05746"></a><span class="lineno"> 5746</span>&#160;      <span class="keywordflow">return</span> _body.get().logon(timeout_, authenticator_, options_);</div><div class="line"><a name="l05747"></a><span class="lineno"> 5747</span>&#160;    }</div><div class="line"><a name="l05761"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a0947189cab30b1480ff06dfdb628ff96"> 5761</a></span>&#160;    std::string <a class="code" href="classAMPS_1_1Client.html#a0947189cab30b1480ff06dfdb628ff96">logon</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* options_, <span class="keywordtype">int</span> timeout_ = 0)</div><div class="line"><a name="l05762"></a><span class="lineno"> 5762</span>&#160;    {</div><div class="line"><a name="l05763"></a><span class="lineno"> 5763</span>&#160;      <span class="keywordflow">return</span> _body.get().logon(timeout_, <a class="code" href="classAMPS_1_1DefaultAuthenticator.html#a5e01247122ade887a4f4f17c649b50c0">DefaultAuthenticator::instance</a>(),</div><div class="line"><a name="l05764"></a><span class="lineno"> 5764</span>&#160;                               options_);</div><div class="line"><a name="l05765"></a><span class="lineno"> 5765</span>&#160;    }</div><div class="line"><a name="l05766"></a><span class="lineno"> 5766</span>&#160;</div><div class="line"><a name="l05780"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#afe7d2ecb7268fee9bcbe9ab4a63e40f8"> 5780</a></span>&#160;    std::string <a class="code" href="classAMPS_1_1Client.html#afe7d2ecb7268fee9bcbe9ab4a63e40f8">logon</a>(<span class="keyword">const</span> std::string&amp; options_, <span class="keywordtype">int</span> timeout_ = 0)</div><div class="line"><a name="l05781"></a><span class="lineno"> 5781</span>&#160;    {</div><div class="line"><a name="l05782"></a><span class="lineno"> 5782</span>&#160;      <span class="keywordflow">return</span> _body.get().logon(timeout_, <a class="code" href="classAMPS_1_1DefaultAuthenticator.html#a5e01247122ade887a4f4f17c649b50c0">DefaultAuthenticator::instance</a>(),</div><div class="line"><a name="l05783"></a><span class="lineno"> 5783</span>&#160;                               options_.c_str());</div><div class="line"><a name="l05784"></a><span class="lineno"> 5784</span>&#160;    }</div><div class="line"><a name="l05785"></a><span class="lineno"> 5785</span>&#160;</div><div class="line"><a name="l05805"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#add7a42da41f6739a482036693be12a2b"> 5805</a></span>&#160;    std::string <a class="code" href="classAMPS_1_1Client.html#add7a42da41f6739a482036693be12a2b">subscribe</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l05806"></a><span class="lineno"> 5806</span>&#160;                          <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l05807"></a><span class="lineno"> 5807</span>&#160;                          <span class="keywordtype">long</span> timeout_ = 0,</div><div class="line"><a name="l05808"></a><span class="lineno"> 5808</span>&#160;                          <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05809"></a><span class="lineno"> 5809</span>&#160;                          <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05810"></a><span class="lineno"> 5810</span>&#160;                          <span class="keyword">const</span> std::string&amp; subId_ = <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l05811"></a><span class="lineno"> 5811</span>&#160;    {</div><div class="line"><a name="l05812"></a><span class="lineno"> 5812</span>&#160;      <span class="keywordflow">return</span> _body.get().subscribe(messageHandler_, topic_, timeout_,</div><div class="line"><a name="l05813"></a><span class="lineno"> 5813</span>&#160;                                   filter_, <span class="stringliteral">&quot;&quot;</span>, options_, subId_);</div><div class="line"><a name="l05814"></a><span class="lineno"> 5814</span>&#160;    }</div><div class="line"><a name="l05815"></a><span class="lineno"> 5815</span>&#160;</div><div class="line"><a name="l05831"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a0f6697e1965a6a9f9276b3734364a1b7"> 5831</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="classAMPS_1_1Client.html#a0f6697e1965a6a9f9276b3734364a1b7">subscribe</a>(<span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l05832"></a><span class="lineno"> 5832</span>&#160;                            <span class="keywordtype">long</span> timeout_ = 0, <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05833"></a><span class="lineno"> 5833</span>&#160;                            <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05834"></a><span class="lineno"> 5834</span>&#160;                            <span class="keyword">const</span> std::string&amp; subId_ = <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l05835"></a><span class="lineno"> 5835</span>&#160;    {</div><div class="line"><a name="l05836"></a><span class="lineno"> 5836</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> result(*<span class="keyword">this</span>);</div><div class="line"><a name="l05837"></a><span class="lineno"> 5837</span>&#160;      <span class="keywordflow">if</span> (_body.get().getDefaultMaxDepth())</div><div class="line"><a name="l05838"></a><span class="lineno"> 5838</span>&#160;      {</div><div class="line"><a name="l05839"></a><span class="lineno"> 5839</span>&#160;        result.<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(_body.get().getDefaultMaxDepth());</div><div class="line"><a name="l05840"></a><span class="lineno"> 5840</span>&#160;      }</div><div class="line"><a name="l05841"></a><span class="lineno"> 5841</span>&#160;      result.setSubscription(_body.get().subscribe(</div><div class="line"><a name="l05842"></a><span class="lineno"> 5842</span>&#160;                               result.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(),</div><div class="line"><a name="l05843"></a><span class="lineno"> 5843</span>&#160;                               topic_, timeout_, filter_, <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05844"></a><span class="lineno"> 5844</span>&#160;                               options_, subId_, <span class="keyword">false</span>));</div><div class="line"><a name="l05845"></a><span class="lineno"> 5845</span>&#160;      <span class="keywordflow">return</span> result;</div><div class="line"><a name="l05846"></a><span class="lineno"> 5846</span>&#160;    }</div><div class="line"><a name="l05847"></a><span class="lineno"> 5847</span>&#160;</div><div class="line"><a name="l05863"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a69c1c9245468474fb99662202e59e6d1"> 5863</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="classAMPS_1_1Client.html#a69c1c9245468474fb99662202e59e6d1">subscribe</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_,</div><div class="line"><a name="l05864"></a><span class="lineno"> 5864</span>&#160;                            <span class="keywordtype">long</span> timeout_ = 0, <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05865"></a><span class="lineno"> 5865</span>&#160;                            <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05866"></a><span class="lineno"> 5866</span>&#160;                            <span class="keyword">const</span> std::string&amp; subId_ = <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l05867"></a><span class="lineno"> 5867</span>&#160;    {</div><div class="line"><a name="l05868"></a><span class="lineno"> 5868</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> result(*<span class="keyword">this</span>);</div><div class="line"><a name="l05869"></a><span class="lineno"> 5869</span>&#160;      <span class="keywordflow">if</span> (_body.get().getDefaultMaxDepth())</div><div class="line"><a name="l05870"></a><span class="lineno"> 5870</span>&#160;      {</div><div class="line"><a name="l05871"></a><span class="lineno"> 5871</span>&#160;        result.<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(_body.get().getDefaultMaxDepth());</div><div class="line"><a name="l05872"></a><span class="lineno"> 5872</span>&#160;      }</div><div class="line"><a name="l05873"></a><span class="lineno"> 5873</span>&#160;      result.setSubscription(_body.get().subscribe(</div><div class="line"><a name="l05874"></a><span class="lineno"> 5874</span>&#160;                               result.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(),</div><div class="line"><a name="l05875"></a><span class="lineno"> 5875</span>&#160;                               topic_, timeout_, filter_, <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05876"></a><span class="lineno"> 5876</span>&#160;                               options_, subId_, <span class="keyword">false</span>));</div><div class="line"><a name="l05877"></a><span class="lineno"> 5877</span>&#160;      <span class="keywordflow">return</span> result;</div><div class="line"><a name="l05878"></a><span class="lineno"> 5878</span>&#160;    }</div><div class="line"><a name="l05879"></a><span class="lineno"> 5879</span>&#160;</div><div class="line"><a name="l05892"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a18c7e4a46d8842d780e999d211a05bdb"> 5892</a></span>&#160;    std::string <a class="code" href="classAMPS_1_1Client.html#a18c7e4a46d8842d780e999d211a05bdb">deltaSubscribe</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l05893"></a><span class="lineno"> 5893</span>&#160;                               <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l05894"></a><span class="lineno"> 5894</span>&#160;                               <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l05895"></a><span class="lineno"> 5895</span>&#160;                               <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05896"></a><span class="lineno"> 5896</span>&#160;                               <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05897"></a><span class="lineno"> 5897</span>&#160;                               <span class="keyword">const</span> std::string&amp; subId_ = <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l05898"></a><span class="lineno"> 5898</span>&#160;    {</div><div class="line"><a name="l05899"></a><span class="lineno"> 5899</span>&#160;      <span class="keywordflow">return</span> _body.get().deltaSubscribe(messageHandler_, topic_, timeout_,</div><div class="line"><a name="l05900"></a><span class="lineno"> 5900</span>&#160;                                        filter_, <span class="stringliteral">&quot;&quot;</span>, options_, subId_);</div><div class="line"><a name="l05901"></a><span class="lineno"> 5901</span>&#160;    }</div><div class="line"><a name="l05910"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#ad69fc7026f7fdac6cc2b7df5bc4cf021"> 5910</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="classAMPS_1_1Client.html#ad69fc7026f7fdac6cc2b7df5bc4cf021">deltaSubscribe</a>(<span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l05911"></a><span class="lineno"> 5911</span>&#160;                                 <span class="keywordtype">long</span> timeout_, <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05912"></a><span class="lineno"> 5912</span>&#160;                                 <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05913"></a><span class="lineno"> 5913</span>&#160;                                 <span class="keyword">const</span> std::string&amp; subId_ = <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l05914"></a><span class="lineno"> 5914</span>&#160;    {</div><div class="line"><a name="l05915"></a><span class="lineno"> 5915</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> result(*<span class="keyword">this</span>);</div><div class="line"><a name="l05916"></a><span class="lineno"> 5916</span>&#160;      <span class="keywordflow">if</span> (_body.get().getDefaultMaxDepth())</div><div class="line"><a name="l05917"></a><span class="lineno"> 5917</span>&#160;      {</div><div class="line"><a name="l05918"></a><span class="lineno"> 5918</span>&#160;        result.<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(_body.get().getDefaultMaxDepth());</div><div class="line"><a name="l05919"></a><span class="lineno"> 5919</span>&#160;      }</div><div class="line"><a name="l05920"></a><span class="lineno"> 5920</span>&#160;      result.setSubscription(_body.get().deltaSubscribe(</div><div class="line"><a name="l05921"></a><span class="lineno"> 5921</span>&#160;                               result.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(),</div><div class="line"><a name="l05922"></a><span class="lineno"> 5922</span>&#160;                               topic_, timeout_, filter_, <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05923"></a><span class="lineno"> 5923</span>&#160;                               options_, subId_, <span class="keyword">false</span>));</div><div class="line"><a name="l05924"></a><span class="lineno"> 5924</span>&#160;      <span class="keywordflow">return</span> result;</div><div class="line"><a name="l05925"></a><span class="lineno"> 5925</span>&#160;    }</div><div class="line"><a name="l05926"></a><span class="lineno"> 5926</span>&#160;</div><div class="line"><a name="l05928"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#aa241a06bc872f7f665912a146b8be17a"> 5928</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="classAMPS_1_1Client.html#aa241a06bc872f7f665912a146b8be17a">deltaSubscribe</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_,</div><div class="line"><a name="l05929"></a><span class="lineno"> 5929</span>&#160;                                 <span class="keywordtype">long</span> timeout_, <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05930"></a><span class="lineno"> 5930</span>&#160;                                 <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05931"></a><span class="lineno"> 5931</span>&#160;                                 <span class="keyword">const</span> std::string&amp; subId_ = <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l05932"></a><span class="lineno"> 5932</span>&#160;    {</div><div class="line"><a name="l05933"></a><span class="lineno"> 5933</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> result(*<span class="keyword">this</span>);</div><div class="line"><a name="l05934"></a><span class="lineno"> 5934</span>&#160;      <span class="keywordflow">if</span> (_body.get().getDefaultMaxDepth())</div><div class="line"><a name="l05935"></a><span class="lineno"> 5935</span>&#160;      {</div><div class="line"><a name="l05936"></a><span class="lineno"> 5936</span>&#160;        result.<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(_body.get().getDefaultMaxDepth());</div><div class="line"><a name="l05937"></a><span class="lineno"> 5937</span>&#160;      }</div><div class="line"><a name="l05938"></a><span class="lineno"> 5938</span>&#160;      result.setSubscription(_body.get().deltaSubscribe(</div><div class="line"><a name="l05939"></a><span class="lineno"> 5939</span>&#160;                               result.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(),</div><div class="line"><a name="l05940"></a><span class="lineno"> 5940</span>&#160;                               topic_, timeout_, filter_, <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05941"></a><span class="lineno"> 5941</span>&#160;                               options_, subId_, <span class="keyword">false</span>));</div><div class="line"><a name="l05942"></a><span class="lineno"> 5942</span>&#160;      <span class="keywordflow">return</span> result;</div><div class="line"><a name="l05943"></a><span class="lineno"> 5943</span>&#160;    }</div><div class="line"><a name="l05944"></a><span class="lineno"> 5944</span>&#160;</div><div class="line"><a name="l05970"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a2059bec4f61e57ee2ea1d73b52438e4b"> 5970</a></span>&#160;    std::string <a class="code" href="classAMPS_1_1Client.html#a2059bec4f61e57ee2ea1d73b52438e4b">bookmarkSubscribe</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l05971"></a><span class="lineno"> 5971</span>&#160;                                  <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l05972"></a><span class="lineno"> 5972</span>&#160;                                  <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l05973"></a><span class="lineno"> 5973</span>&#160;                                  <span class="keyword">const</span> std::string&amp; bookmark_,</div><div class="line"><a name="l05974"></a><span class="lineno"> 5974</span>&#160;                                  <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05975"></a><span class="lineno"> 5975</span>&#160;                                  <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05976"></a><span class="lineno"> 5976</span>&#160;                                  <span class="keyword">const</span> std::string&amp; subId_ = <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l05977"></a><span class="lineno"> 5977</span>&#160;    {</div><div class="line"><a name="l05978"></a><span class="lineno"> 5978</span>&#160;      <span class="keywordflow">return</span> _body.get().subscribe(messageHandler_, topic_, timeout_,</div><div class="line"><a name="l05979"></a><span class="lineno"> 5979</span>&#160;                                   filter_, bookmark_, options_, subId_);</div><div class="line"><a name="l05980"></a><span class="lineno"> 5980</span>&#160;    }</div><div class="line"><a name="l05998"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a636b759d646059aefbf04bf67aabcea4"> 5998</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="classAMPS_1_1Client.html#a636b759d646059aefbf04bf67aabcea4">bookmarkSubscribe</a>(<span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l05999"></a><span class="lineno"> 5999</span>&#160;                                    <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l06000"></a><span class="lineno"> 6000</span>&#160;                                    <span class="keyword">const</span> std::string&amp; bookmark_,</div><div class="line"><a name="l06001"></a><span class="lineno"> 6001</span>&#160;                                    <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06002"></a><span class="lineno"> 6002</span>&#160;                                    <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06003"></a><span class="lineno"> 6003</span>&#160;                                    <span class="keyword">const</span> std::string&amp; subId_ = <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l06004"></a><span class="lineno"> 6004</span>&#160;    {</div><div class="line"><a name="l06005"></a><span class="lineno"> 6005</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> result(*<span class="keyword">this</span>);</div><div class="line"><a name="l06006"></a><span class="lineno"> 6006</span>&#160;      <span class="keywordflow">if</span> (_body.get().getDefaultMaxDepth())</div><div class="line"><a name="l06007"></a><span class="lineno"> 6007</span>&#160;      {</div><div class="line"><a name="l06008"></a><span class="lineno"> 6008</span>&#160;        result.<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(_body.get().getDefaultMaxDepth());</div><div class="line"><a name="l06009"></a><span class="lineno"> 6009</span>&#160;      }</div><div class="line"><a name="l06010"></a><span class="lineno"> 6010</span>&#160;      result.setSubscription(_body.get().subscribe(</div><div class="line"><a name="l06011"></a><span class="lineno"> 6011</span>&#160;                               result.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(),</div><div class="line"><a name="l06012"></a><span class="lineno"> 6012</span>&#160;                               topic_, timeout_, filter_,</div><div class="line"><a name="l06013"></a><span class="lineno"> 6013</span>&#160;                               bookmark_, options_,</div><div class="line"><a name="l06014"></a><span class="lineno"> 6014</span>&#160;                               subId_, <span class="keyword">false</span>));</div><div class="line"><a name="l06015"></a><span class="lineno"> 6015</span>&#160;      <span class="keywordflow">return</span> result;</div><div class="line"><a name="l06016"></a><span class="lineno"> 6016</span>&#160;    }</div><div class="line"><a name="l06017"></a><span class="lineno"> 6017</span>&#160;</div><div class="line"><a name="l06019"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a8f525689e0e6f80f824b8592042522b4"> 6019</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="classAMPS_1_1Client.html#a8f525689e0e6f80f824b8592042522b4">bookmarkSubscribe</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_,</div><div class="line"><a name="l06020"></a><span class="lineno"> 6020</span>&#160;                                    <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l06021"></a><span class="lineno"> 6021</span>&#160;                                    <span class="keyword">const</span> std::string&amp; bookmark_,</div><div class="line"><a name="l06022"></a><span class="lineno"> 6022</span>&#160;                                    <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06023"></a><span class="lineno"> 6023</span>&#160;                                    <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06024"></a><span class="lineno"> 6024</span>&#160;                                    <span class="keyword">const</span> std::string&amp; subId_ = <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l06025"></a><span class="lineno"> 6025</span>&#160;    {</div><div class="line"><a name="l06026"></a><span class="lineno"> 6026</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> result(*<span class="keyword">this</span>);</div><div class="line"><a name="l06027"></a><span class="lineno"> 6027</span>&#160;      <span class="keywordflow">if</span> (_body.get().getDefaultMaxDepth())</div><div class="line"><a name="l06028"></a><span class="lineno"> 6028</span>&#160;      {</div><div class="line"><a name="l06029"></a><span class="lineno"> 6029</span>&#160;        result.<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(_body.get().getDefaultMaxDepth());</div><div class="line"><a name="l06030"></a><span class="lineno"> 6030</span>&#160;      }</div><div class="line"><a name="l06031"></a><span class="lineno"> 6031</span>&#160;      result.setSubscription(_body.get().subscribe(</div><div class="line"><a name="l06032"></a><span class="lineno"> 6032</span>&#160;                               result.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(),</div><div class="line"><a name="l06033"></a><span class="lineno"> 6033</span>&#160;                               topic_, timeout_, filter_,</div><div class="line"><a name="l06034"></a><span class="lineno"> 6034</span>&#160;                               bookmark_, options_,</div><div class="line"><a name="l06035"></a><span class="lineno"> 6035</span>&#160;                               subId_, <span class="keyword">false</span>));</div><div class="line"><a name="l06036"></a><span class="lineno"> 6036</span>&#160;      <span class="keywordflow">return</span> result;</div><div class="line"><a name="l06037"></a><span class="lineno"> 6037</span>&#160;    }</div><div class="line"><a name="l06038"></a><span class="lineno"> 6038</span>&#160;</div><div class="line"><a name="l06047"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a53879275db21cd10862bc3702a9f6e67"> 6047</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a53879275db21cd10862bc3702a9f6e67">unsubscribe</a>(<span class="keyword">const</span> std::string&amp; commandId)</div><div class="line"><a name="l06048"></a><span class="lineno"> 6048</span>&#160;    {</div><div class="line"><a name="l06049"></a><span class="lineno"> 6049</span>&#160;      <span class="keywordflow">return</span> _body.get().unsubscribe(commandId);</div><div class="line"><a name="l06050"></a><span class="lineno"> 6050</span>&#160;    }</div><div class="line"><a name="l06051"></a><span class="lineno"> 6051</span>&#160;</div><div class="line"><a name="l06059"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a22390de6f6cfdab7e17140443f57c1d5"> 6059</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a22390de6f6cfdab7e17140443f57c1d5">unsubscribe</a>()</div><div class="line"><a name="l06060"></a><span class="lineno"> 6060</span>&#160;    {</div><div class="line"><a name="l06061"></a><span class="lineno"> 6061</span>&#160;      <span class="keywordflow">return</span> _body.get().unsubscribe();</div><div class="line"><a name="l06062"></a><span class="lineno"> 6062</span>&#160;    }</div><div class="line"><a name="l06063"></a><span class="lineno"> 6063</span>&#160;</div><div class="line"><a name="l06064"></a><span class="lineno"> 6064</span>&#160;</div><div class="line"><a name="l06094"></a><span class="lineno"><a class="line" href="group__async.html#gaff38779507c72161126f1311aa6d632b"> 6094</a></span>&#160;    std::string <a class="code" href="group__async.html#gaff38779507c72161126f1311aa6d632b">sow</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l06095"></a><span class="lineno"> 6095</span>&#160;                    <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l06096"></a><span class="lineno"> 6096</span>&#160;                    <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06097"></a><span class="lineno"> 6097</span>&#160;                    <span class="keyword">const</span> std::string&amp; orderBy_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06098"></a><span class="lineno"> 6098</span>&#160;                    <span class="keyword">const</span> std::string&amp; bookmark_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06099"></a><span class="lineno"> 6099</span>&#160;                    <span class="keywordtype">int</span> batchSize_ = DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l06100"></a><span class="lineno"> 6100</span>&#160;                    <span class="keywordtype">int</span> topN_ = DEFAULT_TOP_N,</div><div class="line"><a name="l06101"></a><span class="lineno"> 6101</span>&#160;                    <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06102"></a><span class="lineno"> 6102</span>&#160;                    <span class="keywordtype">long</span> timeout_ = DEFAULT_COMMAND_TIMEOUT)</div><div class="line"><a name="l06103"></a><span class="lineno"> 6103</span>&#160;    {</div><div class="line"><a name="l06104"></a><span class="lineno"> 6104</span>&#160;      <span class="keywordflow">return</span> _body.get().sow(messageHandler_, topic_, filter_, orderBy_,</div><div class="line"><a name="l06105"></a><span class="lineno"> 6105</span>&#160;                             bookmark_, batchSize_, topN_, options_,</div><div class="line"><a name="l06106"></a><span class="lineno"> 6106</span>&#160;                             timeout_);</div><div class="line"><a name="l06107"></a><span class="lineno"> 6107</span>&#160;    }</div><div class="line"><a name="l06132"></a><span class="lineno"><a class="line" href="group__sync.html#ga62a50018ae00fab21abbf25b8df69544"> 6132</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="group__sync.html#ga62a50018ae00fab21abbf25b8df69544">sow</a>(<span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l06133"></a><span class="lineno"> 6133</span>&#160;                      <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06134"></a><span class="lineno"> 6134</span>&#160;                      <span class="keyword">const</span> std::string&amp; orderBy_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06135"></a><span class="lineno"> 6135</span>&#160;                      <span class="keyword">const</span> std::string&amp; bookmark_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06136"></a><span class="lineno"> 6136</span>&#160;                      <span class="keywordtype">int</span> batchSize_ = DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l06137"></a><span class="lineno"> 6137</span>&#160;                      <span class="keywordtype">int</span> topN_ = DEFAULT_TOP_N,</div><div class="line"><a name="l06138"></a><span class="lineno"> 6138</span>&#160;                      <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06139"></a><span class="lineno"> 6139</span>&#160;                      <span class="keywordtype">long</span> timeout_ = DEFAULT_COMMAND_TIMEOUT)</div><div class="line"><a name="l06140"></a><span class="lineno"> 6140</span>&#160;    {</div><div class="line"><a name="l06141"></a><span class="lineno"> 6141</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> result(*<span class="keyword">this</span>);</div><div class="line"><a name="l06142"></a><span class="lineno"> 6142</span>&#160;      <span class="keywordflow">if</span> (_body.get().getDefaultMaxDepth())</div><div class="line"><a name="l06143"></a><span class="lineno"> 6143</span>&#160;      {</div><div class="line"><a name="l06144"></a><span class="lineno"> 6144</span>&#160;        result.<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(_body.get().getDefaultMaxDepth());</div><div class="line"><a name="l06145"></a><span class="lineno"> 6145</span>&#160;      }</div><div class="line"><a name="l06146"></a><span class="lineno"> 6146</span>&#160;      result.setSOWOnly(_body.get().sow(result.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(),</div><div class="line"><a name="l06147"></a><span class="lineno"> 6147</span>&#160;                                        topic_, filter_, orderBy_, bookmark_,</div><div class="line"><a name="l06148"></a><span class="lineno"> 6148</span>&#160;                                        batchSize_, topN_, options_, timeout_));</div><div class="line"><a name="l06149"></a><span class="lineno"> 6149</span>&#160;      <span class="keywordflow">return</span> result;</div><div class="line"><a name="l06150"></a><span class="lineno"> 6150</span>&#160;    }</div><div class="line"><a name="l06151"></a><span class="lineno"> 6151</span>&#160;</div><div class="line"><a name="l06153"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a044b964fa6d8d6168ff6ef2d3263a508"> 6153</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="classAMPS_1_1Client.html#a044b964fa6d8d6168ff6ef2d3263a508">sow</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_,</div><div class="line"><a name="l06154"></a><span class="lineno"> 6154</span>&#160;                      <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06155"></a><span class="lineno"> 6155</span>&#160;                      <span class="keyword">const</span> std::string&amp; orderBy_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06156"></a><span class="lineno"> 6156</span>&#160;                      <span class="keyword">const</span> std::string&amp; bookmark_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06157"></a><span class="lineno"> 6157</span>&#160;                      <span class="keywordtype">int</span> batchSize_ = DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l06158"></a><span class="lineno"> 6158</span>&#160;                      <span class="keywordtype">int</span> topN_ = DEFAULT_TOP_N,</div><div class="line"><a name="l06159"></a><span class="lineno"> 6159</span>&#160;                      <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06160"></a><span class="lineno"> 6160</span>&#160;                      <span class="keywordtype">long</span> timeout_ = DEFAULT_COMMAND_TIMEOUT)</div><div class="line"><a name="l06161"></a><span class="lineno"> 6161</span>&#160;    {</div><div class="line"><a name="l06162"></a><span class="lineno"> 6162</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> result(*<span class="keyword">this</span>);</div><div class="line"><a name="l06163"></a><span class="lineno"> 6163</span>&#160;      <span class="keywordflow">if</span> (_body.get().getDefaultMaxDepth())</div><div class="line"><a name="l06164"></a><span class="lineno"> 6164</span>&#160;      {</div><div class="line"><a name="l06165"></a><span class="lineno"> 6165</span>&#160;        result.<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(_body.get().getDefaultMaxDepth());</div><div class="line"><a name="l06166"></a><span class="lineno"> 6166</span>&#160;      }</div><div class="line"><a name="l06167"></a><span class="lineno"> 6167</span>&#160;      result.setSOWOnly(_body.get().sow(result.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(),</div><div class="line"><a name="l06168"></a><span class="lineno"> 6168</span>&#160;                                        topic_, filter_, orderBy_, bookmark_,</div><div class="line"><a name="l06169"></a><span class="lineno"> 6169</span>&#160;                                        batchSize_, topN_, options_, timeout_));</div><div class="line"><a name="l06170"></a><span class="lineno"> 6170</span>&#160;      <span class="keywordflow">return</span> result;</div><div class="line"><a name="l06171"></a><span class="lineno"> 6171</span>&#160;    }</div><div class="line"><a name="l06194"></a><span class="lineno"><a class="line" href="group__async.html#ga6d857b62c7e4821e0940d742aaf78a3b"> 6194</a></span>&#160;    std::string <a class="code" href="group__async.html#ga6d857b62c7e4821e0940d742aaf78a3b">sow</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l06195"></a><span class="lineno"> 6195</span>&#160;                    <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l06196"></a><span class="lineno"> 6196</span>&#160;                    <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l06197"></a><span class="lineno"> 6197</span>&#160;                    <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06198"></a><span class="lineno"> 6198</span>&#160;                    <span class="keywordtype">int</span> batchSize_ = DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l06199"></a><span class="lineno"> 6199</span>&#160;                    <span class="keywordtype">int</span> topN_ = DEFAULT_TOP_N)</div><div class="line"><a name="l06200"></a><span class="lineno"> 6200</span>&#160;    {</div><div class="line"><a name="l06201"></a><span class="lineno"> 6201</span>&#160;      <span class="keywordflow">return</span> _body.get().sow(messageHandler_, topic_, timeout_, filter_,</div><div class="line"><a name="l06202"></a><span class="lineno"> 6202</span>&#160;                             batchSize_, topN_);</div><div class="line"><a name="l06203"></a><span class="lineno"> 6203</span>&#160;    }</div><div class="line"><a name="l06226"></a><span class="lineno"><a class="line" href="group__async.html#ga85464b780acd55106a61b29ac812affc"> 6226</a></span>&#160;    std::string <a class="code" href="group__async.html#ga85464b780acd55106a61b29ac812affc">sowAndSubscribe</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l06227"></a><span class="lineno"> 6227</span>&#160;                                <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l06228"></a><span class="lineno"> 6228</span>&#160;                                <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l06229"></a><span class="lineno"> 6229</span>&#160;                                <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06230"></a><span class="lineno"> 6230</span>&#160;                                <span class="keywordtype">int</span> batchSize_ = DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l06231"></a><span class="lineno"> 6231</span>&#160;                                <span class="keywordtype">bool</span> oofEnabled_ = <span class="keyword">false</span>,</div><div class="line"><a name="l06232"></a><span class="lineno"> 6232</span>&#160;                                <span class="keywordtype">int</span> topN_ = DEFAULT_TOP_N)</div><div class="line"><a name="l06233"></a><span class="lineno"> 6233</span>&#160;    {</div><div class="line"><a name="l06234"></a><span class="lineno"> 6234</span>&#160;      <span class="keywordflow">return</span> _body.get().sowAndSubscribe(messageHandler_, topic_, timeout_,</div><div class="line"><a name="l06235"></a><span class="lineno"> 6235</span>&#160;                                         filter_, batchSize_, oofEnabled_,</div><div class="line"><a name="l06236"></a><span class="lineno"> 6236</span>&#160;                                         topN_);</div><div class="line"><a name="l06237"></a><span class="lineno"> 6237</span>&#160;    }</div><div class="line"><a name="l06238"></a><span class="lineno"> 6238</span>&#160;</div><div class="line"><a name="l06258"></a><span class="lineno"><a class="line" href="group__sync.html#ga6e4e389faa3e47fac68285be20528d5b"> 6258</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="group__sync.html#ga6e4e389faa3e47fac68285be20528d5b">sowAndSubscribe</a>(<span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l06259"></a><span class="lineno"> 6259</span>&#160;                                  <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l06260"></a><span class="lineno"> 6260</span>&#160;                                  <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06261"></a><span class="lineno"> 6261</span>&#160;                                  <span class="keywordtype">int</span> batchSize_ = DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l06262"></a><span class="lineno"> 6262</span>&#160;                                  <span class="keywordtype">bool</span> oofEnabled_ = <span class="keyword">false</span>,</div><div class="line"><a name="l06263"></a><span class="lineno"> 6263</span>&#160;                                  <span class="keywordtype">int</span> topN_ = DEFAULT_TOP_N)</div><div class="line"><a name="l06264"></a><span class="lineno"> 6264</span>&#160;    {</div><div class="line"><a name="l06265"></a><span class="lineno"> 6265</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> result(*<span class="keyword">this</span>);</div><div class="line"><a name="l06266"></a><span class="lineno"> 6266</span>&#160;      <span class="keywordflow">if</span> (_body.get().getDefaultMaxDepth())</div><div class="line"><a name="l06267"></a><span class="lineno"> 6267</span>&#160;      {</div><div class="line"><a name="l06268"></a><span class="lineno"> 6268</span>&#160;        result.<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(_body.get().getDefaultMaxDepth());</div><div class="line"><a name="l06269"></a><span class="lineno"> 6269</span>&#160;      }</div><div class="line"><a name="l06270"></a><span class="lineno"> 6270</span>&#160;      result.setSubscription(_body.get().sowAndSubscribe(</div><div class="line"><a name="l06271"></a><span class="lineno"> 6271</span>&#160;                               result.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(),</div><div class="line"><a name="l06272"></a><span class="lineno"> 6272</span>&#160;                               topic_, timeout_, filter_,</div><div class="line"><a name="l06273"></a><span class="lineno"> 6273</span>&#160;                               batchSize_, oofEnabled_,</div><div class="line"><a name="l06274"></a><span class="lineno"> 6274</span>&#160;                               topN_, <span class="keyword">false</span>));</div><div class="line"><a name="l06275"></a><span class="lineno"> 6275</span>&#160;      <span class="keywordflow">return</span> result;</div><div class="line"><a name="l06276"></a><span class="lineno"> 6276</span>&#160;    }</div><div class="line"><a name="l06296"></a><span class="lineno"><a class="line" href="group__sync.html#ga8f0d6e85e7e4a4b281d862b1a2c96b03"> 6296</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="group__sync.html#ga8f0d6e85e7e4a4b281d862b1a2c96b03">sowAndSubscribe</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_,</div><div class="line"><a name="l06297"></a><span class="lineno"> 6297</span>&#160;                                  <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l06298"></a><span class="lineno"> 6298</span>&#160;                                  <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06299"></a><span class="lineno"> 6299</span>&#160;                                  <span class="keywordtype">int</span> batchSize_ = DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l06300"></a><span class="lineno"> 6300</span>&#160;                                  <span class="keywordtype">bool</span> oofEnabled_ = <span class="keyword">false</span>,</div><div class="line"><a name="l06301"></a><span class="lineno"> 6301</span>&#160;                                  <span class="keywordtype">int</span> topN_ = DEFAULT_TOP_N)</div><div class="line"><a name="l06302"></a><span class="lineno"> 6302</span>&#160;    {</div><div class="line"><a name="l06303"></a><span class="lineno"> 6303</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> result(*<span class="keyword">this</span>);</div><div class="line"><a name="l06304"></a><span class="lineno"> 6304</span>&#160;      <span class="keywordflow">if</span> (_body.get().getDefaultMaxDepth())</div><div class="line"><a name="l06305"></a><span class="lineno"> 6305</span>&#160;      {</div><div class="line"><a name="l06306"></a><span class="lineno"> 6306</span>&#160;        result.<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(_body.get().getDefaultMaxDepth());</div><div class="line"><a name="l06307"></a><span class="lineno"> 6307</span>&#160;      }</div><div class="line"><a name="l06308"></a><span class="lineno"> 6308</span>&#160;      result.setSubscription(_body.get().sowAndSubscribe(</div><div class="line"><a name="l06309"></a><span class="lineno"> 6309</span>&#160;                               result.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(),</div><div class="line"><a name="l06310"></a><span class="lineno"> 6310</span>&#160;                               topic_, timeout_, filter_,</div><div class="line"><a name="l06311"></a><span class="lineno"> 6311</span>&#160;                               batchSize_, oofEnabled_,</div><div class="line"><a name="l06312"></a><span class="lineno"> 6312</span>&#160;                               topN_, <span class="keyword">false</span>));</div><div class="line"><a name="l06313"></a><span class="lineno"> 6313</span>&#160;      <span class="keywordflow">return</span> result;</div><div class="line"><a name="l06314"></a><span class="lineno"> 6314</span>&#160;    }</div><div class="line"><a name="l06315"></a><span class="lineno"> 6315</span>&#160;</div><div class="line"><a name="l06316"></a><span class="lineno"> 6316</span>&#160;</div><div class="line"><a name="l06344"></a><span class="lineno"><a class="line" href="group__async.html#ga63480893c8f42da69207c0492a4c67fd"> 6344</a></span>&#160;    std::string <a class="code" href="group__async.html#ga63480893c8f42da69207c0492a4c67fd">sowAndSubscribe</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l06345"></a><span class="lineno"> 6345</span>&#160;                                <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l06346"></a><span class="lineno"> 6346</span>&#160;                                <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06347"></a><span class="lineno"> 6347</span>&#160;                                <span class="keyword">const</span> std::string&amp; orderBy_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06348"></a><span class="lineno"> 6348</span>&#160;                                <span class="keyword">const</span> std::string&amp; bookmark_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06349"></a><span class="lineno"> 6349</span>&#160;                                <span class="keywordtype">int</span> batchSize_ = DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l06350"></a><span class="lineno"> 6350</span>&#160;                                <span class="keywordtype">int</span> topN_ = DEFAULT_TOP_N,</div><div class="line"><a name="l06351"></a><span class="lineno"> 6351</span>&#160;                                <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06352"></a><span class="lineno"> 6352</span>&#160;                                <span class="keywordtype">long</span> timeout_ = DEFAULT_COMMAND_TIMEOUT)</div><div class="line"><a name="l06353"></a><span class="lineno"> 6353</span>&#160;    {</div><div class="line"><a name="l06354"></a><span class="lineno"> 6354</span>&#160;      <span class="keywordflow">return</span> _body.get().sowAndSubscribe(messageHandler_, topic_, filter_,</div><div class="line"><a name="l06355"></a><span class="lineno"> 6355</span>&#160;                                         orderBy_, bookmark_, batchSize_,</div><div class="line"><a name="l06356"></a><span class="lineno"> 6356</span>&#160;                                         topN_, options_, timeout_);</div><div class="line"><a name="l06357"></a><span class="lineno"> 6357</span>&#160;    }</div><div class="line"><a name="l06358"></a><span class="lineno"> 6358</span>&#160;</div><div class="line"><a name="l06383"></a><span class="lineno"><a class="line" href="group__sync.html#gacc681b5ff2b19186130ef63f543a5f3e"> 6383</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="group__sync.html#gacc681b5ff2b19186130ef63f543a5f3e">sowAndSubscribe</a>(<span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l06384"></a><span class="lineno"> 6384</span>&#160;                                  <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06385"></a><span class="lineno"> 6385</span>&#160;                                  <span class="keyword">const</span> std::string&amp; orderBy_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06386"></a><span class="lineno"> 6386</span>&#160;                                  <span class="keyword">const</span> std::string&amp; bookmark_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06387"></a><span class="lineno"> 6387</span>&#160;                                  <span class="keywordtype">int</span> batchSize_ = DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l06388"></a><span class="lineno"> 6388</span>&#160;                                  <span class="keywordtype">int</span> topN_ = DEFAULT_TOP_N,</div><div class="line"><a name="l06389"></a><span class="lineno"> 6389</span>&#160;                                  <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06390"></a><span class="lineno"> 6390</span>&#160;                                  <span class="keywordtype">long</span> timeout_ = DEFAULT_COMMAND_TIMEOUT)</div><div class="line"><a name="l06391"></a><span class="lineno"> 6391</span>&#160;    {</div><div class="line"><a name="l06392"></a><span class="lineno"> 6392</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> result(*<span class="keyword">this</span>);</div><div class="line"><a name="l06393"></a><span class="lineno"> 6393</span>&#160;      <span class="keywordflow">if</span> (_body.get().getDefaultMaxDepth())</div><div class="line"><a name="l06394"></a><span class="lineno"> 6394</span>&#160;      {</div><div class="line"><a name="l06395"></a><span class="lineno"> 6395</span>&#160;        result.<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(_body.get().getDefaultMaxDepth());</div><div class="line"><a name="l06396"></a><span class="lineno"> 6396</span>&#160;      }</div><div class="line"><a name="l06397"></a><span class="lineno"> 6397</span>&#160;      result.setSubscription(_body.get().sowAndSubscribe(</div><div class="line"><a name="l06398"></a><span class="lineno"> 6398</span>&#160;                               result.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(),</div><div class="line"><a name="l06399"></a><span class="lineno"> 6399</span>&#160;                               topic_, filter_, orderBy_,</div><div class="line"><a name="l06400"></a><span class="lineno"> 6400</span>&#160;                               bookmark_, batchSize_, topN_,</div><div class="line"><a name="l06401"></a><span class="lineno"> 6401</span>&#160;                               options_, timeout_, <span class="keyword">false</span>));</div><div class="line"><a name="l06402"></a><span class="lineno"> 6402</span>&#160;      <span class="keywordflow">return</span> result;</div><div class="line"><a name="l06403"></a><span class="lineno"> 6403</span>&#160;    }</div><div class="line"><a name="l06404"></a><span class="lineno"> 6404</span>&#160;</div><div class="line"><a name="l06406"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#aeb7ad8de45b5f94b094a662631a0f24f"> 6406</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="classAMPS_1_1Client.html#aeb7ad8de45b5f94b094a662631a0f24f">sowAndSubscribe</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_,</div><div class="line"><a name="l06407"></a><span class="lineno"> 6407</span>&#160;                                  <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06408"></a><span class="lineno"> 6408</span>&#160;                                  <span class="keyword">const</span> std::string&amp; orderBy_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06409"></a><span class="lineno"> 6409</span>&#160;                                  <span class="keyword">const</span> std::string&amp; bookmark_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06410"></a><span class="lineno"> 6410</span>&#160;                                  <span class="keywordtype">int</span> batchSize_ = DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l06411"></a><span class="lineno"> 6411</span>&#160;                                  <span class="keywordtype">int</span> topN_ = DEFAULT_TOP_N,</div><div class="line"><a name="l06412"></a><span class="lineno"> 6412</span>&#160;                                  <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06413"></a><span class="lineno"> 6413</span>&#160;                                  <span class="keywordtype">long</span> timeout_ = DEFAULT_COMMAND_TIMEOUT)</div><div class="line"><a name="l06414"></a><span class="lineno"> 6414</span>&#160;    {</div><div class="line"><a name="l06415"></a><span class="lineno"> 6415</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> result(*<span class="keyword">this</span>);</div><div class="line"><a name="l06416"></a><span class="lineno"> 6416</span>&#160;      <span class="keywordflow">if</span> (_body.get().getDefaultMaxDepth())</div><div class="line"><a name="l06417"></a><span class="lineno"> 6417</span>&#160;      {</div><div class="line"><a name="l06418"></a><span class="lineno"> 6418</span>&#160;        result.<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(_body.get().getDefaultMaxDepth());</div><div class="line"><a name="l06419"></a><span class="lineno"> 6419</span>&#160;      }</div><div class="line"><a name="l06420"></a><span class="lineno"> 6420</span>&#160;      result.setSubscription(_body.get().sowAndSubscribe(</div><div class="line"><a name="l06421"></a><span class="lineno"> 6421</span>&#160;                               result.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(),</div><div class="line"><a name="l06422"></a><span class="lineno"> 6422</span>&#160;                               topic_, filter_, orderBy_,</div><div class="line"><a name="l06423"></a><span class="lineno"> 6423</span>&#160;                               bookmark_, batchSize_, topN_,</div><div class="line"><a name="l06424"></a><span class="lineno"> 6424</span>&#160;                               options_, timeout_, <span class="keyword">false</span>));</div><div class="line"><a name="l06425"></a><span class="lineno"> 6425</span>&#160;      <span class="keywordflow">return</span> result;</div><div class="line"><a name="l06426"></a><span class="lineno"> 6426</span>&#160;    }</div><div class="line"><a name="l06427"></a><span class="lineno"> 6427</span>&#160;</div><div class="line"><a name="l06452"></a><span class="lineno"><a class="line" href="group__async.html#gad6fe353536b773e724fa68ffb957a67f"> 6452</a></span>&#160;    std::string <a class="code" href="group__async.html#gad6fe353536b773e724fa68ffb957a67f">sowAndDeltaSubscribe</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l06453"></a><span class="lineno"> 6453</span>&#160;                                     <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l06454"></a><span class="lineno"> 6454</span>&#160;                                     <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06455"></a><span class="lineno"> 6455</span>&#160;                                     <span class="keyword">const</span> std::string&amp; orderBy_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06456"></a><span class="lineno"> 6456</span>&#160;                                     <span class="keywordtype">int</span> batchSize_ = DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l06457"></a><span class="lineno"> 6457</span>&#160;                                     <span class="keywordtype">int</span> topN_ = DEFAULT_TOP_N,</div><div class="line"><a name="l06458"></a><span class="lineno"> 6458</span>&#160;                                     <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06459"></a><span class="lineno"> 6459</span>&#160;                                     <span class="keywordtype">long</span> timeout_ = DEFAULT_COMMAND_TIMEOUT)</div><div class="line"><a name="l06460"></a><span class="lineno"> 6460</span>&#160;    {</div><div class="line"><a name="l06461"></a><span class="lineno"> 6461</span>&#160;      <span class="keywordflow">return</span> _body.get().sowAndDeltaSubscribe(messageHandler_, topic_,</div><div class="line"><a name="l06462"></a><span class="lineno"> 6462</span>&#160;                                              filter_, orderBy_, batchSize_,</div><div class="line"><a name="l06463"></a><span class="lineno"> 6463</span>&#160;                                              topN_, options_, timeout_);</div><div class="line"><a name="l06464"></a><span class="lineno"> 6464</span>&#160;    }</div><div class="line"><a name="l06485"></a><span class="lineno"><a class="line" href="group__sync.html#ga1140525838b53f9f67d3dd40906abd72"> 6485</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="group__sync.html#ga1140525838b53f9f67d3dd40906abd72">sowAndDeltaSubscribe</a>(<span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l06486"></a><span class="lineno"> 6486</span>&#160;                                       <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06487"></a><span class="lineno"> 6487</span>&#160;                                       <span class="keyword">const</span> std::string&amp; orderBy_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06488"></a><span class="lineno"> 6488</span>&#160;                                       <span class="keywordtype">int</span> batchSize_ = DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l06489"></a><span class="lineno"> 6489</span>&#160;                                       <span class="keywordtype">int</span> topN_ = DEFAULT_TOP_N,</div><div class="line"><a name="l06490"></a><span class="lineno"> 6490</span>&#160;                                       <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06491"></a><span class="lineno"> 6491</span>&#160;                                       <span class="keywordtype">long</span> timeout_ = DEFAULT_COMMAND_TIMEOUT)</div><div class="line"><a name="l06492"></a><span class="lineno"> 6492</span>&#160;    {</div><div class="line"><a name="l06493"></a><span class="lineno"> 6493</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> result(*<span class="keyword">this</span>);</div><div class="line"><a name="l06494"></a><span class="lineno"> 6494</span>&#160;      <span class="keywordflow">if</span> (_body.get().getDefaultMaxDepth())</div><div class="line"><a name="l06495"></a><span class="lineno"> 6495</span>&#160;      {</div><div class="line"><a name="l06496"></a><span class="lineno"> 6496</span>&#160;        result.<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(_body.get().getDefaultMaxDepth());</div><div class="line"><a name="l06497"></a><span class="lineno"> 6497</span>&#160;      }</div><div class="line"><a name="l06498"></a><span class="lineno"> 6498</span>&#160;      result.setSubscription(_body.get().sowAndDeltaSubscribe(</div><div class="line"><a name="l06499"></a><span class="lineno"> 6499</span>&#160;                               result.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(),</div><div class="line"><a name="l06500"></a><span class="lineno"> 6500</span>&#160;                               topic_, filter_, orderBy_,</div><div class="line"><a name="l06501"></a><span class="lineno"> 6501</span>&#160;                               batchSize_, topN_, options_,</div><div class="line"><a name="l06502"></a><span class="lineno"> 6502</span>&#160;                               timeout_, <span class="keyword">false</span>));</div><div class="line"><a name="l06503"></a><span class="lineno"> 6503</span>&#160;      <span class="keywordflow">return</span> result;</div><div class="line"><a name="l06504"></a><span class="lineno"> 6504</span>&#160;    }</div><div class="line"><a name="l06505"></a><span class="lineno"> 6505</span>&#160;</div><div class="line"><a name="l06507"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a3b86d941a9dfd237670d8d20c7cad1f3"> 6507</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="classAMPS_1_1Client.html#a3b86d941a9dfd237670d8d20c7cad1f3">sowAndDeltaSubscribe</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_,</div><div class="line"><a name="l06508"></a><span class="lineno"> 6508</span>&#160;                                       <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06509"></a><span class="lineno"> 6509</span>&#160;                                       <span class="keyword">const</span> std::string&amp; orderBy_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06510"></a><span class="lineno"> 6510</span>&#160;                                       <span class="keywordtype">int</span> batchSize_ = DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l06511"></a><span class="lineno"> 6511</span>&#160;                                       <span class="keywordtype">int</span> topN_ = DEFAULT_TOP_N,</div><div class="line"><a name="l06512"></a><span class="lineno"> 6512</span>&#160;                                       <span class="keyword">const</span> std::string&amp; options_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06513"></a><span class="lineno"> 6513</span>&#160;                                       <span class="keywordtype">long</span> timeout_ = DEFAULT_COMMAND_TIMEOUT)</div><div class="line"><a name="l06514"></a><span class="lineno"> 6514</span>&#160;    {</div><div class="line"><a name="l06515"></a><span class="lineno"> 6515</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> result(*<span class="keyword">this</span>);</div><div class="line"><a name="l06516"></a><span class="lineno"> 6516</span>&#160;      <span class="keywordflow">if</span> (_body.get().getDefaultMaxDepth())</div><div class="line"><a name="l06517"></a><span class="lineno"> 6517</span>&#160;      {</div><div class="line"><a name="l06518"></a><span class="lineno"> 6518</span>&#160;        result.<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(_body.get().getDefaultMaxDepth());</div><div class="line"><a name="l06519"></a><span class="lineno"> 6519</span>&#160;      }</div><div class="line"><a name="l06520"></a><span class="lineno"> 6520</span>&#160;      result.setSubscription(_body.get().sowAndDeltaSubscribe(</div><div class="line"><a name="l06521"></a><span class="lineno"> 6521</span>&#160;                               result.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(),</div><div class="line"><a name="l06522"></a><span class="lineno"> 6522</span>&#160;                               topic_, filter_, orderBy_,</div><div class="line"><a name="l06523"></a><span class="lineno"> 6523</span>&#160;                               batchSize_, topN_, options_,</div><div class="line"><a name="l06524"></a><span class="lineno"> 6524</span>&#160;                               timeout_, <span class="keyword">false</span>));</div><div class="line"><a name="l06525"></a><span class="lineno"> 6525</span>&#160;      <span class="keywordflow">return</span> result;</div><div class="line"><a name="l06526"></a><span class="lineno"> 6526</span>&#160;    }</div><div class="line"><a name="l06527"></a><span class="lineno"> 6527</span>&#160;</div><div class="line"><a name="l06552"></a><span class="lineno"><a class="line" href="group__async.html#ga791a217998f2b9a628a04378cc2e6eb5"> 6552</a></span>&#160;    std::string <a class="code" href="group__async.html#ga791a217998f2b9a628a04378cc2e6eb5">sowAndDeltaSubscribe</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l06553"></a><span class="lineno"> 6553</span>&#160;                                     <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l06554"></a><span class="lineno"> 6554</span>&#160;                                     <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l06555"></a><span class="lineno"> 6555</span>&#160;                                     <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06556"></a><span class="lineno"> 6556</span>&#160;                                     <span class="keywordtype">int</span> batchSize_ = DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l06557"></a><span class="lineno"> 6557</span>&#160;                                     <span class="keywordtype">bool</span> oofEnabled_ = <span class="keyword">false</span>,</div><div class="line"><a name="l06558"></a><span class="lineno"> 6558</span>&#160;                                     <span class="keywordtype">bool</span> sendEmpties_ = <span class="keyword">false</span>,</div><div class="line"><a name="l06559"></a><span class="lineno"> 6559</span>&#160;                                     <span class="keywordtype">int</span> topN_ = DEFAULT_TOP_N)</div><div class="line"><a name="l06560"></a><span class="lineno"> 6560</span>&#160;    {</div><div class="line"><a name="l06561"></a><span class="lineno"> 6561</span>&#160;      <span class="keywordflow">return</span> _body.get().sowAndDeltaSubscribe(messageHandler_, topic_,</div><div class="line"><a name="l06562"></a><span class="lineno"> 6562</span>&#160;                                              timeout_, filter_, batchSize_,</div><div class="line"><a name="l06563"></a><span class="lineno"> 6563</span>&#160;                                              oofEnabled_, sendEmpties_,</div><div class="line"><a name="l06564"></a><span class="lineno"> 6564</span>&#160;                                              topN_);</div><div class="line"><a name="l06565"></a><span class="lineno"> 6565</span>&#160;    }</div><div class="line"><a name="l06566"></a><span class="lineno"> 6566</span>&#160;</div><div class="line"><a name="l06588"></a><span class="lineno"><a class="line" href="group__sync.html#gac60c9d70153c3f16faa2fbfc98326057"> 6588</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="group__sync.html#gac60c9d70153c3f16faa2fbfc98326057">sowAndDeltaSubscribe</a>(<span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l06589"></a><span class="lineno"> 6589</span>&#160;                                       <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l06590"></a><span class="lineno"> 6590</span>&#160;                                       <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06591"></a><span class="lineno"> 6591</span>&#160;                                       <span class="keywordtype">int</span> batchSize_ = DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l06592"></a><span class="lineno"> 6592</span>&#160;                                       <span class="keywordtype">bool</span> oofEnabled_ = <span class="keyword">false</span>,</div><div class="line"><a name="l06593"></a><span class="lineno"> 6593</span>&#160;                                       <span class="keywordtype">bool</span> sendEmpties_ = <span class="keyword">false</span>,</div><div class="line"><a name="l06594"></a><span class="lineno"> 6594</span>&#160;                                       <span class="keywordtype">int</span> topN_ = DEFAULT_TOP_N)</div><div class="line"><a name="l06595"></a><span class="lineno"> 6595</span>&#160;    {</div><div class="line"><a name="l06596"></a><span class="lineno"> 6596</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> result(*<span class="keyword">this</span>);</div><div class="line"><a name="l06597"></a><span class="lineno"> 6597</span>&#160;      <span class="keywordflow">if</span> (_body.get().getDefaultMaxDepth())</div><div class="line"><a name="l06598"></a><span class="lineno"> 6598</span>&#160;      {</div><div class="line"><a name="l06599"></a><span class="lineno"> 6599</span>&#160;        result.<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(_body.get().getDefaultMaxDepth());</div><div class="line"><a name="l06600"></a><span class="lineno"> 6600</span>&#160;      }</div><div class="line"><a name="l06601"></a><span class="lineno"> 6601</span>&#160;      result.setSubscription(_body.get().sowAndDeltaSubscribe(</div><div class="line"><a name="l06602"></a><span class="lineno"> 6602</span>&#160;                               result.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(),</div><div class="line"><a name="l06603"></a><span class="lineno"> 6603</span>&#160;                               topic_, timeout_, filter_,</div><div class="line"><a name="l06604"></a><span class="lineno"> 6604</span>&#160;                               batchSize_, oofEnabled_,</div><div class="line"><a name="l06605"></a><span class="lineno"> 6605</span>&#160;                               sendEmpties_, topN_, <span class="keyword">false</span>));</div><div class="line"><a name="l06606"></a><span class="lineno"> 6606</span>&#160;      <span class="keywordflow">return</span> result;</div><div class="line"><a name="l06607"></a><span class="lineno"> 6607</span>&#160;    }</div><div class="line"><a name="l06629"></a><span class="lineno"><a class="line" href="group__sync.html#ga08b8f1e95e4b3ec684b7142fb420a969"> 6629</a></span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="group__sync.html#ga08b8f1e95e4b3ec684b7142fb420a969">sowAndDeltaSubscribe</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_,</div><div class="line"><a name="l06630"></a><span class="lineno"> 6630</span>&#160;                                       <span class="keywordtype">long</span> timeout_,</div><div class="line"><a name="l06631"></a><span class="lineno"> 6631</span>&#160;                                       <span class="keyword">const</span> std::string&amp; filter_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l06632"></a><span class="lineno"> 6632</span>&#160;                                       <span class="keywordtype">int</span> batchSize_ = DEFAULT_BATCH_SIZE,</div><div class="line"><a name="l06633"></a><span class="lineno"> 6633</span>&#160;                                       <span class="keywordtype">bool</span> oofEnabled_ = <span class="keyword">false</span>,</div><div class="line"><a name="l06634"></a><span class="lineno"> 6634</span>&#160;                                       <span class="keywordtype">bool</span> sendEmpties_ = <span class="keyword">false</span>,</div><div class="line"><a name="l06635"></a><span class="lineno"> 6635</span>&#160;                                       <span class="keywordtype">int</span> topN_ = DEFAULT_TOP_N)</div><div class="line"><a name="l06636"></a><span class="lineno"> 6636</span>&#160;    {</div><div class="line"><a name="l06637"></a><span class="lineno"> 6637</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> result(*<span class="keyword">this</span>);</div><div class="line"><a name="l06638"></a><span class="lineno"> 6638</span>&#160;      <span class="keywordflow">if</span> (_body.get().getDefaultMaxDepth())</div><div class="line"><a name="l06639"></a><span class="lineno"> 6639</span>&#160;      {</div><div class="line"><a name="l06640"></a><span class="lineno"> 6640</span>&#160;        result.<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(_body.get().getDefaultMaxDepth());</div><div class="line"><a name="l06641"></a><span class="lineno"> 6641</span>&#160;      }</div><div class="line"><a name="l06642"></a><span class="lineno"> 6642</span>&#160;      result.setSubscription(_body.get().sowAndDeltaSubscribe(</div><div class="line"><a name="l06643"></a><span class="lineno"> 6643</span>&#160;                               result.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(),</div><div class="line"><a name="l06644"></a><span class="lineno"> 6644</span>&#160;                               topic_, timeout_, filter_,</div><div class="line"><a name="l06645"></a><span class="lineno"> 6645</span>&#160;                               batchSize_, oofEnabled_,</div><div class="line"><a name="l06646"></a><span class="lineno"> 6646</span>&#160;                               sendEmpties_, topN_, <span class="keyword">false</span>));</div><div class="line"><a name="l06647"></a><span class="lineno"> 6647</span>&#160;      <span class="keywordflow">return</span> result;</div><div class="line"><a name="l06648"></a><span class="lineno"> 6648</span>&#160;    }</div><div class="line"><a name="l06668"></a><span class="lineno"><a class="line" href="group__async.html#ga17ba8a07934eb1b824879fed7da510fa"> 6668</a></span>&#160;    std::string <a class="code" href="group__async.html#ga17ba8a07934eb1b824879fed7da510fa">sowDelete</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler,</div><div class="line"><a name="l06669"></a><span class="lineno"> 6669</span>&#160;                          <span class="keyword">const</span> std::string&amp; topic,</div><div class="line"><a name="l06670"></a><span class="lineno"> 6670</span>&#160;                          <span class="keyword">const</span> std::string&amp; filter,</div><div class="line"><a name="l06671"></a><span class="lineno"> 6671</span>&#160;                          <span class="keywordtype">long</span> timeout)</div><div class="line"><a name="l06672"></a><span class="lineno"> 6672</span>&#160;    {</div><div class="line"><a name="l06673"></a><span class="lineno"> 6673</span>&#160;      <span class="keywordflow">return</span> _body.get().sowDelete(messageHandler, topic, filter, timeout);</div><div class="line"><a name="l06674"></a><span class="lineno"> 6674</span>&#160;    }</div><div class="line"><a name="l06691"></a><span class="lineno"><a class="line" href="group__sync.html#ga3c60cbdf0153f6d4b7674172b84286a3"> 6691</a></span>&#160;    <a class="code" href="classAMPS_1_1Message.html">Message</a> <a class="code" href="group__sync.html#ga3c60cbdf0153f6d4b7674172b84286a3">sowDelete</a>(<span class="keyword">const</span> std::string&amp; topic, <span class="keyword">const</span> std::string&amp; filter,</div><div class="line"><a name="l06692"></a><span class="lineno"> 6692</span>&#160;                      <span class="keywordtype">long</span> timeout = 0)</div><div class="line"><a name="l06693"></a><span class="lineno"> 6693</span>&#160;    {</div><div class="line"><a name="l06694"></a><span class="lineno"> 6694</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> stream(*<span class="keyword">this</span>);</div><div class="line"><a name="l06695"></a><span class="lineno"> 6695</span>&#160;      <span class="keywordtype">char</span> buf[<a class="code" href="classAMPS_1_1Message.html#a201bafd90c684f9013b9039360390228">Message::IdentifierLength</a> + 1];</div><div class="line"><a name="l06696"></a><span class="lineno"> 6696</span>&#160;      buf[<a class="code" href="classAMPS_1_1Message.html#a201bafd90c684f9013b9039360390228">Message::IdentifierLength</a>] = 0;</div><div class="line"><a name="l06697"></a><span class="lineno"> 6697</span>&#160;      AMPS_snprintf(buf, <a class="code" href="classAMPS_1_1Message.html#a201bafd90c684f9013b9039360390228">Message::IdentifierLength</a> + 1, <span class="stringliteral">&quot;%lx&quot;</span>, MessageImpl::newId());</div><div class="line"><a name="l06698"></a><span class="lineno"> 6698</span>&#160;      <a class="code" href="classAMPS_1_1Field.html">Field</a> cid(buf);</div><div class="line"><a name="l06699"></a><span class="lineno"> 6699</span>&#160;      <span class="keywordflow">try</span></div><div class="line"><a name="l06700"></a><span class="lineno"> 6700</span>&#160;      {</div><div class="line"><a name="l06701"></a><span class="lineno"> 6701</span>&#160;        stream.setStatsOnly(cid);</div><div class="line"><a name="l06702"></a><span class="lineno"> 6702</span>&#160;        _body.get().sowDelete(stream.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(), topic, filter, timeout, cid);</div><div class="line"><a name="l06703"></a><span class="lineno"> 6703</span>&#160;        <span class="keywordflow">return</span> *(stream.<a class="code" href="classAMPS_1_1MessageStream.html#a1ba2852c71ae794b66020f0b331d7288">begin</a>());</div><div class="line"><a name="l06704"></a><span class="lineno"> 6704</span>&#160;      }</div><div class="line"><a name="l06705"></a><span class="lineno"> 6705</span>&#160;      <span class="keywordflow">catch</span> (<span class="keyword">const</span> DisconnectedException&amp;)</div><div class="line"><a name="l06706"></a><span class="lineno"> 6706</span>&#160;      {</div><div class="line"><a name="l06707"></a><span class="lineno"> 6707</span>&#160;        removeMessageHandler(cid);</div><div class="line"><a name="l06708"></a><span class="lineno"> 6708</span>&#160;        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l06709"></a><span class="lineno"> 6709</span>&#160;      }</div><div class="line"><a name="l06710"></a><span class="lineno"> 6710</span>&#160;    }</div><div class="line"><a name="l06711"></a><span class="lineno"> 6711</span>&#160;</div><div class="line"><a name="l06716"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a0cf263706a233647fb4c525fe848c385"> 6716</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a0cf263706a233647fb4c525fe848c385">startTimer</a>()</div><div class="line"><a name="l06717"></a><span class="lineno"> 6717</span>&#160;    {</div><div class="line"><a name="l06718"></a><span class="lineno"> 6718</span>&#160;      _body.get().startTimer();</div><div class="line"><a name="l06719"></a><span class="lineno"> 6719</span>&#160;    }</div><div class="line"><a name="l06720"></a><span class="lineno"> 6720</span>&#160;</div><div class="line"><a name="l06727"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#aed5e3ada1c45d8f52e5135e4d4626b78"> 6727</a></span>&#160;    std::string <a class="code" href="classAMPS_1_1Client.html#aed5e3ada1c45d8f52e5135e4d4626b78">stopTimer</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler)</div><div class="line"><a name="l06728"></a><span class="lineno"> 6728</span>&#160;    {</div><div class="line"><a name="l06729"></a><span class="lineno"> 6729</span>&#160;      <span class="keywordflow">return</span> _body.get().stopTimer(messageHandler);</div><div class="line"><a name="l06730"></a><span class="lineno"> 6730</span>&#160;    }</div><div class="line"><a name="l06731"></a><span class="lineno"> 6731</span>&#160;</div><div class="line"><a name="l06753"></a><span class="lineno"><a class="line" href="group__async.html#gaaf149395b5542b7863de0b561929914f"> 6753</a></span>&#160;    std::string <a class="code" href="group__async.html#gaaf149395b5542b7863de0b561929914f">sowDeleteByKeys</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l06754"></a><span class="lineno"> 6754</span>&#160;                                <span class="keyword">const</span> std::string&amp; topic_,</div><div class="line"><a name="l06755"></a><span class="lineno"> 6755</span>&#160;                                <span class="keyword">const</span> std::string&amp; keys_,</div><div class="line"><a name="l06756"></a><span class="lineno"> 6756</span>&#160;                                <span class="keywordtype">long</span> timeout_ = 0)</div><div class="line"><a name="l06757"></a><span class="lineno"> 6757</span>&#160;    {</div><div class="line"><a name="l06758"></a><span class="lineno"> 6758</span>&#160;      <span class="keywordflow">return</span> _body.get().sowDeleteByKeys(messageHandler_, topic_, keys_, timeout_);</div><div class="line"><a name="l06759"></a><span class="lineno"> 6759</span>&#160;    }</div><div class="line"><a name="l06780"></a><span class="lineno"><a class="line" href="group__sync.html#ga2fd7edef1e59fbc09d8eb5d515b641e2"> 6780</a></span>&#160;    <a class="code" href="classAMPS_1_1Message.html">Message</a> <a class="code" href="group__sync.html#ga2fd7edef1e59fbc09d8eb5d515b641e2">sowDeleteByKeys</a>(<span class="keyword">const</span> std::string&amp; topic_, <span class="keyword">const</span> std::string&amp; keys_,</div><div class="line"><a name="l06781"></a><span class="lineno"> 6781</span>&#160;                            <span class="keywordtype">long</span> timeout_ = 0)</div><div class="line"><a name="l06782"></a><span class="lineno"> 6782</span>&#160;    {</div><div class="line"><a name="l06783"></a><span class="lineno"> 6783</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> stream(*<span class="keyword">this</span>);</div><div class="line"><a name="l06784"></a><span class="lineno"> 6784</span>&#160;      <span class="keywordtype">char</span> buf[<a class="code" href="classAMPS_1_1Message.html#a201bafd90c684f9013b9039360390228">Message::IdentifierLength</a> + 1];</div><div class="line"><a name="l06785"></a><span class="lineno"> 6785</span>&#160;      buf[<a class="code" href="classAMPS_1_1Message.html#a201bafd90c684f9013b9039360390228">Message::IdentifierLength</a>] = 0;</div><div class="line"><a name="l06786"></a><span class="lineno"> 6786</span>&#160;      AMPS_snprintf(buf, <a class="code" href="classAMPS_1_1Message.html#a201bafd90c684f9013b9039360390228">Message::IdentifierLength</a> + 1, <span class="stringliteral">&quot;%lx&quot;</span>, MessageImpl::newId());</div><div class="line"><a name="l06787"></a><span class="lineno"> 6787</span>&#160;      <a class="code" href="classAMPS_1_1Field.html">Field</a> cid(buf);</div><div class="line"><a name="l06788"></a><span class="lineno"> 6788</span>&#160;      <span class="keywordflow">try</span></div><div class="line"><a name="l06789"></a><span class="lineno"> 6789</span>&#160;      {</div><div class="line"><a name="l06790"></a><span class="lineno"> 6790</span>&#160;        stream.setStatsOnly(cid);</div><div class="line"><a name="l06791"></a><span class="lineno"> 6791</span>&#160;        _body.get().sowDeleteByKeys(stream.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(), topic_, keys_, timeout_, cid);</div><div class="line"><a name="l06792"></a><span class="lineno"> 6792</span>&#160;        <span class="keywordflow">return</span> *(stream.<a class="code" href="classAMPS_1_1MessageStream.html#a1ba2852c71ae794b66020f0b331d7288">begin</a>());</div><div class="line"><a name="l06793"></a><span class="lineno"> 6793</span>&#160;      }</div><div class="line"><a name="l06794"></a><span class="lineno"> 6794</span>&#160;      <span class="keywordflow">catch</span> (<span class="keyword">const</span> DisconnectedException&amp;)</div><div class="line"><a name="l06795"></a><span class="lineno"> 6795</span>&#160;      {</div><div class="line"><a name="l06796"></a><span class="lineno"> 6796</span>&#160;        removeMessageHandler(cid);</div><div class="line"><a name="l06797"></a><span class="lineno"> 6797</span>&#160;        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l06798"></a><span class="lineno"> 6798</span>&#160;      }</div><div class="line"><a name="l06799"></a><span class="lineno"> 6799</span>&#160;    }</div><div class="line"><a name="l06800"></a><span class="lineno"> 6800</span>&#160;</div><div class="line"><a name="l06815"></a><span class="lineno"><a class="line" href="group__async.html#ga8227d9f8dd2dad271df4536eae8eb4ce"> 6815</a></span>&#160;    std::string <a class="code" href="group__async.html#ga8227d9f8dd2dad271df4536eae8eb4ce">sowDeleteByData</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; messageHandler_,</div><div class="line"><a name="l06816"></a><span class="lineno"> 6816</span>&#160;                                <span class="keyword">const</span> std::string&amp; topic_, <span class="keyword">const</span> std::string&amp; data_,</div><div class="line"><a name="l06817"></a><span class="lineno"> 6817</span>&#160;                                <span class="keywordtype">long</span> timeout_ = 0)</div><div class="line"><a name="l06818"></a><span class="lineno"> 6818</span>&#160;    {</div><div class="line"><a name="l06819"></a><span class="lineno"> 6819</span>&#160;      <span class="keywordflow">return</span> _body.get().sowDeleteByData(messageHandler_, topic_, data_, timeout_);</div><div class="line"><a name="l06820"></a><span class="lineno"> 6820</span>&#160;    }</div><div class="line"><a name="l06821"></a><span class="lineno"> 6821</span>&#160;</div><div class="line"><a name="l06836"></a><span class="lineno"><a class="line" href="group__async.html#ga27b3bda1529246c2498d1fc1b7262a35"> 6836</a></span>&#160;    <a class="code" href="classAMPS_1_1Message.html">Message</a> <a class="code" href="group__async.html#ga27b3bda1529246c2498d1fc1b7262a35">sowDeleteByData</a>(<span class="keyword">const</span> std::string&amp; topic_, <span class="keyword">const</span> std::string&amp; data_,</div><div class="line"><a name="l06837"></a><span class="lineno"> 6837</span>&#160;                            <span class="keywordtype">long</span> timeout_ = 0)</div><div class="line"><a name="l06838"></a><span class="lineno"> 6838</span>&#160;    {</div><div class="line"><a name="l06839"></a><span class="lineno"> 6839</span>&#160;      <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> stream(*<span class="keyword">this</span>);</div><div class="line"><a name="l06840"></a><span class="lineno"> 6840</span>&#160;      <span class="keywordtype">char</span> buf[<a class="code" href="classAMPS_1_1Message.html#a201bafd90c684f9013b9039360390228">Message::IdentifierLength</a> + 1];</div><div class="line"><a name="l06841"></a><span class="lineno"> 6841</span>&#160;      buf[<a class="code" href="classAMPS_1_1Message.html#a201bafd90c684f9013b9039360390228">Message::IdentifierLength</a>] = 0;</div><div class="line"><a name="l06842"></a><span class="lineno"> 6842</span>&#160;      AMPS_snprintf(buf, <a class="code" href="classAMPS_1_1Message.html#a201bafd90c684f9013b9039360390228">Message::IdentifierLength</a> + 1, <span class="stringliteral">&quot;%lx&quot;</span>, MessageImpl::newId());</div><div class="line"><a name="l06843"></a><span class="lineno"> 6843</span>&#160;      <a class="code" href="classAMPS_1_1Field.html">Field</a> cid(buf);</div><div class="line"><a name="l06844"></a><span class="lineno"> 6844</span>&#160;      <span class="keywordflow">try</span></div><div class="line"><a name="l06845"></a><span class="lineno"> 6845</span>&#160;      {</div><div class="line"><a name="l06846"></a><span class="lineno"> 6846</span>&#160;        stream.setStatsOnly(cid);</div><div class="line"><a name="l06847"></a><span class="lineno"> 6847</span>&#160;        _body.get().sowDeleteByData(stream.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(), topic_, data_, timeout_, cid);</div><div class="line"><a name="l06848"></a><span class="lineno"> 6848</span>&#160;        <span class="keywordflow">return</span> *(stream.<a class="code" href="classAMPS_1_1MessageStream.html#a1ba2852c71ae794b66020f0b331d7288">begin</a>());</div><div class="line"><a name="l06849"></a><span class="lineno"> 6849</span>&#160;      }</div><div class="line"><a name="l06850"></a><span class="lineno"> 6850</span>&#160;      <span class="keywordflow">catch</span> (<span class="keyword">const</span> DisconnectedException&amp;)</div><div class="line"><a name="l06851"></a><span class="lineno"> 6851</span>&#160;      {</div><div class="line"><a name="l06852"></a><span class="lineno"> 6852</span>&#160;        removeMessageHandler(cid);</div><div class="line"><a name="l06853"></a><span class="lineno"> 6853</span>&#160;        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l06854"></a><span class="lineno"> 6854</span>&#160;      }</div><div class="line"><a name="l06855"></a><span class="lineno"> 6855</span>&#160;    }</div><div class="line"><a name="l06856"></a><span class="lineno"> 6856</span>&#160;</div><div class="line"><a name="l06860"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a2f07a7bad9e20121880caabab6fbca18"> 6860</a></span>&#160;    <a class="code" href="amps_8h.html#acfa1278412265f3b4c421e77111ed2ce">amps_handle</a> <a class="code" href="classAMPS_1_1Client.html#a2f07a7bad9e20121880caabab6fbca18">getHandle</a>()</div><div class="line"><a name="l06861"></a><span class="lineno"> 6861</span>&#160;    {</div><div class="line"><a name="l06862"></a><span class="lineno"> 6862</span>&#160;      <span class="keywordflow">return</span> _body.get().getHandle();</div><div class="line"><a name="l06863"></a><span class="lineno"> 6863</span>&#160;    }</div><div class="line"><a name="l06864"></a><span class="lineno"> 6864</span>&#160;</div><div class="line"><a name="l06873"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a0664ebf63c66c02419df0bac0040fcfe"> 6873</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a0664ebf63c66c02419df0bac0040fcfe">setExceptionListener</a>(<span class="keyword">const</span> std::shared_ptr&lt;const ExceptionListener&gt;&amp; pListener_)</div><div class="line"><a name="l06874"></a><span class="lineno"> 6874</span>&#160;    {</div><div class="line"><a name="l06875"></a><span class="lineno"> 6875</span>&#160;      _body.get().setExceptionListener(pListener_);</div><div class="line"><a name="l06876"></a><span class="lineno"> 6876</span>&#160;    }</div><div class="line"><a name="l06877"></a><span class="lineno"> 6877</span>&#160;</div><div class="line"><a name="l06886"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a5630a813d50c2358b60a58ffc7644513"> 6886</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a5630a813d50c2358b60a58ffc7644513">setExceptionListener</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1ExceptionListener.html">ExceptionListener</a>&amp; listener_)</div><div class="line"><a name="l06887"></a><span class="lineno"> 6887</span>&#160;    {</div><div class="line"><a name="l06888"></a><span class="lineno"> 6888</span>&#160;      _body.get().setExceptionListener(listener_);</div><div class="line"><a name="l06889"></a><span class="lineno"> 6889</span>&#160;    }</div><div class="line"><a name="l06890"></a><span class="lineno"> 6890</span>&#160;</div><div class="line"><a name="l06893"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a8d0f8687473d87b04bc7da59eedbf01c"> 6893</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="classAMPS_1_1ExceptionListener.html">ExceptionListener</a>&amp; <a class="code" href="classAMPS_1_1Client.html#a8d0f8687473d87b04bc7da59eedbf01c">getExceptionListener</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l06894"></a><span class="lineno"> 6894</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l06895"></a><span class="lineno"> 6895</span>&#160;      <span class="keywordflow">return</span> _body.get().getExceptionListener();</div><div class="line"><a name="l06896"></a><span class="lineno"> 6896</span>&#160;    }</div><div class="line"><a name="l06897"></a><span class="lineno"> 6897</span>&#160;</div><div class="line"><a name="l06905"></a><span class="lineno"> 6905</span>&#160;    <span class="comment">//  type of message) from the server for the specified interval (plus a grace period),</span></div><div class="line"><a name="l06919"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#acf032d7a0f4b3f6c50bfee9b0f83d00d"> 6919</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#acf032d7a0f4b3f6c50bfee9b0f83d00d">setHeartbeat</a>(<span class="keywordtype">unsigned</span> heartbeatTime_, <span class="keywordtype">unsigned</span> readTimeout_)</div><div class="line"><a name="l06920"></a><span class="lineno"> 6920</span>&#160;    {</div><div class="line"><a name="l06921"></a><span class="lineno"> 6921</span>&#160;      _body.get().setHeartbeat(heartbeatTime_, readTimeout_);</div><div class="line"><a name="l06922"></a><span class="lineno"> 6922</span>&#160;    }</div><div class="line"><a name="l06923"></a><span class="lineno"> 6923</span>&#160;</div><div class="line"><a name="l06931"></a><span class="lineno"> 6931</span>&#160;    <span class="comment">//  type of message) from the server for the specified interval (plus a grace period),</span></div><div class="line"><a name="l06943"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a299b1d90cb2c3c8955de7f8527425381"> 6943</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a299b1d90cb2c3c8955de7f8527425381">setHeartbeat</a>(<span class="keywordtype">unsigned</span> heartbeatTime_)</div><div class="line"><a name="l06944"></a><span class="lineno"> 6944</span>&#160;    {</div><div class="line"><a name="l06945"></a><span class="lineno"> 6945</span>&#160;      _body.get().setHeartbeat(heartbeatTime_, 2 * heartbeatTime_);</div><div class="line"><a name="l06946"></a><span class="lineno"> 6946</span>&#160;    }</div><div class="line"><a name="l06947"></a><span class="lineno"> 6947</span>&#160;</div><div class="line"><a name="l06949"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#aa2d452c8ecf8d4281f0f493e968b9c3e"> 6949</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#aa2d452c8ecf8d4281f0f493e968b9c3e">setUnhandledMessageHandler</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">AMPS::MessageHandler</a>&amp; messageHandler)</div><div class="line"><a name="l06950"></a><span class="lineno"> 6950</span>&#160;    {</div><div class="line"><a name="l06951"></a><span class="lineno"> 6951</span>&#160;      setLastChanceMessageHandler(messageHandler);</div><div class="line"><a name="l06952"></a><span class="lineno"> 6952</span>&#160;    }</div><div class="line"><a name="l06953"></a><span class="lineno"> 6953</span>&#160;</div><div class="line"><a name="l06956"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a2a65485a7ea933fde6765494436c0bd4"> 6956</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a2a65485a7ea933fde6765494436c0bd4">setLastChanceMessageHandler</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">AMPS::MessageHandler</a>&amp; messageHandler)</div><div class="line"><a name="l06957"></a><span class="lineno"> 6957</span>&#160;    {</div><div class="line"><a name="l06958"></a><span class="lineno"> 6958</span>&#160;      _body.get().setGlobalCommandTypeMessageHandler(ClientImpl::GlobalCommandTypeHandlers::LastChance,</div><div class="line"><a name="l06959"></a><span class="lineno"> 6959</span>&#160;                                                     messageHandler);</div><div class="line"><a name="l06960"></a><span class="lineno"> 6960</span>&#160;    }</div><div class="line"><a name="l06961"></a><span class="lineno"> 6961</span>&#160;</div><div class="line"><a name="l06982"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#ac3d0413c7edcb0b40260b728fecb183a"> 6982</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#ac3d0413c7edcb0b40260b728fecb183a">setGlobalCommandTypeMessageHandler</a>(<span class="keyword">const</span> std::string&amp; command_, <span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; handler_)</div><div class="line"><a name="l06983"></a><span class="lineno"> 6983</span>&#160;    {</div><div class="line"><a name="l06984"></a><span class="lineno"> 6984</span>&#160;      _body.get().setGlobalCommandTypeMessageHandler(command_, handler_);</div><div class="line"><a name="l06985"></a><span class="lineno"> 6985</span>&#160;    }</div><div class="line"><a name="l06986"></a><span class="lineno"> 6986</span>&#160;</div><div class="line"><a name="l07007"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a7b1fc3fdd539e5feb8cd2c487562c609"> 7007</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a7b1fc3fdd539e5feb8cd2c487562c609">setGlobalCommandTypeMessageHandler</a>(<span class="keyword">const</span> Message::Command::Type command_, <span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; handler_)</div><div class="line"><a name="l07008"></a><span class="lineno"> 7008</span>&#160;    {</div><div class="line"><a name="l07009"></a><span class="lineno"> 7009</span>&#160;      _body.get().setGlobalCommandTypeMessageHandler(command_, handler_);</div><div class="line"><a name="l07010"></a><span class="lineno"> 7010</span>&#160;    }</div><div class="line"><a name="l07011"></a><span class="lineno"> 7011</span>&#160;</div><div class="line"><a name="l07017"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a8ced98ddc65621dd8ad33d0aaab330d6"> 7017</a></span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classAMPS_1_1Client.html#a8ced98ddc65621dd8ad33d0aaab330d6">BOOKMARK_NOW</a>()</div><div class="line"><a name="l07018"></a><span class="lineno"> 7018</span>&#160;    {</div><div class="line"><a name="l07019"></a><span class="lineno"> 7019</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="group__specialBookmarks.html#ga56a5f968956ad81c7ebb864816c55a01">AMPS_BOOKMARK_NOW</a>;</div><div class="line"><a name="l07020"></a><span class="lineno"> 7020</span>&#160;    }</div><div class="line"><a name="l07026"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a45f7323a20d0ca48db4386c4ee80d50f"> 7026</a></span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classAMPS_1_1Client.html#a45f7323a20d0ca48db4386c4ee80d50f">NOW</a>()</div><div class="line"><a name="l07027"></a><span class="lineno"> 7027</span>&#160;    {</div><div class="line"><a name="l07028"></a><span class="lineno"> 7028</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="group__specialBookmarks.html#ga56a5f968956ad81c7ebb864816c55a01">AMPS_BOOKMARK_NOW</a>;</div><div class="line"><a name="l07029"></a><span class="lineno"> 7029</span>&#160;    }</div><div class="line"><a name="l07030"></a><span class="lineno"> 7030</span>&#160;</div><div class="line"><a name="l07036"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a166d557bcf677b643623c7385ab54499"> 7036</a></span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classAMPS_1_1Client.html#a166d557bcf677b643623c7385ab54499">BOOKMARK_EPOCH</a>()</div><div class="line"><a name="l07037"></a><span class="lineno"> 7037</span>&#160;    {</div><div class="line"><a name="l07038"></a><span class="lineno"> 7038</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="group__specialBookmarks.html#ga9b906ecdf1afe8a265183dbe0856959a">AMPS_BOOKMARK_EPOCH</a>;</div><div class="line"><a name="l07039"></a><span class="lineno"> 7039</span>&#160;    }</div><div class="line"><a name="l07040"></a><span class="lineno"> 7040</span>&#160;</div><div class="line"><a name="l07046"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a91ca84167cd8b86f434906f61e9c53ae"> 7046</a></span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classAMPS_1_1Client.html#a91ca84167cd8b86f434906f61e9c53ae">EPOCH</a>()</div><div class="line"><a name="l07047"></a><span class="lineno"> 7047</span>&#160;    {</div><div class="line"><a name="l07048"></a><span class="lineno"> 7048</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="group__specialBookmarks.html#ga9b906ecdf1afe8a265183dbe0856959a">AMPS_BOOKMARK_EPOCH</a>;</div><div class="line"><a name="l07049"></a><span class="lineno"> 7049</span>&#160;    }</div><div class="line"><a name="l07050"></a><span class="lineno"> 7050</span>&#160;</div><div class="line"><a name="l07057"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a2b010c7f6e163a4ba2dfa59bd6257494"> 7057</a></span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classAMPS_1_1Client.html#a2b010c7f6e163a4ba2dfa59bd6257494">BOOKMARK_MOST_RECENT</a>()</div><div class="line"><a name="l07058"></a><span class="lineno"> 7058</span>&#160;    {</div><div class="line"><a name="l07059"></a><span class="lineno"> 7059</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="group__specialBookmarks.html#ga9dc6d653c4c409720e685038051c7460">AMPS_BOOKMARK_RECENT</a>;</div><div class="line"><a name="l07060"></a><span class="lineno"> 7060</span>&#160;    }</div><div class="line"><a name="l07061"></a><span class="lineno"> 7061</span>&#160;</div><div class="line"><a name="l07068"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#ab99f18871b7d34f23468e76e9a9b97cc"> 7068</a></span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classAMPS_1_1Client.html#ab99f18871b7d34f23468e76e9a9b97cc">MOST_RECENT</a>()</div><div class="line"><a name="l07069"></a><span class="lineno"> 7069</span>&#160;    {</div><div class="line"><a name="l07070"></a><span class="lineno"> 7070</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="group__specialBookmarks.html#ga9dc6d653c4c409720e685038051c7460">AMPS_BOOKMARK_RECENT</a>;</div><div class="line"><a name="l07071"></a><span class="lineno"> 7071</span>&#160;    }</div><div class="line"><a name="l07072"></a><span class="lineno"> 7072</span>&#160;</div><div class="line"><a name="l07079"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#aed3f9530708c60f4027ef0d5a932192e"> 7079</a></span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classAMPS_1_1Client.html#aed3f9530708c60f4027ef0d5a932192e">BOOKMARK_RECENT</a>()</div><div class="line"><a name="l07080"></a><span class="lineno"> 7080</span>&#160;    {</div><div class="line"><a name="l07081"></a><span class="lineno"> 7081</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="group__specialBookmarks.html#ga9dc6d653c4c409720e685038051c7460">AMPS_BOOKMARK_RECENT</a>;</div><div class="line"><a name="l07082"></a><span class="lineno"> 7082</span>&#160;    }</div><div class="line"><a name="l07083"></a><span class="lineno"> 7083</span>&#160;</div><div class="line"><a name="l07084"></a><span class="lineno"> 7084</span>&#160;</div><div class="line"><a name="l07090"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#adc5b02f576cab62cfdaae495b83857ef"> 7090</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#adc5b02f576cab62cfdaae495b83857ef">addConnectionStateListener</a>(<a class="code" href="classAMPS_1_1ConnectionStateListener.html">ConnectionStateListener</a>* listener)</div><div class="line"><a name="l07091"></a><span class="lineno"> 7091</span>&#160;    {</div><div class="line"><a name="l07092"></a><span class="lineno"> 7092</span>&#160;      _body.get().addConnectionStateListener(listener);</div><div class="line"><a name="l07093"></a><span class="lineno"> 7093</span>&#160;    }</div><div class="line"><a name="l07094"></a><span class="lineno"> 7094</span>&#160;</div><div class="line"><a name="l07098"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a130c79c818383f906967a6d8a0bad2ed"> 7098</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a130c79c818383f906967a6d8a0bad2ed">removeConnectionStateListener</a>(<a class="code" href="classAMPS_1_1ConnectionStateListener.html">ConnectionStateListener</a>* listener)</div><div class="line"><a name="l07099"></a><span class="lineno"> 7099</span>&#160;    {</div><div class="line"><a name="l07100"></a><span class="lineno"> 7100</span>&#160;      _body.get().removeConnectionStateListener(listener);</div><div class="line"><a name="l07101"></a><span class="lineno"> 7101</span>&#160;    }</div><div class="line"><a name="l07102"></a><span class="lineno"> 7102</span>&#160;</div><div class="line"><a name="l07105"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a8c461192dce399504f6d356ad8618d7e"> 7105</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a8c461192dce399504f6d356ad8618d7e">clearConnectionStateListeners</a>()</div><div class="line"><a name="l07106"></a><span class="lineno"> 7106</span>&#160;    {</div><div class="line"><a name="l07107"></a><span class="lineno"> 7107</span>&#160;      _body.get().clearConnectionStateListeners();</div><div class="line"><a name="l07108"></a><span class="lineno"> 7108</span>&#160;    }</div><div class="line"><a name="l07109"></a><span class="lineno"> 7109</span>&#160;</div><div class="line"><a name="l07135"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#aad6566eefeaef02b81f6a41e1be568e7"> 7135</a></span>&#160;    std::string <a class="code" href="classAMPS_1_1Client.html#aad6566eefeaef02b81f6a41e1be568e7">executeAsync</a>(<a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; command_, <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a> handler_)</div><div class="line"><a name="l07136"></a><span class="lineno"> 7136</span>&#160;    {</div><div class="line"><a name="l07137"></a><span class="lineno"> 7137</span>&#160;      <span class="keywordflow">return</span> _body.get().executeAsync(command_, handler_);</div><div class="line"><a name="l07138"></a><span class="lineno"> 7138</span>&#160;    }</div><div class="line"><a name="l07139"></a><span class="lineno"> 7139</span>&#160;</div><div class="line"><a name="l07169"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a9015b26fa1b16c4c1fbf497392309ad3"> 7169</a></span>&#160;    std::string <a class="code" href="classAMPS_1_1Client.html#a9015b26fa1b16c4c1fbf497392309ad3">executeAsyncNoResubscribe</a>(<a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; command_,</div><div class="line"><a name="l07170"></a><span class="lineno"> 7170</span>&#160;                                          <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a> handler_)</div><div class="line"><a name="l07171"></a><span class="lineno"> 7171</span>&#160;    {</div><div class="line"><a name="l07172"></a><span class="lineno"> 7172</span>&#160;      std::string id;</div><div class="line"><a name="l07173"></a><span class="lineno"> 7173</span>&#160;      <span class="keywordflow">try</span></div><div class="line"><a name="l07174"></a><span class="lineno"> 7174</span>&#160;      {</div><div class="line"><a name="l07175"></a><span class="lineno"> 7175</span>&#160;        <span class="keywordflow">if</span> (command_.isSubscribe())</div><div class="line"><a name="l07176"></a><span class="lineno"> 7176</span>&#160;        {</div><div class="line"><a name="l07177"></a><span class="lineno"> 7177</span>&#160;          <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message = command_.getMessage();</div><div class="line"><a name="l07178"></a><span class="lineno"> 7178</span>&#160;          <a class="code" href="classAMPS_1_1Field.html">Field</a> subId = message.<a class="code" href="classAMPS_1_1Message.html#a4beb1e21b1dabf98cbb956f97fb95dbd">getSubscriptionId</a>();</div><div class="line"><a name="l07179"></a><span class="lineno"> 7179</span>&#160;          <span class="keywordtype">bool</span> useExistingHandler = !subId.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>() &amp;&amp; !message.<a class="code" href="classAMPS_1_1Message.html#afdc34084b92891f21370c9f848936cad">getOptions</a>().<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>() &amp;&amp; message.<a class="code" href="classAMPS_1_1Message.html#afdc34084b92891f21370c9f848936cad">getOptions</a>().contains(<span class="stringliteral">&quot;replace&quot;</span>, 7);</div><div class="line"><a name="l07180"></a><span class="lineno"> 7180</span>&#160;          <span class="keywordflow">if</span> (useExistingHandler)</div><div class="line"><a name="l07181"></a><span class="lineno"> 7181</span>&#160;          {</div><div class="line"><a name="l07182"></a><span class="lineno"> 7182</span>&#160;            <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a> existingHandler;</div><div class="line"><a name="l07183"></a><span class="lineno"> 7183</span>&#160;            <span class="keywordflow">if</span> (_body.get()._routes.getRoute(subId, existingHandler))</div><div class="line"><a name="l07184"></a><span class="lineno"> 7184</span>&#160;            {</div><div class="line"><a name="l07185"></a><span class="lineno"> 7185</span>&#160;              <span class="comment">// we found an existing handler.</span></div><div class="line"><a name="l07186"></a><span class="lineno"> 7186</span>&#160;              _body.get().executeAsync(command_, existingHandler, <span class="keyword">false</span>);</div><div class="line"><a name="l07187"></a><span class="lineno"> 7187</span>&#160;              <span class="keywordflow">return</span> id; <span class="comment">// empty string indicates existing</span></div><div class="line"><a name="l07188"></a><span class="lineno"> 7188</span>&#160;            }</div><div class="line"><a name="l07189"></a><span class="lineno"> 7189</span>&#160;          }</div><div class="line"><a name="l07190"></a><span class="lineno"> 7190</span>&#160;        }</div><div class="line"><a name="l07191"></a><span class="lineno"> 7191</span>&#160;        <span class="keywordtype">id</span> = _body.get().executeAsync(command_, handler_, <span class="keyword">false</span>);</div><div class="line"><a name="l07192"></a><span class="lineno"> 7192</span>&#160;      }</div><div class="line"><a name="l07193"></a><span class="lineno"> 7193</span>&#160;      <span class="keywordflow">catch</span> (<span class="keyword">const</span> DisconnectedException&amp;)</div><div class="line"><a name="l07194"></a><span class="lineno"> 7194</span>&#160;      {</div><div class="line"><a name="l07195"></a><span class="lineno"> 7195</span>&#160;        removeMessageHandler(command_.getMessage().<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>());</div><div class="line"><a name="l07196"></a><span class="lineno"> 7196</span>&#160;        <span class="keywordflow">if</span> (command_.isSubscribe())</div><div class="line"><a name="l07197"></a><span class="lineno"> 7197</span>&#160;        {</div><div class="line"><a name="l07198"></a><span class="lineno"> 7198</span>&#160;          removeMessageHandler(command_.getMessage().<a class="code" href="classAMPS_1_1Message.html#a4beb1e21b1dabf98cbb956f97fb95dbd">getSubscriptionId</a>());</div><div class="line"><a name="l07199"></a><span class="lineno"> 7199</span>&#160;        }</div><div class="line"><a name="l07200"></a><span class="lineno"> 7200</span>&#160;        <span class="keywordflow">if</span> (command_.isSow())</div><div class="line"><a name="l07201"></a><span class="lineno"> 7201</span>&#160;        {</div><div class="line"><a name="l07202"></a><span class="lineno"> 7202</span>&#160;          removeMessageHandler(command_.getMessage().<a class="code" href="classAMPS_1_1Message.html#a636338403d40c748af5a33f931293f41">getQueryID</a>());</div><div class="line"><a name="l07203"></a><span class="lineno"> 7203</span>&#160;        }</div><div class="line"><a name="l07204"></a><span class="lineno"> 7204</span>&#160;        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l07205"></a><span class="lineno"> 7205</span>&#160;      }</div><div class="line"><a name="l07206"></a><span class="lineno"> 7206</span>&#160;      <span class="keywordflow">return</span> id;</div><div class="line"><a name="l07207"></a><span class="lineno"> 7207</span>&#160;    }</div><div class="line"><a name="l07208"></a><span class="lineno"> 7208</span>&#160;</div><div class="line"><a name="l07221"></a><span class="lineno"> 7221</span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> execute(<a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; command_);</div><div class="line"><a name="l07222"></a><span class="lineno"> 7222</span>&#160;</div><div class="line"><a name="l07231"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a8b0b7fc68d5527a05c5bc7d3d3c3fb8b"> 7231</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a8b0b7fc68d5527a05c5bc7d3d3c3fb8b">ack</a>(<a class="code" href="classAMPS_1_1Field.html">Field</a>&amp; topic_, <a class="code" href="classAMPS_1_1Field.html">Field</a>&amp; bookmark_, <span class="keyword">const</span> <span class="keywordtype">char</span>* options_ = NULL)</div><div class="line"><a name="l07232"></a><span class="lineno"> 7232</span>&#160;    {</div><div class="line"><a name="l07233"></a><span class="lineno"> 7233</span>&#160;      _body.get().ack(topic_, bookmark_, options_);</div><div class="line"><a name="l07234"></a><span class="lineno"> 7234</span>&#160;    }</div><div class="line"><a name="l07235"></a><span class="lineno"> 7235</span>&#160;</div><div class="line"><a name="l07243"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#af34fb70a7d9a9353b8abd9a569452b64"> 7243</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#af34fb70a7d9a9353b8abd9a569452b64">ack</a>(<a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message_, <span class="keyword">const</span> <span class="keywordtype">char</span>* options_ = NULL)</div><div class="line"><a name="l07244"></a><span class="lineno"> 7244</span>&#160;    {</div><div class="line"><a name="l07245"></a><span class="lineno"> 7245</span>&#160;      _body.get().ack(message_.<a class="code" href="classAMPS_1_1Message.html#afdc3e09761f4076f3ee18e99cf254e97">getTopic</a>(), message_.<a class="code" href="classAMPS_1_1Message.html#a7108ef0b54bc76e43dc4d49d700dc8ef">getBookmark</a>(), options_);</div><div class="line"><a name="l07246"></a><span class="lineno"> 7246</span>&#160;    }</div><div class="line"><a name="l07255"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#aa068c18ae5215993a99baf240286f69f"> 7255</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#aa068c18ae5215993a99baf240286f69f">ack</a>(<span class="keyword">const</span> std::string&amp; topic_, <span class="keyword">const</span> std::string&amp; bookmark_,</div><div class="line"><a name="l07256"></a><span class="lineno"> 7256</span>&#160;             <span class="keyword">const</span> <span class="keywordtype">char</span>* options_ = NULL)</div><div class="line"><a name="l07257"></a><span class="lineno"> 7257</span>&#160;    {</div><div class="line"><a name="l07258"></a><span class="lineno"> 7258</span>&#160;      _body.get().ack(<a class="code" href="classAMPS_1_1Field.html">Field</a>(topic_.data(), topic_.length()), <a class="code" href="classAMPS_1_1Field.html">Field</a>(bookmark_.data(), bookmark_.length()), options_);</div><div class="line"><a name="l07259"></a><span class="lineno"> 7259</span>&#160;    }</div><div class="line"><a name="l07260"></a><span class="lineno"> 7260</span>&#160;</div><div class="line"><a name="l07266"></a><span class="lineno"> 7266</span>&#160;    <span class="keywordtype">void</span> ackDeferredAutoAck(<a class="code" href="classAMPS_1_1Field.html">Field</a>&amp; topic_, <a class="code" href="classAMPS_1_1Field.html">Field</a>&amp; bookmark_, <span class="keyword">const</span> <span class="keywordtype">char</span>* options_ = NULL)</div><div class="line"><a name="l07267"></a><span class="lineno"> 7267</span>&#160;    {</div><div class="line"><a name="l07268"></a><span class="lineno"> 7268</span>&#160;      _body.get()._ack(topic_, bookmark_, options_);</div><div class="line"><a name="l07269"></a><span class="lineno"> 7269</span>&#160;    }</div><div class="line"><a name="l07279"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a0a1253c506311beec21e2ff6acc5e167"> 7279</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a0a1253c506311beec21e2ff6acc5e167">flushAcks</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l07280"></a><span class="lineno"> 7280</span>&#160;    {</div><div class="line"><a name="l07281"></a><span class="lineno"> 7281</span>&#160;      _body.get().flushAcks();</div><div class="line"><a name="l07282"></a><span class="lineno"> 7282</span>&#160;    }</div><div class="line"><a name="l07283"></a><span class="lineno"> 7283</span>&#160;</div><div class="line"><a name="l07288"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a5ef8782925a6ec46e9f77a282ee14ef7"> 7288</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classAMPS_1_1Client.html#a5ef8782925a6ec46e9f77a282ee14ef7">getAutoAck</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l07289"></a><span class="lineno"> 7289</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l07290"></a><span class="lineno"> 7290</span>&#160;      <span class="keywordflow">return</span> _body.get().getAutoAck();</div><div class="line"><a name="l07291"></a><span class="lineno"> 7291</span>&#160;    }</div><div class="line"><a name="l07298"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#aafa77fa7277c90c74cd47621d65dc762"> 7298</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#aafa77fa7277c90c74cd47621d65dc762">setAutoAck</a>(<span class="keywordtype">bool</span> isAutoAckEnabled_)</div><div class="line"><a name="l07299"></a><span class="lineno"> 7299</span>&#160;    {</div><div class="line"><a name="l07300"></a><span class="lineno"> 7300</span>&#160;      _body.get().setAutoAck(isAutoAckEnabled_);</div><div class="line"><a name="l07301"></a><span class="lineno"> 7301</span>&#160;    }</div><div class="line"><a name="l07306"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a19830e21dba1e4723a02a2c0e3615940"> 7306</a></span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="classAMPS_1_1Client.html#a19830e21dba1e4723a02a2c0e3615940">getAckBatchSize</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l07307"></a><span class="lineno"> 7307</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l07308"></a><span class="lineno"> 7308</span>&#160;      <span class="keywordflow">return</span> _body.get().getAckBatchSize();</div><div class="line"><a name="l07309"></a><span class="lineno"> 7309</span>&#160;    }</div><div class="line"><a name="l07316"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a3e96c9e776223e90d6c73f4b2d8a6dca"> 7316</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a3e96c9e776223e90d6c73f4b2d8a6dca">setAckBatchSize</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> ackBatchSize_)</div><div class="line"><a name="l07317"></a><span class="lineno"> 7317</span>&#160;    {</div><div class="line"><a name="l07318"></a><span class="lineno"> 7318</span>&#160;      _body.get().setAckBatchSize(ackBatchSize_);</div><div class="line"><a name="l07319"></a><span class="lineno"> 7319</span>&#160;    }</div><div class="line"><a name="l07320"></a><span class="lineno"> 7320</span>&#160;</div><div class="line"><a name="l07327"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a334e6e58d2614fc67d2b16f2d2dbb1e8"> 7327</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="classAMPS_1_1Client.html#a334e6e58d2614fc67d2b16f2d2dbb1e8">getAckTimeout</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l07328"></a><span class="lineno"> 7328</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l07329"></a><span class="lineno"> 7329</span>&#160;      <span class="keywordflow">return</span> _body.get().getAckTimeout();</div><div class="line"><a name="l07330"></a><span class="lineno"> 7330</span>&#160;    }</div><div class="line"><a name="l07339"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#ae057c12e3630bc78660313de0819d7ba"> 7339</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#ae057c12e3630bc78660313de0819d7ba">setAckTimeout</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> ackTimeout_)</div><div class="line"><a name="l07340"></a><span class="lineno"> 7340</span>&#160;    {</div><div class="line"><a name="l07341"></a><span class="lineno"> 7341</span>&#160;      <span class="keywordflow">if</span> (!ackTimeout_ &amp;&amp; _body.get().getAckBatchSize() &gt; 1)</div><div class="line"><a name="l07342"></a><span class="lineno"> 7342</span>&#160;      {</div><div class="line"><a name="l07343"></a><span class="lineno"> 7343</span>&#160;        <span class="keywordflow">throw</span> UsageException(<span class="stringliteral">&quot;Ack timeout must be &gt; 0 when ack batch size &gt; 1&quot;</span>);</div><div class="line"><a name="l07344"></a><span class="lineno"> 7344</span>&#160;      }</div><div class="line"><a name="l07345"></a><span class="lineno"> 7345</span>&#160;      _body.get().setAckTimeout(ackTimeout_);</div><div class="line"><a name="l07346"></a><span class="lineno"> 7346</span>&#160;    }</div><div class="line"><a name="l07347"></a><span class="lineno"> 7347</span>&#160;</div><div class="line"><a name="l07348"></a><span class="lineno"> 7348</span>&#160;</div><div class="line"><a name="l07357"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#ac134878c8dbb9b5674cd241af5d57617"> 7357</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#ac134878c8dbb9b5674cd241af5d57617">setRetryOnDisconnect</a>(<span class="keywordtype">bool</span> isRetryOnDisconnect_)</div><div class="line"><a name="l07358"></a><span class="lineno"> 7358</span>&#160;    {</div><div class="line"><a name="l07359"></a><span class="lineno"> 7359</span>&#160;      _body.get().setRetryOnDisconnect(isRetryOnDisconnect_);</div><div class="line"><a name="l07360"></a><span class="lineno"> 7360</span>&#160;    }</div><div class="line"><a name="l07361"></a><span class="lineno"> 7361</span>&#160;</div><div class="line"><a name="l07366"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a556de384cdf274287d68e70699a0221d"> 7366</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classAMPS_1_1Client.html#a556de384cdf274287d68e70699a0221d">getRetryOnDisconnect</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l07367"></a><span class="lineno"> 7367</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l07368"></a><span class="lineno"> 7368</span>&#160;      <span class="keywordflow">return</span> _body.get().getRetryOnDisconnect();</div><div class="line"><a name="l07369"></a><span class="lineno"> 7369</span>&#160;    }</div><div class="line"><a name="l07370"></a><span class="lineno"> 7370</span>&#160;</div><div class="line"><a name="l07375"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#a3a32d0543e745d4d30ca69bdfe32f111"> 7375</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#a3a32d0543e745d4d30ca69bdfe32f111">setDefaultMaxDepth</a>(<span class="keywordtype">unsigned</span> maxDepth_)</div><div class="line"><a name="l07376"></a><span class="lineno"> 7376</span>&#160;    {</div><div class="line"><a name="l07377"></a><span class="lineno"> 7377</span>&#160;      _body.get().setDefaultMaxDepth(maxDepth_);</div><div class="line"><a name="l07378"></a><span class="lineno"> 7378</span>&#160;    }</div><div class="line"><a name="l07379"></a><span class="lineno"> 7379</span>&#160;</div><div class="line"><a name="l07384"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#afb25c2b9fe3976913e5e9fd86ba24817"> 7384</a></span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="classAMPS_1_1Client.html#afb25c2b9fe3976913e5e9fd86ba24817">getDefaultMaxDepth</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l07385"></a><span class="lineno"> 7385</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l07386"></a><span class="lineno"> 7386</span>&#160;      <span class="keywordflow">return</span> _body.get().getDefaultMaxDepth();</div><div class="line"><a name="l07387"></a><span class="lineno"> 7387</span>&#160;    }</div><div class="line"><a name="l07388"></a><span class="lineno"> 7388</span>&#160;</div><div class="line"><a name="l07395"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#ac45274bb1363104da5330b9881348583"> 7395</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#ac45274bb1363104da5330b9881348583">setTransportFilterFunction</a>(<a class="code" href="amps_8h.html#ad41bd414e658417575019135a09acf55">amps_transport_filter_function</a> filter_,</div><div class="line"><a name="l07396"></a><span class="lineno"> 7396</span>&#160;                                    <span class="keywordtype">void</span>* userData_)</div><div class="line"><a name="l07397"></a><span class="lineno"> 7397</span>&#160;    {</div><div class="line"><a name="l07398"></a><span class="lineno"> 7398</span>&#160;      <span class="keywordflow">return</span> _body.get().setTransportFilterFunction(filter_, userData_);</div><div class="line"><a name="l07399"></a><span class="lineno"> 7399</span>&#160;    }</div><div class="line"><a name="l07400"></a><span class="lineno"> 7400</span>&#160;</div><div class="line"><a name="l07409"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#adcd285a6bbd72d8112083a5d47a7d626"> 7409</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1Client.html#adcd285a6bbd72d8112083a5d47a7d626">setThreadCreatedCallback</a>(<a class="code" href="amps_8h.html#a84547b45700e098324ea8d78641a6036">amps_thread_created_callback</a> callback_,</div><div class="line"><a name="l07410"></a><span class="lineno"> 7410</span>&#160;                                  <span class="keywordtype">void</span>* userData_)</div><div class="line"><a name="l07411"></a><span class="lineno"> 7411</span>&#160;    {</div><div class="line"><a name="l07412"></a><span class="lineno"> 7412</span>&#160;      <span class="keywordflow">return</span> _body.get().setThreadCreatedCallback(callback_, userData_);</div><div class="line"><a name="l07413"></a><span class="lineno"> 7413</span>&#160;    }</div><div class="line"><a name="l07414"></a><span class="lineno"> 7414</span>&#160;</div><div class="line"><a name="l07420"></a><span class="lineno"> 7420</span>&#160;    <span class="keywordtype">void</span> deferredExecution(DeferredExecutionFunc func_, <span class="keywordtype">void</span>* userData_)</div><div class="line"><a name="l07421"></a><span class="lineno"> 7421</span>&#160;    {</div><div class="line"><a name="l07422"></a><span class="lineno"> 7422</span>&#160;      _body.get().deferredExecution(func_, userData_);</div><div class="line"><a name="l07423"></a><span class="lineno"> 7423</span>&#160;    }</div><div class="line"><a name="l07427"></a><span class="lineno"> 7427</span>&#160;  };</div><div class="line"><a name="l07428"></a><span class="lineno"> 7428</span>&#160;</div><div class="line"><a name="l07429"></a><span class="lineno"> 7429</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span></div><div class="line"><a name="l07430"></a><span class="lineno"> 7430</span>&#160;  ClientImpl::lastChance(<a class="code" href="classAMPS_1_1Message.html">AMPS::Message</a>&amp; message)</div><div class="line"><a name="l07431"></a><span class="lineno"> 7431</span>&#160;  {</div><div class="line"><a name="l07432"></a><span class="lineno"> 7432</span>&#160;    AMPS_CALL_EXCEPTION_WRAPPER(_globalCommandTypeHandlers[GlobalCommandTypeHandlers::LastChance].invoke(message));</div><div class="line"><a name="l07433"></a><span class="lineno"> 7433</span>&#160;  }</div><div class="line"><a name="l07434"></a><span class="lineno"> 7434</span>&#160;</div><div class="line"><a name="l07435"></a><span class="lineno"> 7435</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">unsigned</span></div><div class="line"><a name="l07436"></a><span class="lineno"> 7436</span>&#160;  ClientImpl::persistedAck(<a class="code" href="classAMPS_1_1Message.html">AMPS::Message</a>&amp; message)</div><div class="line"><a name="l07437"></a><span class="lineno"> 7437</span>&#160;  {</div><div class="line"><a name="l07438"></a><span class="lineno"> 7438</span>&#160;    <span class="keywordtype">unsigned</span> deliveries = 0;</div><div class="line"><a name="l07439"></a><span class="lineno"> 7439</span>&#160;    <span class="keywordflow">try</span></div><div class="line"><a name="l07440"></a><span class="lineno"> 7440</span>&#160;    {</div><div class="line"><a name="l07441"></a><span class="lineno"> 7441</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l07442"></a><span class="lineno"> 7442</span>&#160;<span class="comment">      * Best Practice:  If you don&#39;t care about the dupe acks that</span></div><div class="line"><a name="l07443"></a><span class="lineno"> 7443</span>&#160;<span class="comment">      * occur during failover or rapid disconnect/reconnect, then just</span></div><div class="line"><a name="l07444"></a><span class="lineno"> 7444</span>&#160;<span class="comment">      * ignore them. We could discard each duplicate from the</span></div><div class="line"><a name="l07445"></a><span class="lineno"> 7445</span>&#160;<span class="comment">      * persisted store, but the storage costs of doing 1 record</span></div><div class="line"><a name="l07446"></a><span class="lineno"> 7446</span>&#160;<span class="comment">      * discards is heavy.  In most scenarios we&#39;ll just quickly blow</span></div><div class="line"><a name="l07447"></a><span class="lineno"> 7447</span>&#160;<span class="comment">      * through the duplicates and get back to processing the</span></div><div class="line"><a name="l07448"></a><span class="lineno"> 7448</span>&#160;<span class="comment">      * non-dupes.</span></div><div class="line"><a name="l07449"></a><span class="lineno"> 7449</span>&#160;<span class="comment">      */</span></div><div class="line"><a name="l07450"></a><span class="lineno"> 7450</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span>* data = NULL;</div><div class="line"><a name="l07451"></a><span class="lineno"> 7451</span>&#160;      <span class="keywordtype">size_t</span> len = 0;</div><div class="line"><a name="l07452"></a><span class="lineno"> 7452</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span>* status = NULL;</div><div class="line"><a name="l07453"></a><span class="lineno"> 7453</span>&#160;      <span class="keywordtype">size_t</span> statusLen = 0;</div><div class="line"><a name="l07454"></a><span class="lineno"> 7454</span>&#160;      <a class="code" href="amps_8h.html#acfa1278412265f3b4c421e77111ed2ce">amps_handle</a> messageHandle = message.getMessage();</div><div class="line"><a name="l07455"></a><span class="lineno"> 7455</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">size_t</span> NotEntitled = 12, Duplicate = 9, Failure = 7;</div><div class="line"><a name="l07456"></a><span class="lineno"> 7456</span>&#160;      <a class="code" href="amps_8h.html#a20b04b7c37343722d2336e9b091631da">amps_message_get_field_value</a>(messageHandle, AMPS_Reason, &amp;data, &amp;len);</div><div class="line"><a name="l07457"></a><span class="lineno"> 7457</span>&#160;      <a class="code" href="amps_8h.html#a20b04b7c37343722d2336e9b091631da">amps_message_get_field_value</a>(messageHandle, AMPS_Status, &amp;status, &amp;statusLen);</div><div class="line"><a name="l07458"></a><span class="lineno"> 7458</span>&#160;      <span class="keywordflow">if</span> (len == NotEntitled || len == Duplicate ||</div><div class="line"><a name="l07459"></a><span class="lineno"> 7459</span>&#160;          (statusLen == Failure &amp;&amp; status[0] == <span class="charliteral">&#39;f&#39;</span>))</div><div class="line"><a name="l07460"></a><span class="lineno"> 7460</span>&#160;      {</div><div class="line"><a name="l07461"></a><span class="lineno"> 7461</span>&#160;        <span class="keywordflow">if</span> (_failedWriteHandler)</div><div class="line"><a name="l07462"></a><span class="lineno"> 7462</span>&#160;        {</div><div class="line"><a name="l07463"></a><span class="lineno"> 7463</span>&#160;          <span class="keywordflow">if</span> (_publishStore.isValid())</div><div class="line"><a name="l07464"></a><span class="lineno"> 7464</span>&#160;          {</div><div class="line"><a name="l07465"></a><span class="lineno"> 7465</span>&#160;            amps_uint64_t sequence =</div><div class="line"><a name="l07466"></a><span class="lineno"> 7466</span>&#160;              <a class="code" href="amps_8h.html#a55949576a6ac830600d5e356308308c4">amps_message_get_field_uint64</a>(messageHandle, AMPS_Sequence);</div><div class="line"><a name="l07467"></a><span class="lineno"> 7467</span>&#160;            FailedWriteStoreReplayer replayer(<span class="keyword">this</span>, data, len);</div><div class="line"><a name="l07468"></a><span class="lineno"> 7468</span>&#160;            AMPS_CALL_EXCEPTION_WRAPPER(_publishStore.replaySingle(</div><div class="line"><a name="l07469"></a><span class="lineno"> 7469</span>&#160;                                          replayer, sequence));</div><div class="line"><a name="l07470"></a><span class="lineno"> 7470</span>&#160;          }</div><div class="line"><a name="l07471"></a><span class="lineno"> 7471</span>&#160;          <span class="keywordflow">else</span> <span class="comment">// Call the handler with what little we have</span></div><div class="line"><a name="l07472"></a><span class="lineno"> 7472</span>&#160;          {</div><div class="line"><a name="l07473"></a><span class="lineno"> 7473</span>&#160;            <span class="keyword">static</span> <a class="code" href="classAMPS_1_1Message.html">Message</a> emptyMessage;</div><div class="line"><a name="l07474"></a><span class="lineno"> 7474</span>&#160;            emptyMessage.<a class="code" href="classAMPS_1_1Message.html#a6a226fb422c3baf9b5304b292e7cd950">setSequence</a>(message.<a class="code" href="classAMPS_1_1Message.html#aa64c3738555b31e41034e5fec812851e">getSequence</a>());</div><div class="line"><a name="l07475"></a><span class="lineno"> 7475</span>&#160;            AMPS_CALL_EXCEPTION_WRAPPER(</div><div class="line"><a name="l07476"></a><span class="lineno"> 7476</span>&#160;              _failedWriteHandler-&gt;failedWrite(emptyMessage,</div><div class="line"><a name="l07477"></a><span class="lineno"> 7477</span>&#160;                                               data, len));</div><div class="line"><a name="l07478"></a><span class="lineno"> 7478</span>&#160;          }</div><div class="line"><a name="l07479"></a><span class="lineno"> 7479</span>&#160;          ++deliveries;</div><div class="line"><a name="l07480"></a><span class="lineno"> 7480</span>&#160;        }</div><div class="line"><a name="l07481"></a><span class="lineno"> 7481</span>&#160;      }</div><div class="line"><a name="l07482"></a><span class="lineno"> 7482</span>&#160;      <span class="keywordflow">if</span> (_publishStore.isValid())</div><div class="line"><a name="l07483"></a><span class="lineno"> 7483</span>&#160;      {</div><div class="line"><a name="l07484"></a><span class="lineno"> 7484</span>&#160;        <span class="comment">// Ack for publisher will have sequence while</span></div><div class="line"><a name="l07485"></a><span class="lineno"> 7485</span>&#160;        <span class="comment">// ack for bookmark subscribe won&#39;t</span></div><div class="line"><a name="l07486"></a><span class="lineno"> 7486</span>&#160;        amps_uint64_t seq = <a class="code" href="amps_8h.html#a55949576a6ac830600d5e356308308c4">amps_message_get_field_uint64</a>(messageHandle,</div><div class="line"><a name="l07487"></a><span class="lineno"> 7487</span>&#160;                                                          AMPS_Sequence);</div><div class="line"><a name="l07488"></a><span class="lineno"> 7488</span>&#160;        <span class="keywordflow">if</span> (seq &gt; 0)</div><div class="line"><a name="l07489"></a><span class="lineno"> 7489</span>&#160;        {</div><div class="line"><a name="l07490"></a><span class="lineno"> 7490</span>&#160;          ++deliveries;</div><div class="line"><a name="l07491"></a><span class="lineno"> 7491</span>&#160;          AMPS_CALL_EXCEPTION_WRAPPER(_publishStore.discardUpTo(seq));</div><div class="line"><a name="l07492"></a><span class="lineno"> 7492</span>&#160;        }</div><div class="line"><a name="l07493"></a><span class="lineno"> 7493</span>&#160;      }</div><div class="line"><a name="l07494"></a><span class="lineno"> 7494</span>&#160;</div><div class="line"><a name="l07495"></a><span class="lineno"> 7495</span>&#160;      <span class="keywordflow">if</span> (!deliveries &amp;&amp; _bookmarkStore.isValid())</div><div class="line"><a name="l07496"></a><span class="lineno"> 7496</span>&#160;      {</div><div class="line"><a name="l07497"></a><span class="lineno"> 7497</span>&#160;        <a class="code" href="amps_8h.html#a20b04b7c37343722d2336e9b091631da">amps_message_get_field_value</a>(messageHandle, AMPS_SubscriptionId,</div><div class="line"><a name="l07498"></a><span class="lineno"> 7498</span>&#160;                                     &amp;data, &amp;len);</div><div class="line"><a name="l07499"></a><span class="lineno"> 7499</span>&#160;        <span class="keywordflow">if</span> (len &gt; 0)</div><div class="line"><a name="l07500"></a><span class="lineno"> 7500</span>&#160;        {</div><div class="line"><a name="l07501"></a><span class="lineno"> 7501</span>&#160;          <a class="code" href="classAMPS_1_1Field.html">Message::Field</a> subId(data, len);</div><div class="line"><a name="l07502"></a><span class="lineno"> 7502</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">char</span>* bookmarkData = NULL;</div><div class="line"><a name="l07503"></a><span class="lineno"> 7503</span>&#160;          <span class="keywordtype">size_t</span> bookmarkLen = 0;</div><div class="line"><a name="l07504"></a><span class="lineno"> 7504</span>&#160;          <a class="code" href="amps_8h.html#a20b04b7c37343722d2336e9b091631da">amps_message_get_field_value</a>(messageHandle,</div><div class="line"><a name="l07505"></a><span class="lineno"> 7505</span>&#160;                                       AMPS_Bookmark,</div><div class="line"><a name="l07506"></a><span class="lineno"> 7506</span>&#160;                                       &amp;bookmarkData,</div><div class="line"><a name="l07507"></a><span class="lineno"> 7507</span>&#160;                                       &amp;bookmarkLen);</div><div class="line"><a name="l07508"></a><span class="lineno"> 7508</span>&#160;          <span class="comment">// Everything is there and not unsubscribed AC-912</span></div><div class="line"><a name="l07509"></a><span class="lineno"> 7509</span>&#160;          <span class="keywordflow">if</span> (bookmarkLen &gt; 0 &amp;&amp; _routes.hasRoute(subId))</div><div class="line"><a name="l07510"></a><span class="lineno"> 7510</span>&#160;          {</div><div class="line"><a name="l07511"></a><span class="lineno"> 7511</span>&#160;            ++deliveries;</div><div class="line"><a name="l07512"></a><span class="lineno"> 7512</span>&#160;            _bookmarkStore.persisted(subId, <a class="code" href="classAMPS_1_1Field.html">Message::Field</a>(bookmarkData, bookmarkLen));</div><div class="line"><a name="l07513"></a><span class="lineno"> 7513</span>&#160;          }</div><div class="line"><a name="l07514"></a><span class="lineno"> 7514</span>&#160;        }</div><div class="line"><a name="l07515"></a><span class="lineno"> 7515</span>&#160;      }</div><div class="line"><a name="l07516"></a><span class="lineno"> 7516</span>&#160;    }</div><div class="line"><a name="l07517"></a><span class="lineno"> 7517</span>&#160;    <span class="keywordflow">catch</span> (std::exception&amp; ex)</div><div class="line"><a name="l07518"></a><span class="lineno"> 7518</span>&#160;    {</div><div class="line"><a name="l07519"></a><span class="lineno"> 7519</span>&#160;      AMPS_UNHANDLED_EXCEPTION(ex);</div><div class="line"><a name="l07520"></a><span class="lineno"> 7520</span>&#160;    }</div><div class="line"><a name="l07521"></a><span class="lineno"> 7521</span>&#160;    <span class="keywordflow">return</span> deliveries;</div><div class="line"><a name="l07522"></a><span class="lineno"> 7522</span>&#160;  }</div><div class="line"><a name="l07523"></a><span class="lineno"> 7523</span>&#160;</div><div class="line"><a name="l07524"></a><span class="lineno"> 7524</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">unsigned</span></div><div class="line"><a name="l07525"></a><span class="lineno"> 7525</span>&#160;  ClientImpl::processedAck(<a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message)</div><div class="line"><a name="l07526"></a><span class="lineno"> 7526</span>&#160;  {</div><div class="line"><a name="l07527"></a><span class="lineno"> 7527</span>&#160;    <span class="keywordtype">unsigned</span> deliveries = 0;</div><div class="line"><a name="l07528"></a><span class="lineno"> 7528</span>&#160;    AckResponse ack;</div><div class="line"><a name="l07529"></a><span class="lineno"> 7529</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* data = NULL;</div><div class="line"><a name="l07530"></a><span class="lineno"> 7530</span>&#160;    <span class="keywordtype">size_t</span> len = 0;</div><div class="line"><a name="l07531"></a><span class="lineno"> 7531</span>&#160;    <a class="code" href="amps_8h.html#acfa1278412265f3b4c421e77111ed2ce">amps_handle</a> messageHandle = message.getMessage();</div><div class="line"><a name="l07532"></a><span class="lineno"> 7532</span>&#160;    <a class="code" href="amps_8h.html#a20b04b7c37343722d2336e9b091631da">amps_message_get_field_value</a>(messageHandle, AMPS_CommandId, &amp;data, &amp;len);</div><div class="line"><a name="l07533"></a><span class="lineno"> 7533</span>&#160;    Lock&lt;Mutex&gt; l(_lock);</div><div class="line"><a name="l07534"></a><span class="lineno"> 7534</span>&#160;    <span class="keywordflow">if</span> (data &amp;&amp; len)</div><div class="line"><a name="l07535"></a><span class="lineno"> 7535</span>&#160;    {</div><div class="line"><a name="l07536"></a><span class="lineno"> 7536</span>&#160;      Lock&lt;Mutex&gt; guard(_ackMapLock);</div><div class="line"><a name="l07537"></a><span class="lineno"> 7537</span>&#160;      AckMap::iterator i = _ackMap.find(std::string(data, len));</div><div class="line"><a name="l07538"></a><span class="lineno"> 7538</span>&#160;      <span class="keywordflow">if</span> (i != _ackMap.end())</div><div class="line"><a name="l07539"></a><span class="lineno"> 7539</span>&#160;      {</div><div class="line"><a name="l07540"></a><span class="lineno"> 7540</span>&#160;        ++deliveries;</div><div class="line"><a name="l07541"></a><span class="lineno"> 7541</span>&#160;        ack = i-&gt;second;</div><div class="line"><a name="l07542"></a><span class="lineno"> 7542</span>&#160;        _ackMap.erase(i);</div><div class="line"><a name="l07543"></a><span class="lineno"> 7543</span>&#160;      }</div><div class="line"><a name="l07544"></a><span class="lineno"> 7544</span>&#160;    }</div><div class="line"><a name="l07545"></a><span class="lineno"> 7545</span>&#160;    <span class="keywordflow">if</span> (deliveries)</div><div class="line"><a name="l07546"></a><span class="lineno"> 7546</span>&#160;    {</div><div class="line"><a name="l07547"></a><span class="lineno"> 7547</span>&#160;      <a class="code" href="amps_8h.html#a20b04b7c37343722d2336e9b091631da">amps_message_get_field_value</a>(messageHandle, AMPS_Status, &amp;data, &amp;len);</div><div class="line"><a name="l07548"></a><span class="lineno"> 7548</span>&#160;      ack.setStatus(data, len);</div><div class="line"><a name="l07549"></a><span class="lineno"> 7549</span>&#160;      <a class="code" href="amps_8h.html#a20b04b7c37343722d2336e9b091631da">amps_message_get_field_value</a>(messageHandle, AMPS_Reason, &amp;data, &amp;len);</div><div class="line"><a name="l07550"></a><span class="lineno"> 7550</span>&#160;      ack.setReason(data, len);</div><div class="line"><a name="l07551"></a><span class="lineno"> 7551</span>&#160;      <a class="code" href="amps_8h.html#a20b04b7c37343722d2336e9b091631da">amps_message_get_field_value</a>(messageHandle, AMPS_UserId, &amp;data, &amp;len);</div><div class="line"><a name="l07552"></a><span class="lineno"> 7552</span>&#160;      ack.setUsername(data, len);</div><div class="line"><a name="l07553"></a><span class="lineno"> 7553</span>&#160;      <a class="code" href="amps_8h.html#a20b04b7c37343722d2336e9b091631da">amps_message_get_field_value</a>(messageHandle, AMPS_Password, &amp;data, &amp;len);</div><div class="line"><a name="l07554"></a><span class="lineno"> 7554</span>&#160;      ack.setPassword(data, len);</div><div class="line"><a name="l07555"></a><span class="lineno"> 7555</span>&#160;      <a class="code" href="amps_8h.html#a20b04b7c37343722d2336e9b091631da">amps_message_get_field_value</a>(messageHandle, AMPS_Version, &amp;data, &amp;len);</div><div class="line"><a name="l07556"></a><span class="lineno"> 7556</span>&#160;      ack.setServerVersion(data, len);</div><div class="line"><a name="l07557"></a><span class="lineno"> 7557</span>&#160;      <a class="code" href="amps_8h.html#a20b04b7c37343722d2336e9b091631da">amps_message_get_field_value</a>(messageHandle, AMPS_Options, &amp;data, &amp;len);</div><div class="line"><a name="l07558"></a><span class="lineno"> 7558</span>&#160;      ack.setOptions(data, len);</div><div class="line"><a name="l07559"></a><span class="lineno"> 7559</span>&#160;      <span class="comment">// This sets bookmark, nameHashValue, and sequenceNo</span></div><div class="line"><a name="l07560"></a><span class="lineno"> 7560</span>&#160;      ack.setBookmark(message.<a class="code" href="classAMPS_1_1Message.html#a7108ef0b54bc76e43dc4d49d700dc8ef">getBookmark</a>());</div><div class="line"><a name="l07561"></a><span class="lineno"> 7561</span>&#160;      ack.setResponded();</div><div class="line"><a name="l07562"></a><span class="lineno"> 7562</span>&#160;      _lock.signalAll();</div><div class="line"><a name="l07563"></a><span class="lineno"> 7563</span>&#160;    }</div><div class="line"><a name="l07564"></a><span class="lineno"> 7564</span>&#160;    <span class="keywordflow">return</span> deliveries;</div><div class="line"><a name="l07565"></a><span class="lineno"> 7565</span>&#160;  }</div><div class="line"><a name="l07566"></a><span class="lineno"> 7566</span>&#160;</div><div class="line"><a name="l07567"></a><span class="lineno"> 7567</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span></div><div class="line"><a name="l07568"></a><span class="lineno"> 7568</span>&#160;  ClientImpl::checkAndSendHeartbeat(<span class="keywordtype">bool</span> force)</div><div class="line"><a name="l07569"></a><span class="lineno"> 7569</span>&#160;  {</div><div class="line"><a name="l07570"></a><span class="lineno"> 7570</span>&#160;    <span class="keywordflow">if</span> (force || _heartbeatTimer.check())</div><div class="line"><a name="l07571"></a><span class="lineno"> 7571</span>&#160;    {</div><div class="line"><a name="l07572"></a><span class="lineno"> 7572</span>&#160;      _heartbeatTimer.start();</div><div class="line"><a name="l07573"></a><span class="lineno"> 7573</span>&#160;      <span class="keywordflow">try</span></div><div class="line"><a name="l07574"></a><span class="lineno"> 7574</span>&#160;      {</div><div class="line"><a name="l07575"></a><span class="lineno"> 7575</span>&#160;        sendWithoutRetry(_beatMessage);</div><div class="line"><a name="l07576"></a><span class="lineno"> 7576</span>&#160;      }</div><div class="line"><a name="l07577"></a><span class="lineno"> 7577</span>&#160;      <span class="keywordflow">catch</span> (<span class="keyword">const</span> AMPSException&amp;)</div><div class="line"><a name="l07578"></a><span class="lineno"> 7578</span>&#160;      {</div><div class="line"><a name="l07579"></a><span class="lineno"> 7579</span>&#160;        ;</div><div class="line"><a name="l07580"></a><span class="lineno"> 7580</span>&#160;      }</div><div class="line"><a name="l07581"></a><span class="lineno"> 7581</span>&#160;    }</div><div class="line"><a name="l07582"></a><span class="lineno"> 7582</span>&#160;  }</div><div class="line"><a name="l07583"></a><span class="lineno"> 7583</span>&#160;</div><div class="line"><a name="l07584"></a><span class="lineno"> 7584</span>&#160;  <span class="keyword">inline</span> ConnectionInfo ClientImpl::getConnectionInfo()<span class="keyword"> const</span></div><div class="line"><a name="l07585"></a><span class="lineno"> 7585</span>&#160;<span class="keyword">  </span>{</div><div class="line"><a name="l07586"></a><span class="lineno"> 7586</span>&#160;    ConnectionInfo info;</div><div class="line"><a name="l07587"></a><span class="lineno"> 7587</span>&#160;    std::ostringstream writer;</div><div class="line"><a name="l07588"></a><span class="lineno"> 7588</span>&#160;</div><div class="line"><a name="l07589"></a><span class="lineno"> 7589</span>&#160;    info[<span class="stringliteral">&quot;client.uri&quot;</span>] = _lastUri;</div><div class="line"><a name="l07590"></a><span class="lineno"> 7590</span>&#160;    info[<span class="stringliteral">&quot;client.name&quot;</span>] = _name;</div><div class="line"><a name="l07591"></a><span class="lineno"> 7591</span>&#160;    info[<span class="stringliteral">&quot;client.username&quot;</span>] = _username;</div><div class="line"><a name="l07592"></a><span class="lineno"> 7592</span>&#160;    <span class="keywordflow">if</span> (_publishStore.isValid())</div><div class="line"><a name="l07593"></a><span class="lineno"> 7593</span>&#160;    {</div><div class="line"><a name="l07594"></a><span class="lineno"> 7594</span>&#160;      writer &lt;&lt; _publishStore.unpersistedCount();</div><div class="line"><a name="l07595"></a><span class="lineno"> 7595</span>&#160;      info[<span class="stringliteral">&quot;publishStore.unpersistedCount&quot;</span>] = writer.str();</div><div class="line"><a name="l07596"></a><span class="lineno"> 7596</span>&#160;      writer.clear();</div><div class="line"><a name="l07597"></a><span class="lineno"> 7597</span>&#160;      writer.str(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l07598"></a><span class="lineno"> 7598</span>&#160;    }</div><div class="line"><a name="l07599"></a><span class="lineno"> 7599</span>&#160;</div><div class="line"><a name="l07600"></a><span class="lineno"> 7600</span>&#160;    <span class="keywordflow">return</span> info;</div><div class="line"><a name="l07601"></a><span class="lineno"> 7601</span>&#160;  }</div><div class="line"><a name="l07602"></a><span class="lineno"> 7602</span>&#160;</div><div class="line"><a name="l07603"></a><span class="lineno"> 7603</span>&#160;  <span class="keyword">inline</span> <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04">amps_result</a></div><div class="line"><a name="l07604"></a><span class="lineno"> 7604</span>&#160;  ClientImpl::ClientImplMessageHandler(<a class="code" href="amps_8h.html#acfa1278412265f3b4c421e77111ed2ce">amps_handle</a> messageHandle_, <span class="keywordtype">void</span>* userData_)</div><div class="line"><a name="l07605"></a><span class="lineno"> 7605</span>&#160;  {</div><div class="line"><a name="l07606"></a><span class="lineno"> 7606</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> SOWMask = Message::Command::SOW | Message::Command::GroupBegin | Message::Command::GroupEnd;</div><div class="line"><a name="l07607"></a><span class="lineno"> 7607</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> PublishMask = Message::Command::OOF | Message::Command::Publish | Message::Command::DeltaPublish;</div><div class="line"><a name="l07608"></a><span class="lineno"> 7608</span>&#160;    ClientImpl* me = (ClientImpl*) userData_;</div><div class="line"><a name="l07609"></a><span class="lineno"> 7609</span>&#160;    AMPS_CALL_EXCEPTION_WRAPPER_2(me, me-&gt;processDeferredExecutions());</div><div class="line"><a name="l07610"></a><span class="lineno"> 7610</span>&#160;    <span class="keywordflow">if</span> (!messageHandle_)</div><div class="line"><a name="l07611"></a><span class="lineno"> 7611</span>&#160;    {</div><div class="line"><a name="l07612"></a><span class="lineno"> 7612</span>&#160;      <span class="keywordflow">if</span> (me-&gt;_queueAckTimeout)</div><div class="line"><a name="l07613"></a><span class="lineno"> 7613</span>&#160;      {</div><div class="line"><a name="l07614"></a><span class="lineno"> 7614</span>&#160;        me-&gt;checkQueueAcks();</div><div class="line"><a name="l07615"></a><span class="lineno"> 7615</span>&#160;      }</div><div class="line"><a name="l07616"></a><span class="lineno"> 7616</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a>;</div><div class="line"><a name="l07617"></a><span class="lineno"> 7617</span>&#160;    }</div><div class="line"><a name="l07618"></a><span class="lineno"> 7618</span>&#160;</div><div class="line"><a name="l07619"></a><span class="lineno"> 7619</span>&#160;    me-&gt;_readMessage.replace(messageHandle_);</div><div class="line"><a name="l07620"></a><span class="lineno"> 7620</span>&#160;    <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message = me-&gt;_readMessage;</div><div class="line"><a name="l07621"></a><span class="lineno"> 7621</span>&#160;    Message::Command::Type commandType = message.<a class="code" href="classAMPS_1_1Message.html#a3e9f467321699a813340e57d4161f3e6">getCommandEnum</a>();</div><div class="line"><a name="l07622"></a><span class="lineno"> 7622</span>&#160;    <span class="keywordflow">if</span> (commandType &amp; SOWMask)</div><div class="line"><a name="l07623"></a><span class="lineno"> 7623</span>&#160;    {</div><div class="line"><a name="l07624"></a><span class="lineno"> 7624</span>&#160;<span class="preprocessor">#if 0 // Not currently implemented, to avoid an extra branch in delivery</span></div><div class="line"><a name="l07625"></a><span class="lineno"> 7625</span>&#160;      <span class="comment">// A small cheat here to get the right handler, using knowledge of the</span></div><div class="line"><a name="l07626"></a><span class="lineno"> 7626</span>&#160;      <span class="comment">// Command values of SOW (8), GroupBegin (8192), and GroupEnd (16384)</span></div><div class="line"><a name="l07627"></a><span class="lineno"> 7627</span>&#160;      <span class="comment">// and their GlobalCommandTypeHandlers values 1, 2, 3.</span></div><div class="line"><a name="l07628"></a><span class="lineno"> 7628</span>&#160;      AMPS_CALL_EXCEPTION_WRAPPER_2(me,</div><div class="line"><a name="l07629"></a><span class="lineno"> 7629</span>&#160;                                    me-&gt;_globalCommandTypeHandlers[1 + (commandType / 8192)].invoke(message));</div><div class="line"><a name="l07630"></a><span class="lineno"> 7630</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l07631"></a><span class="lineno"> 7631</span>&#160;      AMPS_CALL_EXCEPTION_WRAPPER_2(me, me-&gt;_routes.deliverData(message,</div><div class="line"><a name="l07632"></a><span class="lineno"> 7632</span>&#160;                                                                message.<a class="code" href="classAMPS_1_1Message.html#a636338403d40c748af5a33f931293f41">getQueryID</a>()));</div><div class="line"><a name="l07633"></a><span class="lineno"> 7633</span>&#160;    }</div><div class="line"><a name="l07634"></a><span class="lineno"> 7634</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (commandType &amp; PublishMask)</div><div class="line"><a name="l07635"></a><span class="lineno"> 7635</span>&#160;    {</div><div class="line"><a name="l07636"></a><span class="lineno"> 7636</span>&#160;<span class="preprocessor">#if 0 // Not currently implemented, to avoid an extra branch in delivery</span></div><div class="line"><a name="l07637"></a><span class="lineno"> 7637</span>&#160;      AMPS_CALL_EXCEPTION_WRAPPER_2(me,</div><div class="line"><a name="l07638"></a><span class="lineno"> 7638</span>&#160;                                    me-&gt;_globalCommandTypeHandlers[(commandType == Message::Command::Publish ?</div><div class="line"><a name="l07639"></a><span class="lineno"> 7639</span>&#160;                                                                    GlobalCommandTypeHandlers::Publish :</div><div class="line"><a name="l07640"></a><span class="lineno"> 7640</span>&#160;                                                                    GlobalCommandTypeHandlers::OOF)].invoke(message));</div><div class="line"><a name="l07641"></a><span class="lineno"> 7641</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l07642"></a><span class="lineno"> 7642</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span>* subIds = NULL;</div><div class="line"><a name="l07643"></a><span class="lineno"> 7643</span>&#160;      <span class="keywordtype">size_t</span> subIdsLen = 0;</div><div class="line"><a name="l07644"></a><span class="lineno"> 7644</span>&#160;      <span class="comment">// Publish command, send to subscriptions</span></div><div class="line"><a name="l07645"></a><span class="lineno"> 7645</span>&#160;      <a class="code" href="amps_8h.html#a20b04b7c37343722d2336e9b091631da">amps_message_get_field_value</a>(messageHandle_, AMPS_SubscriptionIds,</div><div class="line"><a name="l07646"></a><span class="lineno"> 7646</span>&#160;                                   &amp;subIds, &amp;subIdsLen);</div><div class="line"><a name="l07647"></a><span class="lineno"> 7647</span>&#160;      <span class="keywordtype">size_t</span> subIdCount = me-&gt;_routes.parseRoutes(<a class="code" href="classAMPS_1_1Field.html">AMPS::Field</a>(subIds, subIdsLen), me-&gt;_routeCache);</div><div class="line"><a name="l07648"></a><span class="lineno"> 7648</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; subIdCount; ++i)</div><div class="line"><a name="l07649"></a><span class="lineno"> 7649</span>&#160;      {</div><div class="line"><a name="l07650"></a><span class="lineno"> 7650</span>&#160;        MessageRouter::RouteCache::value_type&amp; lookupResult = me-&gt;_routeCache[i];</div><div class="line"><a name="l07651"></a><span class="lineno"> 7651</span>&#160;        <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; handler = lookupResult.handler;</div><div class="line"><a name="l07652"></a><span class="lineno"> 7652</span>&#160;        <span class="keywordflow">if</span> (handler.isValid())</div><div class="line"><a name="l07653"></a><span class="lineno"> 7653</span>&#160;        {</div><div class="line"><a name="l07654"></a><span class="lineno"> 7654</span>&#160;          <a class="code" href="amps_8h.html#aacc8e69a64c3f57a0905ff8de7ddee6d">amps_message_set_field_value</a>(messageHandle_,</div><div class="line"><a name="l07655"></a><span class="lineno"> 7655</span>&#160;                                       AMPS_SubscriptionId,</div><div class="line"><a name="l07656"></a><span class="lineno"> 7656</span>&#160;                                       subIds + lookupResult.idOffset,</div><div class="line"><a name="l07657"></a><span class="lineno"> 7657</span>&#160;                                       lookupResult.idLength);</div><div class="line"><a name="l07658"></a><span class="lineno"> 7658</span>&#160;          <a class="code" href="classAMPS_1_1Field.html">Message::Field</a> bookmark = message.<a class="code" href="classAMPS_1_1Message.html#a7108ef0b54bc76e43dc4d49d700dc8ef">getBookmark</a>();</div><div class="line"><a name="l07659"></a><span class="lineno"> 7659</span>&#160;          <span class="keywordtype">bool</span> isMessageQueue = message.<a class="code" href="classAMPS_1_1Message.html#a7e6907cf19cb214f8c4bd02e236e01fb">getLeasePeriod</a>().<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>() != 0;</div><div class="line"><a name="l07660"></a><span class="lineno"> 7660</span>&#160;          <span class="keywordtype">bool</span> isAutoAck = me-&gt;_isAutoAckEnabled;</div><div class="line"><a name="l07661"></a><span class="lineno"> 7661</span>&#160;</div><div class="line"><a name="l07662"></a><span class="lineno"> 7662</span>&#160;          <span class="keywordflow">if</span> (!isMessageQueue &amp;&amp; !bookmark.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>() &amp;&amp;</div><div class="line"><a name="l07663"></a><span class="lineno"> 7663</span>&#160;              me-&gt;_bookmarkStore.isValid())</div><div class="line"><a name="l07664"></a><span class="lineno"> 7664</span>&#160;          {</div><div class="line"><a name="l07665"></a><span class="lineno"> 7665</span>&#160;            <span class="keywordflow">if</span> (me-&gt;_bookmarkStore.isDiscarded(me-&gt;_readMessage))</div><div class="line"><a name="l07666"></a><span class="lineno"> 7666</span>&#160;            {</div><div class="line"><a name="l07667"></a><span class="lineno"> 7667</span>&#160;              <span class="comment">//Call duplicate message handler in handlers map</span></div><div class="line"><a name="l07668"></a><span class="lineno"> 7668</span>&#160;              <span class="keywordflow">if</span> (me-&gt;_globalCommandTypeHandlers[GlobalCommandTypeHandlers::DuplicateMessage].isValid())</div><div class="line"><a name="l07669"></a><span class="lineno"> 7669</span>&#160;              {</div><div class="line"><a name="l07670"></a><span class="lineno"> 7670</span>&#160;                AMPS_CALL_EXCEPTION_WRAPPER_2(me, me-&gt;_globalCommandTypeHandlers[GlobalCommandTypeHandlers::DuplicateMessage].invoke(message));</div><div class="line"><a name="l07671"></a><span class="lineno"> 7671</span>&#160;              }</div><div class="line"><a name="l07672"></a><span class="lineno"> 7672</span>&#160;            }</div><div class="line"><a name="l07673"></a><span class="lineno"> 7673</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l07674"></a><span class="lineno"> 7674</span>&#160;            {</div><div class="line"><a name="l07675"></a><span class="lineno"> 7675</span>&#160;              me-&gt;_bookmarkStore.log(me-&gt;_readMessage);</div><div class="line"><a name="l07676"></a><span class="lineno"> 7676</span>&#160;              AMPS_CALL_EXCEPTION_WRAPPER_2(me,</div><div class="line"><a name="l07677"></a><span class="lineno"> 7677</span>&#160;                                            handler.invoke(message));</div><div class="line"><a name="l07678"></a><span class="lineno"> 7678</span>&#160;            }</div><div class="line"><a name="l07679"></a><span class="lineno"> 7679</span>&#160;          }</div><div class="line"><a name="l07680"></a><span class="lineno"> 7680</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l07681"></a><span class="lineno"> 7681</span>&#160;          {</div><div class="line"><a name="l07682"></a><span class="lineno"> 7682</span>&#160;            <span class="keywordflow">if</span> (isMessageQueue &amp;&amp; isAutoAck)</div><div class="line"><a name="l07683"></a><span class="lineno"> 7683</span>&#160;            {</div><div class="line"><a name="l07684"></a><span class="lineno"> 7684</span>&#160;              <span class="keywordflow">try</span></div><div class="line"><a name="l07685"></a><span class="lineno"> 7685</span>&#160;              {</div><div class="line"><a name="l07686"></a><span class="lineno"> 7686</span>&#160;                AMPS_CALL_EXCEPTION_WRAPPER_STREAM_FULL_2(me, handler.invoke(message));</div><div class="line"><a name="l07687"></a><span class="lineno"> 7687</span>&#160;                <span class="keywordflow">if</span> (!message.getIgnoreAutoAck())</div><div class="line"><a name="l07688"></a><span class="lineno"> 7688</span>&#160;                {</div><div class="line"><a name="l07689"></a><span class="lineno"> 7689</span>&#160;                  AMPS_CALL_EXCEPTION_WRAPPER_2(me,</div><div class="line"><a name="l07690"></a><span class="lineno"> 7690</span>&#160;                                                me-&gt;_ack(message.<a class="code" href="classAMPS_1_1Message.html#afdc3e09761f4076f3ee18e99cf254e97">getTopic</a>(), message.<a class="code" href="classAMPS_1_1Message.html#a7108ef0b54bc76e43dc4d49d700dc8ef">getBookmark</a>()));</div><div class="line"><a name="l07691"></a><span class="lineno"> 7691</span>&#160;                }</div><div class="line"><a name="l07692"></a><span class="lineno"> 7692</span>&#160;              }</div><div class="line"><a name="l07693"></a><span class="lineno"> 7693</span>&#160;              <span class="keywordflow">catch</span> (std::exception&amp; ex)</div><div class="line"><a name="l07694"></a><span class="lineno"> 7694</span>&#160;              {</div><div class="line"><a name="l07695"></a><span class="lineno"> 7695</span>&#160;                <span class="keywordflow">if</span> (!message.getIgnoreAutoAck())</div><div class="line"><a name="l07696"></a><span class="lineno"> 7696</span>&#160;                {</div><div class="line"><a name="l07697"></a><span class="lineno"> 7697</span>&#160;                  AMPS_CALL_EXCEPTION_WRAPPER_2(me,</div><div class="line"><a name="l07698"></a><span class="lineno"> 7698</span>&#160;                                                me-&gt;_ack(message.<a class="code" href="classAMPS_1_1Message.html#afdc3e09761f4076f3ee18e99cf254e97">getTopic</a>(), message.<a class="code" href="classAMPS_1_1Message.html#a7108ef0b54bc76e43dc4d49d700dc8ef">getBookmark</a>(), <span class="stringliteral">&quot;cancel&quot;</span>));</div><div class="line"><a name="l07699"></a><span class="lineno"> 7699</span>&#160;                }</div><div class="line"><a name="l07700"></a><span class="lineno"> 7700</span>&#160;                AMPS_UNHANDLED_EXCEPTION_2(me, ex);</div><div class="line"><a name="l07701"></a><span class="lineno"> 7701</span>&#160;              }</div><div class="line"><a name="l07702"></a><span class="lineno"> 7702</span>&#160;            }</div><div class="line"><a name="l07703"></a><span class="lineno"> 7703</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l07704"></a><span class="lineno"> 7704</span>&#160;            {</div><div class="line"><a name="l07705"></a><span class="lineno"> 7705</span>&#160;              AMPS_CALL_EXCEPTION_WRAPPER_2(me,</div><div class="line"><a name="l07706"></a><span class="lineno"> 7706</span>&#160;                                            handler.invoke(message));</div><div class="line"><a name="l07707"></a><span class="lineno"> 7707</span>&#160;            }</div><div class="line"><a name="l07708"></a><span class="lineno"> 7708</span>&#160;          }</div><div class="line"><a name="l07709"></a><span class="lineno"> 7709</span>&#160;        }</div><div class="line"><a name="l07710"></a><span class="lineno"> 7710</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l07711"></a><span class="lineno"> 7711</span>&#160;        {</div><div class="line"><a name="l07712"></a><span class="lineno"> 7712</span>&#160;          me-&gt;lastChance(message);</div><div class="line"><a name="l07713"></a><span class="lineno"> 7713</span>&#160;        }</div><div class="line"><a name="l07714"></a><span class="lineno"> 7714</span>&#160;      } <span class="comment">// for (subidsEnd)</span></div><div class="line"><a name="l07715"></a><span class="lineno"> 7715</span>&#160;    }</div><div class="line"><a name="l07716"></a><span class="lineno"> 7716</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (commandType == Message::Command::Ack)</div><div class="line"><a name="l07717"></a><span class="lineno"> 7717</span>&#160;    {</div><div class="line"><a name="l07718"></a><span class="lineno"> 7718</span>&#160;      AMPS_CALL_EXCEPTION_WRAPPER_2(me,</div><div class="line"><a name="l07719"></a><span class="lineno"> 7719</span>&#160;                                    me-&gt;_globalCommandTypeHandlers[GlobalCommandTypeHandlers::Ack].invoke(message));</div><div class="line"><a name="l07720"></a><span class="lineno"> 7720</span>&#160;      <span class="keywordtype">unsigned</span> ackType = message.<a class="code" href="classAMPS_1_1Message.html#a7d58a2c39f59d6fca098efd4bb81d3b5">getAckTypeEnum</a>();</div><div class="line"><a name="l07721"></a><span class="lineno"> 7721</span>&#160;      <span class="keywordtype">unsigned</span> deliveries = 0U;</div><div class="line"><a name="l07722"></a><span class="lineno"> 7722</span>&#160;      <span class="keywordflow">switch</span> (ackType)</div><div class="line"><a name="l07723"></a><span class="lineno"> 7723</span>&#160;      {</div><div class="line"><a name="l07724"></a><span class="lineno"> 7724</span>&#160;      <span class="keywordflow">case</span> Message::AckType::Persisted:</div><div class="line"><a name="l07725"></a><span class="lineno"> 7725</span>&#160;        deliveries += me-&gt;persistedAck(message);</div><div class="line"><a name="l07726"></a><span class="lineno"> 7726</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l07727"></a><span class="lineno"> 7727</span>&#160;      <span class="keywordflow">case</span> Message::AckType::Processed: <span class="comment">// processed</span></div><div class="line"><a name="l07728"></a><span class="lineno"> 7728</span>&#160;        deliveries += me-&gt;processedAck(message);</div><div class="line"><a name="l07729"></a><span class="lineno"> 7729</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l07730"></a><span class="lineno"> 7730</span>&#160;      }</div><div class="line"><a name="l07731"></a><span class="lineno"> 7731</span>&#160;      AMPS_CALL_EXCEPTION_WRAPPER_2(me, deliveries += me-&gt;_routes.deliverAck(message, ackType));</div><div class="line"><a name="l07732"></a><span class="lineno"> 7732</span>&#160;      <span class="keywordflow">if</span> (deliveries == 0)</div><div class="line"><a name="l07733"></a><span class="lineno"> 7733</span>&#160;      {</div><div class="line"><a name="l07734"></a><span class="lineno"> 7734</span>&#160;        me-&gt;lastChance(message);</div><div class="line"><a name="l07735"></a><span class="lineno"> 7735</span>&#160;      }</div><div class="line"><a name="l07736"></a><span class="lineno"> 7736</span>&#160;    }</div><div class="line"><a name="l07737"></a><span class="lineno"> 7737</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (commandType == Message::Command::Heartbeat)</div><div class="line"><a name="l07738"></a><span class="lineno"> 7738</span>&#160;    {</div><div class="line"><a name="l07739"></a><span class="lineno"> 7739</span>&#160;      AMPS_CALL_EXCEPTION_WRAPPER_2(me,</div><div class="line"><a name="l07740"></a><span class="lineno"> 7740</span>&#160;                                    me-&gt;_globalCommandTypeHandlers[GlobalCommandTypeHandlers::Heartbeat].invoke(message));</div><div class="line"><a name="l07741"></a><span class="lineno"> 7741</span>&#160;      <span class="keywordflow">if</span> (me-&gt;_heartbeatTimer.getTimeout() != 0.0) <span class="comment">// -V550</span></div><div class="line"><a name="l07742"></a><span class="lineno"> 7742</span>&#160;      {</div><div class="line"><a name="l07743"></a><span class="lineno"> 7743</span>&#160;        me-&gt;checkAndSendHeartbeat(<span class="keyword">true</span>);</div><div class="line"><a name="l07744"></a><span class="lineno"> 7744</span>&#160;      }</div><div class="line"><a name="l07745"></a><span class="lineno"> 7745</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l07746"></a><span class="lineno"> 7746</span>&#160;      {</div><div class="line"><a name="l07747"></a><span class="lineno"> 7747</span>&#160;        me-&gt;lastChance(message);</div><div class="line"><a name="l07748"></a><span class="lineno"> 7748</span>&#160;      }</div><div class="line"><a name="l07749"></a><span class="lineno"> 7749</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a>;</div><div class="line"><a name="l07750"></a><span class="lineno"> 7750</span>&#160;    }</div><div class="line"><a name="l07751"></a><span class="lineno"> 7751</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>().<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>())</div><div class="line"><a name="l07752"></a><span class="lineno"> 7752</span>&#160;    {</div><div class="line"><a name="l07753"></a><span class="lineno"> 7753</span>&#160;      <span class="keywordtype">unsigned</span> deliveries = 0U;</div><div class="line"><a name="l07754"></a><span class="lineno"> 7754</span>&#160;      <span class="keywordflow">try</span></div><div class="line"><a name="l07755"></a><span class="lineno"> 7755</span>&#160;      {</div><div class="line"><a name="l07756"></a><span class="lineno"> 7756</span>&#160;        <span class="keywordflow">while</span> (me-&gt;_connected) <span class="comment">// Keep sending heartbeats when stream is full</span></div><div class="line"><a name="l07757"></a><span class="lineno"> 7757</span>&#160;        {</div><div class="line"><a name="l07758"></a><span class="lineno"> 7758</span>&#160;          <span class="keywordflow">try</span></div><div class="line"><a name="l07759"></a><span class="lineno"> 7759</span>&#160;          {</div><div class="line"><a name="l07760"></a><span class="lineno"> 7760</span>&#160;            deliveries = me-&gt;_routes.deliverData(message, message.<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>());</div><div class="line"><a name="l07761"></a><span class="lineno"> 7761</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l07762"></a><span class="lineno"> 7762</span>&#160;          }</div><div class="line"><a name="l07763"></a><span class="lineno"> 7763</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div><div class="line"><a name="l07764"></a><span class="lineno"> 7764</span>&#160;          <span class="keywordflow">catch</span> (MessageStreamFullException&amp;)</div><div class="line"><a name="l07765"></a><span class="lineno"> 7765</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l07766"></a><span class="lineno"> 7766</span>&#160;          <span class="keywordflow">catch</span> (MessageStreamFullException&amp; ex_)</div><div class="line"><a name="l07767"></a><span class="lineno"> 7767</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l07768"></a><span class="lineno"> 7768</span>&#160;          {</div><div class="line"><a name="l07769"></a><span class="lineno"> 7769</span>&#160;            me-&gt;checkAndSendHeartbeat(<span class="keyword">false</span>);</div><div class="line"><a name="l07770"></a><span class="lineno"> 7770</span>&#160;          }</div><div class="line"><a name="l07771"></a><span class="lineno"> 7771</span>&#160;        }</div><div class="line"><a name="l07772"></a><span class="lineno"> 7772</span>&#160;      }</div><div class="line"><a name="l07773"></a><span class="lineno"> 7773</span>&#160;      <span class="keywordflow">catch</span> (std::exception&amp; ex_)</div><div class="line"><a name="l07774"></a><span class="lineno"> 7774</span>&#160;      {</div><div class="line"><a name="l07775"></a><span class="lineno"> 7775</span>&#160;        <span class="keywordflow">try</span></div><div class="line"><a name="l07776"></a><span class="lineno"> 7776</span>&#160;        {</div><div class="line"><a name="l07777"></a><span class="lineno"> 7777</span>&#160;          me-&gt;_exceptionListener-&gt;exceptionThrown(ex_);</div><div class="line"><a name="l07778"></a><span class="lineno"> 7778</span>&#160;        }</div><div class="line"><a name="l07779"></a><span class="lineno"> 7779</span>&#160;        <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l07780"></a><span class="lineno"> 7780</span>&#160;        {</div><div class="line"><a name="l07781"></a><span class="lineno"> 7781</span>&#160;          ;</div><div class="line"><a name="l07782"></a><span class="lineno"> 7782</span>&#160;        }</div><div class="line"><a name="l07783"></a><span class="lineno"> 7783</span>&#160;      }</div><div class="line"><a name="l07784"></a><span class="lineno"> 7784</span>&#160;      <span class="keywordflow">if</span> (deliveries == 0)</div><div class="line"><a name="l07785"></a><span class="lineno"> 7785</span>&#160;      {</div><div class="line"><a name="l07786"></a><span class="lineno"> 7786</span>&#160;        me-&gt;lastChance(message);</div><div class="line"><a name="l07787"></a><span class="lineno"> 7787</span>&#160;      }</div><div class="line"><a name="l07788"></a><span class="lineno"> 7788</span>&#160;    }</div><div class="line"><a name="l07789"></a><span class="lineno"> 7789</span>&#160;    me-&gt;checkAndSendHeartbeat();</div><div class="line"><a name="l07790"></a><span class="lineno"> 7790</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a>;</div><div class="line"><a name="l07791"></a><span class="lineno"> 7791</span>&#160;  }</div><div class="line"><a name="l07792"></a><span class="lineno"> 7792</span>&#160;</div><div class="line"><a name="l07793"></a><span class="lineno"> 7793</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span></div><div class="line"><a name="l07794"></a><span class="lineno"> 7794</span>&#160;  ClientImpl::ClientImplPreDisconnectHandler(<a class="code" href="amps_8h.html#acfa1278412265f3b4c421e77111ed2ce">amps_handle</a> <span class="comment">/*client*/</span>, <span class="keywordtype">unsigned</span> failedConnectionVersion, <span class="keywordtype">void</span>* userData)</div><div class="line"><a name="l07795"></a><span class="lineno"> 7795</span>&#160;  {</div><div class="line"><a name="l07796"></a><span class="lineno"> 7796</span>&#160;    ClientImpl* me = (ClientImpl*) userData;</div><div class="line"><a name="l07797"></a><span class="lineno"> 7797</span>&#160;    <span class="comment">//Client wrapper(me);</span></div><div class="line"><a name="l07798"></a><span class="lineno"> 7798</span>&#160;    <span class="comment">// Go ahead and signal any waiters if they are around...</span></div><div class="line"><a name="l07799"></a><span class="lineno"> 7799</span>&#160;    me-&gt;clearAcks(failedConnectionVersion);</div><div class="line"><a name="l07800"></a><span class="lineno"> 7800</span>&#160;  }</div><div class="line"><a name="l07801"></a><span class="lineno"> 7801</span>&#160;</div><div class="line"><a name="l07802"></a><span class="lineno"> 7802</span>&#160;  <span class="keyword">inline</span> <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04">amps_result</a></div><div class="line"><a name="l07803"></a><span class="lineno"> 7803</span>&#160;  ClientImpl::ClientImplDisconnectHandler(<a class="code" href="amps_8h.html#acfa1278412265f3b4c421e77111ed2ce">amps_handle</a> <span class="comment">/*client*/</span>, <span class="keywordtype">void</span>* userData)</div><div class="line"><a name="l07804"></a><span class="lineno"> 7804</span>&#160;  {</div><div class="line"><a name="l07805"></a><span class="lineno"> 7805</span>&#160;    ClientImpl* me = (ClientImpl*) userData;</div><div class="line"><a name="l07806"></a><span class="lineno"> 7806</span>&#160;    Lock&lt;Mutex&gt; l(me-&gt;_lock);</div><div class="line"><a name="l07807"></a><span class="lineno"> 7807</span>&#160;    Client wrapper(me, <span class="keyword">false</span>);</div><div class="line"><a name="l07808"></a><span class="lineno"> 7808</span>&#160;    <span class="keywordflow">if</span> (me-&gt;_connected)</div><div class="line"><a name="l07809"></a><span class="lineno"> 7809</span>&#160;    {</div><div class="line"><a name="l07810"></a><span class="lineno"> 7810</span>&#160;      me-&gt;broadcastConnectionStateChanged(ConnectionStateListener::Disconnected);</div><div class="line"><a name="l07811"></a><span class="lineno"> 7811</span>&#160;    }</div><div class="line"><a name="l07812"></a><span class="lineno"> 7812</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div><div class="line"><a name="l07813"></a><span class="lineno"> 7813</span>&#160;    {</div><div class="line"><a name="l07814"></a><span class="lineno"> 7814</span>&#160;      AtomicFlagFlip subFlip(&amp;me-&gt;_badTimeToHASubscribe);</div><div class="line"><a name="l07815"></a><span class="lineno"> 7815</span>&#160;      <span class="keywordflow">try</span></div><div class="line"><a name="l07816"></a><span class="lineno"> 7816</span>&#160;      {</div><div class="line"><a name="l07817"></a><span class="lineno"> 7817</span>&#160;        me-&gt;_connected = <span class="keyword">false</span>;</div><div class="line"><a name="l07818"></a><span class="lineno"> 7818</span>&#160;        {</div><div class="line"><a name="l07819"></a><span class="lineno"> 7819</span>&#160;          <span class="comment">// Have to release the lock here or receive thread can&#39;t</span></div><div class="line"><a name="l07820"></a><span class="lineno"> 7820</span>&#160;          <span class="comment">// invoke the message handler.</span></div><div class="line"><a name="l07821"></a><span class="lineno"> 7821</span>&#160;          Unlock&lt;Mutex&gt; unlock(me-&gt;_lock);</div><div class="line"><a name="l07822"></a><span class="lineno"> 7822</span>&#160;          me-&gt;_disconnectHandler.invoke(wrapper);</div><div class="line"><a name="l07823"></a><span class="lineno"> 7823</span>&#160;        }</div><div class="line"><a name="l07824"></a><span class="lineno"> 7824</span>&#160;      }</div><div class="line"><a name="l07825"></a><span class="lineno"> 7825</span>&#160;      <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; ex)</div><div class="line"><a name="l07826"></a><span class="lineno"> 7826</span>&#160;      {</div><div class="line"><a name="l07827"></a><span class="lineno"> 7827</span>&#160;        AMPS_UNHANDLED_EXCEPTION_2(me, ex);</div><div class="line"><a name="l07828"></a><span class="lineno"> 7828</span>&#160;      }</div><div class="line"><a name="l07829"></a><span class="lineno"> 7829</span>&#160;      me-&gt;_lock.signalAll();</div><div class="line"><a name="l07830"></a><span class="lineno"> 7830</span>&#160;</div><div class="line"><a name="l07831"></a><span class="lineno"> 7831</span>&#160;      <span class="keywordflow">if</span> (!me-&gt;_connected)</div><div class="line"><a name="l07832"></a><span class="lineno"> 7832</span>&#160;      {</div><div class="line"><a name="l07833"></a><span class="lineno"> 7833</span>&#160;        me-&gt;broadcastConnectionStateChanged(ConnectionStateListener::Shutdown);</div><div class="line"><a name="l07834"></a><span class="lineno"> 7834</span>&#160;        AMPS_UNHANDLED_EXCEPTION_2(me, DisconnectedException(<span class="stringliteral">&quot;Reconnect failed.&quot;</span>));</div><div class="line"><a name="l07835"></a><span class="lineno"> 7835</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a867ac1b88eb736ddae182279d2788aea">AMPS_E_DISCONNECTED</a>;</div><div class="line"><a name="l07836"></a><span class="lineno"> 7836</span>&#160;      }</div><div class="line"><a name="l07837"></a><span class="lineno"> 7837</span>&#160;      <span class="keywordflow">try</span></div><div class="line"><a name="l07838"></a><span class="lineno"> 7838</span>&#160;      {</div><div class="line"><a name="l07839"></a><span class="lineno"> 7839</span>&#160;        <span class="comment">// Resubscribe</span></div><div class="line"><a name="l07840"></a><span class="lineno"> 7840</span>&#160;        <span class="keywordflow">if</span> (me-&gt;_subscriptionManager)</div><div class="line"><a name="l07841"></a><span class="lineno"> 7841</span>&#160;        {</div><div class="line"><a name="l07842"></a><span class="lineno"> 7842</span>&#160;          {</div><div class="line"><a name="l07843"></a><span class="lineno"> 7843</span>&#160;            <span class="comment">// Have to release the lock here or receive thread can&#39;t</span></div><div class="line"><a name="l07844"></a><span class="lineno"> 7844</span>&#160;            <span class="comment">// invoke the message handler.</span></div><div class="line"><a name="l07845"></a><span class="lineno"> 7845</span>&#160;            Unlock&lt;Mutex&gt; unlock(me-&gt;_lock);</div><div class="line"><a name="l07846"></a><span class="lineno"> 7846</span>&#160;            me-&gt;_subscriptionManager-&gt;resubscribe(wrapper);</div><div class="line"><a name="l07847"></a><span class="lineno"> 7847</span>&#160;          }</div><div class="line"><a name="l07848"></a><span class="lineno"> 7848</span>&#160;          me-&gt;broadcastConnectionStateChanged(ConnectionStateListener::Resubscribed);</div><div class="line"><a name="l07849"></a><span class="lineno"> 7849</span>&#160;        }</div><div class="line"><a name="l07850"></a><span class="lineno"> 7850</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a>;</div><div class="line"><a name="l07851"></a><span class="lineno"> 7851</span>&#160;      }</div><div class="line"><a name="l07852"></a><span class="lineno"> 7852</span>&#160;      <span class="keywordflow">catch</span> (<span class="keyword">const</span> AMPSException&amp; subEx)</div><div class="line"><a name="l07853"></a><span class="lineno"> 7853</span>&#160;      {</div><div class="line"><a name="l07854"></a><span class="lineno"> 7854</span>&#160;        AMPS_UNHANDLED_EXCEPTION_2(me, subEx);</div><div class="line"><a name="l07855"></a><span class="lineno"> 7855</span>&#160;      }</div><div class="line"><a name="l07856"></a><span class="lineno"> 7856</span>&#160;      <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; subEx)</div><div class="line"><a name="l07857"></a><span class="lineno"> 7857</span>&#160;      {</div><div class="line"><a name="l07858"></a><span class="lineno"> 7858</span>&#160;        AMPS_UNHANDLED_EXCEPTION_2(me, subEx);</div><div class="line"><a name="l07859"></a><span class="lineno"> 7859</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a046fe5490917dab049a5a7c516c5b098">AMPS_E_RETRY</a>;</div><div class="line"><a name="l07860"></a><span class="lineno"> 7860</span>&#160;      }</div><div class="line"><a name="l07861"></a><span class="lineno"> 7861</span>&#160;      <span class="keywordflow">catch</span> (...)</div><div class="line"><a name="l07862"></a><span class="lineno"> 7862</span>&#160;      {</div><div class="line"><a name="l07863"></a><span class="lineno"> 7863</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a046fe5490917dab049a5a7c516c5b098">AMPS_E_RETRY</a>;</div><div class="line"><a name="l07864"></a><span class="lineno"> 7864</span>&#160;      }</div><div class="line"><a name="l07865"></a><span class="lineno"> 7865</span>&#160;    }</div><div class="line"><a name="l07866"></a><span class="lineno"> 7866</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a046fe5490917dab049a5a7c516c5b098">AMPS_E_RETRY</a>;</div><div class="line"><a name="l07867"></a><span class="lineno"> 7867</span>&#160;  }</div><div class="line"><a name="l07868"></a><span class="lineno"> 7868</span>&#160;</div><div class="line"><a name="l07869"></a><span class="lineno"> 7869</span>&#160;  <span class="keyword">class </span>FIX</div><div class="line"><a name="l07870"></a><span class="lineno"> 7870</span>&#160;  {</div><div class="line"><a name="l07871"></a><span class="lineno"> 7871</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* _data;</div><div class="line"><a name="l07872"></a><span class="lineno"> 7872</span>&#160;    <span class="keywordtype">size_t</span> _len;</div><div class="line"><a name="l07873"></a><span class="lineno"> 7873</span>&#160;    <span class="keywordtype">char</span> _fieldSep;</div><div class="line"><a name="l07874"></a><span class="lineno"> 7874</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l07875"></a><span class="lineno"> 7875</span>&#160;    <span class="keyword">class </span>iterator</div><div class="line"><a name="l07876"></a><span class="lineno"> 7876</span>&#160;    {</div><div class="line"><a name="l07877"></a><span class="lineno"> 7877</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span>* _data;</div><div class="line"><a name="l07878"></a><span class="lineno"> 7878</span>&#160;      <span class="keywordtype">size_t</span> _len;</div><div class="line"><a name="l07879"></a><span class="lineno"> 7879</span>&#160;      <span class="keywordtype">size_t</span> _pos;</div><div class="line"><a name="l07880"></a><span class="lineno"> 7880</span>&#160;      <span class="keywordtype">char</span> _fieldSep;</div><div class="line"><a name="l07881"></a><span class="lineno"> 7881</span>&#160;      iterator(<span class="keyword">const</span> <span class="keywordtype">char</span>* data_, <span class="keywordtype">size_t</span> len_, <span class="keywordtype">size_t</span> pos_, <span class="keywordtype">char</span> fieldSep_)</div><div class="line"><a name="l07882"></a><span class="lineno"> 7882</span>&#160;        : _data(data_), _len(len_), _pos(pos_), _fieldSep(fieldSep_)</div><div class="line"><a name="l07883"></a><span class="lineno"> 7883</span>&#160;      {</div><div class="line"><a name="l07884"></a><span class="lineno"> 7884</span>&#160;        <span class="keywordflow">while</span> (_pos != _len &amp;&amp; _data[_pos] == _fieldSep)</div><div class="line"><a name="l07885"></a><span class="lineno"> 7885</span>&#160;        {</div><div class="line"><a name="l07886"></a><span class="lineno"> 7886</span>&#160;          ++_pos;</div><div class="line"><a name="l07887"></a><span class="lineno"> 7887</span>&#160;        }</div><div class="line"><a name="l07888"></a><span class="lineno"> 7888</span>&#160;      }</div><div class="line"><a name="l07889"></a><span class="lineno"> 7889</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l07890"></a><span class="lineno"> 7890</span>&#160;      <span class="keyword">typedef</span> <span class="keywordtype">void</span>* difference_type;</div><div class="line"><a name="l07891"></a><span class="lineno"> 7891</span>&#160;      <span class="keyword">typedef</span> std::forward_iterator_tag iterator_category;</div><div class="line"><a name="l07892"></a><span class="lineno"> 7892</span>&#160;      <span class="keyword">typedef</span> std::pair&lt;Message::Field, Message::Field&gt; value_type;</div><div class="line"><a name="l07893"></a><span class="lineno"> 7893</span>&#160;      <span class="keyword">typedef</span> value_type* pointer;</div><div class="line"><a name="l07894"></a><span class="lineno"> 7894</span>&#160;      <span class="keyword">typedef</span> value_type&amp; reference;</div><div class="line"><a name="l07895"></a><span class="lineno"> 7895</span>&#160;      <span class="keywordtype">bool</span> operator==(<span class="keyword">const</span> iterator&amp; rhs)<span class="keyword"> const</span></div><div class="line"><a name="l07896"></a><span class="lineno"> 7896</span>&#160;<span class="keyword">      </span>{</div><div class="line"><a name="l07897"></a><span class="lineno"> 7897</span>&#160;        <span class="keywordflow">return</span> _pos == rhs._pos;</div><div class="line"><a name="l07898"></a><span class="lineno"> 7898</span>&#160;      }</div><div class="line"><a name="l07899"></a><span class="lineno"> 7899</span>&#160;      <span class="keywordtype">bool</span> operator!=(<span class="keyword">const</span> iterator&amp; rhs)<span class="keyword"> const</span></div><div class="line"><a name="l07900"></a><span class="lineno"> 7900</span>&#160;<span class="keyword">      </span>{</div><div class="line"><a name="l07901"></a><span class="lineno"> 7901</span>&#160;        <span class="keywordflow">return</span> _pos != rhs._pos;</div><div class="line"><a name="l07902"></a><span class="lineno"> 7902</span>&#160;      }</div><div class="line"><a name="l07903"></a><span class="lineno"> 7903</span>&#160;      iterator&amp; operator++()</div><div class="line"><a name="l07904"></a><span class="lineno"> 7904</span>&#160;      {</div><div class="line"><a name="l07905"></a><span class="lineno"> 7905</span>&#160;        <span class="comment">// Skip through the data</span></div><div class="line"><a name="l07906"></a><span class="lineno"> 7906</span>&#160;        <span class="keywordflow">while</span> (_pos != _len &amp;&amp; _data[_pos] != _fieldSep)</div><div class="line"><a name="l07907"></a><span class="lineno"> 7907</span>&#160;        {</div><div class="line"><a name="l07908"></a><span class="lineno"> 7908</span>&#160;          ++_pos;</div><div class="line"><a name="l07909"></a><span class="lineno"> 7909</span>&#160;        }</div><div class="line"><a name="l07910"></a><span class="lineno"> 7910</span>&#160;        <span class="comment">// Skip through any field separators</span></div><div class="line"><a name="l07911"></a><span class="lineno"> 7911</span>&#160;        <span class="keywordflow">while</span> (_pos != _len &amp;&amp; _data[_pos] == _fieldSep)</div><div class="line"><a name="l07912"></a><span class="lineno"> 7912</span>&#160;        {</div><div class="line"><a name="l07913"></a><span class="lineno"> 7913</span>&#160;          ++_pos;</div><div class="line"><a name="l07914"></a><span class="lineno"> 7914</span>&#160;        }</div><div class="line"><a name="l07915"></a><span class="lineno"> 7915</span>&#160;        <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l07916"></a><span class="lineno"> 7916</span>&#160;      }</div><div class="line"><a name="l07917"></a><span class="lineno"> 7917</span>&#160;</div><div class="line"><a name="l07918"></a><span class="lineno"> 7918</span>&#160;      value_type operator*()<span class="keyword"> const</span></div><div class="line"><a name="l07919"></a><span class="lineno"> 7919</span>&#160;<span class="keyword">      </span>{</div><div class="line"><a name="l07920"></a><span class="lineno"> 7920</span>&#160;        value_type result;</div><div class="line"><a name="l07921"></a><span class="lineno"> 7921</span>&#160;        <span class="keywordtype">size_t</span> i = _pos, keyLength = 0, valueStart = 0, valueLength = 0;</div><div class="line"><a name="l07922"></a><span class="lineno"> 7922</span>&#160;        <span class="keywordflow">for</span> (; i &lt; _len &amp;&amp; _data[i] != <span class="charliteral">&#39;=&#39;</span>; ++i)</div><div class="line"><a name="l07923"></a><span class="lineno"> 7923</span>&#160;        {</div><div class="line"><a name="l07924"></a><span class="lineno"> 7924</span>&#160;          ++keyLength;</div><div class="line"><a name="l07925"></a><span class="lineno"> 7925</span>&#160;        }</div><div class="line"><a name="l07926"></a><span class="lineno"> 7926</span>&#160;</div><div class="line"><a name="l07927"></a><span class="lineno"> 7927</span>&#160;        result.first.assign(_data + _pos, keyLength);</div><div class="line"><a name="l07928"></a><span class="lineno"> 7928</span>&#160;</div><div class="line"><a name="l07929"></a><span class="lineno"> 7929</span>&#160;        <span class="keywordflow">if</span> (i &lt; _len &amp;&amp; _data[i] == <span class="charliteral">&#39;=&#39;</span>)</div><div class="line"><a name="l07930"></a><span class="lineno"> 7930</span>&#160;        {</div><div class="line"><a name="l07931"></a><span class="lineno"> 7931</span>&#160;          ++i;</div><div class="line"><a name="l07932"></a><span class="lineno"> 7932</span>&#160;          valueStart = i;</div><div class="line"><a name="l07933"></a><span class="lineno"> 7933</span>&#160;          <span class="keywordflow">for</span> (; i &lt; _len &amp;&amp; _data[i] != _fieldSep; ++i)</div><div class="line"><a name="l07934"></a><span class="lineno"> 7934</span>&#160;          {</div><div class="line"><a name="l07935"></a><span class="lineno"> 7935</span>&#160;            valueLength++;</div><div class="line"><a name="l07936"></a><span class="lineno"> 7936</span>&#160;          }</div><div class="line"><a name="l07937"></a><span class="lineno"> 7937</span>&#160;        }</div><div class="line"><a name="l07938"></a><span class="lineno"> 7938</span>&#160;        result.second.assign(_data + valueStart, valueLength);</div><div class="line"><a name="l07939"></a><span class="lineno"> 7939</span>&#160;        <span class="keywordflow">return</span> result;</div><div class="line"><a name="l07940"></a><span class="lineno"> 7940</span>&#160;      }</div><div class="line"><a name="l07941"></a><span class="lineno"> 7941</span>&#160;</div><div class="line"><a name="l07942"></a><span class="lineno"> 7942</span>&#160;      <span class="keyword">friend</span> <span class="keyword">class </span>FIX;</div><div class="line"><a name="l07943"></a><span class="lineno"> 7943</span>&#160;    };</div><div class="line"><a name="l07944"></a><span class="lineno"> 7944</span>&#160;    <span class="keyword">class </span>reverse_iterator</div><div class="line"><a name="l07945"></a><span class="lineno"> 7945</span>&#160;    {</div><div class="line"><a name="l07946"></a><span class="lineno"> 7946</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span>* _data;</div><div class="line"><a name="l07947"></a><span class="lineno"> 7947</span>&#160;      <span class="keywordtype">size_t</span> _len;</div><div class="line"><a name="l07948"></a><span class="lineno"> 7948</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span>* _pos;</div><div class="line"><a name="l07949"></a><span class="lineno"> 7949</span>&#160;      <span class="keywordtype">char</span> _fieldSep;</div><div class="line"><a name="l07950"></a><span class="lineno"> 7950</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l07951"></a><span class="lineno"> 7951</span>&#160;      <span class="keyword">typedef</span> std::pair&lt;Message::Field, Message::Field&gt; value_type;</div><div class="line"><a name="l07952"></a><span class="lineno"> 7952</span>&#160;      reverse_iterator(<span class="keyword">const</span> <span class="keywordtype">char</span>* data, <span class="keywordtype">size_t</span> len, <span class="keyword">const</span> <span class="keywordtype">char</span>* pos, <span class="keywordtype">char</span> fieldsep)</div><div class="line"><a name="l07953"></a><span class="lineno"> 7953</span>&#160;        : _data(data), _len(len), _pos(pos), _fieldSep(fieldsep)</div><div class="line"><a name="l07954"></a><span class="lineno"> 7954</span>&#160;      {</div><div class="line"><a name="l07955"></a><span class="lineno"> 7955</span>&#160;        <span class="keywordflow">if</span> (_pos)</div><div class="line"><a name="l07956"></a><span class="lineno"> 7956</span>&#160;        {</div><div class="line"><a name="l07957"></a><span class="lineno"> 7957</span>&#160;          <span class="comment">// skip past meaningless trailing fieldseps</span></div><div class="line"><a name="l07958"></a><span class="lineno"> 7958</span>&#160;          <span class="keywordflow">while</span> (_pos &gt;= _data &amp;&amp; *_pos == _fieldSep)</div><div class="line"><a name="l07959"></a><span class="lineno"> 7959</span>&#160;          {</div><div class="line"><a name="l07960"></a><span class="lineno"> 7960</span>&#160;            --_pos;</div><div class="line"><a name="l07961"></a><span class="lineno"> 7961</span>&#160;          }</div><div class="line"><a name="l07962"></a><span class="lineno"> 7962</span>&#160;          <span class="keywordflow">while</span> (_pos &gt; _data &amp;&amp; *_pos != _fieldSep)</div><div class="line"><a name="l07963"></a><span class="lineno"> 7963</span>&#160;          {</div><div class="line"><a name="l07964"></a><span class="lineno"> 7964</span>&#160;            --_pos;</div><div class="line"><a name="l07965"></a><span class="lineno"> 7965</span>&#160;          }</div><div class="line"><a name="l07966"></a><span class="lineno"> 7966</span>&#160;          <span class="comment">// if we stopped before the 0th character, it&#39;s because</span></div><div class="line"><a name="l07967"></a><span class="lineno"> 7967</span>&#160;          <span class="comment">// it&#39;s a field sep.  advance one to point to the first character</span></div><div class="line"><a name="l07968"></a><span class="lineno"> 7968</span>&#160;          <span class="comment">// of a key.</span></div><div class="line"><a name="l07969"></a><span class="lineno"> 7969</span>&#160;          <span class="keywordflow">if</span> (_pos &gt; _data || (_pos == _data &amp;&amp; *_pos == _fieldSep))</div><div class="line"><a name="l07970"></a><span class="lineno"> 7970</span>&#160;          {</div><div class="line"><a name="l07971"></a><span class="lineno"> 7971</span>&#160;            ++_pos;</div><div class="line"><a name="l07972"></a><span class="lineno"> 7972</span>&#160;          }</div><div class="line"><a name="l07973"></a><span class="lineno"> 7973</span>&#160;          <span class="keywordflow">if</span> (_pos &lt; _data)</div><div class="line"><a name="l07974"></a><span class="lineno"> 7974</span>&#160;          {</div><div class="line"><a name="l07975"></a><span class="lineno"> 7975</span>&#160;            _pos = 0;</div><div class="line"><a name="l07976"></a><span class="lineno"> 7976</span>&#160;          }</div><div class="line"><a name="l07977"></a><span class="lineno"> 7977</span>&#160;        }</div><div class="line"><a name="l07978"></a><span class="lineno"> 7978</span>&#160;      }</div><div class="line"><a name="l07979"></a><span class="lineno"> 7979</span>&#160;      <span class="keywordtype">bool</span> operator==(<span class="keyword">const</span> reverse_iterator&amp; rhs)<span class="keyword"> const</span></div><div class="line"><a name="l07980"></a><span class="lineno"> 7980</span>&#160;<span class="keyword">      </span>{</div><div class="line"><a name="l07981"></a><span class="lineno"> 7981</span>&#160;        <span class="keywordflow">return</span> _pos == rhs._pos;</div><div class="line"><a name="l07982"></a><span class="lineno"> 7982</span>&#160;      }</div><div class="line"><a name="l07983"></a><span class="lineno"> 7983</span>&#160;      <span class="keywordtype">bool</span> operator!=(<span class="keyword">const</span> reverse_iterator&amp; rhs)<span class="keyword"> const</span></div><div class="line"><a name="l07984"></a><span class="lineno"> 7984</span>&#160;<span class="keyword">      </span>{</div><div class="line"><a name="l07985"></a><span class="lineno"> 7985</span>&#160;        <span class="keywordflow">return</span> _pos != rhs._pos;</div><div class="line"><a name="l07986"></a><span class="lineno"> 7986</span>&#160;      }</div><div class="line"><a name="l07987"></a><span class="lineno"> 7987</span>&#160;      reverse_iterator&amp; operator++()</div><div class="line"><a name="l07988"></a><span class="lineno"> 7988</span>&#160;      {</div><div class="line"><a name="l07989"></a><span class="lineno"> 7989</span>&#160;        <span class="keywordflow">if</span> (_pos == _data)</div><div class="line"><a name="l07990"></a><span class="lineno"> 7990</span>&#160;        {</div><div class="line"><a name="l07991"></a><span class="lineno"> 7991</span>&#160;          _pos = 0;</div><div class="line"><a name="l07992"></a><span class="lineno"> 7992</span>&#160;        }</div><div class="line"><a name="l07993"></a><span class="lineno"> 7993</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l07994"></a><span class="lineno"> 7994</span>&#160;        {</div><div class="line"><a name="l07995"></a><span class="lineno"> 7995</span>&#160;          <span class="comment">// back up 1 to a field separator</span></div><div class="line"><a name="l07996"></a><span class="lineno"> 7996</span>&#160;          --_pos;</div><div class="line"><a name="l07997"></a><span class="lineno"> 7997</span>&#160;          <span class="comment">// keep backing up through field separators</span></div><div class="line"><a name="l07998"></a><span class="lineno"> 7998</span>&#160;          <span class="keywordflow">while</span> (_pos &gt;= _data &amp;&amp; *_pos == _fieldSep)</div><div class="line"><a name="l07999"></a><span class="lineno"> 7999</span>&#160;          {</div><div class="line"><a name="l08000"></a><span class="lineno"> 8000</span>&#160;            --_pos;</div><div class="line"><a name="l08001"></a><span class="lineno"> 8001</span>&#160;          }</div><div class="line"><a name="l08002"></a><span class="lineno"> 8002</span>&#160;          <span class="comment">// now back up to the beginning of this field</span></div><div class="line"><a name="l08003"></a><span class="lineno"> 8003</span>&#160;          <span class="keywordflow">while</span> (_pos &gt; _data &amp;&amp; *_pos != _fieldSep)</div><div class="line"><a name="l08004"></a><span class="lineno"> 8004</span>&#160;          {</div><div class="line"><a name="l08005"></a><span class="lineno"> 8005</span>&#160;            --_pos;</div><div class="line"><a name="l08006"></a><span class="lineno"> 8006</span>&#160;          }</div><div class="line"><a name="l08007"></a><span class="lineno"> 8007</span>&#160;          <span class="keywordflow">if</span> (_pos &gt; _data || (_pos == _data &amp;&amp; *_pos == _fieldSep))</div><div class="line"><a name="l08008"></a><span class="lineno"> 8008</span>&#160;          {</div><div class="line"><a name="l08009"></a><span class="lineno"> 8009</span>&#160;            ++_pos;</div><div class="line"><a name="l08010"></a><span class="lineno"> 8010</span>&#160;          }</div><div class="line"><a name="l08011"></a><span class="lineno"> 8011</span>&#160;          <span class="keywordflow">if</span> (_pos &lt; _data)</div><div class="line"><a name="l08012"></a><span class="lineno"> 8012</span>&#160;          {</div><div class="line"><a name="l08013"></a><span class="lineno"> 8013</span>&#160;            _pos = 0;</div><div class="line"><a name="l08014"></a><span class="lineno"> 8014</span>&#160;          }</div><div class="line"><a name="l08015"></a><span class="lineno"> 8015</span>&#160;        }</div><div class="line"><a name="l08016"></a><span class="lineno"> 8016</span>&#160;        <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l08017"></a><span class="lineno"> 8017</span>&#160;      }</div><div class="line"><a name="l08018"></a><span class="lineno"> 8018</span>&#160;      value_type operator*()<span class="keyword"> const</span></div><div class="line"><a name="l08019"></a><span class="lineno"> 8019</span>&#160;<span class="keyword">      </span>{</div><div class="line"><a name="l08020"></a><span class="lineno"> 8020</span>&#160;        value_type result;</div><div class="line"><a name="l08021"></a><span class="lineno"> 8021</span>&#160;        <span class="keywordtype">size_t</span> keyLength = 0, valueStart = 0, valueLength = 0;</div><div class="line"><a name="l08022"></a><span class="lineno"> 8022</span>&#160;        <span class="keywordtype">size_t</span> i = (size_t)(_pos - _data);</div><div class="line"><a name="l08023"></a><span class="lineno"> 8023</span>&#160;        <span class="keywordflow">for</span> (; i &lt; _len &amp;&amp; _data[i] != <span class="charliteral">&#39;=&#39;</span>; ++i)</div><div class="line"><a name="l08024"></a><span class="lineno"> 8024</span>&#160;        {</div><div class="line"><a name="l08025"></a><span class="lineno"> 8025</span>&#160;          ++keyLength;</div><div class="line"><a name="l08026"></a><span class="lineno"> 8026</span>&#160;        }</div><div class="line"><a name="l08027"></a><span class="lineno"> 8027</span>&#160;        result.first.assign(_pos, keyLength);</div><div class="line"><a name="l08028"></a><span class="lineno"> 8028</span>&#160;        <span class="keywordflow">if</span> (i &lt; _len &amp;&amp; _data[i] == <span class="charliteral">&#39;=&#39;</span>)</div><div class="line"><a name="l08029"></a><span class="lineno"> 8029</span>&#160;        {</div><div class="line"><a name="l08030"></a><span class="lineno"> 8030</span>&#160;          ++i;</div><div class="line"><a name="l08031"></a><span class="lineno"> 8031</span>&#160;          valueStart = i;</div><div class="line"><a name="l08032"></a><span class="lineno"> 8032</span>&#160;          <span class="keywordflow">for</span> (; i &lt; _len &amp;&amp; _data[i] != _fieldSep; ++i)</div><div class="line"><a name="l08033"></a><span class="lineno"> 8033</span>&#160;          {</div><div class="line"><a name="l08034"></a><span class="lineno"> 8034</span>&#160;            valueLength++;</div><div class="line"><a name="l08035"></a><span class="lineno"> 8035</span>&#160;          }</div><div class="line"><a name="l08036"></a><span class="lineno"> 8036</span>&#160;        }</div><div class="line"><a name="l08037"></a><span class="lineno"> 8037</span>&#160;        result.second.assign(_data + valueStart, valueLength);</div><div class="line"><a name="l08038"></a><span class="lineno"> 8038</span>&#160;        <span class="keywordflow">return</span> result;</div><div class="line"><a name="l08039"></a><span class="lineno"> 8039</span>&#160;      }</div><div class="line"><a name="l08040"></a><span class="lineno"> 8040</span>&#160;    };</div><div class="line"><a name="l08041"></a><span class="lineno"> 8041</span>&#160;    FIX(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Field.html">Message::Field</a>&amp; data, <span class="keywordtype">char</span> fieldSeparator = 1)</div><div class="line"><a name="l08042"></a><span class="lineno"> 8042</span>&#160;      : _data(data.<a class="code" href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">data</a>()), _len(data.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>()),</div><div class="line"><a name="l08043"></a><span class="lineno"> 8043</span>&#160;        _fieldSep(fieldSeparator)</div><div class="line"><a name="l08044"></a><span class="lineno"> 8044</span>&#160;    {</div><div class="line"><a name="l08045"></a><span class="lineno"> 8045</span>&#160;    }</div><div class="line"><a name="l08046"></a><span class="lineno"> 8046</span>&#160;</div><div class="line"><a name="l08047"></a><span class="lineno"> 8047</span>&#160;    FIX(<span class="keyword">const</span> <span class="keywordtype">char</span>* data, <span class="keywordtype">size_t</span> len, <span class="keywordtype">char</span> fieldSeparator = 1)</div><div class="line"><a name="l08048"></a><span class="lineno"> 8048</span>&#160;      : _data(data), _len(len), _fieldSep(fieldSeparator)</div><div class="line"><a name="l08049"></a><span class="lineno"> 8049</span>&#160;    {</div><div class="line"><a name="l08050"></a><span class="lineno"> 8050</span>&#160;    }</div><div class="line"><a name="l08051"></a><span class="lineno"> 8051</span>&#160;</div><div class="line"><a name="l08052"></a><span class="lineno"> 8052</span>&#160;    iterator begin()<span class="keyword"> const</span></div><div class="line"><a name="l08053"></a><span class="lineno"> 8053</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l08054"></a><span class="lineno"> 8054</span>&#160;      <span class="keywordflow">return</span> iterator(_data, _len, 0, _fieldSep);</div><div class="line"><a name="l08055"></a><span class="lineno"> 8055</span>&#160;    }</div><div class="line"><a name="l08056"></a><span class="lineno"> 8056</span>&#160;    iterator end()<span class="keyword"> const</span></div><div class="line"><a name="l08057"></a><span class="lineno"> 8057</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l08058"></a><span class="lineno"> 8058</span>&#160;      <span class="keywordflow">return</span> iterator(_data, _len, _len, _fieldSep);</div><div class="line"><a name="l08059"></a><span class="lineno"> 8059</span>&#160;    }</div><div class="line"><a name="l08060"></a><span class="lineno"> 8060</span>&#160;</div><div class="line"><a name="l08061"></a><span class="lineno"> 8061</span>&#160;</div><div class="line"><a name="l08062"></a><span class="lineno"> 8062</span>&#160;    reverse_iterator rbegin()<span class="keyword"> const</span></div><div class="line"><a name="l08063"></a><span class="lineno"> 8063</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l08064"></a><span class="lineno"> 8064</span>&#160;      <span class="keywordflow">return</span> reverse_iterator(_data, _len, _data + (_len - 1), _fieldSep);</div><div class="line"><a name="l08065"></a><span class="lineno"> 8065</span>&#160;    }</div><div class="line"><a name="l08066"></a><span class="lineno"> 8066</span>&#160;</div><div class="line"><a name="l08067"></a><span class="lineno"> 8067</span>&#160;    reverse_iterator rend()<span class="keyword"> const</span></div><div class="line"><a name="l08068"></a><span class="lineno"> 8068</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l08069"></a><span class="lineno"> 8069</span>&#160;      <span class="keywordflow">return</span> reverse_iterator(_data, _len, 0, _fieldSep);</div><div class="line"><a name="l08070"></a><span class="lineno"> 8070</span>&#160;    }</div><div class="line"><a name="l08071"></a><span class="lineno"> 8071</span>&#160;  };</div><div class="line"><a name="l08072"></a><span class="lineno"> 8072</span>&#160;</div><div class="line"><a name="l08073"></a><span class="lineno"> 8073</span>&#160;</div><div class="line"><a name="l08086"></a><span class="lineno"> 8086</span>&#160;</div><div class="line"><a name="l08087"></a><span class="lineno"> 8087</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div><div class="line"><a name="l08088"></a><span class="lineno"><a class="line" href="classAMPS_1_1__FIXBuilder.html"> 8088</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1__FIXBuilder.html">_FIXBuilder</a></div><div class="line"><a name="l08089"></a><span class="lineno"> 8089</span>&#160;  {</div><div class="line"><a name="l08090"></a><span class="lineno"> 8090</span>&#160;    std::stringstream _data;</div><div class="line"><a name="l08091"></a><span class="lineno"> 8091</span>&#160;    <span class="keywordtype">char</span> _fs;</div><div class="line"><a name="l08092"></a><span class="lineno"> 8092</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l08098"></a><span class="lineno"><a class="line" href="classAMPS_1_1__FIXBuilder.html#a5a62d735a9f176af259ea956d8a6f3ae"> 8098</a></span>&#160;    <a class="code" href="classAMPS_1_1__FIXBuilder.html#a5a62d735a9f176af259ea956d8a6f3ae">_FIXBuilder</a>(<span class="keywordtype">char</span> fieldSep_ = (<span class="keywordtype">char</span>)1) : _fs(fieldSep_) {;}</div><div class="line"><a name="l08099"></a><span class="lineno"> 8099</span>&#160;</div><div class="line"><a name="l08107"></a><span class="lineno"><a class="line" href="classAMPS_1_1__FIXBuilder.html#aab4f356d05683e61cb7ecc507268b1f9"> 8107</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1__FIXBuilder.html#aab4f356d05683e61cb7ecc507268b1f9">append</a>(<span class="keyword">const</span> T&amp; tag, <span class="keyword">const</span> <span class="keywordtype">char</span>* value, <span class="keywordtype">size_t</span> offset, <span class="keywordtype">size_t</span> length)</div><div class="line"><a name="l08108"></a><span class="lineno"> 8108</span>&#160;    {</div><div class="line"><a name="l08109"></a><span class="lineno"> 8109</span>&#160;      _data &lt;&lt; tag &lt;&lt; <span class="charliteral">&#39;=&#39;</span>;</div><div class="line"><a name="l08110"></a><span class="lineno"> 8110</span>&#160;      _data.write(value + offset, (std::streamsize)length);</div><div class="line"><a name="l08111"></a><span class="lineno"> 8111</span>&#160;      _data &lt;&lt; _fs;</div><div class="line"><a name="l08112"></a><span class="lineno"> 8112</span>&#160;    }</div><div class="line"><a name="l08118"></a><span class="lineno"><a class="line" href="classAMPS_1_1__FIXBuilder.html#a99affb8de13900f47240533598885627"> 8118</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1__FIXBuilder.html#a99affb8de13900f47240533598885627">append</a>(<span class="keyword">const</span> T&amp; tag, <span class="keyword">const</span> std::string&amp; value)</div><div class="line"><a name="l08119"></a><span class="lineno"> 8119</span>&#160;    {</div><div class="line"><a name="l08120"></a><span class="lineno"> 8120</span>&#160;      _data &lt;&lt; tag &lt;&lt; <span class="charliteral">&#39;=&#39;</span> &lt;&lt; value &lt;&lt; _fs;</div><div class="line"><a name="l08121"></a><span class="lineno"> 8121</span>&#160;    }</div><div class="line"><a name="l08122"></a><span class="lineno"> 8122</span>&#160;</div><div class="line"><a name="l08125"></a><span class="lineno"><a class="line" href="classAMPS_1_1__FIXBuilder.html#afa8c92970e0d5176ed81f1205f0e7adb"> 8125</a></span>&#160;    std::string <a class="code" href="classAMPS_1_1__FIXBuilder.html#afa8c92970e0d5176ed81f1205f0e7adb">getString</a>()<span class="keyword"> const</span></div><div class="line"><a name="l08126"></a><span class="lineno"> 8126</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l08127"></a><span class="lineno"> 8127</span>&#160;      <span class="keywordflow">return</span> _data.str();</div><div class="line"><a name="l08128"></a><span class="lineno"> 8128</span>&#160;    }</div><div class="line"><a name="l08129"></a><span class="lineno"> 8129</span>&#160;    <span class="keyword">operator</span> std::string()<span class="keyword"> const</span></div><div class="line"><a name="l08130"></a><span class="lineno"> 8130</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l08131"></a><span class="lineno"> 8131</span>&#160;      <span class="keywordflow">return</span> _data.str();</div><div class="line"><a name="l08132"></a><span class="lineno"> 8132</span>&#160;    }</div><div class="line"><a name="l08133"></a><span class="lineno"> 8133</span>&#160;</div><div class="line"><a name="l08135"></a><span class="lineno"><a class="line" href="classAMPS_1_1__FIXBuilder.html#a9c68c4632ca5b644f0e664190a40d27d"> 8135</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAMPS_1_1__FIXBuilder.html#a9c68c4632ca5b644f0e664190a40d27d">reset</a>()</div><div class="line"><a name="l08136"></a><span class="lineno"> 8136</span>&#160;    {</div><div class="line"><a name="l08137"></a><span class="lineno"> 8137</span>&#160;      _data.str(std::string());</div><div class="line"><a name="l08138"></a><span class="lineno"> 8138</span>&#160;    }</div><div class="line"><a name="l08139"></a><span class="lineno"> 8139</span>&#160;  };</div><div class="line"><a name="l08140"></a><span class="lineno"> 8140</span>&#160;</div><div class="line"><a name="l08144"></a><span class="lineno"> 8144</span>&#160;</div><div class="line"><a name="l08145"></a><span class="lineno"><a class="line" href="ampsplusplus_8hpp.html#ab3ac5c3b6593c422f819df1c0da4d253"> 8145</a></span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classAMPS_1_1__FIXBuilder.html">_FIXBuilder&lt;int&gt;</a> <a class="code" href="classAMPS_1_1__FIXBuilder.html">FIXBuilder</a>;</div><div class="line"><a name="l08146"></a><span class="lineno"> 8146</span>&#160;</div><div class="line"><a name="l08150"></a><span class="lineno"> 8150</span>&#160;</div><div class="line"><a name="l08151"></a><span class="lineno"><a class="line" href="ampsplusplus_8hpp.html#addd675ccdd3bb1768d7165cf205c70aa"> 8151</a></span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classAMPS_1_1__FIXBuilder.html">_FIXBuilder&lt;std::string&gt;</a> <a class="code" href="classAMPS_1_1__FIXBuilder.html">NVFIXBuilder</a>;</div><div class="line"><a name="l08152"></a><span class="lineno"> 8152</span>&#160;</div><div class="line"><a name="l08153"></a><span class="lineno"> 8153</span>&#160;</div><div class="line"><a name="l08161"></a><span class="lineno"> 8161</span>&#160;</div><div class="line"><a name="l08162"></a><span class="lineno"><a class="line" href="classAMPS_1_1FIXShredder.html"> 8162</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classAMPS_1_1FIXShredder.html">FIXShredder</a></div><div class="line"><a name="l08163"></a><span class="lineno"> 8163</span>&#160;  {</div><div class="line"><a name="l08164"></a><span class="lineno"> 8164</span>&#160;    <span class="keywordtype">char</span> _fs;</div><div class="line"><a name="l08165"></a><span class="lineno"> 8165</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l08170"></a><span class="lineno"><a class="line" href="classAMPS_1_1FIXShredder.html#af693877930aa1bc6b64cabbff322314d"> 8170</a></span>&#160;    <a class="code" href="classAMPS_1_1FIXShredder.html#af693877930aa1bc6b64cabbff322314d">FIXShredder</a>(<span class="keywordtype">char</span> fieldSep_ = (<span class="keywordtype">char</span>)1) : _fs(fieldSep_) {;}</div><div class="line"><a name="l08171"></a><span class="lineno"> 8171</span>&#160;</div><div class="line"><a name="l08174"></a><span class="lineno"><a class="line" href="classAMPS_1_1FIXShredder.html#a2fd96472d6b8cea917632257c67fa8a1"> 8174</a></span>&#160;    <span class="keyword">typedef</span> std::map&lt;Message::Field, Message::Field&gt; <a class="code" href="classAMPS_1_1FIXShredder.html#a2fd96472d6b8cea917632257c67fa8a1">map_type</a>;</div><div class="line"><a name="l08175"></a><span class="lineno"> 8175</span>&#160;</div><div class="line"><a name="l08181"></a><span class="lineno"><a class="line" href="classAMPS_1_1FIXShredder.html#ae0d65bf19d13d713ef7e7dd5c5466419"> 8181</a></span>&#160;    map_type <a class="code" href="classAMPS_1_1FIXShredder.html#ae0d65bf19d13d713ef7e7dd5c5466419">toMap</a>(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Field.html">Message::Field</a>&amp; data)</div><div class="line"><a name="l08182"></a><span class="lineno"> 8182</span>&#160;    {</div><div class="line"><a name="l08183"></a><span class="lineno"> 8183</span>&#160;      FIX fix(data, _fs);</div><div class="line"><a name="l08184"></a><span class="lineno"> 8184</span>&#160;      map_type retval;</div><div class="line"><a name="l08185"></a><span class="lineno"> 8185</span>&#160;      <span class="keywordflow">for</span> (FIX::iterator a = fix.begin(); a != fix.end(); ++a)</div><div class="line"><a name="l08186"></a><span class="lineno"> 8186</span>&#160;      {</div><div class="line"><a name="l08187"></a><span class="lineno"> 8187</span>&#160;        retval.insert(*a);</div><div class="line"><a name="l08188"></a><span class="lineno"> 8188</span>&#160;      }</div><div class="line"><a name="l08189"></a><span class="lineno"> 8189</span>&#160;</div><div class="line"><a name="l08190"></a><span class="lineno"> 8190</span>&#160;      <span class="keywordflow">return</span> retval;</div><div class="line"><a name="l08191"></a><span class="lineno"> 8191</span>&#160;    }</div><div class="line"><a name="l08192"></a><span class="lineno"> 8192</span>&#160;  };</div><div class="line"><a name="l08193"></a><span class="lineno"> 8193</span>&#160;</div><div class="line"><a name="l08194"></a><span class="lineno"> 8194</span>&#160;<span class="preprocessor">#define AMPS_MESSAGE_STREAM_CACHE_MAX 128</span></div><div class="line"><a name="l08195"></a><span class="lineno"> 8195</span>&#160;  <span class="keyword">class </span>MessageStreamImpl : <span class="keyword">public</span> AMPS::RefBody, <a class="code" href="classAMPS_1_1ConnectionStateListener.html">AMPS::ConnectionStateListener</a></div><div class="line"><a name="l08196"></a><span class="lineno"> 8196</span>&#160;  {</div><div class="line"><a name="l08197"></a><span class="lineno"> 8197</span>&#160;    Mutex                _lock;</div><div class="line"><a name="l08198"></a><span class="lineno"> 8198</span>&#160;    std::deque&lt;Message&gt;  _q;</div><div class="line"><a name="l08199"></a><span class="lineno"> 8199</span>&#160;    std::deque&lt;Message&gt;  _cache;</div><div class="line"><a name="l08200"></a><span class="lineno"> 8200</span>&#160;    std::string          _commandId;</div><div class="line"><a name="l08201"></a><span class="lineno"> 8201</span>&#160;    std::string          _subId;</div><div class="line"><a name="l08202"></a><span class="lineno"> 8202</span>&#160;    std::string          _queryId;</div><div class="line"><a name="l08203"></a><span class="lineno"> 8203</span>&#160;    Client               _client;</div><div class="line"><a name="l08204"></a><span class="lineno"> 8204</span>&#160;    <span class="keywordtype">unsigned</span>             _timeout;</div><div class="line"><a name="l08205"></a><span class="lineno"> 8205</span>&#160;    <span class="keywordtype">unsigned</span>             _maxDepth;</div><div class="line"><a name="l08206"></a><span class="lineno"> 8206</span>&#160;    <span class="keywordtype">unsigned</span>             _requestedAcks;</div><div class="line"><a name="l08207"></a><span class="lineno"> 8207</span>&#160;    <span class="keywordtype">size_t</span>               _cacheMax;</div><div class="line"><a name="l08208"></a><span class="lineno"> 8208</span>&#160;    <a class="code" href="classAMPS_1_1Field.html">Message::Field</a>       _previousTopic;</div><div class="line"><a name="l08209"></a><span class="lineno"> 8209</span>&#160;    <a class="code" href="classAMPS_1_1Field.html">Message::Field</a>       _previousBookmark;</div><div class="line"><a name="l08210"></a><span class="lineno"> 8210</span>&#160;    <span class="keyword">typedef</span> <span class="keyword">enum</span> : <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> { Unset = 0x0, Running = 0x10, Subscribe = 0x11, SOWOnly = 0x12, AcksOnly = 0x13, Conflate = 0x14, Closed = 0x1, Disconnected = 0x2 } State;</div><div class="line"><a name="l08211"></a><span class="lineno"> 8211</span>&#160;<span class="preprocessor">#if __cplusplus &gt;= 201100L || _MSC_VER &gt;= 1900</span></div><div class="line"><a name="l08212"></a><span class="lineno"> 8212</span>&#160;    std::atomic&lt;State&gt; _state;</div><div class="line"><a name="l08213"></a><span class="lineno"> 8213</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l08214"></a><span class="lineno"> 8214</span>&#160;    <span class="keyword">volatile</span> State _state;</div><div class="line"><a name="l08215"></a><span class="lineno"> 8215</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l08216"></a><span class="lineno"> 8216</span>&#160;    <span class="keyword">typedef</span> std::map&lt;std::string, Message*&gt; SOWKeyMap;</div><div class="line"><a name="l08217"></a><span class="lineno"> 8217</span>&#160;    SOWKeyMap _sowKeyMap;</div><div class="line"><a name="l08218"></a><span class="lineno"> 8218</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l08219"></a><span class="lineno"> 8219</span>&#160;    MessageStreamImpl(<span class="keyword">const</span> Client&amp; client_)</div><div class="line"><a name="l08220"></a><span class="lineno"> 8220</span>&#160;      : _client(client_),</div><div class="line"><a name="l08221"></a><span class="lineno"> 8221</span>&#160;        _timeout(0),</div><div class="line"><a name="l08222"></a><span class="lineno"> 8222</span>&#160;        _maxDepth((<span class="keywordtype">unsigned</span>)~0),</div><div class="line"><a name="l08223"></a><span class="lineno"> 8223</span>&#160;        _requestedAcks(0),</div><div class="line"><a name="l08224"></a><span class="lineno"> 8224</span>&#160;        _cacheMax(AMPS_MESSAGE_STREAM_CACHE_MAX),</div><div class="line"><a name="l08225"></a><span class="lineno"> 8225</span>&#160;        _state(Unset)</div><div class="line"><a name="l08226"></a><span class="lineno"> 8226</span>&#160;    {</div><div class="line"><a name="l08227"></a><span class="lineno"> 8227</span>&#160;      <span class="keywordflow">if</span> (_client.isValid())</div><div class="line"><a name="l08228"></a><span class="lineno"> 8228</span>&#160;      {</div><div class="line"><a name="l08229"></a><span class="lineno"> 8229</span>&#160;        _client.<a class="code" href="classAMPS_1_1Client.html#adc5b02f576cab62cfdaae495b83857ef">addConnectionStateListener</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l08230"></a><span class="lineno"> 8230</span>&#160;      }</div><div class="line"><a name="l08231"></a><span class="lineno"> 8231</span>&#160;    }</div><div class="line"><a name="l08232"></a><span class="lineno"> 8232</span>&#160;</div><div class="line"><a name="l08233"></a><span class="lineno"> 8233</span>&#160;    MessageStreamImpl(ClientImpl* client_)</div><div class="line"><a name="l08234"></a><span class="lineno"> 8234</span>&#160;      : _client(client_),</div><div class="line"><a name="l08235"></a><span class="lineno"> 8235</span>&#160;        _timeout(0),</div><div class="line"><a name="l08236"></a><span class="lineno"> 8236</span>&#160;        _maxDepth((<span class="keywordtype">unsigned</span>)~0),</div><div class="line"><a name="l08237"></a><span class="lineno"> 8237</span>&#160;        _requestedAcks(0),</div><div class="line"><a name="l08238"></a><span class="lineno"> 8238</span>&#160;        _state(Unset)</div><div class="line"><a name="l08239"></a><span class="lineno"> 8239</span>&#160;    {</div><div class="line"><a name="l08240"></a><span class="lineno"> 8240</span>&#160;      <span class="keywordflow">if</span> (_client.isValid())</div><div class="line"><a name="l08241"></a><span class="lineno"> 8241</span>&#160;      {</div><div class="line"><a name="l08242"></a><span class="lineno"> 8242</span>&#160;        _client.<a class="code" href="classAMPS_1_1Client.html#adc5b02f576cab62cfdaae495b83857ef">addConnectionStateListener</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l08243"></a><span class="lineno"> 8243</span>&#160;      }</div><div class="line"><a name="l08244"></a><span class="lineno"> 8244</span>&#160;    }</div><div class="line"><a name="l08245"></a><span class="lineno"> 8245</span>&#160;</div><div class="line"><a name="l08246"></a><span class="lineno"> 8246</span>&#160;    ~MessageStreamImpl()</div><div class="line"><a name="l08247"></a><span class="lineno"> 8247</span>&#160;    {</div><div class="line"><a name="l08248"></a><span class="lineno"> 8248</span>&#160;    }</div><div class="line"><a name="l08249"></a><span class="lineno"> 8249</span>&#160;</div><div class="line"><a name="l08250"></a><span class="lineno"> 8250</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> destroy()</div><div class="line"><a name="l08251"></a><span class="lineno"> 8251</span>&#160;    {</div><div class="line"><a name="l08252"></a><span class="lineno"> 8252</span>&#160;      <span class="keywordflow">try</span></div><div class="line"><a name="l08253"></a><span class="lineno"> 8253</span>&#160;      {</div><div class="line"><a name="l08254"></a><span class="lineno"> 8254</span>&#160;        close();</div><div class="line"><a name="l08255"></a><span class="lineno"> 8255</span>&#160;      }</div><div class="line"><a name="l08256"></a><span class="lineno"> 8256</span>&#160;      <span class="keywordflow">catch</span> (std::exception&amp; e)</div><div class="line"><a name="l08257"></a><span class="lineno"> 8257</span>&#160;      {</div><div class="line"><a name="l08258"></a><span class="lineno"> 8258</span>&#160;        <span class="keywordflow">try</span></div><div class="line"><a name="l08259"></a><span class="lineno"> 8259</span>&#160;        {</div><div class="line"><a name="l08260"></a><span class="lineno"> 8260</span>&#160;          <span class="keywordflow">if</span> (_client.isValid())</div><div class="line"><a name="l08261"></a><span class="lineno"> 8261</span>&#160;          {</div><div class="line"><a name="l08262"></a><span class="lineno"> 8262</span>&#160;            _client.<a class="code" href="classAMPS_1_1Client.html#a8d0f8687473d87b04bc7da59eedbf01c">getExceptionListener</a>().exceptionThrown(e);</div><div class="line"><a name="l08263"></a><span class="lineno"> 8263</span>&#160;          }</div><div class="line"><a name="l08264"></a><span class="lineno"> 8264</span>&#160;        }</div><div class="line"><a name="l08265"></a><span class="lineno"> 8265</span>&#160;        <span class="keywordflow">catch</span> (...) {<span class="comment">/*Ignore exception listener exceptions*/</span>}   <span class="comment">// -V565</span></div><div class="line"><a name="l08266"></a><span class="lineno"> 8266</span>&#160;      }</div><div class="line"><a name="l08267"></a><span class="lineno"> 8267</span>&#160;      <span class="keywordflow">if</span> (_client.isValid())</div><div class="line"><a name="l08268"></a><span class="lineno"> 8268</span>&#160;      {</div><div class="line"><a name="l08269"></a><span class="lineno"> 8269</span>&#160;        _client.<a class="code" href="classAMPS_1_1Client.html#a130c79c818383f906967a6d8a0bad2ed">removeConnectionStateListener</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l08270"></a><span class="lineno"> 8270</span>&#160;        Client c = _client;</div><div class="line"><a name="l08271"></a><span class="lineno"> 8271</span>&#160;        _client = Client((ClientImpl*)NULL);</div><div class="line"><a name="l08272"></a><span class="lineno"> 8272</span>&#160;        c.deferredExecution(MessageStreamImpl::destroyer, <span class="keyword">this</span>);</div><div class="line"><a name="l08273"></a><span class="lineno"> 8273</span>&#160;      }</div><div class="line"><a name="l08274"></a><span class="lineno"> 8274</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l08275"></a><span class="lineno"> 8275</span>&#160;      {</div><div class="line"><a name="l08276"></a><span class="lineno"> 8276</span>&#160;        <span class="keyword">delete</span> <span class="keyword">this</span>;</div><div class="line"><a name="l08277"></a><span class="lineno"> 8277</span>&#160;      }</div><div class="line"><a name="l08278"></a><span class="lineno"> 8278</span>&#160;    }</div><div class="line"><a name="l08279"></a><span class="lineno"> 8279</span>&#160;</div><div class="line"><a name="l08280"></a><span class="lineno"> 8280</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">void</span> destroyer(<span class="keywordtype">void</span>* vpMessageStreamImpl_)</div><div class="line"><a name="l08281"></a><span class="lineno"> 8281</span>&#160;    {</div><div class="line"><a name="l08282"></a><span class="lineno"> 8282</span>&#160;      <span class="keyword">delete</span> ((MessageStreamImpl*)vpMessageStreamImpl_);</div><div class="line"><a name="l08283"></a><span class="lineno"> 8283</span>&#160;    }</div><div class="line"><a name="l08284"></a><span class="lineno"> 8284</span>&#160;</div><div class="line"><a name="l08285"></a><span class="lineno"> 8285</span>&#160;    <span class="keywordtype">void</span> setSubscription(<span class="keyword">const</span> std::string&amp; subId_,</div><div class="line"><a name="l08286"></a><span class="lineno"> 8286</span>&#160;                         <span class="keyword">const</span> std::string&amp; commandId_ = <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l08287"></a><span class="lineno"> 8287</span>&#160;                         <span class="keyword">const</span> std::string&amp; queryId_ = <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l08288"></a><span class="lineno"> 8288</span>&#160;    {</div><div class="line"><a name="l08289"></a><span class="lineno"> 8289</span>&#160;      Lock&lt;Mutex&gt; lock(_lock);</div><div class="line"><a name="l08290"></a><span class="lineno"> 8290</span>&#160;      _subId = subId_;</div><div class="line"><a name="l08291"></a><span class="lineno"> 8291</span>&#160;      <span class="keywordflow">if</span> (!commandId_.empty() &amp;&amp; commandId_ != subId_)</div><div class="line"><a name="l08292"></a><span class="lineno"> 8292</span>&#160;      {</div><div class="line"><a name="l08293"></a><span class="lineno"> 8293</span>&#160;        _commandId = commandId_;</div><div class="line"><a name="l08294"></a><span class="lineno"> 8294</span>&#160;      }</div><div class="line"><a name="l08295"></a><span class="lineno"> 8295</span>&#160;      <span class="keywordflow">if</span> (!queryId_.empty() &amp;&amp; queryId_ != subId_ &amp;&amp; queryId_ != commandId_)</div><div class="line"><a name="l08296"></a><span class="lineno"> 8296</span>&#160;      {</div><div class="line"><a name="l08297"></a><span class="lineno"> 8297</span>&#160;        _queryId = queryId_;</div><div class="line"><a name="l08298"></a><span class="lineno"> 8298</span>&#160;      }</div><div class="line"><a name="l08299"></a><span class="lineno"> 8299</span>&#160;      <span class="comment">// It&#39;s possible to disconnect between creation/registration and here.</span></div><div class="line"><a name="l08300"></a><span class="lineno"> 8300</span>&#160;      <span class="keywordflow">if</span> (Disconnected == _state)</div><div class="line"><a name="l08301"></a><span class="lineno"> 8301</span>&#160;      {</div><div class="line"><a name="l08302"></a><span class="lineno"> 8302</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l08303"></a><span class="lineno"> 8303</span>&#160;      }</div><div class="line"><a name="l08304"></a><span class="lineno"> 8304</span>&#160;      assert(Unset == _state);</div><div class="line"><a name="l08305"></a><span class="lineno"> 8305</span>&#160;      _state = Subscribe;</div><div class="line"><a name="l08306"></a><span class="lineno"> 8306</span>&#160;    }</div><div class="line"><a name="l08307"></a><span class="lineno"> 8307</span>&#160;</div><div class="line"><a name="l08308"></a><span class="lineno"> 8308</span>&#160;    <span class="keywordtype">void</span> setSOWOnly(<span class="keyword">const</span> std::string&amp; commandId_,</div><div class="line"><a name="l08309"></a><span class="lineno"> 8309</span>&#160;                    <span class="keyword">const</span> std::string&amp; queryId_ = <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l08310"></a><span class="lineno"> 8310</span>&#160;    {</div><div class="line"><a name="l08311"></a><span class="lineno"> 8311</span>&#160;      Lock&lt;Mutex&gt; lock(_lock);</div><div class="line"><a name="l08312"></a><span class="lineno"> 8312</span>&#160;      _commandId = commandId_;</div><div class="line"><a name="l08313"></a><span class="lineno"> 8313</span>&#160;      <span class="keywordflow">if</span> (!queryId_.empty() &amp;&amp; queryId_ != commandId_)</div><div class="line"><a name="l08314"></a><span class="lineno"> 8314</span>&#160;      {</div><div class="line"><a name="l08315"></a><span class="lineno"> 8315</span>&#160;        _queryId = queryId_;</div><div class="line"><a name="l08316"></a><span class="lineno"> 8316</span>&#160;      }</div><div class="line"><a name="l08317"></a><span class="lineno"> 8317</span>&#160;      <span class="comment">// It&#39;s possible to disconnect between creation/registration and here.</span></div><div class="line"><a name="l08318"></a><span class="lineno"> 8318</span>&#160;      <span class="keywordflow">if</span> (Disconnected == _state)</div><div class="line"><a name="l08319"></a><span class="lineno"> 8319</span>&#160;      {</div><div class="line"><a name="l08320"></a><span class="lineno"> 8320</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l08321"></a><span class="lineno"> 8321</span>&#160;      }</div><div class="line"><a name="l08322"></a><span class="lineno"> 8322</span>&#160;      assert(Unset == _state);</div><div class="line"><a name="l08323"></a><span class="lineno"> 8323</span>&#160;      _state = SOWOnly;</div><div class="line"><a name="l08324"></a><span class="lineno"> 8324</span>&#160;    }</div><div class="line"><a name="l08325"></a><span class="lineno"> 8325</span>&#160;</div><div class="line"><a name="l08326"></a><span class="lineno"> 8326</span>&#160;    <span class="keywordtype">void</span> setStatsOnly(<span class="keyword">const</span> std::string&amp; commandId_,</div><div class="line"><a name="l08327"></a><span class="lineno"> 8327</span>&#160;                      <span class="keyword">const</span> std::string&amp; queryId_ = <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l08328"></a><span class="lineno"> 8328</span>&#160;    {</div><div class="line"><a name="l08329"></a><span class="lineno"> 8329</span>&#160;      Lock&lt;Mutex&gt; lock(_lock);</div><div class="line"><a name="l08330"></a><span class="lineno"> 8330</span>&#160;      _commandId = commandId_;</div><div class="line"><a name="l08331"></a><span class="lineno"> 8331</span>&#160;      <span class="keywordflow">if</span> (!queryId_.empty() &amp;&amp; queryId_ != commandId_)</div><div class="line"><a name="l08332"></a><span class="lineno"> 8332</span>&#160;      {</div><div class="line"><a name="l08333"></a><span class="lineno"> 8333</span>&#160;        _queryId = queryId_;</div><div class="line"><a name="l08334"></a><span class="lineno"> 8334</span>&#160;      }</div><div class="line"><a name="l08335"></a><span class="lineno"> 8335</span>&#160;      <span class="comment">// It&#39;s possible to disconnect between creation/registration and here.</span></div><div class="line"><a name="l08336"></a><span class="lineno"> 8336</span>&#160;      <span class="keywordflow">if</span> (Disconnected == _state)</div><div class="line"><a name="l08337"></a><span class="lineno"> 8337</span>&#160;      {</div><div class="line"><a name="l08338"></a><span class="lineno"> 8338</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l08339"></a><span class="lineno"> 8339</span>&#160;      }</div><div class="line"><a name="l08340"></a><span class="lineno"> 8340</span>&#160;      assert(Unset == _state);</div><div class="line"><a name="l08341"></a><span class="lineno"> 8341</span>&#160;      _state = AcksOnly;</div><div class="line"><a name="l08342"></a><span class="lineno"> 8342</span>&#160;      _requestedAcks = Message::AckType::Stats;</div><div class="line"><a name="l08343"></a><span class="lineno"> 8343</span>&#160;    }</div><div class="line"><a name="l08344"></a><span class="lineno"> 8344</span>&#160;</div><div class="line"><a name="l08345"></a><span class="lineno"> 8345</span>&#160;    <span class="keywordtype">void</span> setAcksOnly(<span class="keyword">const</span> std::string&amp; commandId_, <span class="keywordtype">unsigned</span> acks_)</div><div class="line"><a name="l08346"></a><span class="lineno"> 8346</span>&#160;    {</div><div class="line"><a name="l08347"></a><span class="lineno"> 8347</span>&#160;      Lock&lt;Mutex&gt; lock(_lock);</div><div class="line"><a name="l08348"></a><span class="lineno"> 8348</span>&#160;      _commandId = commandId_;</div><div class="line"><a name="l08349"></a><span class="lineno"> 8349</span>&#160;      <span class="comment">// It&#39;s possible to disconnect between creation/registration and here.</span></div><div class="line"><a name="l08350"></a><span class="lineno"> 8350</span>&#160;      <span class="keywordflow">if</span> (Disconnected == _state)</div><div class="line"><a name="l08351"></a><span class="lineno"> 8351</span>&#160;      {</div><div class="line"><a name="l08352"></a><span class="lineno"> 8352</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l08353"></a><span class="lineno"> 8353</span>&#160;      }</div><div class="line"><a name="l08354"></a><span class="lineno"> 8354</span>&#160;      assert(Unset == _state);</div><div class="line"><a name="l08355"></a><span class="lineno"> 8355</span>&#160;      _state = AcksOnly;</div><div class="line"><a name="l08356"></a><span class="lineno"> 8356</span>&#160;      _requestedAcks = acks_;</div><div class="line"><a name="l08357"></a><span class="lineno"> 8357</span>&#160;    }</div><div class="line"><a name="l08358"></a><span class="lineno"> 8358</span>&#160;</div><div class="line"><a name="l08359"></a><span class="lineno"> 8359</span>&#160;    <span class="keywordtype">void</span> connectionStateChanged(<a class="code" href="classAMPS_1_1ConnectionStateListener.html#a6b55fc390dd4591b2a89fd00113f1ef3">ConnectionStateListener::State</a> state_)</div><div class="line"><a name="l08360"></a><span class="lineno"> 8360</span>&#160;    {</div><div class="line"><a name="l08361"></a><span class="lineno"> 8361</span>&#160;      Lock&lt;Mutex&gt; lock(_lock);</div><div class="line"><a name="l08362"></a><span class="lineno"> 8362</span>&#160;      <span class="keywordflow">if</span> (state_ == AMPS::ConnectionStateListener::Disconnected)</div><div class="line"><a name="l08363"></a><span class="lineno"> 8363</span>&#160;      {</div><div class="line"><a name="l08364"></a><span class="lineno"> 8364</span>&#160;        _state = Disconnected;</div><div class="line"><a name="l08365"></a><span class="lineno"> 8365</span>&#160;        close();</div><div class="line"><a name="l08366"></a><span class="lineno"> 8366</span>&#160;      }</div><div class="line"><a name="l08367"></a><span class="lineno"> 8367</span>&#160;      _lock.signalAll();</div><div class="line"><a name="l08368"></a><span class="lineno"> 8368</span>&#160;    }</div><div class="line"><a name="l08369"></a><span class="lineno"> 8369</span>&#160;</div><div class="line"><a name="l08370"></a><span class="lineno"> 8370</span>&#160;    <span class="keywordtype">void</span> timeout(<span class="keywordtype">unsigned</span> timeout_)</div><div class="line"><a name="l08371"></a><span class="lineno"> 8371</span>&#160;    {</div><div class="line"><a name="l08372"></a><span class="lineno"> 8372</span>&#160;      _timeout = timeout_;</div><div class="line"><a name="l08373"></a><span class="lineno"> 8373</span>&#160;    }</div><div class="line"><a name="l08374"></a><span class="lineno"> 8374</span>&#160;    <span class="keywordtype">void</span> conflate(<span class="keywordtype">void</span>)</div><div class="line"><a name="l08375"></a><span class="lineno"> 8375</span>&#160;    {</div><div class="line"><a name="l08376"></a><span class="lineno"> 8376</span>&#160;      <span class="keywordflow">if</span> (_state == Subscribe)</div><div class="line"><a name="l08377"></a><span class="lineno"> 8377</span>&#160;      {</div><div class="line"><a name="l08378"></a><span class="lineno"> 8378</span>&#160;        _state = Conflate;</div><div class="line"><a name="l08379"></a><span class="lineno"> 8379</span>&#160;      }</div><div class="line"><a name="l08380"></a><span class="lineno"> 8380</span>&#160;    }</div><div class="line"><a name="l08381"></a><span class="lineno"> 8381</span>&#160;    <span class="keywordtype">void</span> maxDepth(<span class="keywordtype">unsigned</span> maxDepth_)</div><div class="line"><a name="l08382"></a><span class="lineno"> 8382</span>&#160;    {</div><div class="line"><a name="l08383"></a><span class="lineno"> 8383</span>&#160;      <span class="keywordflow">if</span> (maxDepth_)</div><div class="line"><a name="l08384"></a><span class="lineno"> 8384</span>&#160;      {</div><div class="line"><a name="l08385"></a><span class="lineno"> 8385</span>&#160;        _maxDepth = maxDepth_;</div><div class="line"><a name="l08386"></a><span class="lineno"> 8386</span>&#160;      }</div><div class="line"><a name="l08387"></a><span class="lineno"> 8387</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l08388"></a><span class="lineno"> 8388</span>&#160;      {</div><div class="line"><a name="l08389"></a><span class="lineno"> 8389</span>&#160;        _maxDepth = (unsigned)~0;</div><div class="line"><a name="l08390"></a><span class="lineno"> 8390</span>&#160;      }</div><div class="line"><a name="l08391"></a><span class="lineno"> 8391</span>&#160;    }</div><div class="line"><a name="l08392"></a><span class="lineno"> 8392</span>&#160;    <span class="keywordtype">unsigned</span> getMaxDepth(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l08393"></a><span class="lineno"> 8393</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l08394"></a><span class="lineno"> 8394</span>&#160;      <span class="keywordflow">return</span> _maxDepth;</div><div class="line"><a name="l08395"></a><span class="lineno"> 8395</span>&#160;    }</div><div class="line"><a name="l08396"></a><span class="lineno"> 8396</span>&#160;    <span class="keywordtype">unsigned</span> getDepth(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l08397"></a><span class="lineno"> 8397</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l08398"></a><span class="lineno"> 8398</span>&#160;      <span class="keywordflow">return</span> (<span class="keywordtype">unsigned</span>)(_q.size());</div><div class="line"><a name="l08399"></a><span class="lineno"> 8399</span>&#160;    }</div><div class="line"><a name="l08400"></a><span class="lineno"> 8400</span>&#160;</div><div class="line"><a name="l08401"></a><span class="lineno"> 8401</span>&#160;    <span class="keywordtype">bool</span> next(<a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; current_)</div><div class="line"><a name="l08402"></a><span class="lineno"> 8402</span>&#160;    {</div><div class="line"><a name="l08403"></a><span class="lineno"> 8403</span>&#160;      Lock&lt;Mutex&gt; lock(_lock);</div><div class="line"><a name="l08404"></a><span class="lineno"> 8404</span>&#160;      <span class="keywordflow">if</span> (!_previousTopic.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>() &amp;&amp; !_previousBookmark.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>())</div><div class="line"><a name="l08405"></a><span class="lineno"> 8405</span>&#160;      {</div><div class="line"><a name="l08406"></a><span class="lineno"> 8406</span>&#160;        <span class="keywordflow">try</span></div><div class="line"><a name="l08407"></a><span class="lineno"> 8407</span>&#160;        {</div><div class="line"><a name="l08408"></a><span class="lineno"> 8408</span>&#160;          <span class="keywordflow">if</span> (_client.isValid())</div><div class="line"><a name="l08409"></a><span class="lineno"> 8409</span>&#160;          {</div><div class="line"><a name="l08410"></a><span class="lineno"> 8410</span>&#160;            _client.ackDeferredAutoAck(_previousTopic, _previousBookmark);</div><div class="line"><a name="l08411"></a><span class="lineno"> 8411</span>&#160;          }</div><div class="line"><a name="l08412"></a><span class="lineno"> 8412</span>&#160;        }</div><div class="line"><a name="l08413"></a><span class="lineno"> 8413</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div><div class="line"><a name="l08414"></a><span class="lineno"> 8414</span>&#160;        <span class="keywordflow">catch</span> (AMPSException&amp;)</div><div class="line"><a name="l08415"></a><span class="lineno"> 8415</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l08416"></a><span class="lineno"> 8416</span>&#160;        <span class="keywordflow">catch</span> (AMPSException&amp; e)</div><div class="line"><a name="l08417"></a><span class="lineno"> 8417</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l08418"></a><span class="lineno"> 8418</span>&#160;        {</div><div class="line"><a name="l08419"></a><span class="lineno"> 8419</span>&#160;          current_.invalidate();</div><div class="line"><a name="l08420"></a><span class="lineno"> 8420</span>&#160;          _previousTopic.<a class="code" href="classAMPS_1_1Field.html#a268793c302ec9a3b7ce83248ef7524b3">clear</a>();</div><div class="line"><a name="l08421"></a><span class="lineno"> 8421</span>&#160;          _previousBookmark.<a class="code" href="classAMPS_1_1Field.html#a268793c302ec9a3b7ce83248ef7524b3">clear</a>();</div><div class="line"><a name="l08422"></a><span class="lineno"> 8422</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l08423"></a><span class="lineno"> 8423</span>&#160;        }</div><div class="line"><a name="l08424"></a><span class="lineno"> 8424</span>&#160;        _previousTopic.<a class="code" href="classAMPS_1_1Field.html#a268793c302ec9a3b7ce83248ef7524b3">clear</a>();</div><div class="line"><a name="l08425"></a><span class="lineno"> 8425</span>&#160;        _previousBookmark.<a class="code" href="classAMPS_1_1Field.html#a268793c302ec9a3b7ce83248ef7524b3">clear</a>();</div><div class="line"><a name="l08426"></a><span class="lineno"> 8426</span>&#160;      }</div><div class="line"><a name="l08427"></a><span class="lineno"> 8427</span>&#160;      <span class="keywordtype">double</span> minWaitTime = (double)((_timeout &amp;&amp; _timeout &gt; 1000)</div><div class="line"><a name="l08428"></a><span class="lineno"> 8428</span>&#160;                                    ? _timeout : 1000);</div><div class="line"><a name="l08429"></a><span class="lineno"> 8429</span>&#160;      Timer timer(minWaitTime);</div><div class="line"><a name="l08430"></a><span class="lineno"> 8430</span>&#160;      timer.start();</div><div class="line"><a name="l08431"></a><span class="lineno"> 8431</span>&#160;      <span class="keywordflow">while</span> (_q.empty() &amp;&amp; _state &amp; Running)</div><div class="line"><a name="l08432"></a><span class="lineno"> 8432</span>&#160;      {</div><div class="line"><a name="l08433"></a><span class="lineno"> 8433</span>&#160;        <span class="comment">// Using timeout so python can interrupt</span></div><div class="line"><a name="l08434"></a><span class="lineno"> 8434</span>&#160;        _lock.wait((<span class="keywordtype">long</span>)minWaitTime);</div><div class="line"><a name="l08435"></a><span class="lineno"> 8435</span>&#160;        {</div><div class="line"><a name="l08436"></a><span class="lineno"> 8436</span>&#160;          Unlock&lt;Mutex&gt; unlck(_lock);</div><div class="line"><a name="l08437"></a><span class="lineno"> 8437</span>&#160;          amps_invoke_waiting_function();</div><div class="line"><a name="l08438"></a><span class="lineno"> 8438</span>&#160;        }</div><div class="line"><a name="l08439"></a><span class="lineno"> 8439</span>&#160;        <span class="keywordflow">if</span> (_timeout)</div><div class="line"><a name="l08440"></a><span class="lineno"> 8440</span>&#160;        {</div><div class="line"><a name="l08441"></a><span class="lineno"> 8441</span>&#160;          <span class="comment">// In case we woke up early, see how much longer to wait</span></div><div class="line"><a name="l08442"></a><span class="lineno"> 8442</span>&#160;          <span class="keywordflow">if</span> (timer.checkAndGetRemaining(&amp;minWaitTime))</div><div class="line"><a name="l08443"></a><span class="lineno"> 8443</span>&#160;          {</div><div class="line"><a name="l08444"></a><span class="lineno"> 8444</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08445"></a><span class="lineno"> 8445</span>&#160;          }</div><div class="line"><a name="l08446"></a><span class="lineno"> 8446</span>&#160;        }</div><div class="line"><a name="l08447"></a><span class="lineno"> 8447</span>&#160;      }</div><div class="line"><a name="l08448"></a><span class="lineno"> 8448</span>&#160;      <span class="keywordflow">if</span> (current_.isValid() &amp;&amp; _cache.size() &lt; _cacheMax)</div><div class="line"><a name="l08449"></a><span class="lineno"> 8449</span>&#160;      {</div><div class="line"><a name="l08450"></a><span class="lineno"> 8450</span>&#160;        current_.reset();</div><div class="line"><a name="l08451"></a><span class="lineno"> 8451</span>&#160;        _cache.push_back(current_);</div><div class="line"><a name="l08452"></a><span class="lineno"> 8452</span>&#160;      }</div><div class="line"><a name="l08453"></a><span class="lineno"> 8453</span>&#160;      <span class="keywordflow">if</span> (!_q.empty())</div><div class="line"><a name="l08454"></a><span class="lineno"> 8454</span>&#160;      {</div><div class="line"><a name="l08455"></a><span class="lineno"> 8455</span>&#160;        current_ = _q.front();</div><div class="line"><a name="l08456"></a><span class="lineno"> 8456</span>&#160;        <span class="keywordflow">if</span> (_q.size() == _maxDepth)</div><div class="line"><a name="l08457"></a><span class="lineno"> 8457</span>&#160;        {</div><div class="line"><a name="l08458"></a><span class="lineno"> 8458</span>&#160;          _lock.signalAll();</div><div class="line"><a name="l08459"></a><span class="lineno"> 8459</span>&#160;        }</div><div class="line"><a name="l08460"></a><span class="lineno"> 8460</span>&#160;        _q.pop_front();</div><div class="line"><a name="l08461"></a><span class="lineno"> 8461</span>&#160;        <span class="keywordflow">if</span> (_state == Conflate)</div><div class="line"><a name="l08462"></a><span class="lineno"> 8462</span>&#160;        {</div><div class="line"><a name="l08463"></a><span class="lineno"> 8463</span>&#160;          std::string sowKey = current_.<a class="code" href="classAMPS_1_1Message.html#a4fbc8a1d311ccc20ab3cf3bc48f71d36">getSowKey</a>();</div><div class="line"><a name="l08464"></a><span class="lineno"> 8464</span>&#160;          <span class="keywordflow">if</span> (sowKey.length())</div><div class="line"><a name="l08465"></a><span class="lineno"> 8465</span>&#160;          {</div><div class="line"><a name="l08466"></a><span class="lineno"> 8466</span>&#160;            _sowKeyMap.erase(sowKey);</div><div class="line"><a name="l08467"></a><span class="lineno"> 8467</span>&#160;          }</div><div class="line"><a name="l08468"></a><span class="lineno"> 8468</span>&#160;        }</div><div class="line"><a name="l08469"></a><span class="lineno"> 8469</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (_state == AcksOnly)</div><div class="line"><a name="l08470"></a><span class="lineno"> 8470</span>&#160;        {</div><div class="line"><a name="l08471"></a><span class="lineno"> 8471</span>&#160;          _requestedAcks &amp;= ~(current_.<a class="code" href="classAMPS_1_1Message.html#a7d58a2c39f59d6fca098efd4bb81d3b5">getAckTypeEnum</a>());</div><div class="line"><a name="l08472"></a><span class="lineno"> 8472</span>&#160;        }</div><div class="line"><a name="l08473"></a><span class="lineno"> 8473</span>&#160;        <span class="keywordflow">if</span> ((_state == AcksOnly &amp;&amp; _requestedAcks == 0) ||</div><div class="line"><a name="l08474"></a><span class="lineno"> 8474</span>&#160;            (_state == SOWOnly &amp;&amp; current_.<a class="code" href="classAMPS_1_1Message.html#a9bfa516683f5fd04d0ab2e3161b2babc">getCommand</a>() == <span class="stringliteral">&quot;group_end&quot;</span>))</div><div class="line"><a name="l08475"></a><span class="lineno"> 8475</span>&#160;        {</div><div class="line"><a name="l08476"></a><span class="lineno"> 8476</span>&#160;          _state = Closed;</div><div class="line"><a name="l08477"></a><span class="lineno"> 8477</span>&#160;        }</div><div class="line"><a name="l08478"></a><span class="lineno"> 8478</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (current_.<a class="code" href="classAMPS_1_1Message.html#a3e9f467321699a813340e57d4161f3e6">getCommandEnum</a>() == Message::Command::Publish &amp;&amp;</div><div class="line"><a name="l08479"></a><span class="lineno"> 8479</span>&#160;                 _client.isValid() &amp;&amp; _client.<a class="code" href="classAMPS_1_1Client.html#a5ef8782925a6ec46e9f77a282ee14ef7">getAutoAck</a>() &amp;&amp;</div><div class="line"><a name="l08480"></a><span class="lineno"> 8480</span>&#160;                 !current_.<a class="code" href="classAMPS_1_1Message.html#a7e6907cf19cb214f8c4bd02e236e01fb">getLeasePeriod</a>().<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>() &amp;&amp;</div><div class="line"><a name="l08481"></a><span class="lineno"> 8481</span>&#160;                 !current_.<a class="code" href="classAMPS_1_1Message.html#a7108ef0b54bc76e43dc4d49d700dc8ef">getBookmark</a>().<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>())</div><div class="line"><a name="l08482"></a><span class="lineno"> 8482</span>&#160;        {</div><div class="line"><a name="l08483"></a><span class="lineno"> 8483</span>&#160;          _previousTopic = current_.<a class="code" href="classAMPS_1_1Message.html#afdc3e09761f4076f3ee18e99cf254e97">getTopic</a>().<a class="code" href="classAMPS_1_1Field.html#a6ddfd1486e7bdb967e57eca5c963f1b3">deepCopy</a>();</div><div class="line"><a name="l08484"></a><span class="lineno"> 8484</span>&#160;          _previousBookmark = current_.<a class="code" href="classAMPS_1_1Message.html#a7108ef0b54bc76e43dc4d49d700dc8ef">getBookmark</a>().<a class="code" href="classAMPS_1_1Field.html#a6ddfd1486e7bdb967e57eca5c963f1b3">deepCopy</a>();</div><div class="line"><a name="l08485"></a><span class="lineno"> 8485</span>&#160;        }</div><div class="line"><a name="l08486"></a><span class="lineno"> 8486</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l08487"></a><span class="lineno"> 8487</span>&#160;      }</div><div class="line"><a name="l08488"></a><span class="lineno"> 8488</span>&#160;      <span class="keywordflow">if</span> (_state == Disconnected)</div><div class="line"><a name="l08489"></a><span class="lineno"> 8489</span>&#160;      {</div><div class="line"><a name="l08490"></a><span class="lineno"> 8490</span>&#160;        <span class="keywordflow">throw</span> DisconnectedException(<span class="stringliteral">&quot;Connection closed.&quot;</span>);</div><div class="line"><a name="l08491"></a><span class="lineno"> 8491</span>&#160;      }</div><div class="line"><a name="l08492"></a><span class="lineno"> 8492</span>&#160;      current_.invalidate();</div><div class="line"><a name="l08493"></a><span class="lineno"> 8493</span>&#160;      <span class="keywordflow">if</span> (_state == Closed)</div><div class="line"><a name="l08494"></a><span class="lineno"> 8494</span>&#160;      {</div><div class="line"><a name="l08495"></a><span class="lineno"> 8495</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l08496"></a><span class="lineno"> 8496</span>&#160;      }</div><div class="line"><a name="l08497"></a><span class="lineno"> 8497</span>&#160;      <span class="keywordflow">return</span> _timeout != 0;</div><div class="line"><a name="l08498"></a><span class="lineno"> 8498</span>&#160;    }</div><div class="line"><a name="l08499"></a><span class="lineno"> 8499</span>&#160;    <span class="keywordtype">void</span> close(<span class="keywordtype">void</span>)</div><div class="line"><a name="l08500"></a><span class="lineno"> 8500</span>&#160;    {</div><div class="line"><a name="l08501"></a><span class="lineno"> 8501</span>&#160;      <span class="keywordflow">if</span> (_client.isValid())</div><div class="line"><a name="l08502"></a><span class="lineno"> 8502</span>&#160;      {</div><div class="line"><a name="l08503"></a><span class="lineno"> 8503</span>&#160;        <span class="keywordflow">if</span> (_state == SOWOnly || _state == Subscribe) <span class="comment">//not delete</span></div><div class="line"><a name="l08504"></a><span class="lineno"> 8504</span>&#160;        {</div><div class="line"><a name="l08505"></a><span class="lineno"> 8505</span>&#160;          <span class="keywordflow">if</span> (!_commandId.empty())</div><div class="line"><a name="l08506"></a><span class="lineno"> 8506</span>&#160;          {</div><div class="line"><a name="l08507"></a><span class="lineno"> 8507</span>&#160;            _client.<a class="code" href="classAMPS_1_1Client.html#a53879275db21cd10862bc3702a9f6e67">unsubscribe</a>(_commandId);</div><div class="line"><a name="l08508"></a><span class="lineno"> 8508</span>&#160;          }</div><div class="line"><a name="l08509"></a><span class="lineno"> 8509</span>&#160;          <span class="keywordflow">if</span> (!_subId.empty())</div><div class="line"><a name="l08510"></a><span class="lineno"> 8510</span>&#160;          {</div><div class="line"><a name="l08511"></a><span class="lineno"> 8511</span>&#160;            _client.<a class="code" href="classAMPS_1_1Client.html#a53879275db21cd10862bc3702a9f6e67">unsubscribe</a>(_subId);</div><div class="line"><a name="l08512"></a><span class="lineno"> 8512</span>&#160;          }</div><div class="line"><a name="l08513"></a><span class="lineno"> 8513</span>&#160;          <span class="keywordflow">if</span> (!_queryId.empty())</div><div class="line"><a name="l08514"></a><span class="lineno"> 8514</span>&#160;          {</div><div class="line"><a name="l08515"></a><span class="lineno"> 8515</span>&#160;            _client.<a class="code" href="classAMPS_1_1Client.html#a53879275db21cd10862bc3702a9f6e67">unsubscribe</a>(_queryId);</div><div class="line"><a name="l08516"></a><span class="lineno"> 8516</span>&#160;          }</div><div class="line"><a name="l08517"></a><span class="lineno"> 8517</span>&#160;        }</div><div class="line"><a name="l08518"></a><span class="lineno"> 8518</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l08519"></a><span class="lineno"> 8519</span>&#160;        {</div><div class="line"><a name="l08520"></a><span class="lineno"> 8520</span>&#160;          <span class="keywordflow">if</span> (!_commandId.empty())</div><div class="line"><a name="l08521"></a><span class="lineno"> 8521</span>&#160;          {</div><div class="line"><a name="l08522"></a><span class="lineno"> 8522</span>&#160;            _client.<a class="code" href="classAMPS_1_1Client.html#abf8c120c68bb374f839b7510d12647e7">removeMessageHandler</a>(_commandId);</div><div class="line"><a name="l08523"></a><span class="lineno"> 8523</span>&#160;          }</div><div class="line"><a name="l08524"></a><span class="lineno"> 8524</span>&#160;          <span class="keywordflow">if</span> (!_subId.empty())</div><div class="line"><a name="l08525"></a><span class="lineno"> 8525</span>&#160;          {</div><div class="line"><a name="l08526"></a><span class="lineno"> 8526</span>&#160;            _client.<a class="code" href="classAMPS_1_1Client.html#abf8c120c68bb374f839b7510d12647e7">removeMessageHandler</a>(_subId);</div><div class="line"><a name="l08527"></a><span class="lineno"> 8527</span>&#160;          }</div><div class="line"><a name="l08528"></a><span class="lineno"> 8528</span>&#160;          <span class="keywordflow">if</span> (!_queryId.empty())</div><div class="line"><a name="l08529"></a><span class="lineno"> 8529</span>&#160;          {</div><div class="line"><a name="l08530"></a><span class="lineno"> 8530</span>&#160;            _client.<a class="code" href="classAMPS_1_1Client.html#abf8c120c68bb374f839b7510d12647e7">removeMessageHandler</a>(_queryId);</div><div class="line"><a name="l08531"></a><span class="lineno"> 8531</span>&#160;          }</div><div class="line"><a name="l08532"></a><span class="lineno"> 8532</span>&#160;        }</div><div class="line"><a name="l08533"></a><span class="lineno"> 8533</span>&#160;      }</div><div class="line"><a name="l08534"></a><span class="lineno"> 8534</span>&#160;      <span class="keywordflow">if</span> (_state == SOWOnly || _state == Subscribe || _state == Unset)</div><div class="line"><a name="l08535"></a><span class="lineno"> 8535</span>&#160;      {</div><div class="line"><a name="l08536"></a><span class="lineno"> 8536</span>&#160;        _state = Closed;</div><div class="line"><a name="l08537"></a><span class="lineno"> 8537</span>&#160;      }</div><div class="line"><a name="l08538"></a><span class="lineno"> 8538</span>&#160;    }</div><div class="line"><a name="l08539"></a><span class="lineno"> 8539</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">void</span> _messageHandler(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message_, MessageStreamImpl* this_)</div><div class="line"><a name="l08540"></a><span class="lineno"> 8540</span>&#160;    {</div><div class="line"><a name="l08541"></a><span class="lineno"> 8541</span>&#160;      Lock&lt;Mutex&gt; lock(this_-&gt;_lock);</div><div class="line"><a name="l08542"></a><span class="lineno"> 8542</span>&#160;      <span class="keywordflow">if</span> (this_-&gt;_state != Conflate)</div><div class="line"><a name="l08543"></a><span class="lineno"> 8543</span>&#160;      {</div><div class="line"><a name="l08544"></a><span class="lineno"> 8544</span>&#160;        AMPS_TESTING_SLOW_MESSAGE_STREAM</div><div class="line"><a name="l08545"></a><span class="lineno"> 8545</span>&#160;        <span class="keywordflow">if</span> (this_-&gt;_q.size() &gt;= this_-&gt;_maxDepth)</div><div class="line"><a name="l08546"></a><span class="lineno"> 8546</span>&#160;        {</div><div class="line"><a name="l08547"></a><span class="lineno"> 8547</span>&#160;          <span class="comment">// We throw here so that heartbeats can be sent. The exception</span></div><div class="line"><a name="l08548"></a><span class="lineno"> 8548</span>&#160;          <span class="comment">// will be handled internally only, and the same Message will</span></div><div class="line"><a name="l08549"></a><span class="lineno"> 8549</span>&#160;          <span class="comment">// come back to try again. Make sure to signal.</span></div><div class="line"><a name="l08550"></a><span class="lineno"> 8550</span>&#160;          this_-&gt;_lock.signalAll();</div><div class="line"><a name="l08551"></a><span class="lineno"> 8551</span>&#160;          <span class="keywordflow">throw</span> MessageStreamFullException(<span class="stringliteral">&quot;Stream is currently full.&quot;</span>);</div><div class="line"><a name="l08552"></a><span class="lineno"> 8552</span>&#160;        }</div><div class="line"><a name="l08553"></a><span class="lineno"> 8553</span>&#160;        <span class="keywordflow">if</span> (!this_-&gt;_cache.empty())</div><div class="line"><a name="l08554"></a><span class="lineno"> 8554</span>&#160;        {</div><div class="line"><a name="l08555"></a><span class="lineno"> 8555</span>&#160;          this_-&gt;_cache.front().deepCopy(message_);</div><div class="line"><a name="l08556"></a><span class="lineno"> 8556</span>&#160;          this_-&gt;_q.push_back(this_-&gt;_cache.front());</div><div class="line"><a name="l08557"></a><span class="lineno"> 8557</span>&#160;          this_-&gt;_cache.pop_front();</div><div class="line"><a name="l08558"></a><span class="lineno"> 8558</span>&#160;        }</div><div class="line"><a name="l08559"></a><span class="lineno"> 8559</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l08560"></a><span class="lineno"> 8560</span>&#160;        {</div><div class="line"><a name="l08561"></a><span class="lineno"> 8561</span>&#160;<span class="preprocessor">#ifdef AMPS_USE_EMPLACE</span></div><div class="line"><a name="l08562"></a><span class="lineno"> 8562</span>&#160;          this_-&gt;_q.emplace_back(message_.<a class="code" href="classAMPS_1_1Message.html#afd3b5831324320af6566883f3b9ff9dd">deepCopy</a>());</div><div class="line"><a name="l08563"></a><span class="lineno"> 8563</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l08564"></a><span class="lineno"> 8564</span>&#160;          this_-&gt;_q.push_back(message_.<a class="code" href="classAMPS_1_1Message.html#afd3b5831324320af6566883f3b9ff9dd">deepCopy</a>());</div><div class="line"><a name="l08565"></a><span class="lineno"> 8565</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l08566"></a><span class="lineno"> 8566</span>&#160;        }</div><div class="line"><a name="l08567"></a><span class="lineno"> 8567</span>&#160;        <span class="keywordflow">if</span> (message_.<a class="code" href="classAMPS_1_1Message.html#a3e9f467321699a813340e57d4161f3e6">getCommandEnum</a>() == Message::Command::Publish &amp;&amp;</div><div class="line"><a name="l08568"></a><span class="lineno"> 8568</span>&#160;            this_-&gt;_client.isValid() &amp;&amp; this_-&gt;_client.getAutoAck() &amp;&amp;</div><div class="line"><a name="l08569"></a><span class="lineno"> 8569</span>&#160;            !message_.<a class="code" href="classAMPS_1_1Message.html#a7e6907cf19cb214f8c4bd02e236e01fb">getLeasePeriod</a>().<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>() &amp;&amp;</div><div class="line"><a name="l08570"></a><span class="lineno"> 8570</span>&#160;            !message_.<a class="code" href="classAMPS_1_1Message.html#a7108ef0b54bc76e43dc4d49d700dc8ef">getBookmark</a>().<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>())</div><div class="line"><a name="l08571"></a><span class="lineno"> 8571</span>&#160;        {</div><div class="line"><a name="l08572"></a><span class="lineno"> 8572</span>&#160;          message_.setIgnoreAutoAck();</div><div class="line"><a name="l08573"></a><span class="lineno"> 8573</span>&#160;        }</div><div class="line"><a name="l08574"></a><span class="lineno"> 8574</span>&#160;      }</div><div class="line"><a name="l08575"></a><span class="lineno"> 8575</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l08576"></a><span class="lineno"> 8576</span>&#160;      {</div><div class="line"><a name="l08577"></a><span class="lineno"> 8577</span>&#160;        std::string sowKey = message_.<a class="code" href="classAMPS_1_1Message.html#a4fbc8a1d311ccc20ab3cf3bc48f71d36">getSowKey</a>();</div><div class="line"><a name="l08578"></a><span class="lineno"> 8578</span>&#160;        <span class="keywordflow">if</span> (sowKey.length())</div><div class="line"><a name="l08579"></a><span class="lineno"> 8579</span>&#160;        {</div><div class="line"><a name="l08580"></a><span class="lineno"> 8580</span>&#160;          SOWKeyMap::iterator it = this_-&gt;_sowKeyMap.find(sowKey);</div><div class="line"><a name="l08581"></a><span class="lineno"> 8581</span>&#160;          <span class="keywordflow">if</span> (it != this_-&gt;_sowKeyMap.end())</div><div class="line"><a name="l08582"></a><span class="lineno"> 8582</span>&#160;          {</div><div class="line"><a name="l08583"></a><span class="lineno"> 8583</span>&#160;            it-&gt;second-&gt;deepCopy(message_);</div><div class="line"><a name="l08584"></a><span class="lineno"> 8584</span>&#160;          }</div><div class="line"><a name="l08585"></a><span class="lineno"> 8585</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l08586"></a><span class="lineno"> 8586</span>&#160;          {</div><div class="line"><a name="l08587"></a><span class="lineno"> 8587</span>&#160;            <span class="keywordflow">if</span> (this_-&gt;_q.size() &gt;= this_-&gt;_maxDepth)</div><div class="line"><a name="l08588"></a><span class="lineno"> 8588</span>&#160;            {</div><div class="line"><a name="l08589"></a><span class="lineno"> 8589</span>&#160;              <span class="comment">// We throw here so that heartbeats can be sent. The</span></div><div class="line"><a name="l08590"></a><span class="lineno"> 8590</span>&#160;              <span class="comment">// exception will be handled internally only, and the</span></div><div class="line"><a name="l08591"></a><span class="lineno"> 8591</span>&#160;              <span class="comment">// same Message will come back to try again. Make sure</span></div><div class="line"><a name="l08592"></a><span class="lineno"> 8592</span>&#160;              <span class="comment">// to signal.</span></div><div class="line"><a name="l08593"></a><span class="lineno"> 8593</span>&#160;              this_-&gt;_lock.signalAll();</div><div class="line"><a name="l08594"></a><span class="lineno"> 8594</span>&#160;              <span class="keywordflow">throw</span> MessageStreamFullException(<span class="stringliteral">&quot;Stream is currently full.&quot;</span>);</div><div class="line"><a name="l08595"></a><span class="lineno"> 8595</span>&#160;            }</div><div class="line"><a name="l08596"></a><span class="lineno"> 8596</span>&#160;            <span class="keywordflow">if</span> (!this_-&gt;_cache.empty())</div><div class="line"><a name="l08597"></a><span class="lineno"> 8597</span>&#160;            {</div><div class="line"><a name="l08598"></a><span class="lineno"> 8598</span>&#160;              this_-&gt;_cache.front().deepCopy(message_);</div><div class="line"><a name="l08599"></a><span class="lineno"> 8599</span>&#160;              this_-&gt;_q.push_back(this_-&gt;_cache.front());</div><div class="line"><a name="l08600"></a><span class="lineno"> 8600</span>&#160;              this_-&gt;_cache.pop_front();</div><div class="line"><a name="l08601"></a><span class="lineno"> 8601</span>&#160;            }</div><div class="line"><a name="l08602"></a><span class="lineno"> 8602</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l08603"></a><span class="lineno"> 8603</span>&#160;            {</div><div class="line"><a name="l08604"></a><span class="lineno"> 8604</span>&#160;<span class="preprocessor">#ifdef AMPS_USE_EMPLACE</span></div><div class="line"><a name="l08605"></a><span class="lineno"> 8605</span>&#160;              this_-&gt;_q.emplace_back(message_.<a class="code" href="classAMPS_1_1Message.html#afd3b5831324320af6566883f3b9ff9dd">deepCopy</a>());</div><div class="line"><a name="l08606"></a><span class="lineno"> 8606</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l08607"></a><span class="lineno"> 8607</span>&#160;              this_-&gt;_q.push_back(message_.<a class="code" href="classAMPS_1_1Message.html#afd3b5831324320af6566883f3b9ff9dd">deepCopy</a>());</div><div class="line"><a name="l08608"></a><span class="lineno"> 8608</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l08609"></a><span class="lineno"> 8609</span>&#160;            }</div><div class="line"><a name="l08610"></a><span class="lineno"> 8610</span>&#160;            this_-&gt;_sowKeyMap[sowKey] = &amp;(this_-&gt;_q.back());</div><div class="line"><a name="l08611"></a><span class="lineno"> 8611</span>&#160;          }</div><div class="line"><a name="l08612"></a><span class="lineno"> 8612</span>&#160;        }</div><div class="line"><a name="l08613"></a><span class="lineno"> 8613</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l08614"></a><span class="lineno"> 8614</span>&#160;        {</div><div class="line"><a name="l08615"></a><span class="lineno"> 8615</span>&#160;          <span class="keywordflow">if</span> (this_-&gt;_q.size() &gt;= this_-&gt;_maxDepth)</div><div class="line"><a name="l08616"></a><span class="lineno"> 8616</span>&#160;          {</div><div class="line"><a name="l08617"></a><span class="lineno"> 8617</span>&#160;            <span class="comment">// We throw here so that heartbeats can be sent. The exception</span></div><div class="line"><a name="l08618"></a><span class="lineno"> 8618</span>&#160;            <span class="comment">// will be handled internally only, and the same Message will</span></div><div class="line"><a name="l08619"></a><span class="lineno"> 8619</span>&#160;            <span class="comment">// come back to try again. Make sure to signal.</span></div><div class="line"><a name="l08620"></a><span class="lineno"> 8620</span>&#160;            this_-&gt;_lock.signalAll();</div><div class="line"><a name="l08621"></a><span class="lineno"> 8621</span>&#160;            <span class="keywordflow">throw</span> MessageStreamFullException(<span class="stringliteral">&quot;Stream is currently full.&quot;</span>);</div><div class="line"><a name="l08622"></a><span class="lineno"> 8622</span>&#160;          }</div><div class="line"><a name="l08623"></a><span class="lineno"> 8623</span>&#160;          <span class="keywordflow">if</span> (!this_-&gt;_cache.empty())</div><div class="line"><a name="l08624"></a><span class="lineno"> 8624</span>&#160;          {</div><div class="line"><a name="l08625"></a><span class="lineno"> 8625</span>&#160;            this_-&gt;_cache.front().deepCopy(message_);</div><div class="line"><a name="l08626"></a><span class="lineno"> 8626</span>&#160;            this_-&gt;_q.push_back(this_-&gt;_cache.front());</div><div class="line"><a name="l08627"></a><span class="lineno"> 8627</span>&#160;            this_-&gt;_cache.pop_front();</div><div class="line"><a name="l08628"></a><span class="lineno"> 8628</span>&#160;          }</div><div class="line"><a name="l08629"></a><span class="lineno"> 8629</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l08630"></a><span class="lineno"> 8630</span>&#160;          {</div><div class="line"><a name="l08631"></a><span class="lineno"> 8631</span>&#160;<span class="preprocessor">#ifdef   AMPS_USE_EMPLACE</span></div><div class="line"><a name="l08632"></a><span class="lineno"> 8632</span>&#160;            this_-&gt;_q.emplace_back(message_.<a class="code" href="classAMPS_1_1Message.html#afd3b5831324320af6566883f3b9ff9dd">deepCopy</a>());</div><div class="line"><a name="l08633"></a><span class="lineno"> 8633</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l08634"></a><span class="lineno"> 8634</span>&#160;            this_-&gt;_q.push_back(message_.<a class="code" href="classAMPS_1_1Message.html#afd3b5831324320af6566883f3b9ff9dd">deepCopy</a>());</div><div class="line"><a name="l08635"></a><span class="lineno"> 8635</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l08636"></a><span class="lineno"> 8636</span>&#160;          }</div><div class="line"><a name="l08637"></a><span class="lineno"> 8637</span>&#160;          <span class="keywordflow">if</span> (message_.<a class="code" href="classAMPS_1_1Message.html#a3e9f467321699a813340e57d4161f3e6">getCommandEnum</a>() == Message::Command::Publish &amp;&amp;</div><div class="line"><a name="l08638"></a><span class="lineno"> 8638</span>&#160;              this_-&gt;_client.isValid() &amp;&amp; this_-&gt;_client.getAutoAck() &amp;&amp;</div><div class="line"><a name="l08639"></a><span class="lineno"> 8639</span>&#160;              !message_.<a class="code" href="classAMPS_1_1Message.html#a7e6907cf19cb214f8c4bd02e236e01fb">getLeasePeriod</a>().<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>() &amp;&amp;</div><div class="line"><a name="l08640"></a><span class="lineno"> 8640</span>&#160;              !message_.<a class="code" href="classAMPS_1_1Message.html#a7108ef0b54bc76e43dc4d49d700dc8ef">getBookmark</a>().<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>())</div><div class="line"><a name="l08641"></a><span class="lineno"> 8641</span>&#160;          {</div><div class="line"><a name="l08642"></a><span class="lineno"> 8642</span>&#160;            message_.setIgnoreAutoAck();</div><div class="line"><a name="l08643"></a><span class="lineno"> 8643</span>&#160;          }</div><div class="line"><a name="l08644"></a><span class="lineno"> 8644</span>&#160;        }</div><div class="line"><a name="l08645"></a><span class="lineno"> 8645</span>&#160;      }</div><div class="line"><a name="l08646"></a><span class="lineno"> 8646</span>&#160;      this_-&gt;_lock.signalAll();</div><div class="line"><a name="l08647"></a><span class="lineno"> 8647</span>&#160;    }</div><div class="line"><a name="l08648"></a><span class="lineno"> 8648</span>&#160;  };</div><div class="line"><a name="l08649"></a><span class="lineno"> 8649</span>&#160;  <span class="keyword">inline</span> MessageStream::MessageStream(<span class="keywordtype">void</span>)</div><div class="line"><a name="l08650"></a><span class="lineno"> 8650</span>&#160;  {</div><div class="line"><a name="l08651"></a><span class="lineno"> 8651</span>&#160;  }</div><div class="line"><a name="l08652"></a><span class="lineno"> 8652</span>&#160;  <span class="keyword">inline</span> MessageStream::MessageStream(<span class="keyword">const</span> Client&amp; client_)</div><div class="line"><a name="l08653"></a><span class="lineno"> 8653</span>&#160;    : _body(<span class="keyword">new</span> MessageStreamImpl(client_))</div><div class="line"><a name="l08654"></a><span class="lineno"> 8654</span>&#160;  {</div><div class="line"><a name="l08655"></a><span class="lineno"> 8655</span>&#160;  }</div><div class="line"><a name="l08656"></a><span class="lineno"> 8656</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> MessageStream::iterator::advance(<span class="keywordtype">void</span>)</div><div class="line"><a name="l08657"></a><span class="lineno"> 8657</span>&#160;  {</div><div class="line"><a name="l08658"></a><span class="lineno"> 8658</span>&#160;    _pStream = _pStream-&gt;_body-&gt;next(_current) ? _pStream : NULL;</div><div class="line"><a name="l08659"></a><span class="lineno"> 8659</span>&#160;  }</div><div class="line"><a name="l08660"></a><span class="lineno"> 8660</span>&#160;  <span class="keyword">inline</span> MessageStream::operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l08661"></a><span class="lineno"> 8661</span>&#160;  {</div><div class="line"><a name="l08662"></a><span class="lineno"> 8662</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>((<span class="keywordtype">void</span>(*)(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp;, <span class="keywordtype">void</span>*))MessageStreamImpl::_messageHandler, &amp;_body.get());</div><div class="line"><a name="l08663"></a><span class="lineno"> 8663</span>&#160;  }</div><div class="line"><a name="l08664"></a><span class="lineno"> 8664</span>&#160;  <span class="keyword">inline</span> <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> MessageStream::fromExistingHandler(<span class="keyword">const</span> <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>&amp; handler_)</div><div class="line"><a name="l08665"></a><span class="lineno"> 8665</span>&#160;  {</div><div class="line"><a name="l08666"></a><span class="lineno"> 8666</span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> result;</div><div class="line"><a name="l08667"></a><span class="lineno"> 8667</span>&#160;    <span class="keywordflow">if</span> (handler_._func == (MessageHandler::FunctionType)MessageStreamImpl::_messageHandler)</div><div class="line"><a name="l08668"></a><span class="lineno"> 8668</span>&#160;    {</div><div class="line"><a name="l08669"></a><span class="lineno"> 8669</span>&#160;      result._body = (MessageStreamImpl*)(handler_._userData);</div><div class="line"><a name="l08670"></a><span class="lineno"> 8670</span>&#160;    }</div><div class="line"><a name="l08671"></a><span class="lineno"> 8671</span>&#160;    <span class="keywordflow">return</span> result;</div><div class="line"><a name="l08672"></a><span class="lineno"> 8672</span>&#160;  }</div><div class="line"><a name="l08673"></a><span class="lineno"> 8673</span>&#160;</div><div class="line"><a name="l08674"></a><span class="lineno"> 8674</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> MessageStream::setSOWOnly(<span class="keyword">const</span> std::string&amp; commandId_,</div><div class="line"><a name="l08675"></a><span class="lineno"> 8675</span>&#160;                                        <span class="keyword">const</span> std::string&amp; queryId_)</div><div class="line"><a name="l08676"></a><span class="lineno"> 8676</span>&#160;  {</div><div class="line"><a name="l08677"></a><span class="lineno"> 8677</span>&#160;    _body-&gt;setSOWOnly(commandId_, queryId_);</div><div class="line"><a name="l08678"></a><span class="lineno"> 8678</span>&#160;  }</div><div class="line"><a name="l08679"></a><span class="lineno"> 8679</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> MessageStream::setSubscription(<span class="keyword">const</span> std::string&amp; subId_,</div><div class="line"><a name="l08680"></a><span class="lineno"> 8680</span>&#160;                                             <span class="keyword">const</span> std::string&amp; commandId_,</div><div class="line"><a name="l08681"></a><span class="lineno"> 8681</span>&#160;                                             <span class="keyword">const</span> std::string&amp; queryId_)</div><div class="line"><a name="l08682"></a><span class="lineno"> 8682</span>&#160;  {</div><div class="line"><a name="l08683"></a><span class="lineno"> 8683</span>&#160;    _body-&gt;setSubscription(subId_, commandId_, queryId_);</div><div class="line"><a name="l08684"></a><span class="lineno"> 8684</span>&#160;  }</div><div class="line"><a name="l08685"></a><span class="lineno"> 8685</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> MessageStream::setStatsOnly(<span class="keyword">const</span> std::string&amp; commandId_,</div><div class="line"><a name="l08686"></a><span class="lineno"> 8686</span>&#160;                                          <span class="keyword">const</span> std::string&amp; queryId_)</div><div class="line"><a name="l08687"></a><span class="lineno"> 8687</span>&#160;  {</div><div class="line"><a name="l08688"></a><span class="lineno"> 8688</span>&#160;    _body-&gt;setStatsOnly(commandId_, queryId_);</div><div class="line"><a name="l08689"></a><span class="lineno"> 8689</span>&#160;  }</div><div class="line"><a name="l08690"></a><span class="lineno"> 8690</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> MessageStream::setAcksOnly(<span class="keyword">const</span> std::string&amp; commandId_,</div><div class="line"><a name="l08691"></a><span class="lineno"> 8691</span>&#160;                                         <span class="keywordtype">unsigned</span> acks_)</div><div class="line"><a name="l08692"></a><span class="lineno"> 8692</span>&#160;  {</div><div class="line"><a name="l08693"></a><span class="lineno"> 8693</span>&#160;    _body-&gt;setAcksOnly(commandId_, acks_);</div><div class="line"><a name="l08694"></a><span class="lineno"> 8694</span>&#160;  }</div><div class="line"><a name="l08695"></a><span class="lineno"><a class="line" href="classAMPS_1_1MessageStream.html#a6c5a0f16a137b7472ac12f8f59b070a4"> 8695</a></span>&#160;  <span class="keyword">inline</span> <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="classAMPS_1_1MessageStream.html#a6c5a0f16a137b7472ac12f8f59b070a4">MessageStream::timeout</a>(<span class="keywordtype">unsigned</span> timeout_)</div><div class="line"><a name="l08696"></a><span class="lineno"> 8696</span>&#160;  {</div><div class="line"><a name="l08697"></a><span class="lineno"> 8697</span>&#160;    _body-&gt;<a class="code" href="classAMPS_1_1MessageStream.html#a6c5a0f16a137b7472ac12f8f59b070a4">timeout</a>(timeout_);</div><div class="line"><a name="l08698"></a><span class="lineno"> 8698</span>&#160;    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l08699"></a><span class="lineno"> 8699</span>&#160;  }</div><div class="line"><a name="l08700"></a><span class="lineno"><a class="line" href="classAMPS_1_1MessageStream.html#a1c073439651dd4b9950fb67ef78635c5"> 8700</a></span>&#160;  <span class="keyword">inline</span> <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="classAMPS_1_1MessageStream.html#a1c073439651dd4b9950fb67ef78635c5">MessageStream::conflate</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l08701"></a><span class="lineno"> 8701</span>&#160;  {</div><div class="line"><a name="l08702"></a><span class="lineno"> 8702</span>&#160;    _body-&gt;<a class="code" href="classAMPS_1_1MessageStream.html#a1c073439651dd4b9950fb67ef78635c5">conflate</a>();</div><div class="line"><a name="l08703"></a><span class="lineno"> 8703</span>&#160;    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l08704"></a><span class="lineno"> 8704</span>&#160;  }</div><div class="line"><a name="l08705"></a><span class="lineno"><a class="line" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24"> 8705</a></span>&#160;  <span class="keyword">inline</span> <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">MessageStream::maxDepth</a>(<span class="keywordtype">unsigned</span> maxDepth_)</div><div class="line"><a name="l08706"></a><span class="lineno"> 8706</span>&#160;  {</div><div class="line"><a name="l08707"></a><span class="lineno"> 8707</span>&#160;    _body-&gt;<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(maxDepth_);</div><div class="line"><a name="l08708"></a><span class="lineno"> 8708</span>&#160;    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l08709"></a><span class="lineno"> 8709</span>&#160;  }</div><div class="line"><a name="l08710"></a><span class="lineno"><a class="line" href="classAMPS_1_1MessageStream.html#a585bc3ade892c75bc4f2dedc75f232fc"> 8710</a></span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <a class="code" href="classAMPS_1_1MessageStream.html#a585bc3ade892c75bc4f2dedc75f232fc">MessageStream::getMaxDepth</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l08711"></a><span class="lineno"> 8711</span>&#160;<span class="keyword">  </span>{</div><div class="line"><a name="l08712"></a><span class="lineno"> 8712</span>&#160;    <span class="keywordflow">return</span> _body-&gt;getMaxDepth();</div><div class="line"><a name="l08713"></a><span class="lineno"> 8713</span>&#160;  }</div><div class="line"><a name="l08714"></a><span class="lineno"><a class="line" href="classAMPS_1_1MessageStream.html#afbd30232e215c309bb1d9f4f1b9e169a"> 8714</a></span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <a class="code" href="classAMPS_1_1MessageStream.html#afbd30232e215c309bb1d9f4f1b9e169a">MessageStream::getDepth</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l08715"></a><span class="lineno"> 8715</span>&#160;<span class="keyword">  </span>{</div><div class="line"><a name="l08716"></a><span class="lineno"> 8716</span>&#160;    <span class="keywordflow">return</span> _body-&gt;getDepth();</div><div class="line"><a name="l08717"></a><span class="lineno"> 8717</span>&#160;  }</div><div class="line"><a name="l08718"></a><span class="lineno"> 8718</span>&#160;</div><div class="line"><a name="l08719"></a><span class="lineno"> 8719</span>&#160;  <span class="keyword">inline</span> <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> ClientImpl::getEmptyMessageStream(<span class="keywordtype">void</span>)</div><div class="line"><a name="l08720"></a><span class="lineno"> 8720</span>&#160;  {</div><div class="line"><a name="l08721"></a><span class="lineno"> 8721</span>&#160;    <span class="keywordflow">return</span> *(_pEmptyMessageStream.get());</div><div class="line"><a name="l08722"></a><span class="lineno"> 8722</span>&#160;  }</div><div class="line"><a name="l08723"></a><span class="lineno"> 8723</span>&#160;</div><div class="line"><a name="l08724"></a><span class="lineno"><a class="line" href="classAMPS_1_1Client.html#aafe817ecbe79a5277f2007e1095124a3"> 8724</a></span>&#160;  <span class="keyword">inline</span> <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> <a class="code" href="classAMPS_1_1Client.html#aafe817ecbe79a5277f2007e1095124a3">Client::execute</a>(<a class="code" href="classAMPS_1_1Command.html">Command</a>&amp; command_)</div><div class="line"><a name="l08725"></a><span class="lineno"> 8725</span>&#160;  {</div><div class="line"><a name="l08726"></a><span class="lineno"> 8726</span>&#160;    <span class="comment">// If the command is sow and has a sub_id, OR</span></div><div class="line"><a name="l08727"></a><span class="lineno"> 8727</span>&#160;    <span class="comment">// if the command has a replace option, return the existing</span></div><div class="line"><a name="l08728"></a><span class="lineno"> 8728</span>&#160;    <span class="comment">// messagestream, don&#39;t create a new one.</span></div><div class="line"><a name="l08729"></a><span class="lineno"> 8729</span>&#160;    ClientImpl&amp; body = _body.get();</div><div class="line"><a name="l08730"></a><span class="lineno"> 8730</span>&#160;    <a class="code" href="classAMPS_1_1Message.html">Message</a>&amp; message = command_.getMessage();</div><div class="line"><a name="l08731"></a><span class="lineno"> 8731</span>&#160;    <a class="code" href="classAMPS_1_1Field.html">Field</a> subId = message.<a class="code" href="classAMPS_1_1Message.html#a4beb1e21b1dabf98cbb956f97fb95dbd">getSubscriptionId</a>();</div><div class="line"><a name="l08732"></a><span class="lineno"> 8732</span>&#160;    <span class="keywordtype">unsigned</span> ackTypes = message.<a class="code" href="classAMPS_1_1Message.html#a7d58a2c39f59d6fca098efd4bb81d3b5">getAckTypeEnum</a>();</div><div class="line"><a name="l08733"></a><span class="lineno"> 8733</span>&#160;    <span class="keywordtype">bool</span> useExistingHandler = !subId.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>() &amp;&amp; ((!message.<a class="code" href="classAMPS_1_1Message.html#afdc34084b92891f21370c9f848936cad">getOptions</a>().<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>() &amp;&amp; message.<a class="code" href="classAMPS_1_1Message.html#afdc34084b92891f21370c9f848936cad">getOptions</a>().contains(<span class="stringliteral">&quot;replace&quot;</span>, 7)) || message.<a class="code" href="classAMPS_1_1Message.html#a3e9f467321699a813340e57d4161f3e6">getCommandEnum</a>() == Message::Command::SOW);</div><div class="line"><a name="l08734"></a><span class="lineno"> 8734</span>&#160;    <span class="keywordflow">if</span> (useExistingHandler)</div><div class="line"><a name="l08735"></a><span class="lineno"> 8735</span>&#160;    {</div><div class="line"><a name="l08736"></a><span class="lineno"> 8736</span>&#160;      <span class="comment">// Try to find the existing message handler.</span></div><div class="line"><a name="l08737"></a><span class="lineno"> 8737</span>&#160;      <span class="keywordflow">if</span> (!subId.<a class="code" href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">empty</a>())</div><div class="line"><a name="l08738"></a><span class="lineno"> 8738</span>&#160;      {</div><div class="line"><a name="l08739"></a><span class="lineno"> 8739</span>&#160;        <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a> existingHandler;</div><div class="line"><a name="l08740"></a><span class="lineno"> 8740</span>&#160;        <span class="keywordflow">if</span> (body._routes.getRoute(subId, existingHandler))</div><div class="line"><a name="l08741"></a><span class="lineno"> 8741</span>&#160;        {</div><div class="line"><a name="l08742"></a><span class="lineno"> 8742</span>&#160;          <span class="comment">// we found an existing handler. It might not be a message stream, but that&#39;s okay.</span></div><div class="line"><a name="l08743"></a><span class="lineno"> 8743</span>&#160;          body.executeAsync(command_, existingHandler, <span class="keyword">false</span>);</div><div class="line"><a name="l08744"></a><span class="lineno"> 8744</span>&#160;          <span class="keywordflow">return</span> MessageStream::fromExistingHandler(existingHandler);</div><div class="line"><a name="l08745"></a><span class="lineno"> 8745</span>&#160;        }</div><div class="line"><a name="l08746"></a><span class="lineno"> 8746</span>&#160;      }</div><div class="line"><a name="l08747"></a><span class="lineno"> 8747</span>&#160;      <span class="comment">// fall through; we&#39;ll a new handler altogether.</span></div><div class="line"><a name="l08748"></a><span class="lineno"> 8748</span>&#160;    }</div><div class="line"><a name="l08749"></a><span class="lineno"> 8749</span>&#160;    <span class="comment">// Make sure something will be returned to the stream or use the empty one</span></div><div class="line"><a name="l08750"></a><span class="lineno"> 8750</span>&#160;    <span class="comment">// Check that: it&#39;s a command that doesn&#39;t normally return data, and there</span></div><div class="line"><a name="l08751"></a><span class="lineno"> 8751</span>&#160;    <span class="comment">// are no acks requested for the cmd id</span></div><div class="line"><a name="l08752"></a><span class="lineno"> 8752</span>&#160;    Message::Command::Type command = message.<a class="code" href="classAMPS_1_1Message.html#a3e9f467321699a813340e57d4161f3e6">getCommandEnum</a>();</div><div class="line"><a name="l08753"></a><span class="lineno"> 8753</span>&#160;    <span class="keywordflow">if</span> ((command &amp; Message::Command::NoDataCommands)</div><div class="line"><a name="l08754"></a><span class="lineno"> 8754</span>&#160;        &amp;&amp; (ackTypes == Message::AckType::Persisted</div><div class="line"><a name="l08755"></a><span class="lineno"> 8755</span>&#160;            || ackTypes == Message::AckType::None))</div><div class="line"><a name="l08756"></a><span class="lineno"> 8756</span>&#160;    {</div><div class="line"><a name="l08757"></a><span class="lineno"> 8757</span>&#160;      executeAsync(command_, <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>());</div><div class="line"><a name="l08758"></a><span class="lineno"> 8758</span>&#160;      <span class="keywordflow">if</span> (!body._pEmptyMessageStream)</div><div class="line"><a name="l08759"></a><span class="lineno"> 8759</span>&#160;      {</div><div class="line"><a name="l08760"></a><span class="lineno"> 8760</span>&#160;        body._pEmptyMessageStream.reset(<span class="keyword">new</span> <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a>((ClientImpl*)0));</div><div class="line"><a name="l08761"></a><span class="lineno"> 8761</span>&#160;        body._pEmptyMessageStream.get()-&gt;_body-&gt;close();</div><div class="line"><a name="l08762"></a><span class="lineno"> 8762</span>&#160;      }</div><div class="line"><a name="l08763"></a><span class="lineno"> 8763</span>&#160;      <span class="keywordflow">return</span> body.getEmptyMessageStream();</div><div class="line"><a name="l08764"></a><span class="lineno"> 8764</span>&#160;    }</div><div class="line"><a name="l08765"></a><span class="lineno"> 8765</span>&#160;    <a class="code" href="classAMPS_1_1MessageStream.html">MessageStream</a> stream(*<span class="keyword">this</span>);</div><div class="line"><a name="l08766"></a><span class="lineno"> 8766</span>&#160;    <span class="keywordflow">if</span> (body.getDefaultMaxDepth())</div><div class="line"><a name="l08767"></a><span class="lineno"> 8767</span>&#160;    {</div><div class="line"><a name="l08768"></a><span class="lineno"> 8768</span>&#160;      stream.<a class="code" href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">maxDepth</a>(body.getDefaultMaxDepth());</div><div class="line"><a name="l08769"></a><span class="lineno"> 8769</span>&#160;    }</div><div class="line"><a name="l08770"></a><span class="lineno"> 8770</span>&#160;    <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a> handler = stream.operator <a class="code" href="classAMPS_1_1Handler.html">MessageHandler</a>();</div><div class="line"><a name="l08771"></a><span class="lineno"> 8771</span>&#160;    std::string commandID = body.executeAsync(command_, handler, <span class="keyword">false</span>);</div><div class="line"><a name="l08772"></a><span class="lineno"> 8772</span>&#160;    <span class="keywordflow">if</span> (command_.hasStatsAck())</div><div class="line"><a name="l08773"></a><span class="lineno"> 8773</span>&#160;    {</div><div class="line"><a name="l08774"></a><span class="lineno"> 8774</span>&#160;      stream.setStatsOnly(commandID, command_.getMessage().<a class="code" href="classAMPS_1_1Message.html#a1b4db85007e3981904544f36371247ad">getQueryId</a>());</div><div class="line"><a name="l08775"></a><span class="lineno"> 8775</span>&#160;    }</div><div class="line"><a name="l08776"></a><span class="lineno"> 8776</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command_.isSow())</div><div class="line"><a name="l08777"></a><span class="lineno"> 8777</span>&#160;    {</div><div class="line"><a name="l08778"></a><span class="lineno"> 8778</span>&#160;      stream.setSOWOnly(commandID, command_.getMessage().<a class="code" href="classAMPS_1_1Message.html#a1b4db85007e3981904544f36371247ad">getQueryId</a>());</div><div class="line"><a name="l08779"></a><span class="lineno"> 8779</span>&#160;    }</div><div class="line"><a name="l08780"></a><span class="lineno"> 8780</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command_.isSubscribe())</div><div class="line"><a name="l08781"></a><span class="lineno"> 8781</span>&#160;    {</div><div class="line"><a name="l08782"></a><span class="lineno"> 8782</span>&#160;      stream.setSubscription(commandID,</div><div class="line"><a name="l08783"></a><span class="lineno"> 8783</span>&#160;                             command_.getMessage().<a class="code" href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">getCommandId</a>(),</div><div class="line"><a name="l08784"></a><span class="lineno"> 8784</span>&#160;                             command_.getMessage().<a class="code" href="classAMPS_1_1Message.html#a1b4db85007e3981904544f36371247ad">getQueryId</a>());</div><div class="line"><a name="l08785"></a><span class="lineno"> 8785</span>&#160;    }</div><div class="line"><a name="l08786"></a><span class="lineno"> 8786</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l08787"></a><span class="lineno"> 8787</span>&#160;    {</div><div class="line"><a name="l08788"></a><span class="lineno"> 8788</span>&#160;      <span class="comment">// Persisted acks for writes don&#39;t come back with command id</span></div><div class="line"><a name="l08789"></a><span class="lineno"> 8789</span>&#160;      <span class="keywordflow">if</span> (command == Message::Command::Publish ||</div><div class="line"><a name="l08790"></a><span class="lineno"> 8790</span>&#160;          command == Message::Command::DeltaPublish ||</div><div class="line"><a name="l08791"></a><span class="lineno"> 8791</span>&#160;          command == Message::Command::SOWDelete)</div><div class="line"><a name="l08792"></a><span class="lineno"> 8792</span>&#160;      {</div><div class="line"><a name="l08793"></a><span class="lineno"> 8793</span>&#160;        stream.setAcksOnly(commandID,</div><div class="line"><a name="l08794"></a><span class="lineno"> 8794</span>&#160;                           ackTypes &amp; (<span class="keywordtype">unsigned</span>)~Message::AckType::Persisted);</div><div class="line"><a name="l08795"></a><span class="lineno"> 8795</span>&#160;      }</div><div class="line"><a name="l08796"></a><span class="lineno"> 8796</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l08797"></a><span class="lineno"> 8797</span>&#160;      {</div><div class="line"><a name="l08798"></a><span class="lineno"> 8798</span>&#160;        stream.setAcksOnly(commandID, ackTypes);</div><div class="line"><a name="l08799"></a><span class="lineno"> 8799</span>&#160;      }</div><div class="line"><a name="l08800"></a><span class="lineno"> 8800</span>&#160;    }</div><div class="line"><a name="l08801"></a><span class="lineno"> 8801</span>&#160;    <span class="keywordflow">return</span> stream;</div><div class="line"><a name="l08802"></a><span class="lineno"> 8802</span>&#160;  }</div><div class="line"><a name="l08803"></a><span class="lineno"> 8803</span>&#160;</div><div class="line"><a name="l08804"></a><span class="lineno"> 8804</span>&#160;<span class="comment">// This is here because it uses api from Client.</span></div><div class="line"><a name="l08805"></a><span class="lineno"> 8805</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> Message::ack(<span class="keyword">const</span> <span class="keywordtype">char</span>* options_)<span class="keyword"> const</span></div><div class="line"><a name="l08806"></a><span class="lineno"> 8806</span>&#160;<span class="keyword">  </span>{</div><div class="line"><a name="l08807"></a><span class="lineno"> 8807</span>&#160;    ClientImpl* pClient = _body.get().clientImpl();</div><div class="line"><a name="l08808"></a><span class="lineno"> 8808</span>&#160;    <a class="code" href="classAMPS_1_1Field.html">Message::Field</a> bookmark = getBookmark();</div><div class="line"><a name="l08809"></a><span class="lineno"> 8809</span>&#160;    <span class="keywordflow">if</span> (pClient &amp;&amp; bookmark.<a class="code" href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">len</a>() &amp;&amp;</div><div class="line"><a name="l08810"></a><span class="lineno"> 8810</span>&#160;        !pClient-&gt;getAutoAck())</div><div class="line"><a name="l08811"></a><span class="lineno"> 8811</span>&#160;      <span class="comment">//(!pClient-&gt;getAutoAck() || getIgnoreAutoAck()))</span></div><div class="line"><a name="l08812"></a><span class="lineno"> 8812</span>&#160;    {</div><div class="line"><a name="l08813"></a><span class="lineno"> 8813</span>&#160;      pClient-&gt;ack(getTopic(), bookmark, options_);</div><div class="line"><a name="l08814"></a><span class="lineno"> 8814</span>&#160;    }</div><div class="line"><a name="l08815"></a><span class="lineno"> 8815</span>&#160;  }</div><div class="line"><a name="l08816"></a><span class="lineno"> 8816</span>&#160;}<span class="comment">// end namespace AMPS</span></div><div class="line"><a name="l08817"></a><span class="lineno"> 8817</span>&#160;<span class="preprocessor">#endif</span></div><div class="ttc" id="classAMPS_1_1Command_html_ae76a87584bbabbd04387c890000c8653"><div class="ttname"><a href="classAMPS_1_1Command.html#ae76a87584bbabbd04387c890000c8653">AMPS::Command::setBookmark</a></div><div class="ttdeci">Command &amp; setBookmark(const std::string &amp;bookmark_)</div><div class="ttdoc">Set the bookmark to be used this command. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:717</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_aba9624de4f611d56fcdf415377ff6d1f"><div class="ttname"><a href="classAMPS_1_1Command.html#aba9624de4f611d56fcdf415377ff6d1f">AMPS::Command::setFilter</a></div><div class="ttdeci">Command &amp; setFilter(const char *filter_, size_t filterLen_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:668</div></div>
<div class="ttc" id="classAMPS_1_1Reason_html"><div class="ttname"><a href="classAMPS_1_1Reason.html">AMPS::Reason</a></div><div class="ttdoc">Class to hold string versions of failure reasons. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:183</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_afbdb7364fc7634f7a25751a5c284686b"><div class="ttname"><a href="classAMPS_1_1Message.html#afbdb7364fc7634f7a25751a5c284686b">AMPS::Message::setData</a></div><div class="ttdeci">Message &amp; setData(const std::string &amp;v_)</div><div class="ttdoc">Sets the data portion of self. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1476</div></div>
<div class="ttc" id="amps_8h_html"><div class="ttname"><a href="amps_8h.html">amps.h</a></div><div class="ttdoc">Core type and function declarations for the AMPS C client. </div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a4b5866738505dee70761e241df42dd2e"><div class="ttname"><a href="classAMPS_1_1Client.html#a4b5866738505dee70761e241df42dd2e">AMPS::Client::Client</a></div><div class="ttdeci">Client(const std::string &amp;clientName=&quot;&quot;)</div><div class="ttdoc">Constructs a new client with a given client name. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5092</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a1dacda9d7f12db2871bd13e3b4d8c62e"><div class="ttname"><a href="classAMPS_1_1Message.html#a1dacda9d7f12db2871bd13e3b4d8c62e">AMPS::Message::getUserId</a></div><div class="ttdeci">Field getUserId() const </div><div class="ttdoc">Retrieves the value of the UserId header of the Message as a new Field. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1453</div></div>
<div class="ttc" id="group__async_html_gaaf149395b5542b7863de0b561929914f"><div class="ttname"><a href="group__async.html#gaaf149395b5542b7863de0b561929914f">AMPS::Client::sowDeleteByKeys</a></div><div class="ttdeci">std::string sowDeleteByKeys(const MessageHandler &amp;messageHandler_, const std::string &amp;topic_, const std::string &amp;keys_, long timeout_=0)</div><div class="ttdoc">Deletes messages that match SOW keys from a topic&amp;#39;s SOW cache. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6753</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_aed5e3ada1c45d8f52e5135e4d4626b78"><div class="ttname"><a href="classAMPS_1_1Client.html#aed5e3ada1c45d8f52e5135e4d4626b78">AMPS::Client::stopTimer</a></div><div class="ttdeci">std::string stopTimer(const MessageHandler &amp;messageHandler)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6727</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a201bafd90c684f9013b9039360390228"><div class="ttname"><a href="classAMPS_1_1Message.html#a201bafd90c684f9013b9039360390228">AMPS::Message::IdentifierLength</a></div><div class="ttdeci">static const unsigned int IdentifierLength</div><div class="ttdoc">The length of identifiers used for unique identification of commands and subscriptions. </div><div class="ttdef"><b>Definition:</b> Message.hpp:542</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a3578f78b66ee6520eb1dd65f641715ea"><div class="ttname"><a href="classAMPS_1_1Command.html#a3578f78b66ee6520eb1dd65f641715ea">AMPS::Command::getAckType</a></div><div class="ttdeci">std::string getAckType() const </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:915</div></div>
<div class="ttc" id="amps_8h_html_af3c7405bbfab51b026e39b11295f6172"><div class="ttname"><a href="amps_8h.html#af3c7405bbfab51b026e39b11295f6172">amps_client_set_disconnect_handler</a></div><div class="ttdeci">AMPSDLL void amps_client_set_disconnect_handler(amps_handle client, amps_handler disconnectHandler, void *userData)</div><div class="ttdoc">Sets the disconnect handler function to be called when a disconnect occurs. </div></div>
<div class="ttc" id="classAMPS_1_1Client_html_abf8c120c68bb374f839b7510d12647e7"><div class="ttname"><a href="classAMPS_1_1Client.html#abf8c120c68bb374f839b7510d12647e7">AMPS::Client::removeMessageHandler</a></div><div class="ttdeci">bool removeMessageHandler(const Field &amp;commandId_)</div><div class="ttdoc">Removes a MessageHandler for a given ComandId from self. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5304</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_ab615fec15ed415791470da4b056bfe36"><div class="ttname"><a href="classAMPS_1_1Message.html#ab615fec15ed415791470da4b056bfe36">AMPS::Message::assignTopic</a></div><div class="ttdeci">Message &amp; assignTopic(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the Topic header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1449</div></div>
<div class="ttc" id="classAMPS_1_1__FIXBuilder_html"><div class="ttname"><a href="classAMPS_1_1__FIXBuilder.html">AMPS::_FIXBuilder</a></div><div class="ttdoc">Provides a convenient way of building messages in FIX format, typically referenced using the typedefs...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:8088</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a0cf263706a233647fb4c525fe848c385"><div class="ttname"><a href="classAMPS_1_1Client.html#a0cf263706a233647fb4c525fe848c385">AMPS::Client::startTimer</a></div><div class="ttdeci">void startTimer()</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6716</div></div>
<div class="ttc" id="group__sync_html_ga6e4e389faa3e47fac68285be20528d5b"><div class="ttname"><a href="group__sync.html#ga6e4e389faa3e47fac68285be20528d5b">AMPS::Client::sowAndSubscribe</a></div><div class="ttdeci">MessageStream sowAndSubscribe(const std::string &amp;topic_, long timeout_, const std::string &amp;filter_=&quot;&quot;, int batchSize_=DEFAULT_BATCH_SIZE, bool oofEnabled_=false, int topN_=DEFAULT_TOP_N)</div><div class="ttdoc">Query the SOW cache of a topic and initiates a new subscription on it. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6258</div></div>
<div class="ttc" id="classAMPS_1_1StoreImpl_html"><div class="ttname"><a href="classAMPS_1_1StoreImpl.html">AMPS::StoreImpl</a></div><div class="ttdoc">Abstract base class for storing published messages for an HA publisher client. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1059</div></div>
<div class="ttc" id="classAMPS_1_1MessageStream_html_a1c073439651dd4b9950fb67ef78635c5"><div class="ttname"><a href="classAMPS_1_1MessageStream.html#a1c073439651dd4b9950fb67ef78635c5">AMPS::MessageStream::conflate</a></div><div class="ttdeci">MessageStream conflate(void)</div><div class="ttdoc">Sets self to conflation mode, where a new update for a matching sow key will replace the previous one...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:8700</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_aa64c3738555b31e41034e5fec812851e"><div class="ttname"><a href="classAMPS_1_1Message.html#aa64c3738555b31e41034e5fec812851e">AMPS::Message::getSequence</a></div><div class="ttdeci">Field getSequence() const </div><div class="ttdoc">Retrieves the value of the Sequence header of the Message as a new Field. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1422</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a26c7ef49af94b85f5dd432bc26e5181c"><div class="ttname"><a href="classAMPS_1_1Client.html#a26c7ef49af94b85f5dd432bc26e5181c">AMPS::Client::send</a></div><div class="ttdeci">std::string send(const MessageHandler &amp;messageHandler, Message &amp;message, int timeout=0)</div><div class="ttdoc">Sends a Message to the connected AMPS server, performing only minimal validation and bypassing client...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5332</div></div>
<div class="ttc" id="amps_8h_html_a598d1dad4cf605f0b46ec2de6649eae0"><div class="ttname"><a href="amps_8h.html#a598d1dad4cf605f0b46ec2de6649eae0">amps_client_set_name</a></div><div class="ttdeci">AMPSDLL amps_result amps_client_set_name(amps_handle handle, const amps_char *clientName)</div><div class="ttdoc">Sets the name on an amps client object. </div></div>
<div class="ttc" id="classAMPS_1_1Message_html_af74da8269d78337655907680cb03c950"><div class="ttname"><a href="classAMPS_1_1Message.html#af74da8269d78337655907680cb03c950">AMPS::Message::setCorrelationId</a></div><div class="ttdeci">Message &amp; setCorrelationId(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the CorrelationId header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1304</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a1a814beb4b54f23e364cac2f929b3bfe"><div class="ttname"><a href="classAMPS_1_1Message.html#a1a814beb4b54f23e364cac2f929b3bfe">AMPS::Message::setQueryID</a></div><div class="ttdeci">Message &amp; setQueryID(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the QueryID header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1417</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a9bc5e9a4db84fc9f2c3570ee3ad6a3c3"><div class="ttname"><a href="classAMPS_1_1Command.html#a9bc5e9a4db84fc9f2c3570ee3ad6a3c3">AMPS::Command::Command</a></div><div class="ttdeci">Command(const std::string &amp;command_)</div><div class="ttdoc">Creates an object to represent the given AMPS command, such as &quot;sow&quot; or &quot;subscribe&quot;. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:529</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a3e9f467321699a813340e57d4161f3e6"><div class="ttname"><a href="classAMPS_1_1Message.html#a3e9f467321699a813340e57d4161f3e6">AMPS::Message::getCommandEnum</a></div><div class="ttdeci">Command::Type getCommandEnum() const </div><div class="ttdoc">Decode self&amp;#39;s &quot;command&quot; field and return one of the values from Command. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1228</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a3fd62107459f6d1f9efcc3dbd3195014"><div class="ttname"><a href="classAMPS_1_1Command.html#a3fd62107459f6d1f9efcc3dbd3195014">AMPS::Command::setBookmark</a></div><div class="ttdeci">Command &amp; setBookmark(const char *bookmark_, size_t bookmarkLen_)</div><div class="ttdoc">Set the bookmark to be used this command. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:728</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a7b1fc3fdd539e5feb8cd2c487562c609"><div class="ttname"><a href="classAMPS_1_1Client.html#a7b1fc3fdd539e5feb8cd2c487562c609">AMPS::Client::setGlobalCommandTypeMessageHandler</a></div><div class="ttdeci">void setGlobalCommandTypeMessageHandler(const Message::Command::Type command_, const MessageHandler &amp;handler_)</div><div class="ttdoc">Sets a handler for all messages of a particular type: currently supported types are heartbeat message...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7007</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a0efb7bc0a43730b866f6d68d357d4dac"><div class="ttname"><a href="classAMPS_1_1Command.html#a0efb7bc0a43730b866f6d68d357d4dac">AMPS::Command::setAckType</a></div><div class="ttdeci">Command &amp; setAckType(unsigned ackType_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:893</div></div>
<div class="ttc" id="classAMPS_1_1BookmarkStore_html_a1111ca27840fa8b321f0b47ff0e99b88"><div class="ttname"><a href="classAMPS_1_1BookmarkStore.html#a1111ca27840fa8b321f0b47ff0e99b88">AMPS::BookmarkStore::setServerVersion</a></div><div class="ttdeci">void setServerVersion(size_t version_)</div><div class="ttdoc">Internally used to set the server version so the store knows how to deal with persisted acks and call...</div><div class="ttdef"><b>Definition:</b> BookmarkStore.hpp:429</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a3a32d0543e745d4d30ca69bdfe32f111"><div class="ttname"><a href="classAMPS_1_1Client.html#a3a32d0543e745d4d30ca69bdfe32f111">AMPS::Client::setDefaultMaxDepth</a></div><div class="ttdeci">void setDefaultMaxDepth(unsigned maxDepth_)</div><div class="ttdoc">Sets a default max depth on all subsequently created MessageStream objects. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7375</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a337510e3d98de7216fcbc06f2ba17d74"><div class="ttname"><a href="classAMPS_1_1Client.html#a337510e3d98de7216fcbc06f2ba17d74">AMPS::Client::getNameHashValue</a></div><div class="ttdeci">const amps_uint64_t getNameHashValue() const </div><div class="ttdoc">Returns the numeric name hash of this client as generated by the server and returned when the client ...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5153</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a4beb1e21b1dabf98cbb956f97fb95dbd"><div class="ttname"><a href="classAMPS_1_1Message.html#a4beb1e21b1dabf98cbb956f97fb95dbd">AMPS::Message::getSubscriptionId</a></div><div class="ttdeci">Field getSubscriptionId() const </div><div class="ttdoc">Retrieves the value of the SubscriptionId header of the Message as a new Field. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1427</div></div>
<div class="ttc" id="amps_8h_html_a44ece132b32081e6c2191cc63326b198"><div class="ttname"><a href="amps_8h.html#a44ece132b32081e6c2191cc63326b198">amps_client_connect</a></div><div class="ttdeci">AMPSDLL amps_result amps_client_connect(amps_handle handle, const amps_char *uri)</div><div class="ttdoc">Connects to the AMPS server specified in uri. </div></div>
<div class="ttc" id="classAMPS_1_1Client_html_af44e3550521234435f7967adc845578f"><div class="ttname"><a href="classAMPS_1_1Client.html#af44e3550521234435f7967adc845578f">AMPS::Client::convertVersionToNumber</a></div><div class="ttdeci">static size_t convertVersionToNumber(const std::string &amp;version_)</div><div class="ttdoc">Converts a string version, such as &quot;3.8.1.5&quot; into the same numeric form used internally and returned ...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5209</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a53879275db21cd10862bc3702a9f6e67"><div class="ttname"><a href="classAMPS_1_1Client.html#a53879275db21cd10862bc3702a9f6e67">AMPS::Client::unsubscribe</a></div><div class="ttdeci">void unsubscribe(const std::string &amp;commandId)</div><div class="ttdoc">Unsubscribe from a topic. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6047</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a57b4ea42d4917e552593cdd3d59cb34c"><div class="ttname"><a href="classAMPS_1_1Command.html#a57b4ea42d4917e552593cdd3d59cb34c">AMPS::Command::setOptions</a></div><div class="ttdeci">Command &amp; setOptions(const std::string &amp;options_)</div><div class="ttdoc">Sets the options string for this command: see Message.Options for a helper class for constructing the...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:758</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a6b211029971140a5c5c0f9f1416c6f2e"><div class="ttname"><a href="classAMPS_1_1Message.html#a6b211029971140a5c5c0f9f1416c6f2e">AMPS::Message::setOrderBy</a></div><div class="ttdeci">Message &amp; setOrderBy(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the OrderBy header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1415</div></div>
<div class="ttc" id="classAMPS_1_1StoreReplayer_html"><div class="ttname"><a href="classAMPS_1_1StoreReplayer.html">AMPS::StoreReplayer</a></div><div class="ttdoc">Abstract base class for replaying a publish message. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1031</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a83a0aad855b226d75ebbae2c3ad150f3"><div class="ttname"><a href="classAMPS_1_1Command.html#a83a0aad855b226d75ebbae2c3ad150f3">AMPS::Command::setCommandId</a></div><div class="ttdeci">Command &amp; setCommandId(const char *cmdId_, size_t cmdIdLen_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:642</div></div>
<div class="ttc" id="classAMPS_1_1BookmarkStore_html_a73ade06e341e7e694cbe756a1c6ab187"><div class="ttname"><a href="classAMPS_1_1BookmarkStore.html#a73ade06e341e7e694cbe756a1c6ab187">AMPS::BookmarkStore::persisted</a></div><div class="ttdeci">void persisted(const Message::Field &amp;subId_, const Message::Field &amp;bookmark_)</div><div class="ttdoc">Called internally to indicate messages up to and including bookmark are replicated to all replication...</div><div class="ttdef"><b>Definition:</b> BookmarkStore.hpp:405</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_afb25c2b9fe3976913e5e9fd86ba24817"><div class="ttname"><a href="classAMPS_1_1Client.html#afb25c2b9fe3976913e5e9fd86ba24817">AMPS::Client::getDefaultMaxDepth</a></div><div class="ttdeci">unsigned getDefaultMaxDepth(void) const </div><div class="ttdoc">Returns the default max depth for returned MessageStream objects. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7384</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_af34fb70a7d9a9353b8abd9a569452b64"><div class="ttname"><a href="classAMPS_1_1Client.html#af34fb70a7d9a9353b8abd9a569452b64">AMPS::Client::ack</a></div><div class="ttdeci">void ack(Message &amp;message_, const char *options_=NULL)</div><div class="ttdoc">Acknowledge a message queue message by supplying the message directly: this adds the ack to the curre...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7243</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a636b759d646059aefbf04bf67aabcea4"><div class="ttname"><a href="classAMPS_1_1Client.html#a636b759d646059aefbf04bf67aabcea4">AMPS::Client::bookmarkSubscribe</a></div><div class="ttdeci">MessageStream bookmarkSubscribe(const std::string &amp;topic_, long timeout_, const std::string &amp;bookmark_, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;options_=&quot;&quot;, const std::string &amp;subId_=&quot;&quot;)</div><div class="ttdoc">Subscribe to a topic using a bookmark. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5998</div></div>
<div class="ttc" id="amps_8h_html_a11605a2b33d17883c3496559d9d492d6"><div class="ttname"><a href="amps_8h.html#a11605a2b33d17883c3496559d9d492d6">amps_client_disconnect</a></div><div class="ttdeci">AMPSDLL void amps_client_disconnect(amps_handle handle)</div><div class="ttdoc">Disconnects from the AMPS server, if connected. </div></div>
<div class="ttc" id="amps_8h_html_acbe9d0930eeaa8c7ef2d6620e779f2e2"><div class="ttname"><a href="amps_8h.html#acbe9d0930eeaa8c7ef2d6620e779f2e2">amps_client_get_socket</a></div><div class="ttdeci">AMPSDLL AMPS_SOCKET amps_client_get_socket(amps_handle client)</div><div class="ttdoc">Returns the socket from the underlying transport in client, or NULL if no transport is associated wit...</div></div>
<div class="ttc" id="classAMPS_1_1BookmarkStore_html_a4d9b0e300e15e63999aad696c00b04c8"><div class="ttname"><a href="classAMPS_1_1BookmarkStore.html#a4d9b0e300e15e63999aad696c00b04c8">AMPS::BookmarkStore::discard</a></div><div class="ttdeci">void discard(const Message::Field &amp;subId_, size_t bookmarkSeqNo_)</div><div class="ttdoc">Log a discard-bookmark entry to the persistent log based on a bookmark sequence number. </div><div class="ttdef"><b>Definition:</b> BookmarkStore.hpp:283</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_aceec2c8638a2728d13604ad2b37cae7b"><div class="ttname"><a href="classAMPS_1_1Client.html#aceec2c8638a2728d13604ad2b37cae7b">AMPS::Client::setPublishStore</a></div><div class="ttdeci">void setPublishStore(const Store &amp;publishStore_)</div><div class="ttdoc">Set the publish store to be used by the client. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5428</div></div>
<div class="ttc" id="classAMPS_1_1Store_html_ac7f5bd02d664786a067b1cf8b54728fa"><div class="ttname"><a href="classAMPS_1_1Store.html#ac7f5bd02d664786a067b1cf8b54728fa">AMPS::Store::setErrorOnPublishGap</a></div><div class="ttdeci">void setErrorOnPublishGap(bool errorOnPublishGap_)</div><div class="ttdoc">Called to enable or disable throwing PublishStoreGapException. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1308</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_aa709a48088f1e1d859d5cb07a54b5848"><div class="ttname"><a href="classAMPS_1_1Client.html#aa709a48088f1e1d859d5cb07a54b5848">AMPS::Client::deltaPublish</a></div><div class="ttdeci">amps_uint64_t deltaPublish(const std::string &amp;topic_, const std::string &amp;data_, unsigned long expiration_)</div><div class="ttdoc">Publish the changed fields of a message to an AMPS topic. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5693</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a4b3c857af6818082d742295f5d38edd2"><div class="ttname"><a href="classAMPS_1_1Client.html#a4b3c857af6818082d742295f5d38edd2">AMPS::Client::convertVersionToNumber</a></div><div class="ttdeci">static size_t convertVersionToNumber(const char *data_, size_t len_)</div><div class="ttdoc">Converts a string version, such as &quot;3.8.1.5&quot; into the same numeric form used internally and returned ...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5224</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_abaa87b57b3fd2b92efba6a2987b825f2"><div class="ttname"><a href="classAMPS_1_1Message.html#abaa87b57b3fd2b92efba6a2987b825f2">AMPS::Message::setFilter</a></div><div class="ttdeci">Message &amp; setFilter(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the Filter header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1306</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a4daebac94b438bf99cb0efd782095950"><div class="ttname"><a href="classAMPS_1_1Command.html#a4daebac94b438bf99cb0efd782095950">AMPS::Command::setSubId</a></div><div class="ttdeci">Command &amp; setSubId(const char *subId_, size_t subIdLen_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:694</div></div>
<div class="ttc" id="classAMPS_1_1Message_1_1Options_html_a4f4f51284cd746515ffe1ce4e7c727b7"><div class="ttname"><a href="classAMPS_1_1Message_1_1Options.html#a4f4f51284cd746515ffe1ce4e7c727b7">AMPS::Message::Options::setNoEmpties</a></div><div class="ttdeci">void setNoEmpties(void)</div><div class="ttdoc">Set the option to not send empty messages on a delta subscription. </div><div class="ttdef"><b>Definition:</b> Message.hpp:841</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_aeb616a25779f0bacd12e021ac3b20b9b"><div class="ttname"><a href="classAMPS_1_1Client.html#aeb616a25779f0bacd12e021ac3b20b9b">AMPS::Client::setDuplicateMessageHandler</a></div><div class="ttdeci">void setDuplicateMessageHandler(const MessageHandler &amp;duplicateMessageHandler_)</div><div class="ttdoc">Sets a callback function that is invoked when a duplicate message is detected. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5444</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_afd3b5831324320af6566883f3b9ff9dd"><div class="ttname"><a href="classAMPS_1_1Message.html#afd3b5831324320af6566883f3b9ff9dd">AMPS::Message::deepCopy</a></div><div class="ttdeci">Message deepCopy(void) const </div><div class="ttdoc">Returns a deep copy of self. </div><div class="ttdef"><b>Definition:</b> Message.hpp:579</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a130c79c818383f906967a6d8a0bad2ed"><div class="ttname"><a href="classAMPS_1_1Client.html#a130c79c818383f906967a6d8a0bad2ed">AMPS::Client::removeConnectionStateListener</a></div><div class="ttdeci">void removeConnectionStateListener(ConnectionStateListener *listener)</div><div class="ttdoc">Attempts to remove listener from self&amp;#39;s set of ConnectionStateListeners. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7098</div></div>
<div class="ttc" id="classAMPS_1_1Message_1_1Options_html_adf952bbadc27b3ee45680d4041458a2e"><div class="ttname"><a href="classAMPS_1_1Message_1_1Options.html#adf952bbadc27b3ee45680d4041458a2e">AMPS::Message::Options::setOOF</a></div><div class="ttdeci">void setOOF(void)</div><div class="ttdoc">Set the option to receive out of focus (OOF) messages on a subscription, where applicable. </div><div class="ttdef"><b>Definition:</b> Message.hpp:824</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a334e6e58d2614fc67d2b16f2d2dbb1e8"><div class="ttname"><a href="classAMPS_1_1Client.html#a334e6e58d2614fc67d2b16f2d2dbb1e8">AMPS::Client::getAckTimeout</a></div><div class="ttdeci">int getAckTimeout(void) const </div><div class="ttdoc">Returns the current value of the message queue ack timeout setting – that is, the amount of time aft...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7327</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_ac0545f209017fb7ea215aa9b13668e66"><div class="ttname"><a href="classAMPS_1_1Client.html#ac0545f209017fb7ea215aa9b13668e66">AMPS::Client::getServerVersionInfo</a></div><div class="ttdeci">VersionInfo getServerVersionInfo() const </div><div class="ttdoc">Returns the server version retrieved during logon. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5195</div></div>
<div class="ttc" id="group__sync_html_ga2fd7edef1e59fbc09d8eb5d515b641e2"><div class="ttname"><a href="group__sync.html#ga2fd7edef1e59fbc09d8eb5d515b641e2">AMPS::Client::sowDeleteByKeys</a></div><div class="ttdeci">Message sowDeleteByKeys(const std::string &amp;topic_, const std::string &amp;keys_, long timeout_=0)</div><div class="ttdoc">Deletes messages that match SOW keys from a topic&amp;#39;s SOW cache. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6780</div></div>
<div class="ttc" id="amps_8h_html_a913663899199a9168a51df67a2ff8684"><div class="ttname"><a href="amps_8h.html#a913663899199a9168a51df67a2ff8684">amps_client_set_transport_filter_function</a></div><div class="ttdeci">AMPSDLL amps_result amps_client_set_transport_filter_function(amps_handle client, amps_transport_filter_function filter, void *userData)</div><div class="ttdoc">Sets a user-supplied callback function for filtering data before it is sent and after it is received...</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_abe60c2afbfddcd1eb2e2f2d035100e83"><div class="ttname"><a href="classAMPS_1_1Command.html#abe60c2afbfddcd1eb2e2f2d035100e83">AMPS::Command::Command</a></div><div class="ttdeci">Command(const char *command_, size_t commandLen_)</div><div class="ttdoc">Creates an object to represent the given AMPS command, such as &quot;sow&quot; or &quot;subscribe&quot;. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:537</div></div>
<div class="ttc" id="amps_8h_html_a55949576a6ac830600d5e356308308c4"><div class="ttname"><a href="amps_8h.html#a55949576a6ac830600d5e356308308c4">amps_message_get_field_uint64</a></div><div class="ttdeci">AMPSDLL amps_uint64_t amps_message_get_field_uint64(amps_handle message, FieldId field)</div><div class="ttdoc">Gets the unsigned 64-bit int value of a header field in an AMPS message. </div></div>
<div class="ttc" id="amps_8h_html_ad5674cb8a55c793aa66de7c7068d923c"><div class="ttname"><a href="amps_8h.html#ad5674cb8a55c793aa66de7c7068d923c">amps_client_set_idle_time</a></div><div class="ttdeci">AMPSDLL amps_result amps_client_set_idle_time(amps_handle client, int idleTime)</div><div class="ttdoc">Sets an idle-time (milliseconds). </div></div>
<div class="ttc" id="classAMPS_1_1Message_html"><div class="ttname"><a href="classAMPS_1_1Message.html">AMPS::Message</a></div><div class="ttdoc">Message encapsulates a single message sent to or received from an AMPS server, and provides methods f...</div><div class="ttdef"><b>Definition:</b> Message.hpp:531</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a749101140aff56cb9ed189dc75251f9d"><div class="ttname"><a href="classAMPS_1_1Message.html#a749101140aff56cb9ed189dc75251f9d">AMPS::Message::setAckTypeEnum</a></div><div class="ttdeci">Message &amp; setAckTypeEnum(unsigned ackType_)</div><div class="ttdoc">Encode self&amp;#39;s &quot;ack type&quot; field from a bitmask of values from AckType. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1183</div></div>
<div class="ttc" id="classAMPS_1_1Store_html_a5cf5ab022849a4bc25c5d4f75653cf8b"><div class="ttname"><a href="classAMPS_1_1Store.html#a5cf5ab022849a4bc25c5d4f75653cf8b">AMPS::Store::getLastPersisted</a></div><div class="ttdeci">amps_uint64_t getLastPersisted()</div><div class="ttdoc">Get the last persisted message sequence in the store. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1279</div></div>
<div class="ttc" id="classAMPS_1_1__FIXBuilder_html_afa8c92970e0d5176ed81f1205f0e7adb"><div class="ttname"><a href="classAMPS_1_1__FIXBuilder.html#afa8c92970e0d5176ed81f1205f0e7adb">AMPS::_FIXBuilder::getString</a></div><div class="ttdeci">std::string getString() const </div><div class="ttdoc">Returns the current contents of this builder as a string. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:8125</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_ac45274bb1363104da5330b9881348583"><div class="ttname"><a href="classAMPS_1_1Client.html#ac45274bb1363104da5330b9881348583">AMPS::Client::setTransportFilterFunction</a></div><div class="ttdeci">void setTransportFilterFunction(amps_transport_filter_function filter_, void *userData_)</div><div class="ttdoc">Sets a filter function on the transport that is called with all raw data sent or received. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7395</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_af83e27efa1a60c996b6d50788ba3efad"><div class="ttname"><a href="classAMPS_1_1Client.html#af83e27efa1a60c996b6d50788ba3efad">AMPS::Client::publish</a></div><div class="ttdeci">amps_uint64_t publish(const char *topic_, size_t topicLength_, const char *data_, size_t dataLength_, unsigned long expiration_)</div><div class="ttdoc">Publish a message to an AMPS topic, returning the sequence number assigned by the publish store if on...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5580</div></div>
<div class="ttc" id="classAMPS_1_1MessageStream_html_a1ba2852c71ae794b66020f0b331d7288"><div class="ttname"><a href="classAMPS_1_1MessageStream.html#a1ba2852c71ae794b66020f0b331d7288">AMPS::MessageStream::begin</a></div><div class="ttdeci">iterator begin(void)</div><div class="ttdoc">Returns an iterator representing the beginning of the topic or subscription. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:4996</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a7e6907cf19cb214f8c4bd02e236e01fb"><div class="ttname"><a href="classAMPS_1_1Message.html#a7e6907cf19cb214f8c4bd02e236e01fb">AMPS::Message::getLeasePeriod</a></div><div class="ttdeci">Field getLeasePeriod() const </div><div class="ttdoc">Retrieves the value of the LeasePeriod header of the Message as a new Field. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1309</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a718262bf4e93bd1a3268a63f2da2286e"><div class="ttname"><a href="classAMPS_1_1Command.html#a718262bf4e93bd1a3268a63f2da2286e">AMPS::Command::setSowKeys</a></div><div class="ttdeci">Command &amp; setSowKeys(const char *sowKeys_, size_t sowKeysLen_)</div><div class="ttdoc">Sets the SowKeys for the command. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:629</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a45f7323a20d0ca48db4386c4ee80d50f"><div class="ttname"><a href="classAMPS_1_1Client.html#a45f7323a20d0ca48db4386c4ee80d50f">AMPS::Client::NOW</a></div><div class="ttdeci">static const char * NOW()</div><div class="ttdoc">Convenience method for returning the special value to start a subscription at the end of the transact...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7026</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a2e6f175a2f1b77cc51b0766d9ca44064"><div class="ttname"><a href="classAMPS_1_1Command.html#a2e6f175a2f1b77cc51b0766d9ca44064">AMPS::Command::setAckType</a></div><div class="ttdeci">Command &amp; setAckType(const std::string &amp;ackType_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:871</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a166d557bcf677b643623c7385ab54499"><div class="ttname"><a href="classAMPS_1_1Client.html#a166d557bcf677b643623c7385ab54499">AMPS::Client::BOOKMARK_EPOCH</a></div><div class="ttdeci">static const char * BOOKMARK_EPOCH()</div><div class="ttdoc">Convenience method for returning the special value to start a subscription at the beginning of the tr...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7036</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a9575d96a91df4f3254085a79d24cc9d8"><div class="ttname"><a href="classAMPS_1_1Client.html#a9575d96a91df4f3254085a79d24cc9d8">AMPS::Client::send</a></div><div class="ttdeci">void send(const Message &amp;message)</div><div class="ttdoc">Sends a Message to the connected AMPS server, performing only minimal validation and bypassing client...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5280</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a91c7836acad3ba13f71c2de6a320cfc7"><div class="ttname"><a href="classAMPS_1_1Message.html#a91c7836acad3ba13f71c2de6a320cfc7">AMPS::Message::setSowKey</a></div><div class="ttdeci">Message &amp; setSowKey(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the SowKey header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1424</div></div>
<div class="ttc" id="amps_8h_html_aacc8e69a64c3f57a0905ff8de7ddee6d"><div class="ttname"><a href="amps_8h.html#aacc8e69a64c3f57a0905ff8de7ddee6d">amps_message_set_field_value</a></div><div class="ttdeci">AMPSDLL void amps_message_set_field_value(amps_handle message, FieldId field, const amps_char *value, size_t length)</div><div class="ttdoc">Sets the value of a header field in an AMPS message. </div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a2059bec4f61e57ee2ea1d73b52438e4b"><div class="ttname"><a href="classAMPS_1_1Client.html#a2059bec4f61e57ee2ea1d73b52438e4b">AMPS::Client::bookmarkSubscribe</a></div><div class="ttdeci">std::string bookmarkSubscribe(const MessageHandler &amp;messageHandler_, const std::string &amp;topic_, long timeout_, const std::string &amp;bookmark_, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;options_=&quot;&quot;, const std::string &amp;subId_=&quot;&quot;)</div><div class="ttdoc">Subscribe to a topic using a bookmark. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5970</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a5fa58330c69b73c47b4d8bc3de6bfa06"><div class="ttname"><a href="classAMPS_1_1Message.html#a5fa58330c69b73c47b4d8bc3de6bfa06">AMPS::Message::getFilter</a></div><div class="ttdeci">Field getFilter() const </div><div class="ttdoc">Retrieves the value of the Filter header of the Message as a new Field. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1306</div></div>
<div class="ttc" id="classAMPS_1_1StoreImpl_html_a2b96fcfc9e76a87c1854edc7c3f7d7ce"><div class="ttname"><a href="classAMPS_1_1StoreImpl.html#a2b96fcfc9e76a87c1854edc7c3f7d7ce">AMPS::StoreImpl::getUnsetPosition</a></div><div class="ttdeci">static size_t getUnsetPosition()</div><div class="ttdoc">Method to return the value used to represent not found or unset. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1122</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_ac134878c8dbb9b5674cd241af5d57617"><div class="ttname"><a href="classAMPS_1_1Client.html#ac134878c8dbb9b5674cd241af5d57617">AMPS::Client::setRetryOnDisconnect</a></div><div class="ttdeci">void setRetryOnDisconnect(bool isRetryOnDisconnect_)</div><div class="ttdoc">Enables or disables automatic retry of a command to AMPS after a reconnect. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7357</div></div>
<div class="ttc" id="classAMPS_1_1MessageStream_html_a585bc3ade892c75bc4f2dedc75f232fc"><div class="ttname"><a href="classAMPS_1_1MessageStream.html#a585bc3ade892c75bc4f2dedc75f232fc">AMPS::MessageStream::getMaxDepth</a></div><div class="ttdeci">unsigned getMaxDepth(void) const </div><div class="ttdoc">Gets the maximum number of messages that can be held in the underlying queue. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:8710</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_ad63229ae2f13d0d4f1aca228ccd902c6"><div class="ttname"><a href="classAMPS_1_1Message.html#ad63229ae2f13d0d4f1aca228ccd902c6">AMPS::Message::assignUserId</a></div><div class="ttdeci">Message &amp; assignUserId(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the UserId header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1453</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_ab17450ad7154a0867ae89aa4fdc4e3e4"><div class="ttname"><a href="classAMPS_1_1Client.html#ab17450ad7154a0867ae89aa4fdc4e3e4">AMPS::Client::connect</a></div><div class="ttdeci">void connect(const std::string &amp;uri)</div><div class="ttdoc">Connect to an AMPS server. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5255</div></div>
<div class="ttc" id="classAMPS_1_1Field_html_a268793c302ec9a3b7ce83248ef7524b3"><div class="ttname"><a href="classAMPS_1_1Field.html#a268793c302ec9a3b7ce83248ef7524b3">AMPS::Field::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdoc">Deletes the data associated with this Field, should only be used on Fields that were created as deepC...</div><div class="ttdef"><b>Definition:</b> Field.hpp:247</div></div>
<div class="ttc" id="classAMPS_1_1SubscriptionManager_html"><div class="ttname"><a href="classAMPS_1_1SubscriptionManager.html">AMPS::SubscriptionManager</a></div><div class="ttdoc">Abstract base class to manage all subscriptions placed on a client so that they can be re-established...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1423</div></div>
<div class="ttc" id="group__async_html_gad6fe353536b773e724fa68ffb957a67f"><div class="ttname"><a href="group__async.html#gad6fe353536b773e724fa68ffb957a67f">AMPS::Client::sowAndDeltaSubscribe</a></div><div class="ttdeci">std::string sowAndDeltaSubscribe(const MessageHandler &amp;messageHandler_, const std::string &amp;topic_, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;orderBy_=&quot;&quot;, int batchSize_=DEFAULT_BATCH_SIZE, int topN_=DEFAULT_TOP_N, const std::string &amp;options_=&quot;&quot;, long timeout_=DEFAULT_COMMAND_TIMEOUT)</div><div class="ttdoc">Query the SOW cache of a topic and initiates a new delta subscription on it. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6452</div></div>
<div class="ttc" id="amps_8h_html_a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb"><div class="ttname"><a href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a6d02b911ff01261a69f5bee75fb996eb">AMPS_E_OK</a></div><div class="ttdoc">Success. </div><div class="ttdef"><b>Definition:</b> amps.h:205</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_ab84e7ca0d5f72269208b0647b67c0375"><div class="ttname"><a href="classAMPS_1_1Message.html#ab84e7ca0d5f72269208b0647b67c0375">AMPS::Message::setCommandEnum</a></div><div class="ttdeci">Message &amp; setCommandEnum(Command::Type command_)</div><div class="ttdoc">Set self&amp;#39;s &quot;command&quot; field from one of the values in Command. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1288</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_afdc34084b92891f21370c9f848936cad"><div class="ttname"><a href="classAMPS_1_1Message.html#afdc34084b92891f21370c9f848936cad">AMPS::Message::getOptions</a></div><div class="ttdeci">Field getOptions() const </div><div class="ttdoc">Retrieves the value of the Options header of the Message as a new Field. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1316</div></div>
<div class="ttc" id="classAMPS_1_1DefaultAuthenticator_html_a36c6103a7f172503f19a3d314f2df9d4"><div class="ttname"><a href="classAMPS_1_1DefaultAuthenticator.html#a36c6103a7f172503f19a3d314f2df9d4">AMPS::DefaultAuthenticator::authenticate</a></div><div class="ttdeci">std::string authenticate(const std::string &amp;, const std::string &amp;password_)</div><div class="ttdoc">A simple implementation that returns an unmodified password. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1005</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a4af4789d563e731b9a952bb6a1866e5e"><div class="ttname"><a href="classAMPS_1_1Client.html#a4af4789d563e731b9a952bb6a1866e5e">AMPS::Client::deltaPublish</a></div><div class="ttdeci">amps_uint64_t deltaPublish(const char *topic_, size_t topicLength_, const char *data_, size_t dataLength_)</div><div class="ttdoc">Publish the changed fields of a message to an AMPS topic. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5670</div></div>
<div class="ttc" id="classAMPS_1_1FIXShredder_html_af693877930aa1bc6b64cabbff322314d"><div class="ttname"><a href="classAMPS_1_1FIXShredder.html#af693877930aa1bc6b64cabbff322314d">AMPS::FIXShredder::FIXShredder</a></div><div class="ttdeci">FIXShredder(char fieldSep_=(char) 1)</div><div class="ttdoc">Construct an instance of FIXShredder using the specified value as the delimiter between fields...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:8170</div></div>
<div class="ttc" id="group__async_html_gaff38779507c72161126f1311aa6d632b"><div class="ttname"><a href="group__async.html#gaff38779507c72161126f1311aa6d632b">AMPS::Client::sow</a></div><div class="ttdeci">std::string sow(const MessageHandler &amp;messageHandler_, const std::string &amp;topic_, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;orderBy_=&quot;&quot;, const std::string &amp;bookmark_=&quot;&quot;, int batchSize_=DEFAULT_BATCH_SIZE, int topN_=DEFAULT_TOP_N, const std::string &amp;options_=&quot;&quot;, long timeout_=DEFAULT_COMMAND_TIMEOUT)</div><div class="ttdoc">Query a State-of-the-World topic. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6094</div></div>
<div class="ttc" id="amps_8h_html_acfa1278412265f3b4c421e77111ed2ce"><div class="ttname"><a href="amps_8h.html#acfa1278412265f3b4c421e77111ed2ce">amps_handle</a></div><div class="ttdeci">void * amps_handle</div><div class="ttdoc">Opaque handle type used to refer to objects in the AMPS api. </div><div class="ttdef"><b>Definition:</b> amps.h:195</div></div>
<div class="ttc" id="classAMPS_1_1Message_1_1Options_html"><div class="ttname"><a href="classAMPS_1_1Message_1_1Options.html">AMPS::Message::Options</a></div><div class="ttdoc">Class for constructing the options string to pass to AMPS in a Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:601</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_aa5855363a3780aac2df900f815dc6eba"><div class="ttname"><a href="classAMPS_1_1Client.html#aa5855363a3780aac2df900f815dc6eba">AMPS::Client::addMessageHandler</a></div><div class="ttdeci">void addMessageHandler(const Field &amp;commandId_, const AMPS::MessageHandler &amp;messageHandler_, unsigned requestedAcks_, bool isSubscribe_)</div><div class="ttdoc">Adds a MessageHandler to be invoked for Messages with the given CommandId as their command id...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5293</div></div>
<div class="ttc" id="classAMPS_1_1Field_html_ae04e461b0091ff9564f9bf17bd07f23a"><div class="ttname"><a href="classAMPS_1_1Field.html#ae04e461b0091ff9564f9bf17bd07f23a">AMPS::Field::data</a></div><div class="ttdeci">const char * data() const </div><div class="ttdoc">Returns the (non-null-terminated) data underlying this field. </div><div class="ttdef"><b>Definition:</b> Field.hpp:260</div></div>
<div class="ttc" id="classAMPS_1_1MessageStream_html_ac63bb0d3c7072548c04ac41d35131416"><div class="ttname"><a href="classAMPS_1_1MessageStream.html#ac63bb0d3c7072548c04ac41d35131416">AMPS::MessageStream::isValid</a></div><div class="ttdeci">bool isValid() const </div><div class="ttdoc">Returns true if self is a valid stream that may be iterated. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:4989</div></div>
<div class="ttc" id="amps_8h_html_a684390c2bf8c56d49e8e2d4dc715bb04"><div class="ttname"><a href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04">amps_result</a></div><div class="ttdeci">amps_result</div><div class="ttdoc">Return values from amps_xxx functions. </div><div class="ttdef"><b>Definition:</b> amps.h:200</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a38829ab40b25b3514098007cf47c622f"><div class="ttname"><a href="classAMPS_1_1Client.html#a38829ab40b25b3514098007cf47c622f">AMPS::Client::getFailedWriteHandler</a></div><div class="ttdeci">FailedWriteHandler * getFailedWriteHandler()</div><div class="ttdoc">Get the handler that is invoked to report on failed writes. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5481</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a3a466c84aa258673083b621733a595df"><div class="ttname"><a href="classAMPS_1_1Message.html#a3a466c84aa258673083b621733a595df">AMPS::Message::getAckType</a></div><div class="ttdeci">Field getAckType() const </div><div class="ttdoc">Retrieves the value of the AckType header of the Message as a new Field. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1130</div></div>
<div class="ttc" id="amps_8h_html_af1c2d862766f235158f10e8a2d368389"><div class="ttname"><a href="amps_8h.html#af1c2d862766f235158f10e8a2d368389">amps_client_create</a></div><div class="ttdeci">AMPSDLL amps_handle amps_client_create(const amps_char *clientName)</div><div class="ttdoc">Functions for creation of an AMPS client. </div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a9bfa516683f5fd04d0ab2e3161b2babc"><div class="ttname"><a href="classAMPS_1_1Message.html#a9bfa516683f5fd04d0ab2e3161b2babc">AMPS::Message::getCommand</a></div><div class="ttdeci">Field getCommand() const </div><div class="ttdoc">Retrieves the value of the Command header of the Message as a new Field. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1195</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_aafe817ecbe79a5277f2007e1095124a3"><div class="ttname"><a href="classAMPS_1_1Client.html#aafe817ecbe79a5277f2007e1095124a3">AMPS::Client::execute</a></div><div class="ttdeci">MessageStream execute(Command &amp;command_)</div><div class="ttdoc">Execute the provided command and return messages received in response in a MessageStream. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:8724</div></div>
<div class="ttc" id="amps_8h_html_ad41bd414e658417575019135a09acf55"><div class="ttname"><a href="amps_8h.html#ad41bd414e658417575019135a09acf55">amps_transport_filter_function</a></div><div class="ttdeci">void(* amps_transport_filter_function)(const unsigned char *, size_t, short, void *)</div><div class="ttdoc">Prototype for a user-supplied callback function for filtering data before it is sent and after it is ...</div><div class="ttdef"><b>Definition:</b> amps.h:626</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_ab68a4ca105280880c57e3bb29506c2c6"><div class="ttname"><a href="classAMPS_1_1Message.html#ab68a4ca105280880c57e3bb29506c2c6">AMPS::Message::setTopic</a></div><div class="ttdeci">Message &amp; setTopic(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the Topic header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1449</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_af876c155695c6296a597d3ffd958b8b7"><div class="ttname"><a href="classAMPS_1_1Client.html#af876c155695c6296a597d3ffd958b8b7">AMPS::Client::getPublishStore</a></div><div class="ttdeci">Store getPublishStore()</div><div class="ttdoc">Get the publish store used by the client. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5436</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_adcd285a6bbd72d8112083a5d47a7d626"><div class="ttname"><a href="classAMPS_1_1Client.html#adcd285a6bbd72d8112083a5d47a7d626">AMPS::Client::setThreadCreatedCallback</a></div><div class="ttdeci">void setThreadCreatedCallback(amps_thread_created_callback callback_, void *userData_)</div><div class="ttdoc">Sets a callback function on the transport that is called when a new thread is created to receive data...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7409</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a03cab2a448b7204d209f229c966bb151"><div class="ttname"><a href="classAMPS_1_1Command.html#a03cab2a448b7204d209f229c966bb151">AMPS::Command::getAckTypeEnum</a></div><div class="ttdeci">unsigned getAckTypeEnum() const </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:920</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_aaeb2b405c78ce2a16f2f5a2f685fc1a0"><div class="ttname"><a href="classAMPS_1_1Client.html#aaeb2b405c78ce2a16f2f5a2f685fc1a0">AMPS::Client::getServerVersion</a></div><div class="ttdeci">size_t getServerVersion() const </div><div class="ttdoc">Returns the server version retrieved during logon. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5184</div></div>
<div class="ttc" id="classAMPS_1_1ConnectionStateListener_html_a6b55fc390dd4591b2a89fd00113f1ef3"><div class="ttname"><a href="classAMPS_1_1ConnectionStateListener.html#a6b55fc390dd4591b2a89fd00113f1ef3">AMPS::ConnectionStateListener::State</a></div><div class="ttdeci">State</div><div class="ttdoc">Constants for the state of the connection. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1467</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a95f64efcf26813d9a2888b115eaa2e82"><div class="ttname"><a href="classAMPS_1_1Command.html#a95f64efcf26813d9a2888b115eaa2e82">AMPS::Command::setData</a></div><div class="ttdeci">Command &amp; setData(const std::string &amp;data_)</div><div class="ttdoc">Sets the data for this command from an existing string. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:798</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a71a4e9911b4ecf17cfdc8c92febc80ef"><div class="ttname"><a href="classAMPS_1_1Client.html#a71a4e9911b4ecf17cfdc8c92febc80ef">AMPS::Client::logon</a></div><div class="ttdeci">std::string logon(int timeout_=0, Authenticator &amp;authenticator_=DefaultAuthenticator::instance(), const char *options_=NULL)</div><div class="ttdoc">Logon to the server, providing the client name, credentials (if available), and client information (s...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5742</div></div>
<div class="ttc" id="classAMPS_1_1Store_html_a7ec3c52b0f3d54454f55d8ccb071151c"><div class="ttname"><a href="classAMPS_1_1Store.html#a7ec3c52b0f3d54454f55d8ccb071151c">AMPS::Store::discardUpTo</a></div><div class="ttdeci">void discardUpTo(amps_uint64_t index_)</div><div class="ttdoc">Called by Client to indicate that all messages up to and including. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1212</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_aa5bbd6590624610a555e3928addca1a2"><div class="ttname"><a href="classAMPS_1_1Command.html#aa5bbd6590624610a555e3928addca1a2">AMPS::Command::setFilter</a></div><div class="ttdeci">Command &amp; setFilter(const std::string &amp;filter_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:661</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a91a6874ed0558ff4f835f61bcf48c6e2"><div class="ttname"><a href="classAMPS_1_1Client.html#a91a6874ed0558ff4f835f61bcf48c6e2">AMPS::Client::getNameHash</a></div><div class="ttdeci">const std::string &amp; getNameHash() const </div><div class="ttdoc">Returns the name hash string of this client as generated by the server and returned when the client l...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5145</div></div>
<div class="ttc" id="classAMPS_1_1StoreImpl_html_ae6dffba99210c30facc396491f271e77"><div class="ttname"><a href="classAMPS_1_1StoreImpl.html#ae6dffba99210c30facc396491f271e77">AMPS::StoreImpl::StoreImpl</a></div><div class="ttdeci">StoreImpl(bool errorOnPublishGap_=false)</div><div class="ttdoc">Default constructor. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1067</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_aeb7ad8de45b5f94b094a662631a0f24f"><div class="ttname"><a href="classAMPS_1_1Client.html#aeb7ad8de45b5f94b094a662631a0f24f">AMPS::Client::sowAndSubscribe</a></div><div class="ttdeci">MessageStream sowAndSubscribe(const char *topic_, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;orderBy_=&quot;&quot;, const std::string &amp;bookmark_=&quot;&quot;, int batchSize_=DEFAULT_BATCH_SIZE, int topN_=DEFAULT_TOP_N, const std::string &amp;options_=&quot;&quot;, long timeout_=DEFAULT_COMMAND_TIMEOUT)</div><div class="ttdoc">Query the SOW cache of a topic and initiates a new subscription on it. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6406</div></div>
<div class="ttc" id="classAMPS_1_1Client_html"><div class="ttname"><a href="classAMPS_1_1Client.html">AMPS::Client</a></div><div class="ttdoc">Client represents a connection to an AMPS server, but does not provide failover or reconnection behav...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5075</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_ac3d0413c7edcb0b40260b728fecb183a"><div class="ttname"><a href="classAMPS_1_1Client.html#ac3d0413c7edcb0b40260b728fecb183a">AMPS::Client::setGlobalCommandTypeMessageHandler</a></div><div class="ttdeci">void setGlobalCommandTypeMessageHandler(const std::string &amp;command_, const MessageHandler &amp;handler_)</div><div class="ttdoc">Sets a handler for all messages of a particular type, or for messages that would be delivered to a pa...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6982</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a7228cb64f1bc52d086d96928c6b4f29d"><div class="ttname"><a href="classAMPS_1_1Command.html#a7228cb64f1bc52d086d96928c6b4f29d">AMPS::Command::setSubId</a></div><div class="ttdeci">Command &amp; setSubId(const std::string &amp;subId_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:687</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a8ced98ddc65621dd8ad33d0aaab330d6"><div class="ttname"><a href="classAMPS_1_1Client.html#a8ced98ddc65621dd8ad33d0aaab330d6">AMPS::Client::BOOKMARK_NOW</a></div><div class="ttdeci">static const char * BOOKMARK_NOW()</div><div class="ttdoc">Convenience method for returning the special value to start a subscription at the end of the transact...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7017</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a375c97392882ea1eb606bdd4432ea98c"><div class="ttname"><a href="classAMPS_1_1Message.html#a375c97392882ea1eb606bdd4432ea98c">AMPS::Message::newCommandId</a></div><div class="ttdeci">Message &amp; newCommandId()</div><div class="ttdoc">Creates and sets a new sequential value for the CommandId header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1302</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_adc5b02f576cab62cfdaae495b83857ef"><div class="ttname"><a href="classAMPS_1_1Client.html#adc5b02f576cab62cfdaae495b83857ef">AMPS::Client::addConnectionStateListener</a></div><div class="ttdeci">void addConnectionStateListener(ConnectionStateListener *listener)</div><div class="ttdoc">Adds a ConnectionStateListener to self&amp;#39;s set of listeners. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7090</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_afb5f2abac84771cc21a79726a9c7f520"><div class="ttname"><a href="classAMPS_1_1Command.html#afb5f2abac84771cc21a79726a9c7f520">AMPS::Command::reset</a></div><div class="ttdeci">Command &amp; reset(const std::string &amp;command_)</div><div class="ttdoc">Resets the fields of self, and sets the command to command_. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:552</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a3b178e108bbc1d6f48b40039c714975e"><div class="ttname"><a href="classAMPS_1_1Command.html#a3b178e108bbc1d6f48b40039c714975e">AMPS::Command::setTimeout</a></div><div class="ttdeci">Command &amp; setTimeout(unsigned timeout_)</div><div class="ttdoc">Sets the client-side timeout for this command. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:820</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a8c461192dce399504f6d356ad8618d7e"><div class="ttname"><a href="classAMPS_1_1Client.html#a8c461192dce399504f6d356ad8618d7e">AMPS::Client::clearConnectionStateListeners</a></div><div class="ttdeci">void clearConnectionStateListeners()</div><div class="ttdoc">Clear all listeners from self&amp;#39;s set of ConnectionStateListeners. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7105</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a6a226fb422c3baf9b5304b292e7cd950"><div class="ttname"><a href="classAMPS_1_1Message.html#a6a226fb422c3baf9b5304b292e7cd950">AMPS::Message::setSequence</a></div><div class="ttdeci">Message &amp; setSequence(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the Sequence header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1422</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a06589dcfa1e74108cce1c0350a8ac5a4"><div class="ttname"><a href="classAMPS_1_1Client.html#a06589dcfa1e74108cce1c0350a8ac5a4">AMPS::Client::publish</a></div><div class="ttdeci">amps_uint64_t publish(const char *topic_, size_t topicLength_, const char *data_, size_t dataLength_)</div><div class="ttdoc">Publish a message to an AMPS topic, returning the sequence number assigned by the publish store if on...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5529</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a72986309f5f7ddc9bd34704d5a771b50"><div class="ttname"><a href="classAMPS_1_1Command.html#a72986309f5f7ddc9bd34704d5a771b50">AMPS::Command::setCommandId</a></div><div class="ttdeci">Command &amp; setCommandId(const std::string &amp;cmdId_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:635</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a6bcb681645121af485daee1d4ecda730"><div class="ttname"><a href="classAMPS_1_1Message.html#a6bcb681645121af485daee1d4ecda730">AMPS::Message::setUserId</a></div><div class="ttdeci">Message &amp; setUserId(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the UserId header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1453</div></div>
<div class="ttc" id="amps_8h_html_ac34eedaa39d701459abd94bd14086b67"><div class="ttname"><a href="amps_8h.html#ac34eedaa39d701459abd94bd14086b67">amps_client_send_with_version</a></div><div class="ttdeci">AMPSDLL amps_result amps_client_send_with_version(amps_handle client, amps_handle message, unsigned *version_out)</div><div class="ttdoc">Sends a message to the AMPS server. </div></div>
<div class="ttc" id="classAMPS_1_1Message_html_afdc3e09761f4076f3ee18e99cf254e97"><div class="ttname"><a href="classAMPS_1_1Message.html#afdc3e09761f4076f3ee18e99cf254e97">AMPS::Message::getTopic</a></div><div class="ttdeci">Field getTopic() const </div><div class="ttdoc">Retrieves the value of the Topic header of the Message as a new Field. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1449</div></div>
<div class="ttc" id="amps_8h_html_ac7816495baca710ac04603903aa172fb"><div class="ttname"><a href="amps_8h.html#ac7816495baca710ac04603903aa172fb">amps_client_set_message_handler</a></div><div class="ttdeci">AMPSDLL void amps_client_set_message_handler(amps_handle client, amps_handler messageHandler, void *userData)</div><div class="ttdoc">Sets the message handler function for this client. </div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a1c6cabbad324c935e8f97eff3476a92d"><div class="ttname"><a href="classAMPS_1_1Client.html#a1c6cabbad324c935e8f97eff3476a92d">AMPS::Client::getSubscriptionManager</a></div><div class="ttdeci">SubscriptionManager * getSubscriptionManager()</div><div class="ttdoc">Get the subscription manager being used by the client. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5392</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_add7a42da41f6739a482036693be12a2b"><div class="ttname"><a href="classAMPS_1_1Client.html#add7a42da41f6739a482036693be12a2b">AMPS::Client::subscribe</a></div><div class="ttdeci">std::string subscribe(const MessageHandler &amp;messageHandler_, const std::string &amp;topic_, long timeout_=0, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;options_=&quot;&quot;, const std::string &amp;subId_=&quot;&quot;)</div><div class="ttdoc">Subscribe to a topic. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5805</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a8d27c7a091022a3d09885f0f75eb57ab"><div class="ttname"><a href="classAMPS_1_1Command.html#a8d27c7a091022a3d09885f0f75eb57ab">AMPS::Command::Command</a></div><div class="ttdeci">Command(Message::Command::Type command_)</div><div class="ttdoc">Creates an object to represent the given AMPS command, such as &quot;sow&quot; or &quot;subscribe&quot;. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:544</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a1f764331674c037090b73401dda816bc"><div class="ttname"><a href="classAMPS_1_1Message.html#a1f764331674c037090b73401dda816bc">AMPS::Message::setMessageType</a></div><div class="ttdeci">Message &amp; setMessageType(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the MessageType header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1312</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a96eeecebef31b51444e6d6d5fe8cd2e6"><div class="ttname"><a href="classAMPS_1_1Message.html#a96eeecebef31b51444e6d6d5fe8cd2e6">AMPS::Message::getCommandId</a></div><div class="ttdeci">Field getCommandId() const </div><div class="ttdoc">Retrieves the value of the CommandId header of the Message as a new Field. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1302</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a8d0f8687473d87b04bc7da59eedbf01c"><div class="ttname"><a href="classAMPS_1_1Client.html#a8d0f8687473d87b04bc7da59eedbf01c">AMPS::Client::getExceptionListener</a></div><div class="ttdeci">const ExceptionListener &amp; getExceptionListener(void) const </div><div class="ttdoc">Returns the exception listener set on this Client. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6893</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a1b4db85007e3981904544f36371247ad"><div class="ttname"><a href="classAMPS_1_1Message.html#a1b4db85007e3981904544f36371247ad">AMPS::Message::getQueryId</a></div><div class="ttdeci">Field getQueryId() const </div><div class="ttdoc">Retrieves the value of the QueryID header of the Message as a new Field. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1417</div></div>
<div class="ttc" id="classAMPS_1_1DefaultAuthenticator_html_a5e01247122ade887a4f4f17c649b50c0"><div class="ttname"><a href="classAMPS_1_1DefaultAuthenticator.html#a5e01247122ade887a4f4f17c649b50c0">AMPS::DefaultAuthenticator::instance</a></div><div class="ttdeci">static Authenticator &amp; instance()</div><div class="ttdoc">Static function to return a static instance used when no Authenticator is supplied to a Client...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1022</div></div>
<div class="ttc" id="classAMPS_1_1ConnectionStateListener_html"><div class="ttname"><a href="classAMPS_1_1ConnectionStateListener.html">AMPS::ConnectionStateListener</a></div><div class="ttdoc">Abstract base class for connection state listeners. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1463</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_aba905c4e623ad81e1cd100d2da197024"><div class="ttname"><a href="classAMPS_1_1Message.html#aba905c4e623ad81e1cd100d2da197024">AMPS::Message::setSubscriptionId</a></div><div class="ttdeci">Message &amp; setSubscriptionId(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the SubscriptionId header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1427</div></div>
<div class="ttc" id="group__async_html_ga8227d9f8dd2dad271df4536eae8eb4ce"><div class="ttname"><a href="group__async.html#ga8227d9f8dd2dad271df4536eae8eb4ce">AMPS::Client::sowDeleteByData</a></div><div class="ttdeci">std::string sowDeleteByData(const MessageHandler &amp;messageHandler_, const std::string &amp;topic_, const std::string &amp;data_, long timeout_=0)</div><div class="ttdoc">Deletes the message whose keys match the message data provided. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6815</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a2754902102892e4072feee3d6f356fe7"><div class="ttname"><a href="classAMPS_1_1Command.html#a2754902102892e4072feee3d6f356fe7">AMPS::Command::setOptions</a></div><div class="ttdeci">Command &amp; setOptions(const char *options_, size_t optionsLen_)</div><div class="ttdoc">Sets the options string for this command: see Message.Options for a helper class for constructing the...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:766</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_af0abc1c791ec6cbc73e6a4e97b32a18c"><div class="ttname"><a href="classAMPS_1_1Message.html#af0abc1c791ec6cbc73e6a4e97b32a18c">AMPS::Message::newQueryId</a></div><div class="ttdeci">Message &amp; newQueryId()</div><div class="ttdoc">Creates and sets a new sequential value for the QueryID header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1417</div></div>
<div class="ttc" id="group__specialBookmarks_html_ga9dc6d653c4c409720e685038051c7460"><div class="ttname"><a href="group__specialBookmarks.html#ga9dc6d653c4c409720e685038051c7460">AMPS_BOOKMARK_RECENT</a></div><div class="ttdeci">#define AMPS_BOOKMARK_RECENT</div><div class="ttdoc">Start the subscription at the first undiscarded message in the bookmark store, or at the end of the b...</div><div class="ttdef"><b>Definition:</b> BookmarkStore.hpp:47</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a00cbe4fc836c7c71cdb50303d1503067"><div class="ttname"><a href="classAMPS_1_1Message.html#a00cbe4fc836c7c71cdb50303d1503067">AMPS::Message::assignExpiration</a></div><div class="ttdeci">Message &amp; assignExpiration(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the Expiration header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1305</div></div>
<div class="ttc" id="classAMPS_1_1Field_html_aa8c3e25815836ad14d67d5247cba42de"><div class="ttname"><a href="classAMPS_1_1Field.html#aa8c3e25815836ad14d67d5247cba42de">AMPS::Field::empty</a></div><div class="ttdeci">bool empty() const </div><div class="ttdoc">Returns &amp;#39;true&amp;#39; if empty, &amp;#39;false&amp;#39; otherwise. </div><div class="ttdef"><b>Definition:</b> Field.hpp:128</div></div>
<div class="ttc" id="classAMPS_1_1Store_html_ac715c8dd8436c4c484e53a31668366a0"><div class="ttname"><a href="classAMPS_1_1Store.html#ac715c8dd8436c4c484e53a31668366a0">AMPS::Store::replaySingle</a></div><div class="ttdeci">bool replaySingle(StoreReplayer &amp;replayer_, amps_uint64_t index_)</div><div class="ttdoc">Called by Client to get a single message replayed by the store onto the StoreReplayer. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1233</div></div>
<div class="ttc" id="classAMPS_1_1DefaultAuthenticator_html_a89cc5a38aeb64afb48a7b0cc12590321"><div class="ttname"><a href="classAMPS_1_1DefaultAuthenticator.html#a89cc5a38aeb64afb48a7b0cc12590321">AMPS::DefaultAuthenticator::completed</a></div><div class="ttdeci">void completed(const std::string &amp;, const std::string &amp;, const std::string &amp;)</div><div class="ttdoc">Called by Client once a logon completes successfully. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1017</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_ad69fc7026f7fdac6cc2b7df5bc4cf021"><div class="ttname"><a href="classAMPS_1_1Client.html#ad69fc7026f7fdac6cc2b7df5bc4cf021">AMPS::Client::deltaSubscribe</a></div><div class="ttdeci">MessageStream deltaSubscribe(const std::string &amp;topic_, long timeout_, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;options_=&quot;&quot;, const std::string &amp;subId_=&quot;&quot;)</div><div class="ttdoc">Delta Subscribe to a topic. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5910</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a91ca84167cd8b86f434906f61e9c53ae"><div class="ttname"><a href="classAMPS_1_1Client.html#a91ca84167cd8b86f434906f61e9c53ae">AMPS::Client::EPOCH</a></div><div class="ttdeci">static const char * EPOCH()</div><div class="ttdoc">Convenience method for returning the special value to start a subscription at the beginning of the tr...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7046</div></div>
<div class="ttc" id="classAMPS_1_1BookmarkStore_html"><div class="ttname"><a href="classAMPS_1_1BookmarkStore.html">AMPS::BookmarkStore</a></div><div class="ttdoc">Interface for BookmarkStoreImpl classes. </div><div class="ttdef"><b>Definition:</b> BookmarkStore.hpp:228</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_ae2a297fa51e30777207361e090fe72d5"><div class="ttname"><a href="classAMPS_1_1Command.html#ae2a297fa51e30777207361e090fe72d5">AMPS::Command::reset</a></div><div class="ttdeci">Command &amp; reset(const char *command_, size_t commandLen_)</div><div class="ttdoc">Resets the fields of self, and sets the command to command_. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:561</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a06736e24beb25dcb27c50f5d8bbf12d8"><div class="ttname"><a href="classAMPS_1_1Command.html#a06736e24beb25dcb27c50f5d8bbf12d8">AMPS::Command::setSequence</a></div><div class="ttdeci">Command &amp; setSequence(const char *seq_, size_t seqLen_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:779</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a0947189cab30b1480ff06dfdb628ff96"><div class="ttname"><a href="classAMPS_1_1Client.html#a0947189cab30b1480ff06dfdb628ff96">AMPS::Client::logon</a></div><div class="ttdeci">std::string logon(const char *options_, int timeout_=0)</div><div class="ttdoc">Logon to the server, providing the client name, credentials (if available) client information (such a...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5761</div></div>
<div class="ttc" id="classAMPS_1_1Field_html_a1eeb28693651fd7f83ffe4dd960a3b30"><div class="ttname"><a href="classAMPS_1_1Field.html#a1eeb28693651fd7f83ffe4dd960a3b30">AMPS::Field::len</a></div><div class="ttdeci">size_t len() const </div><div class="ttdoc">Returns the length of the data underlying this field. </div><div class="ttdef"><b>Definition:</b> Field.hpp:267</div></div>
<div class="ttc" id="classAMPS_1_1Authenticator_html_ac363ec42f1c034ccdd9e8a6d13596811"><div class="ttname"><a href="classAMPS_1_1Authenticator.html#ac363ec42f1c034ccdd9e8a6d13596811">AMPS::Authenticator::completed</a></div><div class="ttdeci">virtual void completed(const std::string &amp;userName_, const std::string &amp;password_, const std::string &amp;reason_)=0</div><div class="ttdoc">Called by Client once a logon completes successfully. </div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a617a1ec519cf9cfc868f8e28eef108e4"><div class="ttname"><a href="classAMPS_1_1Message.html#a617a1ec519cf9cfc868f8e28eef108e4">AMPS::Message::setClientName</a></div><div class="ttdeci">Message &amp; setClientName(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the ClientName header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1303</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a4fbc8a1d311ccc20ab3cf3bc48f71d36"><div class="ttname"><a href="classAMPS_1_1Message.html#a4fbc8a1d311ccc20ab3cf3bc48f71d36">AMPS::Message::getSowKey</a></div><div class="ttdeci">Field getSowKey() const </div><div class="ttdoc">Retrieves the value of the SowKey header of the Message as a new Field. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1424</div></div>
<div class="ttc" id="group__specialBookmarks_html_ga9b906ecdf1afe8a265183dbe0856959a"><div class="ttname"><a href="group__specialBookmarks.html#ga9b906ecdf1afe8a265183dbe0856959a">AMPS_BOOKMARK_EPOCH</a></div><div class="ttdeci">#define AMPS_BOOKMARK_EPOCH</div><div class="ttdoc">Start the subscription at the beginning of the journal. </div><div class="ttdef"><b>Definition:</b> BookmarkStore.hpp:51</div></div>
<div class="ttc" id="classAMPS_1_1DefaultAuthenticator_html"><div class="ttname"><a href="classAMPS_1_1DefaultAuthenticator.html">AMPS::DefaultAuthenticator</a></div><div class="ttdoc">A default implementation of Authenticator that only uses an unchanged password and does not implement...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:999</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_ad974dd3577be4471a48164e0ee43ae55"><div class="ttname"><a href="classAMPS_1_1Client.html#ad974dd3577be4471a48164e0ee43ae55">AMPS::Client::setLogonCorrelationData</a></div><div class="ttdeci">void setLogonCorrelationData(const std::string &amp;logonCorrelationData_)</div><div class="ttdoc">Sets the logon correlation data for the client. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5164</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_af39105be28f361f2323148114509f663"><div class="ttname"><a href="classAMPS_1_1Message.html#af39105be28f361f2323148114509f663">AMPS::Message::setCommand</a></div><div class="ttdeci">Message &amp; setCommand(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the Command header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1195</div></div>
<div class="ttc" id="classAMPS_1_1__FIXBuilder_html_a5a62d735a9f176af259ea956d8a6f3ae"><div class="ttname"><a href="classAMPS_1_1__FIXBuilder.html#a5a62d735a9f176af259ea956d8a6f3ae">AMPS::_FIXBuilder::_FIXBuilder</a></div><div class="ttdeci">_FIXBuilder(char fieldSep_=(char) 1)</div><div class="ttdoc">Construct an instance of _FIXBuilder, using the specified separator between fields. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:8098</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_aa068c18ae5215993a99baf240286f69f"><div class="ttname"><a href="classAMPS_1_1Client.html#aa068c18ae5215993a99baf240286f69f">AMPS::Client::ack</a></div><div class="ttdeci">void ack(const std::string &amp;topic_, const std::string &amp;bookmark_, const char *options_=NULL)</div><div class="ttdoc">Acknowledge a message queue message by supplying a topic and bookmark string: this adds the ack to th...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7255</div></div>
<div class="ttc" id="classAMPS_1_1DefaultAuthenticator_html_a5e0e20ec8ccfa247b669d218318d797f"><div class="ttname"><a href="classAMPS_1_1DefaultAuthenticator.html#a5e0e20ec8ccfa247b669d218318d797f">AMPS::DefaultAuthenticator::retry</a></div><div class="ttdeci">std::string retry(const std::string &amp;, const std::string &amp;)</div><div class="ttdoc">Throws an AuthenticationException because retry is not implemented. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1012</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a31c695d0d5a3409d23e45c8cc845592c"><div class="ttname"><a href="classAMPS_1_1Message.html#a31c695d0d5a3409d23e45c8cc845592c">AMPS::Message::assignSubscriptionId</a></div><div class="ttdeci">Message &amp; assignSubscriptionId(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the SubscriptionId header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1427</div></div>
<div class="ttc" id="ampsplusplus_8hpp_html_a9fa4264bf91045e7105b5502c0ee0e9c"><div class="ttname"><a href="ampsplusplus_8hpp.html#a9fa4264bf91045e7105b5502c0ee0e9c">AMPS::PublishStoreResizeHandler</a></div><div class="ttdeci">bool(* PublishStoreResizeHandler)(Store store_, size_t size_, void *userData_)</div><div class="ttdoc">Function type for PublishStore resize events The store_ param is store which is resizing. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1053</div></div>
<div class="ttc" id="amps_8h_html_a20b04b7c37343722d2336e9b091631da"><div class="ttname"><a href="amps_8h.html#a20b04b7c37343722d2336e9b091631da">amps_message_get_field_value</a></div><div class="ttdeci">AMPSDLL void amps_message_get_field_value(amps_handle message, FieldId field, const amps_char **value_ptr, size_t *length_ptr)</div><div class="ttdoc">Retrieves the value of a header field in an AMPS message. </div></div>
<div class="ttc" id="group__sync_html_ga8f0d6e85e7e4a4b281d862b1a2c96b03"><div class="ttname"><a href="group__sync.html#ga8f0d6e85e7e4a4b281d862b1a2c96b03">AMPS::Client::sowAndSubscribe</a></div><div class="ttdeci">MessageStream sowAndSubscribe(const char *topic_, long timeout_, const std::string &amp;filter_=&quot;&quot;, int batchSize_=DEFAULT_BATCH_SIZE, bool oofEnabled_=false, int topN_=DEFAULT_TOP_N)</div><div class="ttdoc">Query the SOW cache of a topic and initiates a new subscription on it. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6296</div></div>
<div class="ttc" id="classAMPS_1_1StoreImpl_html_af38461a40772ee3147546e0e6132eea4"><div class="ttname"><a href="classAMPS_1_1StoreImpl.html#af38461a40772ee3147546e0e6132eea4">AMPS::StoreImpl::setResizeHandler</a></div><div class="ttdeci">virtual void setResizeHandler(PublishStoreResizeHandler handler_, void *userData_)</div><div class="ttdoc">Set a handler to be called if the Store needs to resize in order to keep storing messages. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1153</div></div>
<div class="ttc" id="classAMPS_1_1__FIXBuilder_html_aab4f356d05683e61cb7ecc507268b1f9"><div class="ttname"><a href="classAMPS_1_1__FIXBuilder.html#aab4f356d05683e61cb7ecc507268b1f9">AMPS::_FIXBuilder::append</a></div><div class="ttdeci">void append(const T &amp;tag, const char *value, size_t offset, size_t length)</div><div class="ttdoc">Write a field with the provided tag and value to the message being constructed. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:8107</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a7d1f25436d5a567bda4b69171fbc469c"><div class="ttname"><a href="classAMPS_1_1Message.html#a7d1f25436d5a567bda4b69171fbc469c">AMPS::Message::assignCommand</a></div><div class="ttdeci">Message &amp; assignCommand(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the Command header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1195</div></div>
<div class="ttc" id="group__specialBookmarks_html_ga56a5f968956ad81c7ebb864816c55a01"><div class="ttname"><a href="group__specialBookmarks.html#ga56a5f968956ad81c7ebb864816c55a01">AMPS_BOOKMARK_NOW</a></div><div class="ttdeci">#define AMPS_BOOKMARK_NOW</div><div class="ttdoc">Start the subscription at the point in time when AMPS processes the subscription. ...</div><div class="ttdef"><b>Definition:</b> BookmarkStore.hpp:55</div></div>
<div class="ttc" id="classAMPS_1_1Store_html_ab267b150a870f650ea5f3a5b6c6aac01"><div class="ttname"><a href="classAMPS_1_1Store.html#ab267b150a870f650ea5f3a5b6c6aac01">AMPS::Store::setResizeHandler</a></div><div class="ttdeci">void setResizeHandler(PublishStoreResizeHandler handler_, void *userData_)</div><div class="ttdoc">Set a handler to be called if the Store needs to resize in order to keep storing messages. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1293</div></div>
<div class="ttc" id="classAMPS_1_1Authenticator_html_ac8f59e8371571030bbd751d215781866"><div class="ttname"><a href="classAMPS_1_1Authenticator.html#ac8f59e8371571030bbd751d215781866">AMPS::Authenticator::retry</a></div><div class="ttdeci">virtual std::string retry(const std::string &amp;userName_, const std::string &amp;password_)=0</div><div class="ttdoc">Called by Client when a logon ack is received with a status of retry. </div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a676e669b401a20ea2264b1e85e61ea15"><div class="ttname"><a href="classAMPS_1_1Client.html#a676e669b401a20ea2264b1e85e61ea15">AMPS::Client::getBookmarkStore</a></div><div class="ttdeci">BookmarkStore getBookmarkStore()</div><div class="ttdoc">Get the bookmark store being used by the client. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5384</div></div>
<div class="ttc" id="classAMPS_1_1Store_html_a3302f995710b33a7d16b715e7e2bd7ac"><div class="ttname"><a href="classAMPS_1_1Store.html#a3302f995710b33a7d16b715e7e2bd7ac">AMPS::Store::isValid</a></div><div class="ttdeci">bool isValid() const </div><div class="ttdoc">Method to return if there is an underlying implementation for the Store. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1250</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a3e96c9e776223e90d6c73f4b2d8a6dca"><div class="ttname"><a href="classAMPS_1_1Client.html#a3e96c9e776223e90d6c73f4b2d8a6dca">AMPS::Client::setAckBatchSize</a></div><div class="ttdeci">void setAckBatchSize(const unsigned ackBatchSize_)</div><div class="ttdoc">Sets the queue ack batch size setting. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7316</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_ad93e2cdda6d519d3600e3182937faa85"><div class="ttname"><a href="classAMPS_1_1Message.html#ad93e2cdda6d519d3600e3182937faa85">AMPS::Message::getPassword</a></div><div class="ttdeci">Field getPassword() const </div><div class="ttdoc">Retrieves the value of the Password header of the Message as a new Field. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1416</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a806ab5b1e5e69c8541d6c35f891b9905"><div class="ttname"><a href="classAMPS_1_1Message.html#a806ab5b1e5e69c8541d6c35f891b9905">AMPS::Message::setTopNRecordsReturned</a></div><div class="ttdeci">Message &amp; setTopNRecordsReturned(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the TopNRecordsReturned header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1451</div></div>
<div class="ttc" id="classAMPS_1_1FailedWriteHandler_html"><div class="ttname"><a href="classAMPS_1_1FailedWriteHandler.html">AMPS::FailedWriteHandler</a></div><div class="ttdoc">Class to handle when a client receives a duplicate publish message, or not entitled message...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1343</div></div>
<div class="ttc" id="group__sync_html_ga3c60cbdf0153f6d4b7674172b84286a3"><div class="ttname"><a href="group__sync.html#ga3c60cbdf0153f6d4b7674172b84286a3">AMPS::Client::sowDelete</a></div><div class="ttdeci">Message sowDelete(const std::string &amp;topic, const std::string &amp;filter, long timeout=0)</div><div class="ttdoc">Deletes one or more messages from a topic&amp;#39;s SOW cache. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6691</div></div>
<div class="ttc" id="classAMPS_1_1SubscriptionManager_html_a763d96b233fdbccc2261a4b9312c7eac"><div class="ttname"><a href="classAMPS_1_1SubscriptionManager.html#a763d96b233fdbccc2261a4b9312c7eac">AMPS::SubscriptionManager::setFailedResubscribeHandler</a></div><div class="ttdeci">virtual void setFailedResubscribeHandler(std::shared_ptr&lt; FailedResubscribeHandler &gt; handler_)</div><div class="ttdoc">Set a handler to deal with failing subscriptions after a failover event. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1451</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_ae137f7a16fe053ab0d487d551780a744"><div class="ttname"><a href="classAMPS_1_1Message.html#ae137f7a16fe053ab0d487d551780a744">AMPS::Message::setSowKeys</a></div><div class="ttdeci">Message &amp; setSowKeys(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the SowKeys header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1425</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a0fcb952dea3610728b490179c553e52f"><div class="ttname"><a href="classAMPS_1_1Client.html#a0fcb952dea3610728b490179c553e52f">AMPS::Client::setBookmarkStore</a></div><div class="ttdeci">void setBookmarkStore(const BookmarkStore &amp;bookmarkStore_)</div><div class="ttdoc">Set the bookmark store to be used by the client. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5376</div></div>
<div class="ttc" id="classAMPS_1_1MessageRouter_html"><div class="ttname"><a href="classAMPS_1_1MessageRouter.html">AMPS::MessageRouter</a></div><div class="ttdoc">This class multiplexes messages from AMPS to multiple subscribers and uses the stream of acks from AM...</div><div class="ttdef"><b>Definition:</b> MessageRouter.hpp:149</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a1ec9017cd6fd7acf3dff2123a5189b6d"><div class="ttname"><a href="classAMPS_1_1Message.html#a1ec9017cd6fd7acf3dff2123a5189b6d">AMPS::Message::setExpiration</a></div><div class="ttdeci">Message &amp; setExpiration(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the Expiration header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1305</div></div>
<div class="ttc" id="classAMPS_1_1Authenticator_html_a3ca23cf3bab7fa2326db9123be0fe594"><div class="ttname"><a href="classAMPS_1_1Authenticator.html#a3ca23cf3bab7fa2326db9123be0fe594">AMPS::Authenticator::authenticate</a></div><div class="ttdeci">virtual std::string authenticate(const std::string &amp;userName_, const std::string &amp;password_)=0</div><div class="ttdoc">Called by Client just before the logon command is sent. </div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a26f34e7d69627feca5880a5298007b63"><div class="ttname"><a href="classAMPS_1_1Command.html#a26f34e7d69627feca5880a5298007b63">AMPS::Command::setOrderBy</a></div><div class="ttdeci">Command &amp; setOrderBy(const std::string &amp;orderBy_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:674</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a5630a813d50c2358b60a58ffc7644513"><div class="ttname"><a href="classAMPS_1_1Client.html#a5630a813d50c2358b60a58ffc7644513">AMPS::Client::setExceptionListener</a></div><div class="ttdeci">void setExceptionListener(const ExceptionListener &amp;listener_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6886</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a4b1ae75ee305b560aec92535d83ec583"><div class="ttname"><a href="classAMPS_1_1Command.html#a4b1ae75ee305b560aec92535d83ec583">AMPS::Command::reset</a></div><div class="ttdeci">Command &amp; reset(Message::Command::Type command_)</div><div class="ttdoc">Resets the fields of self, and sets the command to command_. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:569</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a85fc196c705dafab3e9802709b6cb029"><div class="ttname"><a href="classAMPS_1_1Client.html#a85fc196c705dafab3e9802709b6cb029">AMPS::Client::setSubscriptionManager</a></div><div class="ttdeci">void setSubscriptionManager(SubscriptionManager *subscriptionManager_)</div><div class="ttdoc">Set the subscription manager to be used by the client. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5404</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_aa2d452c8ecf8d4281f0f493e968b9c3e"><div class="ttname"><a href="classAMPS_1_1Client.html#aa2d452c8ecf8d4281f0f493e968b9c3e">AMPS::Client::setUnhandledMessageHandler</a></div><div class="ttdeci">void setUnhandledMessageHandler(const AMPS::MessageHandler &amp;messageHandler)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6949</div></div>
<div class="ttc" id="classAMPS_1_1__FIXBuilder_html_a99affb8de13900f47240533598885627"><div class="ttname"><a href="classAMPS_1_1__FIXBuilder.html#a99affb8de13900f47240533598885627">AMPS::_FIXBuilder::append</a></div><div class="ttdeci">void append(const T &amp;tag, const std::string &amp;value)</div><div class="ttdoc">Write a field with the provided tag and value to the message being constructed. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:8118</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a19830e21dba1e4723a02a2c0e3615940"><div class="ttname"><a href="classAMPS_1_1Client.html#a19830e21dba1e4723a02a2c0e3615940">AMPS::Client::getAckBatchSize</a></div><div class="ttdeci">unsigned getAckBatchSize(void) const </div><div class="ttdoc">Returns the value of the queue ack batch size setting. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7306</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a37c037481e360ab212e965f2d0f51e23"><div class="ttname"><a href="classAMPS_1_1Client.html#a37c037481e360ab212e965f2d0f51e23">AMPS::Client::deltaPublish</a></div><div class="ttdeci">amps_uint64_t deltaPublish(const std::string &amp;topic_, const std::string &amp;data_)</div><div class="ttdoc">Publish the changed fields of a message to an AMPS topic. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5647</div></div>
<div class="ttc" id="group__sync_html_gacc681b5ff2b19186130ef63f543a5f3e"><div class="ttname"><a href="group__sync.html#gacc681b5ff2b19186130ef63f543a5f3e">AMPS::Client::sowAndSubscribe</a></div><div class="ttdeci">MessageStream sowAndSubscribe(const std::string &amp;topic_, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;orderBy_=&quot;&quot;, const std::string &amp;bookmark_=&quot;&quot;, int batchSize_=DEFAULT_BATCH_SIZE, int topN_=DEFAULT_TOP_N, const std::string &amp;options_=&quot;&quot;, long timeout_=DEFAULT_COMMAND_TIMEOUT)</div><div class="ttdoc">Query the SOW cache of a topic and initiates a new subscription on it. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6383</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_ae65e7a153a338239210ec52786717384"><div class="ttname"><a href="classAMPS_1_1Command.html#ae65e7a153a338239210ec52786717384">AMPS::Command::setExpiration</a></div><div class="ttdeci">Command &amp; setExpiration(unsigned expiration_)</div><div class="ttdoc">Set the expiration time for a publish command. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:851</div></div>
<div class="ttc" id="amps_8h_html_ab497b6d4c689878c2fe99ba80fb64a62"><div class="ttname"><a href="amps_8h.html#ab497b6d4c689878c2fe99ba80fb64a62">amps_client_set_predisconnect_handler</a></div><div class="ttdeci">AMPSDLL void amps_client_set_predisconnect_handler(amps_handle client, amps_predisconnect_handler predisconnectHandler, void *userData)</div><div class="ttdoc">Sets the predisconnect handler function to be called when a disconnect occurs. </div></div>
<div class="ttc" id="classAMPS_1_1MessageStream_1_1iterator_html"><div class="ttname"><a href="classAMPS_1_1MessageStream_1_1iterator.html">AMPS::MessageStream::iterator</a></div><div class="ttdoc">Represents an iterator over messages in an AMPS topic. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:4951</div></div>
<div class="ttc" id="classAMPS_1_1BookmarkStore_html_a502ac677f4ceea04e19b4cdd820c876c"><div class="ttname"><a href="classAMPS_1_1BookmarkStore.html#a502ac677f4ceea04e19b4cdd820c876c">AMPS::BookmarkStore::log</a></div><div class="ttdeci">size_t log(Message &amp;message_)</div><div class="ttdoc">Log a bookmark to the persistent log. </div><div class="ttdef"><b>Definition:</b> BookmarkStore.hpp:268</div></div>
<div class="ttc" id="group__sync_html_ga08b8f1e95e4b3ec684b7142fb420a969"><div class="ttname"><a href="group__sync.html#ga08b8f1e95e4b3ec684b7142fb420a969">AMPS::Client::sowAndDeltaSubscribe</a></div><div class="ttdeci">MessageStream sowAndDeltaSubscribe(const char *topic_, long timeout_, const std::string &amp;filter_=&quot;&quot;, int batchSize_=DEFAULT_BATCH_SIZE, bool oofEnabled_=false, bool sendEmpties_=false, int topN_=DEFAULT_TOP_N)</div><div class="ttdoc">Query the SOW cache of a topic and initiates a new delta subscription on it. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6629</div></div>
<div class="ttc" id="classAMPS_1_1Store_html_ac936fdf868fb74571577f3f6f9251930"><div class="ttname"><a href="classAMPS_1_1Store.html#ac936fdf868fb74571577f3f6f9251930">AMPS::Store::unpersistedCount</a></div><div class="ttdeci">size_t unpersistedCount() const </div><div class="ttdoc">Method to return how many messages are in the store that have not been discarded, indicating that the...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1242</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a02de7745dd770b0cd6eae121767831f6"><div class="ttname"><a href="classAMPS_1_1Command.html#a02de7745dd770b0cd6eae121767831f6">AMPS::Command::setData</a></div><div class="ttdeci">Command &amp; setData(const char *data_, size_t dataLen_)</div><div class="ttdoc">Sets the data for this command. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:806</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a2a05e8fb7bfc572a5680935a9b841bb1"><div class="ttname"><a href="classAMPS_1_1Message.html#a2a05e8fb7bfc572a5680935a9b841bb1">AMPS::Message::assignAckType</a></div><div class="ttdeci">Message &amp; assignAckType(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the AckType header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1130</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a97138feb835e25fbf88eec2e74dcee83"><div class="ttname"><a href="classAMPS_1_1Client.html#a97138feb835e25fbf88eec2e74dcee83">AMPS::Client::publishFlush</a></div><div class="ttdeci">void publishFlush(long timeout_=0, unsigned ackType_=Message::AckType::Processed)</div><div class="ttdoc">Ensure that AMPS messages are sent and have been processed by the AMPS server. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5626</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_aad6566eefeaef02b81f6a41e1be568e7"><div class="ttname"><a href="classAMPS_1_1Client.html#aad6566eefeaef02b81f6a41e1be568e7">AMPS::Client::executeAsync</a></div><div class="ttdeci">std::string executeAsync(Command &amp;command_, MessageHandler handler_)</div><div class="ttdoc">Execute the provided command and, once AMPS acknowledges the command, process messages in response to...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7135</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a28458656d98019132b6f12e6e6d6beab"><div class="ttname"><a href="classAMPS_1_1Command.html#a28458656d98019132b6f12e6e6d6beab">AMPS::Command::setSowKey</a></div><div class="ttdeci">Command &amp; setSowKey(const char *sowKey_, size_t sowKeyLen_)</div><div class="ttdoc">Sets the SowKey field of the command, typically used for a publish command to a topic in the state of...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:594</div></div>
<div class="ttc" id="group__sync_html_gac60c9d70153c3f16faa2fbfc98326057"><div class="ttname"><a href="group__sync.html#gac60c9d70153c3f16faa2fbfc98326057">AMPS::Client::sowAndDeltaSubscribe</a></div><div class="ttdeci">MessageStream sowAndDeltaSubscribe(const std::string &amp;topic_, long timeout_, const std::string &amp;filter_=&quot;&quot;, int batchSize_=DEFAULT_BATCH_SIZE, bool oofEnabled_=false, bool sendEmpties_=false, int topN_=DEFAULT_TOP_N)</div><div class="ttdoc">Query the SOW cache of a topic and initiates a new delta subscription on it. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6588</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_afe7d2ecb7268fee9bcbe9ab4a63e40f8"><div class="ttname"><a href="classAMPS_1_1Client.html#afe7d2ecb7268fee9bcbe9ab4a63e40f8">AMPS::Client::logon</a></div><div class="ttdeci">std::string logon(const std::string &amp;options_, int timeout_=0)</div><div class="ttdoc">Logon to the server, providing the client name, credentials (if available) client information (such a...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5780</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a22390de6f6cfdab7e17140443f57c1d5"><div class="ttname"><a href="classAMPS_1_1Client.html#a22390de6f6cfdab7e17140443f57c1d5">AMPS::Client::unsubscribe</a></div><div class="ttdeci">void unsubscribe()</div><div class="ttdoc">Unsubscribe from all topics. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6059</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_aafa77fa7277c90c74cd47621d65dc762"><div class="ttname"><a href="classAMPS_1_1Client.html#aafa77fa7277c90c74cd47621d65dc762">AMPS::Client::setAutoAck</a></div><div class="ttdeci">void setAutoAck(bool isAutoAckEnabled_)</div><div class="ttdoc">Sets the queue auto-ack setting on this client. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7298</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_aa241a06bc872f7f665912a146b8be17a"><div class="ttname"><a href="classAMPS_1_1Client.html#aa241a06bc872f7f665912a146b8be17a">AMPS::Client::deltaSubscribe</a></div><div class="ttdeci">MessageStream deltaSubscribe(const char *topic_, long timeout_, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;options_=&quot;&quot;, const std::string &amp;subId_=&quot;&quot;)</div><div class="ttdoc">Delta Subscribe to a topic. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5928</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_ad036a9214ec2b202fdefa75f43dfbe5a"><div class="ttname"><a href="classAMPS_1_1Message.html#ad036a9214ec2b202fdefa75f43dfbe5a">AMPS::Message::assignCorrelationId</a></div><div class="ttdeci">Message &amp; assignCorrelationId(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the CorrelationId header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1304</div></div>
<div class="ttc" id="classAMPS_1_1Store_html_acb06fbca0f83c7c4dfc91662b9149dba"><div class="ttname"><a href="classAMPS_1_1Store.html#acb06fbca0f83c7c4dfc91662b9149dba">AMPS::Store::store</a></div><div class="ttdeci">amps_uint64_t store(const Message &amp;message_)</div><div class="ttdoc">Called by Client to store a message being published. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1201</div></div>
<div class="ttc" id="group__async_html_ga791a217998f2b9a628a04378cc2e6eb5"><div class="ttname"><a href="group__async.html#ga791a217998f2b9a628a04378cc2e6eb5">AMPS::Client::sowAndDeltaSubscribe</a></div><div class="ttdeci">std::string sowAndDeltaSubscribe(const MessageHandler &amp;messageHandler_, const std::string &amp;topic_, long timeout_, const std::string &amp;filter_=&quot;&quot;, int batchSize_=DEFAULT_BATCH_SIZE, bool oofEnabled_=false, bool sendEmpties_=false, int topN_=DEFAULT_TOP_N)</div><div class="ttdoc">Query the SOW cache of a topic and initiates a new delta subscription on it. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6552</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a4da5f284f51b7eccc4e758e9c3d2f0cb"><div class="ttname"><a href="classAMPS_1_1Command.html#a4da5f284f51b7eccc4e758e9c3d2f0cb">AMPS::Command::setBatchSize</a></div><div class="ttdeci">Command &amp; setBatchSize(unsigned batchSize_)</div><div class="ttdoc">Sets the batch size for this command, which controls how many records are sent together in the result...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:835</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a0664ebf63c66c02419df0bac0040fcfe"><div class="ttname"><a href="classAMPS_1_1Client.html#a0664ebf63c66c02419df0bac0040fcfe">AMPS::Client::setExceptionListener</a></div><div class="ttdeci">void setExceptionListener(const std::shared_ptr&lt; const ExceptionListener &gt; &amp;pListener_)</div><div class="ttdoc">Sets the exception listener for exceptions that are not thrown back to the user (for example...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6873</div></div>
<div class="ttc" id="classAMPS_1_1Store_html_a0ec6dc4d797cb1e7f5ed68183c38d9c4"><div class="ttname"><a href="classAMPS_1_1Store.html#a0ec6dc4d797cb1e7f5ed68183c38d9c4">AMPS::Store::get</a></div><div class="ttdeci">StoreImpl * get()</div><div class="ttdoc">Used to get a pointer to the implementation. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1325</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_ae104192d161560f702480ce138855804"><div class="ttname"><a href="classAMPS_1_1Client.html#ae104192d161560f702480ce138855804">AMPS::Client::getDuplicateMessageHandler</a></div><div class="ttdeci">MessageHandler getDuplicateMessageHandler(void)</div><div class="ttdoc">Returns the callback function that is invoked when a duplicate message is detected. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5459</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a41d4fe90af9fa7e64631cdbf38d4474c"><div class="ttname"><a href="classAMPS_1_1Command.html#a41d4fe90af9fa7e64631cdbf38d4474c">AMPS::Command::setQueryId</a></div><div class="ttdeci">Command &amp; setQueryId(const char *queryId_, size_t queryIdLen_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:707</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a6779e81b85aaab32f00790d3d2ef779b"><div class="ttname"><a href="classAMPS_1_1Client.html#a6779e81b85aaab32f00790d3d2ef779b">AMPS::Client::getDisconnectHandler</a></div><div class="ttdeci">DisconnectHandler getDisconnectHandler(void) const </div><div class="ttdoc">Returns the callback function that is invoked when a disconnect occurs. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5354</div></div>
<div class="ttc" id="classAMPS_1_1FIXShredder_html"><div class="ttname"><a href="classAMPS_1_1FIXShredder.html">AMPS::FIXShredder</a></div><div class="ttdoc">Class for parsing a FIX format message into a std::map of keys and values, where the keys and values ...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:8162</div></div>
<div class="ttc" id="classAMPS_1_1Field_html"><div class="ttname"><a href="classAMPS_1_1Field.html">AMPS::Field</a></div><div class="ttdoc">Field represents the value of a single field in a Message. </div><div class="ttdef"><b>Definition:</b> Field.hpp:86</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a862bfc9f74ca5b47689e84873180331e"><div class="ttname"><a href="classAMPS_1_1Message.html#a862bfc9f74ca5b47689e84873180331e">AMPS::Message::setAckType</a></div><div class="ttdeci">Message &amp; setAckType(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the AckType header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1130</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a22e83df2788e08a38927bef0759a46d8"><div class="ttname"><a href="classAMPS_1_1Client.html#a22e83df2788e08a38927bef0759a46d8">AMPS::Client::getConnectionInfo</a></div><div class="ttdeci">virtual ConnectionInfo getConnectionInfo() const </div><div class="ttdoc">Get the connection information for the current connection. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5363</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a946e77e4579c0fc419887743de0e333d"><div class="ttname"><a href="classAMPS_1_1Message.html#a946e77e4579c0fc419887743de0e333d">AMPS::Message::setOptions</a></div><div class="ttdeci">Message &amp; setOptions(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the Options header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1344</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a8b0b7fc68d5527a05c5bc7d3d3c3fb8b"><div class="ttname"><a href="classAMPS_1_1Client.html#a8b0b7fc68d5527a05c5bc7d3d3c3fb8b">AMPS::Client::ack</a></div><div class="ttdeci">void ack(Field &amp;topic_, Field &amp;bookmark_, const char *options_=NULL)</div><div class="ttdoc">Acknowledge a message queue message by supplying a topic and bookmark: this adds the ack to the curre...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7231</div></div>
<div class="ttc" id="classAMPS_1_1FailedResubscribeHandler_html"><div class="ttname"><a href="classAMPS_1_1FailedResubscribeHandler.html">AMPS::FailedResubscribeHandler</a></div><div class="ttdoc">Abstract base class where you can implement handling of exceptions that occur when a SubscriptionMana...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1401</div></div>
<div class="ttc" id="amps_8h_html_a4675b81308412798c6f2f0852ecc4ee6"><div class="ttname"><a href="amps_8h.html#a4675b81308412798c6f2f0852ecc4ee6">amps_client_send</a></div><div class="ttdeci">AMPSDLL amps_result amps_client_send(amps_handle client, amps_handle message)</div><div class="ttdoc">Sends a message to the AMPS server. </div></div>
<div class="ttc" id="classAMPS_1_1FIXShredder_html_a2fd96472d6b8cea917632257c67fa8a1"><div class="ttname"><a href="classAMPS_1_1FIXShredder.html#a2fd96472d6b8cea917632257c67fa8a1">AMPS::FIXShredder::map_type</a></div><div class="ttdeci">std::map&lt; Message::Field, Message::Field &gt; map_type</div><div class="ttdoc">Convenience defintion for the std::map specialization used for this class. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:8174</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_aa0cfeafe37d2b3a30518c88a869f2c2f"><div class="ttname"><a href="classAMPS_1_1Command.html#aa0cfeafe37d2b3a30518c88a869f2c2f">AMPS::Command::setTopic</a></div><div class="ttdeci">Command &amp; setTopic(const char *topic_, size_t topicLen_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:655</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a5de7a2604ac4f18c93ca812ce6ebf605"><div class="ttname"><a href="classAMPS_1_1Client.html#a5de7a2604ac4f18c93ca812ce6ebf605">AMPS::Client::setDisconnectHandler</a></div><div class="ttdeci">void setDisconnectHandler(const DisconnectHandler &amp;disconnectHandler)</div><div class="ttdoc">Sets the function to be called when the client is unintentionally disconnected. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5346</div></div>
<div class="ttc" id="classAMPS_1_1Store_html"><div class="ttname"><a href="classAMPS_1_1Store.html">AMPS::Store</a></div><div class="ttdoc">Handle class for StoreImpl classes that track publish messages. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1185</div></div>
<div class="ttc" id="classAMPS_1_1FIXShredder_html_ae0d65bf19d13d713ef7e7dd5c5466419"><div class="ttname"><a href="classAMPS_1_1FIXShredder.html#ae0d65bf19d13d713ef7e7dd5c5466419">AMPS::FIXShredder::toMap</a></div><div class="ttdeci">map_type toMap(const Message::Field &amp;data)</div><div class="ttdoc">Returns the key/value pairs within the message, represented as AMPS::Field objects that contain point...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:8181</div></div>
<div class="ttc" id="classAMPS_1_1ExceptionListener_html"><div class="ttname"><a href="classAMPS_1_1ExceptionListener.html">AMPS::ExceptionListener</a></div><div class="ttdoc">Exception listener for unhandled exceptions. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:236</div></div>
<div class="ttc" id="group__sync_html_ga1140525838b53f9f67d3dd40906abd72"><div class="ttname"><a href="group__sync.html#ga1140525838b53f9f67d3dd40906abd72">AMPS::Client::sowAndDeltaSubscribe</a></div><div class="ttdeci">MessageStream sowAndDeltaSubscribe(const std::string &amp;topic_, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;orderBy_=&quot;&quot;, int batchSize_=DEFAULT_BATCH_SIZE, int topN_=DEFAULT_TOP_N, const std::string &amp;options_=&quot;&quot;, long timeout_=DEFAULT_COMMAND_TIMEOUT)</div><div class="ttdoc">Query the SOW cache of a topic and initiates a new delta subscription on it. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6485</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a299b1d90cb2c3c8955de7f8527425381"><div class="ttname"><a href="classAMPS_1_1Client.html#a299b1d90cb2c3c8955de7f8527425381">AMPS::Client::setHeartbeat</a></div><div class="ttdeci">void setHeartbeat(unsigned heartbeatTime_)</div><div class="ttdoc">Requests heartbeating with the AMPS server. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6943</div></div>
<div class="ttc" id="classAMPS_1_1Handler_html"><div class="ttname"><a href="classAMPS_1_1Handler.html">AMPS::Handler&lt; DisconnectHandlerFunc, Client &amp; &gt;</a></div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a69c1c9245468474fb99662202e59e6d1"><div class="ttname"><a href="classAMPS_1_1Client.html#a69c1c9245468474fb99662202e59e6d1">AMPS::Client::subscribe</a></div><div class="ttdeci">MessageStream subscribe(const char *topic_, long timeout_=0, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;options_=&quot;&quot;, const std::string &amp;subId_=&quot;&quot;)</div><div class="ttdoc">Subscribe to a topic. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5863</div></div>
<div class="ttc" id="classAMPS_1_1MessageStream_html"><div class="ttname"><a href="classAMPS_1_1MessageStream.html">AMPS::MessageStream</a></div><div class="ttdoc">An iterable object representing the results of an AMPS subscription and/or query. ...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:4943</div></div>
<div class="ttc" id="classAMPS_1_1Store_html_aa2c8054f0f9cbd6728122a43a9aeb53f"><div class="ttname"><a href="classAMPS_1_1Store.html#aa2c8054f0f9cbd6728122a43a9aeb53f">AMPS::Store::getErrorOnPublishGap</a></div><div class="ttdeci">bool getErrorOnPublishGap() const </div><div class="ttdoc">Called to check if the Store will throw PublishStoreGapException. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1317</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a7f762adedb0c899de4c948a32c52af0c"><div class="ttname"><a href="classAMPS_1_1Command.html#a7f762adedb0c899de4c948a32c52af0c">AMPS::Command::setSequence</a></div><div class="ttdeci">Command &amp; setSequence(const std::string &amp;seq_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:772</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_ab99f18871b7d34f23468e76e9a9b97cc"><div class="ttname"><a href="classAMPS_1_1Client.html#ab99f18871b7d34f23468e76e9a9b97cc">AMPS::Client::MOST_RECENT</a></div><div class="ttdeci">static const char * MOST_RECENT()</div><div class="ttdoc">Convenience method for returning the special value to start a subscription at a recovery point based ...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7068</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a9719923668a86708e2a18a05e22a7da4"><div class="ttname"><a href="classAMPS_1_1Command.html#a9719923668a86708e2a18a05e22a7da4">AMPS::Command::setQueryId</a></div><div class="ttdeci">Command &amp; setQueryId(const std::string &amp;queryId_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:700</div></div>
<div class="ttc" id="amps_8h_html_aa0f4f979392dd0aaa1c94cdd159e590f"><div class="ttname"><a href="amps_8h.html#aa0f4f979392dd0aaa1c94cdd159e590f">amps_client_set_thread_created_callback</a></div><div class="ttdeci">AMPSDLL amps_result amps_client_set_thread_created_callback(amps_handle client, amps_thread_created_callback callback, void *userData)</div><div class="ttdoc">Sets a user-supplied callback function to allow thread attributes to set when a new thread is created...</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a71cf9429e3173c45d74b70ffd7736ece"><div class="ttname"><a href="classAMPS_1_1Message.html#a71cf9429e3173c45d74b70ffd7736ece">AMPS::Message::setCommandId</a></div><div class="ttdeci">Message &amp; setCommandId(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the CommandId header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1302</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a4f92fd299fdcae768723b0ae286cea89"><div class="ttname"><a href="classAMPS_1_1Command.html#a4f92fd299fdcae768723b0ae286cea89">AMPS::Command::setSequence</a></div><div class="ttdeci">Command &amp; setSequence(const amps_uint64_t seq_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:785</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_aed3f9530708c60f4027ef0d5a932192e"><div class="ttname"><a href="classAMPS_1_1Client.html#aed3f9530708c60f4027ef0d5a932192e">AMPS::Client::BOOKMARK_RECENT</a></div><div class="ttdeci">static const char * BOOKMARK_RECENT()</div><div class="ttdoc">Convenience method for returning the special value to start a subscription at a recovery point based ...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7079</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a7d503375ce8227f2e428fcbbe41c8310"><div class="ttname"><a href="classAMPS_1_1Message.html#a7d503375ce8227f2e428fcbbe41c8310">AMPS::Message::setQueryId</a></div><div class="ttdeci">Message &amp; setQueryId(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the QueryID header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1417</div></div>
<div class="ttc" id="amps_8h_html_a84547b45700e098324ea8d78641a6036"><div class="ttname"><a href="amps_8h.html#a84547b45700e098324ea8d78641a6036">amps_thread_created_callback</a></div><div class="ttdeci">amps_result(* amps_thread_created_callback)(AMPS_THREAD_T, void *)</div><div class="ttdoc">Prototype for a user-supplied callback function to allow thread attributes to be set when a new threa...</div><div class="ttdef"><b>Definition:</b> amps.h:652</div></div>
<div class="ttc" id="classAMPS_1_1Store_html_a928e1a334e213cb4d00a113e85984d52"><div class="ttname"><a href="classAMPS_1_1Store.html#a928e1a334e213cb4d00a113e85984d52">AMPS::Store::getLowestUnpersisted</a></div><div class="ttdeci">amps_uint64_t getLowestUnpersisted()</div><div class="ttdoc">Get the oldest unpersisted message sequence in the store. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1271</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a06fbdc5c3e1d46c2a81b6f106fbe7731"><div class="ttname"><a href="classAMPS_1_1Command.html#a06fbdc5c3e1d46c2a81b6f106fbe7731">AMPS::Command::setTopic</a></div><div class="ttdeci">Command &amp; setTopic(const std::string &amp;topic_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:648</div></div>
<div class="ttc" id="classAMPS_1_1MessageStream_html_a2ff2b7530e4f82c4f664c1da9db03f24"><div class="ttname"><a href="classAMPS_1_1MessageStream.html#a2ff2b7530e4f82c4f664c1da9db03f24">AMPS::MessageStream::maxDepth</a></div><div class="ttdeci">MessageStream maxDepth(unsigned maxDepth_)</div><div class="ttdoc">Sets the maximum number of messages that can be held in the underlying queue. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:8705</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a7cd07ad086b817bc95abbecbe729666b"><div class="ttname"><a href="classAMPS_1_1Message.html#a7cd07ad086b817bc95abbecbe729666b">AMPS::Message::assignVersion</a></div><div class="ttdeci">Message &amp; assignVersion(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the Version header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1452</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a40bbfce7ed53e6438ce55e4f5cda5023"><div class="ttname"><a href="classAMPS_1_1Client.html#a40bbfce7ed53e6438ce55e4f5cda5023">AMPS::Client::disconnect</a></div><div class="ttdeci">void disconnect()</div><div class="ttdoc">Disconnect from an AMPS server. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5262</div></div>
<div class="ttc" id="group__sync_html_ga62a50018ae00fab21abbf25b8df69544"><div class="ttname"><a href="group__sync.html#ga62a50018ae00fab21abbf25b8df69544">AMPS::Client::sow</a></div><div class="ttdeci">MessageStream sow(const std::string &amp;topic_, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;orderBy_=&quot;&quot;, const std::string &amp;bookmark_=&quot;&quot;, int batchSize_=DEFAULT_BATCH_SIZE, int topN_=DEFAULT_TOP_N, const std::string &amp;options_=&quot;&quot;, long timeout_=DEFAULT_COMMAND_TIMEOUT)</div><div class="ttdoc">Query the SOW cache of a topic. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6132</div></div>
<div class="ttc" id="classAMPS_1_1MessageStream_html_afbd30232e215c309bb1d9f4f1b9e169a"><div class="ttname"><a href="classAMPS_1_1MessageStream.html#afbd30232e215c309bb1d9f4f1b9e169a">AMPS::MessageStream::getDepth</a></div><div class="ttdeci">unsigned getDepth(void) const </div><div class="ttdoc">Gets the current number of messages held in the underlying queue. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:8714</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a636338403d40c748af5a33f931293f41"><div class="ttname"><a href="classAMPS_1_1Message.html#a636338403d40c748af5a33f931293f41">AMPS::Message::getQueryID</a></div><div class="ttdeci">Field getQueryID() const </div><div class="ttdoc">Retrieves the value of the QueryID header of the Message as a new Field. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1417</div></div>
<div class="ttc" id="amps_8h_html_a684390c2bf8c56d49e8e2d4dc715bb04a046fe5490917dab049a5a7c516c5b098"><div class="ttname"><a href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a046fe5490917dab049a5a7c516c5b098">AMPS_E_RETRY</a></div><div class="ttdoc">The operation has not succeeded, but ought to be retried. </div><div class="ttdef"><b>Definition:</b> amps.h:229</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a25e68b3da452c79b701993ea2bfa17c2"><div class="ttname"><a href="classAMPS_1_1Client.html#a25e68b3da452c79b701993ea2bfa17c2">AMPS::Client::getLogonCorrelationData</a></div><div class="ttdeci">const std::string &amp; getLogonCorrelationData() const </div><div class="ttdoc">Returns the currently set logon correlation data for the client. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5171</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_acf032d7a0f4b3f6c50bfee9b0f83d00d"><div class="ttname"><a href="classAMPS_1_1Client.html#acf032d7a0f4b3f6c50bfee9b0f83d00d">AMPS::Client::setHeartbeat</a></div><div class="ttdeci">void setHeartbeat(unsigned heartbeatTime_, unsigned readTimeout_)</div><div class="ttdoc">Requests heartbeating with the AMPS server. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6919</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a036e74005b6221c1ffbdad734eda9588"><div class="ttname"><a href="classAMPS_1_1Command.html#a036e74005b6221c1ffbdad734eda9588">AMPS::Command::setTopN</a></div><div class="ttdeci">Command &amp; setTopN(unsigned topN_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:826</div></div>
<div class="ttc" id="amps_8h_html_a7bc2d5213a2a07234287fe191c19bae1"><div class="ttname"><a href="amps_8h.html#a7bc2d5213a2a07234287fe191c19bae1">amps_client_set_read_timeout</a></div><div class="ttdeci">AMPSDLL amps_result amps_client_set_read_timeout(amps_handle client, int readTimeout)</div><div class="ttdoc">Sets a read timeout (seconds), in which if no message is received, the connection is presumed dead...</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a5f251b42fa95e5e99d514be8646ed407"><div class="ttname"><a href="classAMPS_1_1Client.html#a5f251b42fa95e5e99d514be8646ed407">AMPS::Client::getURI</a></div><div class="ttdeci">const std::string &amp; getURI() const </div><div class="ttdoc">Returns the last URI this client is connected to. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5231</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_adb6b8d41f238cae8188bc120f09d0860"><div class="ttname"><a href="classAMPS_1_1Command.html#adb6b8d41f238cae8188bc120f09d0860">AMPS::Command::addAckType</a></div><div class="ttdeci">Command &amp; addAckType(const std::string &amp;ackType_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:857</div></div>
<div class="ttc" id="classAMPS_1_1Store_html_a061742652521bbbf91709703cd75f8cc"><div class="ttname"><a href="classAMPS_1_1Store.html#a061742652521bbbf91709703cd75f8cc">AMPS::Store::replay</a></div><div class="ttdeci">void replay(StoreReplayer &amp;replayer_)</div><div class="ttdoc">Called by Client to get all stored and non-discarded messages replayed by the store onto the StoreRep...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1221</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a2b010c7f6e163a4ba2dfa59bd6257494"><div class="ttname"><a href="classAMPS_1_1Client.html#a2b010c7f6e163a4ba2dfa59bd6257494">AMPS::Client::BOOKMARK_MOST_RECENT</a></div><div class="ttdeci">static const char * BOOKMARK_MOST_RECENT()</div><div class="ttdoc">Convenience method for returning the special value to start a subscription at a recovery point based ...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7057</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a5bfe27b946a745eac652586d09e71438"><div class="ttname"><a href="classAMPS_1_1Message.html#a5bfe27b946a745eac652586d09e71438">AMPS::Message::setBookmark</a></div><div class="ttdeci">Message &amp; setBookmark(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the Bookmark header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1194</div></div>
<div class="ttc" id="classAMPS_1_1Field_html_a6ddfd1486e7bdb967e57eca5c963f1b3"><div class="ttname"><a href="classAMPS_1_1Field.html#a6ddfd1486e7bdb967e57eca5c963f1b3">AMPS::Field::deepCopy</a></div><div class="ttdeci">void deepCopy(const Field &amp;orig_)</div><div class="ttdoc">Makes self a deep copy of the original field. </div><div class="ttdef"><b>Definition:</b> Field.hpp:218</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_a8dc288f3f9fb70f39783939a32f2c0f1"><div class="ttname"><a href="classAMPS_1_1Command.html#a8dc288f3f9fb70f39783939a32f2c0f1">AMPS::Command::setOrderBy</a></div><div class="ttdeci">Command &amp; setOrderBy(const char *orderBy_, size_t orderByLen_)</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:681</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a7d58a2c39f59d6fca098efd4bb81d3b5"><div class="ttname"><a href="classAMPS_1_1Message.html#a7d58a2c39f59d6fca098efd4bb81d3b5">AMPS::Message::getAckTypeEnum</a></div><div class="ttdeci">unsigned getAckTypeEnum() const </div><div class="ttdoc">Decode self&amp;#39;s &quot;ack type&quot; field and return the corresponding bitmask of values from AckType...</div><div class="ttdef"><b>Definition:</b> Message.hpp:1160</div></div>
<div class="ttc" id="classAMPS_1_1BookmarkStore_html_ab3463f69d9afcf2b9fc2fcd2a9a92dbc"><div class="ttname"><a href="classAMPS_1_1BookmarkStore.html#ab3463f69d9afcf2b9fc2fcd2a9a92dbc">AMPS::BookmarkStore::get</a></div><div class="ttdeci">BookmarkStoreImpl * get()</div><div class="ttdoc">Used to get a pointer to the implementation. </div><div class="ttdef"><b>Definition:</b> BookmarkStore.hpp:465</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a2f07a7bad9e20121880caabab6fbca18"><div class="ttname"><a href="classAMPS_1_1Client.html#a2f07a7bad9e20121880caabab6fbca18">AMPS::Client::getHandle</a></div><div class="ttdeci">amps_handle getHandle()</div><div class="ttdoc">Returns the underlying amps_handle for this client, to be used with amps_client_* functions from the ...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6860</div></div>
<div class="ttc" id="amps_8h_html_a68540fe2dee66d424783377b04aacca4"><div class="ttname"><a href="amps_8h.html#a68540fe2dee66d424783377b04aacca4">amps_client_attempt_reconnect</a></div><div class="ttdeci">AMPSDLL amps_result amps_client_attempt_reconnect(amps_handle client, unsigned version)</div><div class="ttdoc">Manually invokes the user-supplied disconnect handler for this client. </div></div>
<div class="ttc" id="amps_8h_html_a24ba31c24748140d5e4870c33aab2fbd"><div class="ttname"><a href="amps_8h.html#a24ba31c24748140d5e4870c33aab2fbd">amps_client_destroy</a></div><div class="ttdeci">AMPSDLL void amps_client_destroy(amps_handle handle)</div><div class="ttdoc">Disconnects and destroys an AMPS client object. </div></div>
<div class="ttc" id="classAMPS_1_1__FIXBuilder_html_a9c68c4632ca5b644f0e664190a40d27d"><div class="ttname"><a href="classAMPS_1_1__FIXBuilder.html#a9c68c4632ca5b644f0e664190a40d27d">AMPS::_FIXBuilder::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdoc">Clear all data from the builder. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:8135</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a324b2eb19cdf02d77cede593541e9002"><div class="ttname"><a href="classAMPS_1_1Client.html#a324b2eb19cdf02d77cede593541e9002">AMPS::Client::setFailedWriteHandler</a></div><div class="ttdeci">void setFailedWriteHandler(FailedWriteHandler *handler_)</div><div class="ttdoc">Set the handler that is invoked to report when a publish fails, for example if the publisher is not e...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5473</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a3b86d941a9dfd237670d8d20c7cad1f3"><div class="ttname"><a href="classAMPS_1_1Client.html#a3b86d941a9dfd237670d8d20c7cad1f3">AMPS::Client::sowAndDeltaSubscribe</a></div><div class="ttdeci">MessageStream sowAndDeltaSubscribe(const char *topic_, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;orderBy_=&quot;&quot;, int batchSize_=DEFAULT_BATCH_SIZE, int topN_=DEFAULT_TOP_N, const std::string &amp;options_=&quot;&quot;, long timeout_=DEFAULT_COMMAND_TIMEOUT)</div><div class="ttdoc">Query the SOW cache of a topic and initiates a new delta subscription on it. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6507</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_ae057c12e3630bc78660313de0819d7ba"><div class="ttname"><a href="classAMPS_1_1Client.html#ae057c12e3630bc78660313de0819d7ba">AMPS::Client::setAckTimeout</a></div><div class="ttdeci">void setAckTimeout(const int ackTimeout_)</div><div class="ttdoc">Sets the message queue ack timeout value. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7339</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_ad92fd7193d751b22bb5798d61e82869a"><div class="ttname"><a href="classAMPS_1_1Command.html#ad92fd7193d751b22bb5798d61e82869a">AMPS::Command::setSowKeys</a></div><div class="ttdeci">Command &amp; setSowKeys(const std::string &amp;sowKeys_)</div><div class="ttdoc">Sets the SowKeys for the command. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:611</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a703caed4d3de9b343c1695e3d0e7b662"><div class="ttname"><a href="classAMPS_1_1Message.html#a703caed4d3de9b343c1695e3d0e7b662">AMPS::Message::setPassword</a></div><div class="ttdeci">Message &amp; setPassword(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the Password header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1416</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a5ef8782925a6ec46e9f77a282ee14ef7"><div class="ttname"><a href="classAMPS_1_1Client.html#a5ef8782925a6ec46e9f77a282ee14ef7">AMPS::Client::getAutoAck</a></div><div class="ttdeci">bool getAutoAck(void) const </div><div class="ttdoc">Returns the value of the queue auto-ack setting. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7288</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a3a81db5a4818f1d3ddf119b13f93133d"><div class="ttname"><a href="classAMPS_1_1Client.html#a3a81db5a4818f1d3ddf119b13f93133d">AMPS::Client::publish</a></div><div class="ttdeci">amps_uint64_t publish(const std::string &amp;topic_, const std::string &amp;data_)</div><div class="ttdoc">Publish a message to an AMPS topic, returning the sequence number assigned by the publish store if on...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5504</div></div>
<div class="ttc" id="namespaceAMPS_html"><div class="ttname"><a href="namespaceAMPS.html">AMPS</a></div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:106</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a35592f4b12faeabff94450d74902a6c5"><div class="ttname"><a href="classAMPS_1_1Client.html#a35592f4b12faeabff94450d74902a6c5">AMPS::Client::setName</a></div><div class="ttdeci">void setName(const std::string &amp;name)</div><div class="ttdoc">Sets the name of this client, assuming no name was provided previously. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5130</div></div>
<div class="ttc" id="classAMPS_1_1Authenticator_html"><div class="ttname"><a href="classAMPS_1_1Authenticator.html">AMPS::Authenticator</a></div><div class="ttdoc">The interface for handling authentication with the AMPS server. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:968</div></div>
<div class="ttc" id="classAMPS_1_1Store_html_ab074d36fc26325c59630e90c5bd871b4"><div class="ttname"><a href="classAMPS_1_1Store.html#ab074d36fc26325c59630e90c5bd871b4">AMPS::Store::flush</a></div><div class="ttdeci">void flush(long timeout_=0)</div><div class="ttdoc">Method to wait for the Store to discard everything that has been stored up to the point in time when ...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1263</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_a7108ef0b54bc76e43dc4d49d700dc8ef"><div class="ttname"><a href="classAMPS_1_1Message.html#a7108ef0b54bc76e43dc4d49d700dc8ef">AMPS::Message::getBookmark</a></div><div class="ttdeci">Field getBookmark() const </div><div class="ttdoc">Retrieves the value of the Bookmark header of the Message as a new Field. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1194</div></div>
<div class="ttc" id="ampsplusplus_8hpp_html_a9bb281004cdd51708ed2e971f344c972"><div class="ttname"><a href="ampsplusplus_8hpp.html#a9bb281004cdd51708ed2e971f344c972">AMPS::DangerousFlushPublishStoreResizeHandler</a></div><div class="ttdeci">bool DangerousFlushPublishStoreResizeHandler(Store store_, size_t, void *data_)</div><div class="ttdoc">PublishStoreResizeHandler that will block up to the timeout specified in user data milliseconds tryin...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1373</div></div>
<div class="ttc" id="classAMPS_1_1StoreImpl_html_a23e0d9dc3d5fbb2c45a1c990c9606cab"><div class="ttname"><a href="classAMPS_1_1StoreImpl.html#a23e0d9dc3d5fbb2c45a1c990c9606cab">AMPS::StoreImpl::getUnsetSequence</a></div><div class="ttdeci">static amps_uint64_t getUnsetSequence()</div><div class="ttdoc">Method to return the value used to represent no such sequence. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:1129</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_abff58b407ee65fa3ba3bc30a0a901b37"><div class="ttname"><a href="classAMPS_1_1Command.html#abff58b407ee65fa3ba3bc30a0a901b37">AMPS::Command::setCorrelationId</a></div><div class="ttdeci">Command &amp; setCorrelationId(const char *correlationId_, size_t correlationIdLen_)</div><div class="ttdoc">Set the correlation ID for this command. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:751</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a044b964fa6d8d6168ff6ef2d3263a508"><div class="ttname"><a href="classAMPS_1_1Client.html#a044b964fa6d8d6168ff6ef2d3263a508">AMPS::Client::sow</a></div><div class="ttdeci">MessageStream sow(const char *topic_, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;orderBy_=&quot;&quot;, const std::string &amp;bookmark_=&quot;&quot;, int batchSize_=DEFAULT_BATCH_SIZE, int topN_=DEFAULT_TOP_N, const std::string &amp;options_=&quot;&quot;, long timeout_=DEFAULT_COMMAND_TIMEOUT)</div><div class="ttdoc">Query the SOW cache of a topic. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6153</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a1314726e3e71a30c068f911d7e20d221"><div class="ttname"><a href="classAMPS_1_1Client.html#a1314726e3e71a30c068f911d7e20d221">AMPS::Client::publish</a></div><div class="ttdeci">amps_uint64_t publish(const std::string &amp;topic_, const std::string &amp;data_, unsigned long expiration_)</div><div class="ttdoc">Publish a message to an AMPS topic, returning the sequence number assigned by the publish store (if a...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5553</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a2a65485a7ea933fde6765494436c0bd4"><div class="ttname"><a href="classAMPS_1_1Client.html#a2a65485a7ea933fde6765494436c0bd4">AMPS::Client::setLastChanceMessageHandler</a></div><div class="ttdeci">void setLastChanceMessageHandler(const AMPS::MessageHandler &amp;messageHandler)</div><div class="ttdoc">Sets the message handler called when no other handler matches. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6956</div></div>
<div class="ttc" id="classAMPS_1_1BookmarkStore_html_aec9e0485c22cf800e90327bcb5ac01a9"><div class="ttname"><a href="classAMPS_1_1BookmarkStore.html#aec9e0485c22cf800e90327bcb5ac01a9">AMPS::BookmarkStore::getMostRecent</a></div><div class="ttdeci">Message::Field getMostRecent(const Message::Field &amp;subId_)</div><div class="ttdoc">Returns the most recent bookmark from the log that ought to be used for (re-)subscriptions. </div><div class="ttdef"><b>Definition:</b> BookmarkStore.hpp:310</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a9a387e08e23ec67d9d4faa670fc07def"><div class="ttname"><a href="classAMPS_1_1Client.html#a9a387e08e23ec67d9d4faa670fc07def">AMPS::Client::deltaPublish</a></div><div class="ttdeci">amps_uint64_t deltaPublish(const char *topic_, size_t topicLength_, const char *data_, size_t dataLength_, unsigned long expiration_)</div><div class="ttdoc">Publish the changed fields of a message to an AMPS topic. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5719</div></div>
<div class="ttc" id="amps_8h_html_a684390c2bf8c56d49e8e2d4dc715bb04a867ac1b88eb736ddae182279d2788aea"><div class="ttname"><a href="amps_8h.html#a684390c2bf8c56d49e8e2d4dc715bb04a867ac1b88eb736ddae182279d2788aea">AMPS_E_DISCONNECTED</a></div><div class="ttdoc">The client and server are disconnected. </div><div class="ttdef"><b>Definition:</b> amps.h:233</div></div>
<div class="ttc" id="group__async_html_ga27b3bda1529246c2498d1fc1b7262a35"><div class="ttname"><a href="group__async.html#ga27b3bda1529246c2498d1fc1b7262a35">AMPS::Client::sowDeleteByData</a></div><div class="ttdeci">Message sowDeleteByData(const std::string &amp;topic_, const std::string &amp;data_, long timeout_=0)</div><div class="ttdoc">Deletes the message whose keys match the message data provided. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6836</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a18c7e4a46d8842d780e999d211a05bdb"><div class="ttname"><a href="classAMPS_1_1Client.html#a18c7e4a46d8842d780e999d211a05bdb">AMPS::Client::deltaSubscribe</a></div><div class="ttdeci">std::string deltaSubscribe(const MessageHandler &amp;messageHandler_, const std::string &amp;topic_, long timeout_, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;options_=&quot;&quot;, const std::string &amp;subId_=&quot;&quot;)</div><div class="ttdoc">Delta Subscribe to a topic. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5892</div></div>
<div class="ttc" id="classAMPS_1_1MessageStream_html_a6c5a0f16a137b7472ac12f8f59b070a4"><div class="ttname"><a href="classAMPS_1_1MessageStream.html#a6c5a0f16a137b7472ac12f8f59b070a4">AMPS::MessageStream::timeout</a></div><div class="ttdeci">MessageStream timeout(unsigned timeout_)</div><div class="ttdoc">Sets the maximum time to wait for the next message in milliseconds; if no message is available within...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:8695</div></div>
<div class="ttc" id="group__async_html_ga6d857b62c7e4821e0940d742aaf78a3b"><div class="ttname"><a href="group__async.html#ga6d857b62c7e4821e0940d742aaf78a3b">AMPS::Client::sow</a></div><div class="ttdeci">std::string sow(const MessageHandler &amp;messageHandler_, const std::string &amp;topic_, long timeout_, const std::string &amp;filter_=&quot;&quot;, int batchSize_=DEFAULT_BATCH_SIZE, int topN_=DEFAULT_TOP_N)</div><div class="ttdoc">Query the SOW cache of a topic. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6194</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_af16fd9fccdbf0ae84c2b11544a989f58"><div class="ttname"><a href="classAMPS_1_1Client.html#af16fd9fccdbf0ae84c2b11544a989f58">AMPS::Client::getName</a></div><div class="ttdeci">const std::string &amp; getName() const </div><div class="ttdoc">Returns the name of this client passed in the constructor. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5137</div></div>
<div class="ttc" id="classAMPS_1_1Command_html"><div class="ttname"><a href="classAMPS_1_1Command.html">AMPS::Command</a></div><div class="ttdoc">Command is an encapsulation of a single AMPS command sent by the client. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:441</div></div>
<div class="ttc" id="group__async_html_ga63480893c8f42da69207c0492a4c67fd"><div class="ttname"><a href="group__async.html#ga63480893c8f42da69207c0492a4c67fd">AMPS::Client::sowAndSubscribe</a></div><div class="ttdeci">std::string sowAndSubscribe(const MessageHandler &amp;messageHandler_, const std::string &amp;topic_, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;orderBy_=&quot;&quot;, const std::string &amp;bookmark_=&quot;&quot;, int batchSize_=DEFAULT_BATCH_SIZE, int topN_=DEFAULT_TOP_N, const std::string &amp;options_=&quot;&quot;, long timeout_=DEFAULT_COMMAND_TIMEOUT)</div><div class="ttdoc">Query the SOW cache of a topic and initiates a new subscription on it. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6344</div></div>
<div class="ttc" id="classAMPS_1_1Message_html_ae70b22f7c5a65f058e25fa9b4ccbca20"><div class="ttname"><a href="classAMPS_1_1Message.html#ae70b22f7c5a65f058e25fa9b4ccbca20">AMPS::Message::setBatchSize</a></div><div class="ttdeci">Message &amp; setBatchSize(const std::string &amp;v)</div><div class="ttdoc">Sets the value of the BatchSize header for this Message. </div><div class="ttdef"><b>Definition:</b> Message.hpp:1193</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a0f6697e1965a6a9f9276b3734364a1b7"><div class="ttname"><a href="classAMPS_1_1Client.html#a0f6697e1965a6a9f9276b3734364a1b7">AMPS::Client::subscribe</a></div><div class="ttdeci">MessageStream subscribe(const std::string &amp;topic_, long timeout_=0, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;options_=&quot;&quot;, const std::string &amp;subId_=&quot;&quot;)</div><div class="ttdoc">Subscribe to a topic. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5831</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a8f525689e0e6f80f824b8592042522b4"><div class="ttname"><a href="classAMPS_1_1Client.html#a8f525689e0e6f80f824b8592042522b4">AMPS::Client::bookmarkSubscribe</a></div><div class="ttdeci">MessageStream bookmarkSubscribe(const char *topic_, long timeout_, const std::string &amp;bookmark_, const std::string &amp;filter_=&quot;&quot;, const std::string &amp;options_=&quot;&quot;, const std::string &amp;subId_=&quot;&quot;)</div><div class="ttdoc">Subscribe to a topic using a bookmark. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6019</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_ad69da394a06b70a520377454c2c295f9"><div class="ttname"><a href="classAMPS_1_1Command.html#ad69da394a06b70a520377454c2c295f9">AMPS::Command::setSowKey</a></div><div class="ttdeci">Command &amp; setSowKey(const std::string &amp;sowKey_)</div><div class="ttdoc">Sets the SowKey field of the command, typically used for a publish command to a topic in the state of...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:581</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a9015b26fa1b16c4c1fbf497392309ad3"><div class="ttname"><a href="classAMPS_1_1Client.html#a9015b26fa1b16c4c1fbf497392309ad3">AMPS::Client::executeAsyncNoResubscribe</a></div><div class="ttdeci">std::string executeAsyncNoResubscribe(Command &amp;command_, MessageHandler handler_)</div><div class="ttdoc">Execute the provided command and, once AMPS acknowledges the command, process messages in response to...</div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7169</div></div>
<div class="ttc" id="classAMPS_1_1Command_html_aac68ea7a5194fc37ea7fce24e6f1b2e2"><div class="ttname"><a href="classAMPS_1_1Command.html#aac68ea7a5194fc37ea7fce24e6f1b2e2">AMPS::Command::setCorrelationId</a></div><div class="ttdeci">Command &amp; setCorrelationId(const std::string &amp;correlationId_)</div><div class="ttdoc">Set the correlation ID for this command. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:739</div></div>
<div class="ttc" id="group__async_html_ga17ba8a07934eb1b824879fed7da510fa"><div class="ttname"><a href="group__async.html#ga17ba8a07934eb1b824879fed7da510fa">AMPS::Client::sowDelete</a></div><div class="ttdeci">std::string sowDelete(const MessageHandler &amp;messageHandler, const std::string &amp;topic, const std::string &amp;filter, long timeout)</div><div class="ttdoc">Deletes one or more messages from a topic&amp;#39;s SOW cache. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6668</div></div>
<div class="ttc" id="classAMPS_1_1MessageStream_html_af18bb3867d6f394cb215ef7dadaf4818"><div class="ttname"><a href="classAMPS_1_1MessageStream.html#af18bb3867d6f394cb215ef7dadaf4818">AMPS::MessageStream::end</a></div><div class="ttdeci">iterator end(void)</div><div class="ttdoc">Returns an iterator representing the end of the topic or subscription. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:5007</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a556de384cdf274287d68e70699a0221d"><div class="ttname"><a href="classAMPS_1_1Client.html#a556de384cdf274287d68e70699a0221d">AMPS::Client::getRetryOnDisconnect</a></div><div class="ttdeci">bool getRetryOnDisconnect(void) const </div><div class="ttdoc">Returns true if automatic retry of a command to AMPS after a reconnect is enabled. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7366</div></div>
<div class="ttc" id="classAMPS_1_1Client_html_a0a1253c506311beec21e2ff6acc5e167"><div class="ttname"><a href="classAMPS_1_1Client.html#a0a1253c506311beec21e2ff6acc5e167">AMPS::Client::flushAcks</a></div><div class="ttdeci">void flushAcks(void)</div><div class="ttdoc">Sends any queued message queue ack messages to the server immediately. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:7279</div></div>
<div class="ttc" id="group__async_html_ga85464b780acd55106a61b29ac812affc"><div class="ttname"><a href="group__async.html#ga85464b780acd55106a61b29ac812affc">AMPS::Client::sowAndSubscribe</a></div><div class="ttdeci">std::string sowAndSubscribe(const MessageHandler &amp;messageHandler_, const std::string &amp;topic_, long timeout_, const std::string &amp;filter_=&quot;&quot;, int batchSize_=DEFAULT_BATCH_SIZE, bool oofEnabled_=false, int topN_=DEFAULT_TOP_N)</div><div class="ttdoc">Query the SOW cache of a topic and initiates a new subscription on it. </div><div class="ttdef"><b>Definition:</b> ampsplusplus.hpp:6226</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_f7d6cfa3eaf5b0ef385da843b1e654a8.html">amps</a></li><li class="navelem"><a class="el" href="ampsplusplus_8hpp.html">ampsplusplus.hpp</a></li>
    <li class="footer">Generated on Mon Oct 9 2023 18:11:31 for AMPS C/C++ Client Class Reference by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
